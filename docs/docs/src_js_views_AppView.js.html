<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>MetacatUI Dev Docs: Source: src/js/views/AppView.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
    <link type="text/css" rel="stylesheet" href="/metacatui/assets/css/styles.css">
    <link type="text/css" rel="stylesheet" href="styles/style.css">
</head>

<body>

<nav id="nav">
    <a href="/">
      <div class="logo">
<svg class="cat" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="cat" class="svg-inline--fa fa-cat fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M290.59 192c-20.18 0-106.82 1.98-162.59 85.95V192c0-52.94-43.06-96-96-96-17.67 0-32 14.33-32 32s14.33 32 32 32c17.64 0 32 14.36 32 32v256c0 35.3 28.7 64 64 64h176c8.84 0 16-7.16 16-16v-16c0-17.67-14.33-32-32-32h-32l128-96v144c0 8.84 7.16 16 16 16h32c8.84 0 16-7.16 16-16V289.86c-10.29 2.67-20.89 4.54-32 4.54-61.81 0-113.52-44.05-125.41-102.4zM448 96h-64l-64-64v134.4c0 53.02 42.98 96 96 96s96-42.98 96-96V32l-64 64zm-72 80c-8.84 0-16-7.16-16-16s7.16-16 16-16 16 7.16 16 16-7.16 16-16 16zm80 0c-8.84 0-16-7.16-16-16s7.16-16 16-16 16 7.16 16 16-7.16 16-16 16z"></path></svg>

<svg width="459px" height="53px" viewBox="0 0 459 53" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
    <g id="metacatui" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
        <path d="M16.492,52 C17.212,52 17.812,51.748 18.292,51.244 C18.772,50.74 19.012,50.128 19.012,49.408 L19.012,49.408 L18.94,22.912 L30.82,37.816 C31.204,38.344 31.72,38.764 32.368,39.076 C33.016,39.388 33.7,39.544 34.42,39.544 C35.908,39.544 37.132,38.896 38.092,37.6 L38.092,37.6 L49.684,22.912 L49.684,49.408 C49.684,50.128 49.96,50.74 50.512,51.244 C51.064,51.748 51.7,52 52.42,52 L52.42,52 L62.068,52 C62.788,52 63.388,51.748 63.868,51.244 C64.348,50.74 64.588,50.128 64.588,49.408 L64.588,49.408 L64.588,4.12 C64.588,3.448 64.336,2.86 63.832,2.356 C63.328,1.852 62.74,1.6 62.068,1.6 L62.068,1.6 L52.348,1.6 C51.388,1.6 50.56,1.648 49.864,1.744 C49.168,1.84 48.532,2.152 47.956,2.68 L47.956,2.68 L33.916,17.296 L20.524,2.608 C20.332,2.368 19.972,2.14 19.444,1.924 C18.916,1.708 18.412,1.6 17.932,1.6 L17.932,1.6 L6.772,1.6 C6.052,1.6 5.44,1.852 4.936,2.356 C4.432,2.86 4.18,3.448 4.18,4.12 L4.18,4.12 L4.18,49.408 C4.18,50.08 4.432,50.68 4.936,51.208 C5.44,51.736 6.052,52 6.772,52 L6.772,52 L16.492,52 Z M110.74,52 C111.556,52 112.264,51.676 112.864,51.028 C113.464,50.38 113.764,49.624 113.764,48.76 L113.764,48.76 L113.764,42.568 C113.764,41.608 113.464,40.828 112.864,40.228 C112.264,39.628 111.556,39.328 110.74,39.328 L110.74,39.328 L89.428,39.328 L89.428,32.92 L109.732,32.92 C110.5,32.92 111.184,32.596 111.784,31.948 C112.384,31.3 112.684,30.568 112.684,29.752 L112.684,29.752 L112.684,23.488 C112.684,22.576 112.384,21.82 111.784,21.22 C111.184,20.62 110.5,20.32 109.732,20.32 L109.732,20.32 L89.428,20.32 L89.428,14.488 L110.74,14.488 C111.508,14.488 112.204,14.164 112.828,13.516 C113.452,12.868 113.764,12.136 113.764,11.32 L113.764,11.32 L113.764,5.056 C113.764,4.144 113.464,3.388 112.864,2.788 C112.264,2.188 111.556,1.888 110.74,1.888 L110.74,1.888 L76.756,1.888 C75.94,1.888 75.232,2.188 74.632,2.788 C74.032,3.388 73.732,4.144 73.732,5.056 L73.732,5.056 L73.732,48.76 C73.732,49.624 74.032,50.38 74.632,51.028 C75.232,51.676 75.94,52 76.756,52 L76.756,52 L110.74,52 Z M147.604,52 C148.42,52 149.104,51.688 149.656,51.064 C150.208,50.44 150.484,49.672 150.484,48.76 L150.484,48.76 L150.484,16.216 L161.86,16.216 C162.676,16.216 163.396,15.904 164.02,15.28 C164.644,14.656 164.956,13.936 164.956,13.12 L164.956,13.12 L164.956,4.768 C164.956,4 164.644,3.316 164.02,2.716 C163.396,2.116 162.676,1.816 161.86,1.816 L161.86,1.816 L124.132,1.816 C123.22,1.816 122.464,2.104 121.864,2.68 C121.264,3.256 120.964,3.952 120.964,4.768 L120.964,4.768 L120.964,13.12 C120.964,13.936 121.264,14.656 121.864,15.28 C122.464,15.904 123.22,16.216 124.132,16.216 L124.132,16.216 L135.652,16.216 L135.148,48.832 C135.148,49.744 135.424,50.5 135.976,51.1 C136.528,51.7 137.212,52 138.028,52 L138.028,52 L147.604,52 Z M175.828,52 C176.836,52 177.676,51.82 178.348,51.46 C179.02,51.1 179.452,50.584 179.644,49.912 L179.644,49.912 L181.876,42.712 L197.932,42.712 L200.164,49.912 C200.356,50.584 200.8,51.1 201.496,51.46 C202.192,51.82 203.044,52 204.052,52 L204.052,52 L213.916,52 C215.836,51.712 216.796,50.704 216.796,48.976 C216.796,48.304 216.676,47.596 216.436,46.852 C216.196,46.108 216.052,45.616 216.004,45.376 L216.004,45.376 L199.876,4.84 C199.588,3.976 199.036,3.232 198.22,2.608 C197.404,1.984 196.372,1.648 195.124,1.6 L195.124,1.6 L184.756,1.6 C183.604,1.648 182.608,1.948 181.768,2.5 C180.928,3.052 180.292,3.832 179.86,4.84 L179.86,4.84 L163.876,45.376 C163.828,45.472 163.672,45.916 163.408,46.708 C163.144,47.5 163.012,48.304 163.012,49.12 C163.012,50.752 163.948,51.712 165.82,52 L165.82,52 L175.828,52 Z M195.34,30.544 L184.036,30.544 L189.652,13.624 L195.34,30.544 Z M245.38,53.08 C250.612,53.08 255.652,51.544 260.5,48.472 C261.22,47.944 261.58,47.296 261.58,46.528 C261.58,45.808 261.292,45.16 260.716,44.584 L260.716,44.584 L252.796,36.808 C252.364,36.376 251.836,36.16 251.212,36.16 C250.78,36.16 250.372,36.256 249.988,36.448 C248.356,37.12 246.796,37.456 245.308,37.456 C243.244,37.456 241.348,36.952 239.62,35.944 C237.892,34.936 236.512,33.58 235.48,31.876 C234.448,30.172 233.932,28.336 233.932,26.368 C233.932,24.352 234.436,22.504 235.444,20.824 C236.452,19.144 237.832,17.812 239.584,16.828 C241.336,15.844 243.244,15.352 245.308,15.352 C246.892,15.352 248.332,15.64 249.628,16.216 C250.012,16.408 250.444,16.504 250.924,16.504 C251.548,16.504 252.1,16.264 252.58,15.784 L252.58,15.784 L259.636,8.008 C260.164,7.384 260.428,6.76 260.428,6.136 C260.428,5.224 259.996,4.528 259.132,4.048 C254.86,1.552 250.276,0.304 245.38,0.304 C240.532,0.304 236.032,1.492 231.88,3.868 C227.728,6.244 224.44,9.448 222.016,13.48 C219.592,17.512 218.38,21.904 218.38,26.656 C218.38,31.408 219.592,35.812 222.016,39.868 C224.44,43.924 227.728,47.14 231.88,49.516 C236.032,51.892 240.532,53.08 245.38,53.08 Z M279.796,52 C280.804,52 281.644,51.82 282.316,51.46 C282.988,51.1 283.42,50.584 283.612,49.912 L283.612,49.912 L285.844,42.712 L301.9,42.712 L304.132,49.912 C304.324,50.584 304.768,51.1 305.464,51.46 C306.16,51.82 307.012,52 308.02,52 L308.02,52 L317.884,52 C319.804,51.712 320.764,50.704 320.764,48.976 C320.764,48.304 320.644,47.596 320.404,46.852 C320.164,46.108 320.02,45.616 319.972,45.376 L319.972,45.376 L303.844,4.84 C303.556,3.976 303.004,3.232 302.188,2.608 C301.372,1.984 300.34,1.648 299.092,1.6 L299.092,1.6 L288.724,1.6 C287.572,1.648 286.576,1.948 285.736,2.5 C284.896,3.052 284.26,3.832 283.828,4.84 L283.828,4.84 L267.844,45.376 C267.796,45.472 267.64,45.916 267.376,46.708 C267.112,47.5 266.98,48.304 266.98,49.12 C266.98,50.752 267.916,51.712 269.788,52 L269.788,52 L279.796,52 Z M299.308,30.544 L288.004,30.544 L293.62,13.624 L299.308,30.544 Z M352.588,52 C353.404,52 354.088,51.688 354.64,51.064 C355.192,50.44 355.468,49.672 355.468,48.76 L355.468,48.76 L355.468,16.216 L366.844,16.216 C367.66,16.216 368.38,15.904 369.004,15.28 C369.628,14.656 369.94,13.936 369.94,13.12 L369.94,13.12 L369.94,4.768 C369.94,4 369.628,3.316 369.004,2.716 C368.38,2.116 367.66,1.816 366.844,1.816 L366.844,1.816 L329.116,1.816 C328.204,1.816 327.448,2.104 326.848,2.68 C326.248,3.256 325.948,3.952 325.948,4.768 L325.948,4.768 L325.948,13.12 C325.948,13.936 326.248,14.656 326.848,15.28 C327.448,15.904 328.204,16.216 329.116,16.216 L329.116,16.216 L340.636,16.216 L340.132,48.832 C340.132,49.744 340.408,50.5 340.96,51.1 C341.512,51.7 342.196,52 343.012,52 L343.012,52 L352.588,52 Z M402.052,52.792 C408.1,52.792 412.912,51.628 416.488,49.3 C420.064,46.972 422.536,44.068 423.904,40.588 C425.272,37.108 425.932,33.424 425.884,29.536 C425.884,29.5309474 425.883967,29.5237673 425.8839,29.5144598 L425.883102,29.4330859 C425.879911,29.1480111 425.868211,28.3183158 425.848,26.944 C425.8294,25.6792 425.818008,22.91524 425.813823,18.65212 L425.813103,17.80828 C425.812997,17.66452 425.8129,17.5192 425.81281,17.37232 L425.812,3.904 C425.86,3.184 425.632,2.62 425.128,2.212 C424.624,1.804 423.916,1.6 423.004,1.6 L423.004,1.6 L413.428,1.6 C412.612,1.6 411.904,1.828 411.304,2.284 C410.704,2.74 410.404,3.28 410.404,3.904 L410.404,3.904 L410.26,27.808 C410.26,34.144 407.476,37.312 401.908,37.312 C399.076,37.312 396.832,36.412 395.176,34.612 C393.52,32.812 392.668,30.352 392.62,27.232 L392.62,27.232 L392.332,3.76 C392.332,3.088 392.068,2.56 391.54,2.176 C391.012,1.792 390.268,1.6 389.308,1.6 L389.308,1.6 L379.876,1.6 C378.244,1.6 377.428,2.32 377.428,3.76 L377.428,3.76 L377.5,28.816 C377.5,33.04 378.376,36.964 380.128,40.588 C381.88,44.212 384.592,47.152 388.264,49.408 C391.936,51.664 396.532,52.792 402.052,52.792 Z M449.284,52.144 C450.148,52.144 450.88,51.844 451.48,51.244 C452.08,50.644 452.38,49.84 452.38,48.832 L452.38,48.832 L452.38,4.912 C452.38,4 452.08,3.22 451.48,2.572 C450.88,1.924 450.148,1.6 449.284,1.6 L449.284,1.6 L439.42,1.6 C438.46,1.6 437.692,1.924 437.116,2.572 C436.54,3.22 436.252,4 436.252,4.912 L436.252,4.912 L436.252,48.832 C436.252,49.84 436.54,50.644 437.116,51.244 C437.692,51.844 438.46,52.144 439.42,52.144 L439.42,52.144 L449.284,52.144 Z" id="metacatui" fill="#FCBF49" fill-rule="nonzero"></path>
    </g>
</svg>
</logo>

    </a>
    <h3>Namespaces</h3><ul><li><a href="AppConfig.html">AppConfig</a></li><li><a href="IconUtilities.html">IconUtilities</a></li><li><a href="MapConfig.html">MapConfig</a></li><li><a href="MetacatUI.html">MetacatUI</a></li><li><a href="Utilities.html">Utilities</a></li></ul><h3>Classes</h3><ul><li class='category-heading' data-category='Collections'>Collections</li><li><a href="AccessPolicy.html">AccessPolicy</a></li><li><a href="Citations.html">Citations</a></li><li><a href="DataPackage.html">DataPackage</a></li><li><a href="Filters.html">Filters</a></li><li><a href="ObjectFormats.html">ObjectFormats</a></li><li><a href="ProjectList.html">ProjectList</a></li><li><a href="QualityReport.html">QualityReport</a></li><li><a href="SolrResults.html">SolrResults</a></li><li><a href="Units.html">Units</a></li><li><a href="UserGroup.html">UserGroup</a></li><li class='category-heading' data-category='Collections/Bookkeeper'>Collections/Bookkeeper</li><li><a href="Quotas.html">Quotas</a></li><li><a href="Usages.html">Usages</a></li><li class='category-heading' data-category='Collections/Geohashes'>Collections/Geohashes</li><li><a href="Geohashes.html">Geohashes</a></li><li class='category-heading' data-category='Collections/Maps'>Collections/Maps</li><li><a href="AssetCategories.html">AssetCategories</a></li><li><a href="AssetColors.html">AssetColors</a></li><li><a href="Features.html">Features</a></li><li><a href="GeoPoints.html">GeoPoints</a></li><li><a href="MapAssets.html">MapAssets</a></li><li><a href="VectorFilters.html">VectorFilters</a></li><li><a href="ZoomPresets.html">ZoomPresets</a></li><li class='category-heading' data-category='Collections/Metadata/EML'>Collections/Metadata/EML</li><li><a href="EMLAnnotations.html">EMLAnnotations</a></li><li><a href="EMLMissingValueCodes.html">EMLMissingValueCodes</a></li><li class='category-heading' data-category='Collections/QueryFields'>Collections/QueryFields</li><li><a href="QueryFields.html">QueryFields</a></li><li class='category-heading' data-category='Models'>Models</li><li><a href="AccessRule.html">AccessRule</a></li><li><a href="AppModel.html">AppModel</a></li><li><a href="CitationModel.html">CitationModel</a></li><li><a href="CollectionModel.html">CollectionModel</a></li><li><a href="DataONEObject.html">DataONEObject</a></li><li><a href="LookupModel.html">LookupModel</a></li><li><a href="Map.html">Map</a></li><li><a href="Metrics.html">Metrics</a></li><li><a href="QualityCheck.html">QualityCheck</a></li><li><a href="Search.html">Search</a></li><li><a href="SolrResult.html">SolrResult</a></li><li><a href="Stats.html">Stats</a></li><li class='category-heading' data-category='Models/Analytics'>Models/Analytics</li><li><a href="Analytics.html">Analytics</a></li><li><a href="GoogleAnalytics.html">GoogleAnalytics</a></li><li class='category-heading' data-category='Models/Bookkeeper'>Models/Bookkeeper</li><li><a href="Quota.html">Quota</a></li><li><a href="Subscription.html">Subscription</a></li><li><a href="Usage.html">Usage</a></li><li class='category-heading' data-category='Models/Connectors'>Models/Connectors</li><li><a href="FiltersMapConnector.html">FiltersMapConnector</a></li><li><a href="FiltersSearchConnector.html">FiltersSearchConnector</a></li><li><a href="GeoPointsCesiumConnector.html">GeoPointsCesiumConnector</a></li><li><a href="GeoPointsCesiumPointsConnector.html">GeoPointsCesiumPointsConnector</a></li><li><a href="GeoPointsCesiumPolygonConnector.html">GeoPointsCesiumPolygonConnector</a></li><li><a href="MapSearchConnector.html">MapSearchConnector</a></li><li><a href="MapSearchFiltersConnector.html">MapSearchFiltersConnector</a></li><li class='category-heading' data-category='Models/Filters'>Models/Filters</li><li><a href="BooleanFilter.html">BooleanFilter</a></li><li><a href="ChoiceFilter.html">ChoiceFilter</a></li><li><a href="DateFilter.html">DateFilter</a></li><li><a href="Filter.html">Filter</a></li><li><a href="FilterGroup.html">FilterGroup</a></li><li><a href="NumericFilter.html">NumericFilter</a></li><li><a href="SpatialFilter.html">SpatialFilter</a></li><li><a href="ToggleFilter.html">ToggleFilter</a></li><li class='category-heading' data-category='Models/Formats'>Models/Formats</li><li><a href="ObjectFormat.html">ObjectFormat</a></li><li class='category-heading' data-category='Models/Geocoder'>Models/Geocoder</li><li><a href="GeocodedLocation.html">GeocodedLocation</a></li><li><a href="GeocoderSearch.html">GeocoderSearch</a></li><li><a href="GoogleMapsAutocompleter.html">GoogleMapsAutocompleter</a></li><li><a href="GoogleMapsGeocoder.html">GoogleMapsGeocoder</a></li><li><a href="Prediction.html">Prediction</a></li><li class='category-heading' data-category='Models/Geohashes'>Models/Geohashes</li><li><a href="Geohash.html">Geohash</a></li><li class='category-heading' data-category='Models/Maps'>Models/Maps</li><li><a href="AssetCategory.html">AssetCategory</a></li><li><a href="AssetColor.html">AssetColor</a></li><li><a href="AssetColorPalette.html">AssetColorPalette</a></li><li><a href="ExpansionPanelsModel.html">ExpansionPanelsModel</a></li><li><a href="Feature.html">Feature</a></li><li><a href="GeoBoundingBox.html">GeoBoundingBox</a></li><li><a href="GeoPoint.html">GeoPoint</a></li><li><a href="GeoScale.html">GeoScale</a></li><li><a href="GeoUtilities.html">GeoUtilities</a></li><li><a href="MapInteraction.html">MapInteraction</a></li><li><a href="MapModel.html">MapModel</a></li><li><a href="VectorFilter.html">VectorFilter</a></li><li><a href="ViewfinderModel.html">ViewfinderModel</a></li><li><a href="ZoomPresetModel.html">ZoomPresetModel</a></li><li class='category-heading' data-category='Models/Maps/Assets'>Models/Maps/Assets</li><li><a href="Cesium3DTileset.html">Cesium3DTileset</a></li><li><a href="CesiumGeohash.html">CesiumGeohash</a></li><li><a href="CesiumImagery.html">CesiumImagery</a></li><li><a href="CesiumTerrain.html">CesiumTerrain</a></li><li><a href="CesiumVectorData.html">CesiumVectorData</a></li><li><a href="MapAsset.html">MapAsset</a></li><li class='category-heading' data-category='Models/Metadata'>Models/Metadata</li><li><a href="ScienceMetadata.html">ScienceMetadata</a></li><li class='category-heading' data-category='Models/Metadata/EML'>Models/Metadata/EML</li><li><a href="EMLMethodStep.html">EMLMethodStep</a></li><li><a href="EMLSpecializedText.html">EMLSpecializedText</a></li><li class='category-heading' data-category='Models/Metadata/EML211'>Models/Metadata/EML211</li><li><a href="EML211.html">EML211</a></li><li><a href="EMLAnnotation.html">EMLAnnotation</a></li><li><a href="EMLAttribute.html">EMLAttribute</a></li><li><a href="EMLDataTable.html">EMLDataTable</a></li><li><a href="EMLDistribution.html">EMLDistribution</a></li><li><a href="EMLEntity.html">EMLEntity</a></li><li><a href="EMLGeoCoverage.html">EMLGeoCoverage</a></li><li><a href="EMLMeasurementScale.html">EMLMeasurementScale</a></li><li><a href="EMLMethods.html">EMLMethods</a></li><li><a href="EMLMissingValueCode.html">EMLMissingValueCode</a></li><li><a href="EMLNonNumericDomain.html">EMLNonNumericDomain</a></li><li><a href="EMLNumericDomain.html">EMLNumericDomain</a></li><li><a href="EMLOtherEntity.html">EMLOtherEntity</a></li><li><a href="EMLParty.html">EMLParty</a></li><li><a href="EMLTemporalCoverage.html">EMLTemporalCoverage</a></li><li><a href="EMLText211.html">EMLText211</a></li><li><a href="EMLUnit.html">EMLUnit</a></li><li class='category-heading' data-category='Models/Metadata/EML220'>Models/Metadata/EML220</li><li><a href="EMLText.html">EMLText</a></li><li class='category-heading' data-category='Models/Portals'>Models/Portals</li><li><a href="PortalImage.html">PortalImage</a></li><li><a href="PortalModel.html">PortalModel</a></li><li><a href="PortalSectionModel.html">PortalSectionModel</a></li><li class='category-heading' data-category='Models/Projects'>Models/Projects</li><li><a href="Project.html">Project</a></li><li class='category-heading' data-category='Models/QueryFields'>Models/QueryFields</li><li><a href="QueryField.html">QueryField</a></li><li class='category-heading' data-category='Router'>Router</li><li><a href="UIRouter.html">UIRouter</a></li><li class='category-heading' data-category='Views'>Views</li><li><a href="AccessPolicyView.html">AccessPolicyView</a></li><li><a href="AccessRuleView.html">AccessRuleView</a></li><li><a href="AnnotationView.html">AnnotationView</a></li><li><a href="AppView.html">AppView</a></li><li><a href="CatalogSearchView.html">CatalogSearchView</a></li><li><a href="CitationHeaderView.html">CitationHeaderView</a></li><li><a href="CitationListView.html">CitationListView</a></li><li><a href="CitationModalView.html">CitationModalView</a></li><li><a href="CitationView.html">CitationView</a></li><li><a href="ColorPaletteView.html">ColorPaletteView</a></li><li><a href="DataCatalogViewWithFilters.html">DataCatalogViewWithFilters</a></li><li><a href="DataItemView.html">DataItemView</a></li><li><a href="DataPackageView.html">DataPackageView</a></li><li><a href="DraftsView.html">DraftsView</a></li><li><a href="EditCollectionView.html">EditCollectionView</a></li><li><a href="EditorView.html">EditorView</a></li><li><a href="FooterView.html">FooterView</a></li><li><a href="GroupListView.html">GroupListView</a></li><li><a href="ImageUploaderView.html">ImageUploaderView</a></li><li><a href="MarkdownEditorView.html">MarkdownEditorView</a></li><li><a href="MarkdownView.html">MarkdownView</a></li><li><a href="MdqRunView.html">MdqRunView</a></li><li><a href="MetadataView.html">MetadataView</a></li><li><a href="MetricModalView.html">MetricModalView</a></li><li><a href="MetricView.html">MetricView</a></li><li><a href="MetricsChartView.html">MetricsChartView</a></li><li><a href="NavbarView.html">NavbarView</a></li><li><a href="RegisterCitationView.html">RegisterCitationView</a></li><li><a href="SearchResultView.html">SearchResultView</a></li><li><a href="SignInView.html">SignInView</a></li><li><a href="TOCView.html">TOCView</a></li><li><a href="TableEditorView.html">TableEditorView</a></li><li><a href="UserGroupView.html">UserGroupView</a></li><li><a href="UserView.html">UserView</a></li><li class='category-heading' data-category='Views/Filters'>Views/Filters</li><li><a href="BooleanFilterView.html">BooleanFilterView</a></li><li><a href="ChoiceFilterView.html">ChoiceFilterView</a></li><li><a href="DateFilterView.html">DateFilterView</a></li><li><a href="FilterEditorView.html">FilterEditorView</a></li><li><a href="FilterGroupView.html">FilterGroupView</a></li><li><a href="FilterGroupsView.html">FilterGroupsView</a></li><li><a href="FilterView.html">FilterView</a></li><li><a href="NumericFilterView.html">NumericFilterView</a></li><li><a href="SemanticFilterView.html">SemanticFilterView</a></li><li><a href="ToggleFilterView.html">ToggleFilterView</a></li><li class='category-heading' data-category='Views/Maps'>Views/Maps</li><li><a href="CesiumWidgetView.html">CesiumWidgetView</a></li><li><a href="DrawTool.html">DrawTool</a></li><li><a href="FeatureInfoView.html">FeatureInfoView</a></li><li><a href="LayerCategoryItemView.html">LayerCategoryItemView</a></li><li><a href="LayerCategoryListView.html">LayerCategoryListView</a></li><li><a href="LayerDetailView.html">LayerDetailView</a></li><li><a href="LayerDetailsView.html">LayerDetailsView</a></li><li><a href="LayerInfoView.html">LayerInfoView</a></li><li><a href="LayerItemView.html">LayerItemView</a></li><li><a href="LayerListView.html">LayerListView</a></li><li><a href="LayerNavigationView.html">LayerNavigationView</a></li><li><a href="LayerOpacityView.html">LayerOpacityView</a></li><li><a href="LayersPanelView.html">LayersPanelView</a></li><li><a href="LegendView.html">LegendView</a></li><li><a href="MapHelpPanel.html">MapHelpPanel</a></li><li><a href="MapView.html">MapView</a></li><li><a href="PredictionView.html">PredictionView</a></li><li><a href="PredictionsListView.html">PredictionsListView</a></li><li><a href="ScaleBarView.html">ScaleBarView</a></li><li><a href="SearchInputView.html">SearchInputView</a></li><li><a href="SearchView.html">SearchView</a></li><li><a href="ToolbarView.html">ToolbarView</a></li><li><a href="ViewfinderView.html">ViewfinderView</a></li><li class='category-heading' data-category='Views/Maps/Viewfinder'>Views/Maps/Viewfinder</li><li><a href="ExpansionPanelView.html">ExpansionPanelView</a></li><li><a href="ZoomPresetView.html">ZoomPresetView</a></li><li><a href="ZoomPresetsListView.html">ZoomPresetsListView</a></li><li class='category-heading' data-category='Views/Metadata'>Views/Metadata</li><li><a href="EML211EditorView.html">EML211EditorView</a></li><li><a href="EMLAttributeView.html">EMLAttributeView</a></li><li><a href="EMLEntityView.html">EMLEntityView</a></li><li><a href="EMLMeasurementScaleView.html">EMLMeasurementScaleView</a></li><li><a href="EMLMeasurementTypeView.html">EMLMeasurementTypeView</a></li><li><a href="EMLMethodsView.html">EMLMethodsView</a></li><li><a href="EMLMissingValueCodeView.html">EMLMissingValueCodeView</a></li><li><a href="EMLMissingValueCodesView.html">EMLMissingValueCodesView</a></li><li><a href="EMLOtherEntityView.html">EMLOtherEntityView</a></li><li><a href="EMLPartyView.html">EMLPartyView</a></li><li><a href="EMLTempCoverageView.html">EMLTempCoverageView</a></li><li><a href="EMLView.html">EMLView</a></li><li><a href="EMlGeoCoverageView_.html">EMlGeoCoverageView</a></li><li><a href="ScienceMetadataView.html">ScienceMetadataView</a></li><li class='category-heading' data-category='Views/Portals'>Views/Portals</li><li><a href="PortalDataView.html">PortalDataView</a></li><li><a href="PortalHeaderView.html">PortalHeaderView</a></li><li><a href="PortalListView.html">PortalListView</a></li><li><a href="PortalLogosView.html">PortalLogosView</a></li><li><a href="PortalMembersView.html">PortalMembersView</a></li><li><a href="PortalSectionView.html">PortalSectionView</a></li><li><a href="PortalUsagesView.html">PortalUsagesView</a></li><li><a href="PortalView.html">PortalView</a></li><li><a href="PortalVisualizationsView.html">PortalVisualizationsView</a></li><li><a href="PortalsSearchView.html">PortalsSearchView</a></li><li class='category-heading' data-category='Views/Portals/Editor'>Views/Portals/Editor</li><li><a href="PortEditorDataView.html">PortEditorDataView</a></li><li><a href="PortEditorImageView.html">PortEditorImageView</a></li><li><a href="PortEditorLogosView.html">PortEditorLogosView</a></li><li><a href="PortEditorMdSectionView.html">PortEditorMdSectionView</a></li><li><a href="PortEditorSectionView.html">PortEditorSectionView</a></li><li><a href="PortEditorSectionsView.html">PortEditorSectionsView</a></li><li><a href="PortEditorSettingsView.html">PortEditorSettingsView</a></li><li><a href="PortalEditorView.html">PortalEditorView</a></li><li class='category-heading' data-category='Views/Projects'>Views/Projects</li><li><a href="ProjectView.html">ProjectView</a></li><li class='category-heading' data-category='Views/QueryBuilder'>Views/QueryBuilder</li><li><a href="QueryBuilderView.html">QueryBuilderView</a></li><li><a href="QueryRuleView.html">QueryRuleView</a></li><li class='category-heading' data-category='Views/Search'>Views/Search</li><li><a href="SearchResultsPagerView.html">SearchResultsPagerView</a></li><li><a href="SearchResultsView.html">SearchResultsView</a></li><li><a href="SorterView.html">SorterView</a></li><li class='category-heading' data-category='Views/SearchSelect'>Views/SearchSelect</li><li><a href="AccountSelectView.html">AccountSelectView</a></li><li><a href="AnnotationFilter.html">AnnotationFilter</a></li><li><a href="NodeSelect.html">NodeSelect</a></li><li><a href="ObjectFormatSelect.html">ObjectFormatSelect</a></li><li><a href="QueryFieldSelectView.html">QueryFieldSelectView</a></li><li><a href="SearchableSelectView.html">SearchableSelectView</a></li><li class='category-heading' data-category='Deprecated'>Deprecated</li><li><a href="AnnotatorView.html">AnnotatorView</a></li><li><a href="ExternalView.html">ExternalView</a></li><li><a href="LogsSearch.html">LogsSearch</a></li></ul><h3>Global</h3><ul><li><a href="global.html#appConfigPath">appConfigPath</a></li><li><a href="global.html#autocompleteSearch">autocompleteSearch</a></li><li><a href="global.html#blur">blur</a></li><li><a href="global.html#className">className</a></li><li><a href="global.html#classNames">classNames</a></li><li><a href="global.html#classificationsAreEqual">classificationsAreEqual</a></li><li><a href="global.html#clear">clear</a></li><li><a href="global.html#clearError">clearError</a></li><li><a href="global.html#couldBeLatLong">couldBeLatLong</a></li><li><a href="global.html#decrementFocusIndex">decrementFocusIndex</a></li><li><a href="global.html#defaults">defaults</a></li><li><a href="global.html#distLocations">distLocations</a></li><li><a href="global.html#events">events</a></li><li><a href="global.html#focus">focus</a></li><li><a href="global.html#focusInput">focusInput</a></li><li><a href="global.html#getCancelButtonContainer">getCancelButtonContainer</a></li><li><a href="global.html#getError">getError</a></li><li><a href="global.html#getInput">getInput</a></li><li><a href="global.html#getInputField">getInputField</a></li><li><a href="global.html#getInputValue">getInputValue</a></li><li><a href="global.html#getSearch">getSearch</a></li><li><a href="global.html#getSearchButton">getSearchButton</a></li><li><a href="global.html#getZoomPresets">getZoomPresets</a></li><li><a href="global.html#goToLocation">goToLocation</a></li><li><a href="global.html#hasValuesForDistributionLocation">hasValuesForDistributionLocation</a></li><li><a href="global.html#hideCancelAndDimSearch">hideCancelAndDimSearch</a></li><li><a href="global.html#incrementFocusIndex">incrementFocusIndex</a></li><li><a href="global.html#initialize">initialize</a></li><li><a href="global.html#isDuplicate">isDuplicate</a></li><li><a href="global.html#offlineNodes">offlineNodes</a></li><li><a href="global.html#onBlur">onBlur</a></li><li><a href="global.html#onCancel">onCancel</a></li><li><a href="global.html#onFocus">onFocus</a></li><li><a href="global.html#onKeydown">onKeydown</a></li><li><a href="global.html#onKeyup">onKeyup</a></li><li><a href="global.html#onSearch">onSearch</a></li><li><a href="global.html#onlineNodes">onlineNodes</a></li><li><a href="global.html#parse">parse</a></li><li><a href="global.html#removeDuplicateClassifications">removeDuplicateClassifications</a></li><li><a href="global.html#render">render</a></li><li><a href="global.html#renderSearchView">renderSearchView</a></li><li><a href="global.html#renderZoomPresetsView">renderZoomPresetsView</a></li><li><a href="global.html#resetFocusIndex">resetFocusIndex</a></li><li><a href="global.html#search">search</a></li><li><a href="global.html#select">select</a></li><li><a href="global.html#selectPrediction">selectPrediction</a></li><li><a href="global.html#selectZoomPreset">selectZoomPreset</a></li><li><a href="global.html#serialize">serialize</a></li><li><a href="global.html#setError">setError</a></li><li><a href="global.html#setInputValue">setInputValue</a></li><li><a href="global.html#setupListeners">setupListeners</a></li><li><a href="global.html#showCancelAndSearch">showCancelAndSearch</a></li><li><a href="global.html#tagName">tagName</a></li><li><a href="global.html#taxonomicClassification">taxonomicClassification</a></li><li><a href="global.html#templateVars">templateVars</a></li><li><a href="global.html#type">type</a></li><li><a href="global.html#urlFunctionTypes">urlFunctionTypes</a></li></ul>
</nav>

<div id="main">

    <h1 class="page-title">Source: src/js/views/AppView.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>﻿﻿/*global define */
define([
  "jquery",
  "underscore",
  "backbone",
  "views/AltHeaderView",
  "views/NavbarView",
  "views/FooterView",
  "views/SignInView",
  "text!templates/alert.html",
  "text!templates/appHead.html",
  "text!templates/jsonld.txt",
  "text!templates/app.html",
  "text!templates/loading.html",
], function (
  $,
  _,
  Backbone,
  AltHeaderView,
  NavbarView,
  FooterView,
  SignInView,
  AlertTemplate,
  AppHeadTemplate,
  JsonLDTemplate,
  AppTemplate,
  LoadingTemplate
) {
  "use strict";

  var app = app || {};

  /**
   * @class AppView
   * @classdesc The top-level view of the UI that contains and coordinates all other views of the UI
   * @classcategory Views
   */
  var AppView = Backbone.View.extend(
    /** @lends AppView.prototype */ {
      // Instead of generating a new element, bind to the existing skeleton of
      // the App already present in the HTML.
      el: "#metacatui-app",

      //Templates
      template: _.template(AppTemplate),
      alertTemplate: _.template(AlertTemplate),
      appHeadTemplate: _.template(AppHeadTemplate),
      jsonLDTemplate: _.template(JsonLDTemplate),
      loadingTemplate: _.template(LoadingTemplate),

      events: {
        click: "closePopovers",
        "click .btn.direct-search": "routeToMetadata",
        "keypress input.direct-search": "routeToMetadataOnEnter",
        "click .toggle-slide": "toggleSlide",
        "click input.copy": "higlightInput",
        "focus input.copy": "higlightInput",
        "click textarea.copy": "higlightInput",
        "focus textarea.copy": "higlightInput",
        "click .open-chat": "openChatWithMessage",
        "click .login.redirect": "sendToLogin",
        "focus .jump-width-input": "widenInput",
        "focusout .jump-width-input": "narrowInput",
        "click .temporary-message .close": "hideTemporaryMessage",
      },

      initialize: function () {
        //Check for the LDAP sign in error message
        if (
          window.location.search.indexOf(
            "error=Unable%20to%20authenticate%20LDAP%20user"
          ) > -1
        ) {
          window.location =
            window.location.origin +
            window.location.pathname +
            "#signinldaperror";
        }

        //Is there a logged-in user?
        MetacatUI.appUserModel.checkStatus();

        //Change the document title when the app changes the MetacatUI.appModel title at any time
        this.listenTo(MetacatUI.appModel, "change:title", this.changeTitle);
        this.listenTo(MetacatUI.appModel, "change:description", this.changeDescription);

        this.checkIncompatibility();
      },

      /**
      * The JS query selector for the element inside the AppView that contains the main view contents. When a new view is routed to
      * and displayed via {@link AppView#showView}, the view will be inserted into this element.
      * @type {string}
      * @default "#Content"
      * @since 2.22.0
      */
      contentSelector: "#Content",

      /**
       * Gets the Element in this AppView via the {@link AppView#contentSelector}
       * @returns {Element}
       */
      getContentEl: function () {
        return this.el.querySelector(this.contentSelector);
      },

      /**
       * Change the web document's title
       */
      changeTitle: function () {
        document.title = MetacatUI.appModel.get("title");
      },

      /**
       * Change the web document's description
       * @since 2.25.0
       */
      changeDescription: function () {
        $("meta[name=description]").attr(
          "content",
          MetacatUI.appModel.get("description")
        );
      },

      /** Render the main view and/or re-render subviews. Delegate rendering
        and event handling to sub views.
    ---
    If there is no AppView element on the page, don't render the application.
     ---
    If there is no AppView element on the page, this function will exit without rendering anything.
    For instance, this can occur when the AppView is loaded during unit tests.
    See {@link AppView#el} to check which element is required for rendering. By default,
    it is set to the element with the `metacatui-app` id (check docs for the most up-to-date info).
    ----
    This step is usually unnecessary for Backbone Views since they should only render elements inside of
    their own `el` anyway. But the APpView is different since it renders the overall structure of MetacatUI.
    */
      render: function () {
        //If there is no AppView element on the page, don't render the application.
        if (!this.el) {
          console.error(
            "Not rendering the UI of the app since the AppView HTML element (AppView.el) does not exist on the page. Make sure you have the AppView element included in index.html"
          );
          return;
        }

        // set up the head - make sure to prepend, otherwise the CSS may be out of order!
        $("head")
          .append(
            this.appHeadTemplate({
              theme: MetacatUI.theme
            })
          )
          //Add the JSON-LD to the head element
          .append(
            $(document.createElement("script"))
              .attr("type", "application/ld+json")
              .attr("id", "jsonld")
              .html(this.jsonLDTemplate())
          );

        // set up the body
        this.$el.append(this.template());

        /**
         * @name MetacatUI.navbarView
         * @type NavbarView
         * @description The view that displays a navigation menu on every MetacatUI page and controls the navigation between pages in MetacatUI.
         */
        MetacatUI.navbarView = new NavbarView();
        MetacatUI.navbarView.setElement($("#Navbar")).render();

        /**
         * @name MetacatUI.altHeaderView
         * @type AltHeaderView
         * @description The view that displays a header on every MetacatUI view that uses the "AltHeader" header type.
         * This header is usually for decorative / aesthetic purposes only.
         */
        MetacatUI.altHeaderView = new AltHeaderView();
        MetacatUI.altHeaderView.setElement($("#HeaderContainer")).render();

        /**
         * @name MetacatUI.footerView
         * @type FooterView
         * @description The view that displays the main footer of the MetacatUI page.
         * It has informational and navigational links in it and is displayed on every page, except for views that hide it for full-screen display.
         */
        MetacatUI.footerView = new FooterView();
        MetacatUI.footerView.setElement($("#Footer")).render();

        this.showTemporaryMessage();

        //Load the Slaask chat widget if it is enabled in this theme
        if (MetacatUI.appModel.get("slaaskKey") &amp;&amp; window._slaask)
          _slaask.init(MetacatUI.appModel.get("slaaskKey"));

        this.listenForActivity();
        this.listenForTimeout();

        this.initializeWidgets();

        return this;
      },

      // the currently rendered view
      currentView: null,

      // Our view switcher for the whole app
      showView: function (view, viewOptions) {
        if (!this.el) {
          console.error(
            "Not rendering the UI of the app since the AppView HTML element (AppView.el) does not exist on the page. Make sure you have the AppView element included in index.html"
          );
          return;
        }

        //reference to appView
        var thisAppViewRef = this;

        // Change the background image if there is one
        MetacatUI.navbarView.changeBackground();

        // close the current view
        if (this.currentView) {
          //If the current view has a function to confirm closing of the view, call it
          if (typeof this.currentView.canClose == "function") {
            //If the user or view confirmed that the view shouldn't be closed, then don't navigate to the next route
            if (!this.currentView.canClose()) {
              //Get a confirmation message from the view, or use a default one
              if (
                typeof this.currentView.getConfirmCloseMessage == "function"
              ) {
                var confirmMessage = this.currentView.getConfirmCloseMessage();
              } else {
                var confirmMessage = "Leave this page?";
              }

              //Show a confirm alert to the user and wait for their response
              var leave = confirm(confirmMessage);
              //If they clicked Cancel, then don't navigate to the next route
              if (!leave) {
                MetacatUI.uiRouter.undoLastRoute();
                return;
              }
            }
          }

          // need reference to the old/current view for the callback method
          var oldView = this.currentView;

          this.currentView.$el.fadeOut("slow", function () {
            // clean up old view
            if (oldView.onClose) oldView.onClose();

            //If the view to show is not the same as the main content element, then put it inside the content element.
            if (view.el !== thisAppViewRef.getContentEl()) {
              thisAppViewRef.getContentEl().replaceChildren(view.el);
              $(thisAppViewRef.getContentEl()).show();
            }

            view.$el.fadeIn("slow", function () {
              // render the new view
              view.render(viewOptions);

              // after fade in, do postRender()
              if (view.postRender) view.postRender();
              // force scroll to top if no custom scrolling is implemented
              else thisAppViewRef.scrollToTop();
            });
          });
        } else {
          //If the view to show is not the same as the main content element, then put it inside the content element.
          if (view.el !== this.getContentEl()) {
            this.getContentEl().replaceChildren(view.el);
          }

          // just show the view without transition
          view.render(viewOptions);

          if (view.postRender) view.postRender();
          // force scroll to top if no custom scrolling is implemented
          else thisAppViewRef.scrollToTop();
        }

        // track the current view
        this.currentView = view;
        MetacatUI.analytics?.trackPageView();

        this.trigger("appRenderComplete");
      },

      routeToMetadata: function (e) {
        e.preventDefault();

        //Get the value from the input element
        var form = $(e.target).attr("form") || null,
          val = this.$("#" + form)
            .find("input[type=text]")
            .val();

        //Remove the text from the input
        this.$("#" + form)
          .find("input[type=text]")
          .val("");

        if (!val) return false;

        MetacatUI.uiRouter.navigate("view/" + val, { trigger: true });
      },

      routeToMetadataOnEnter: function (e) {
        //If the user pressed a key inside a text input, we only want to proceed if it was the Enter key
        if (e.type == "keypress" &amp;&amp; e.keycode != 13) return;
        else this.routeToMetadata(e);
      },

      sendToLogin: function (e) {
        if (e) e.preventDefault();

        var url = $(e.target).attr("href");
        url = url.substring(0, url.indexOf("target=") + 7);
        url += window.location.href;

        window.location.href = url;
      },

      resetSearch: function () {
        // Clear the search and map model to start a fresh search
        MetacatUI.appSearchModel.clear();
        MetacatUI.appSearchModel.set(MetacatUI.appSearchModel.defaults());
        MetacatUI.mapModel.clear();
        MetacatUI.mapModel.set(MetacatUI.mapModel.defaults());

        //Clear the search history
        MetacatUI.appModel.set("searchHistory", new Array());

        MetacatUI.uiRouter.navigate("data", { trigger: true });
      },

      closePopovers: function (e) {
        if (this.currentView &amp;&amp; this.currentView.closePopovers)
          this.currentView.closePopovers(e);
      },

      toggleSlide: function (e) {
        if (e) e.preventDefault();
        else return false;

        var clickedOn = $(e.target),
          toggleElId =
            clickedOn.attr("data-slide-el") ||
            clickedOn.parents("[data-slide-el]").attr("data-slide-el"),
          toggleEl = $("#" + toggleElId);

        toggleEl.slideToggle("fast", function () {
          //Toggle the display of the link if it has the right class
          if (clickedOn.is(".toggle-display-on-slide")) {
            clickedOn.siblings(".toggle-display-on-slide").toggle();
            clickedOn.toggle();
          }
        });
      },

      /**
       * Displays the given message to the user in a Bootstrap "alert" style.
       * @param {object} options A literal object of options for the alert message.
       * @property {string|Element} options.message A message string or HTML Element to display
       * @property {string} [options.classes] A string of HTML classes to set on the alert
       * @property {string|Element} [options.container] The container to show the alert in
       * @property {boolean} [options.replaceContents] If true, the alert will replace the contents of the container element.
       *                                               If false, the alert will be prepended to the container element.
       * @property {boolean|number} [options.delay] Set to true or specify a number of milliseconds to display the alert temporarily
       * @property {boolean} [options.remove] If true, the user will be able to remove the alert with a "close" icon.
       * @property {boolean} [options.includeEmail] If true, the alert will include a link to the {@link AppConfig#emailContact}
       * @property {string} [options.emailBody] Specify an email body to use in the email link.
       * @returns {Element} The alert element
       */
      showAlert: function () {
        if (arguments.length > 1) {
          var options = {
            message: arguments[0],
            classes: arguments[1],
            container: arguments[2],
            delay: arguments[3],
          };
          if (typeof arguments[4] == "object") {
            options = _.extend(options, arguments[4]);
          }
        } else {
          var options = arguments[0];
        }

        if (typeof options != "object" || !options) {
          return;
        }

        if (!options.classes) options.classes = "alert-success";

        if (!options.container || !$(options.container).length)
          options.container = this.$el;

        //Remove any alerts that are already in this container
        if ($(options.container).children(".alert-container").length > 0)
          $(options.container).children(".alert-container").remove();

        //Allow messages to be HTML or strings
        if (typeof options.message != "string")
          options.message = $(document.createElement("div"))
            .append($(options.message))
            .html();

        var emailOptions = "";

        //Check for more options
        if (options.emailBody) emailOptions += "?body=" + options.emailBody;

        var alert = $.parseHTML(
          this.alertTemplate({
            msg: options.message,
            classes: options.classes,
            emailOptions: emailOptions,
            remove: options.remove || false,
            includeEmail: options.includeEmail,
          }).trim()
        );

        if (options.delay) {
          $(alert).hide();

          if (options.replaceContents) {
            $(options.container).html(alert);
          } else {
            $(options.container).prepend(alert);
          }

          $(alert)
            .show()
            .delay(typeof options.delay == "number" ? options.delay : 3000)
            .fadeOut();
        } else {
          if (options.replaceContents) {
            $(options.container).html(alert);
          } else {
            $(options.container).prepend(alert);
          }
        }
        return alert;
      },

      /**
       * Previous to MetacatUI 2.14.0, the {@link AppView#showAlert} function allowed up to five parameters
       * to customize the alert message. As of 2.14.0, the function has condensed these options into
       * a single literal object. See the docs for {@link AppView#showAlert}. The old signature of five
       * parameters may soon be deprecated completely, but is still supported.
       * @deprecated
       * @param {string|Element} msg
       * @param {string} [classes]
       * @param {string|Element} [container]
       * @param {boolean} [delay]
       * @param {object} [options]
       * @param {boolean} [options.includeEmail] If true, the alert will include a link to the {@link AppConfig#emailContact}
       * @param {string} [options.emailBody]
       * @param {boolean} [options.remove]
       * @param {boolean} [options.replaceContents]
       */
      showAlert_deprecated: function (
        msg,
        classes,
        container,
        delay,
        options
      ) {},

      /**
       * Listens to the focus event on the window to detect when a user switches back to this browser tab from somewhere else
       * When a user checks back, we want to check for log-in status
       */
      listenForActivity: function () {
        MetacatUI.appUserModel.on("change:loggedIn", function () {
          if (!MetacatUI.appUserModel.get("loggedIn")) return;

          //When the user re-focuses back on the window
          $(window).focus(function () {
            //If the user has logged out in the meantime, then exit
            if (!MetacatUI.appUserModel.get("loggedIn")) return;

            //If the expiration date of the token has passed, then allow the user to sign back in
            if (MetacatUI.appUserModel.get("expires") &lt;= new Date()) {
              MetacatUI.appView.showTimeoutSignIn();
            }
          });
        });
      },

      /**
       * Will determine the length of time until the user's current token expires,
       * and will set a window timeout for that length of time. When the timeout
       * is triggered, the sign in modal window will be displayed so that the user
       * can sign in again (which happens in AppView.showTimeoutSignIn())
       */
      listenForTimeout: function () {
        //Only proceed if the user is logged in
        if (!MetacatUI.appUserModel.get("checked")) {
          //When the user logged back in, listen again for the next timeout
          this.listenToOnce(
            MetacatUI.appUserModel,
            "change:checked",
            function () {
              //If the user is logged in, then listen call this function again
              if (
                MetacatUI.appUserModel.get("checked") &amp;&amp;
                MetacatUI.appUserModel.get("loggedIn")
              )
                this.listenForTimeout();
            }
          );

          return;
        } else if (!MetacatUI.appUserModel.get("loggedIn")) {
          //When the user logged back in, listen again for the next timeout
          this.listenToOnce(
            MetacatUI.appUserModel,
            "change:loggedIn",
            function () {
              //If the user is logged in, then listen call this function again
              if (
                MetacatUI.appUserModel.get("checked") &amp;&amp;
                MetacatUI.appUserModel.get("loggedIn")
              )
                this.listenForTimeout();
            }
          );

          return;
        }

        var view = this,
          expires = MetacatUI.appUserModel.get("expires"),
          timeLeft = expires - new Date();

        //If there is no time left until expiration, then show the sign in view now
        if (timeLeft &lt; 0) {
          this.showTimeoutSignIn();
        }
        //Otherwise, set a timeout for a expiration time, then show the Sign In View
        else {
          var timeoutId = setTimeout(function () {
            view.showTimeoutSignIn.call(view);
          }, timeLeft);

          //Save the timeout id in case we want to destroy the timeout later
          MetacatUI.appUserModel.set("timeoutId", timeoutId);
        }
      },

      /**
       * If the user's auth token has expired, a new SignInView model window is
       * displayed so the user can sign back in. A listener is set on the appUserModel
       * so that when they do successfully sign back in, we set another timeout listener
       * via AppView.listenForTimeout()
       */
      showTimeoutSignIn: function () {
        if (MetacatUI.appUserModel.get("expires") &lt;= new Date()) {
          MetacatUI.appUserModel.set("loggedIn", false);

          var signInView = new SignInView({
            inPlace: true,
            closeButtons: false,
            topMessage:
              "Your session has timed out. Click Sign In to open a " +
              "new window to sign in again. Make sure your browser settings allow pop-ups.",
          });
          var signInForm = signInView.render().el;

          if (this.subviews &amp;&amp; Array.isArray(this.subviews))
            this.subviews.push(signInView);
          else this.subviews = [signInView];

          $("body").append(signInForm);
          $(signInForm).modal();

          //When the user logged back in, listen again for the next timeout
          this.listenToOnce(
            MetacatUI.appUserModel,
            "change:checked",
            function () {
              if (
                MetacatUI.appUserModel.get("checked") &amp;&amp;
                MetacatUI.appUserModel.get("loggedIn")
              )
                this.listenForTimeout();
            }
          );
        }
      },

      openChatWithMessage: function () {
        if (!_slaask) return;

        $("#slaask-input").val(MetacatUI.appModel.get("defaultSupportMessage"));
        $("#slaask-button").trigger("click");
      },

      initializeWidgets: function () {
        // Autocomplete widget extension to provide description tooltips.
        $.widget("app.hoverAutocomplete", $.ui.autocomplete, {
          // Set the content attribute as the "item.desc" value.
          // This becomes the tooltip content.
          _renderItem: function (ul, item) {
            // if we have a label, use it for the title
            var title = item.value;
            if (item.label) {
              title = item.label;
            }
            // if we have a description, use it for the content
            var content = item.value;
            if (item.desc) {
              content = item.desc;
              if (item.desc != item.value) {
                content += " (" + item.value + ")";
              }
            }
            var element = this._super(ul, item)
              .attr("data-title", title)
              .attr("data-content", content);
            element.popover({
              placement: "right",
              trigger: "hover",
              container: "body",
            });
            return element;
          },
        });
      },

      /**
       * Checks if the user's browser is an outdated version that won't work with
       * MetacatUI well, and displays a warning message to the user..
       * The user agent is checked against the `unsupportedBrowsers` list in the AppModel.
       */
      checkIncompatibility: function () {
        //Check if this browser is incompatible with this app. i.e. It is an old browser version
        var isUnsupportedBrowser = _.some(
          MetacatUI.appModel.get("unsupportedBrowsers"),
          function (browserRegEx) {
            var matches = navigator.userAgent.match(browserRegEx);
            return matches &amp;&amp; matches.length > 0;
          }
        );

        if (!isUnsupportedBrowser) {
          return;
        } else {
          //Show a warning message to the user about their browser.
          this.showAlert(
            "Your web browser is out of date. Update your browser for more security, " +
              "speed and the best experience on this site.",
            "alert-warning",
            this.$el,
            false,
            { remove: true }
          );
          this.$el
            .children(".alert-container")
            .addClass("important-app-message");
        }
      },

      /**
       * Shows a temporary message at the top of the view
       */
      showTemporaryMessage: function () {
        try {
          //Is there a temporary message to display throughout the app?
          if (MetacatUI.appModel.get("temporaryMessage")) {
            var startTime = MetacatUI.appModel.get("temporaryMessageStartTime"),
              endTime = MetacatUI.appModel.get("temporaryMessageEndTime"),
              today = new Date(),
              isDisplayed = false;

            //Find cases where we should display the message
            //If there is a date range and today is in the range
            if (startTime &amp;&amp; endTime &amp;&amp; today > startTime &amp;&amp; today &lt; endTime) {
              isDisplayed = true;
            }
            //If there's just a start time and today is after it
            else if (startTime &amp;&amp; !endTime &amp;&amp; today > startTime) {
              isDisplayed = true;
            }
            //If there's just an end time and today is before it
            else if (!startTime &amp;&amp; endTime &amp;&amp; today &lt; endTime) {
              isDisplayed = true;
            }
            //If there's no start or end time
            else if (!startTime &amp;&amp; !endTime) {
              isDisplayed = true;
            }

            if (isDisplayed) {
              require(["text!templates/alert.html"], function (alertTemplate) {
                //Get classes for the message
                var classes =
                  MetacatUI.appModel.get("temporaryMessageClasses") || "";
                classes += " temporary-message";

                var container =
                  MetacatUI.appModel.get("temporaryMessageContainer") ||
                  "#Navbar";

                //If the message exists already, return
                if ($(container + " .temporary-message").length) {
                  return;
                }

                //Insert the message using the Alert template
                $(container).prepend(
                  _.template(alertTemplate)({
                    classes: classes,
                    msg: MetacatUI.appModel.get("temporaryMessage"),
                    includeEmail: MetacatUI.appModel.get(
                      "temporaryMessageIncludeEmail"
                    ),
                    remove: true,
                  })
                );

                //Add a class to the body in case we need to adjust other elements on the page
                $("body").addClass("has-temporary-message");
              });
            }
          }
        } catch (e) {
          console.error("Couldn't display the temporary message: ", e);
        }
      },

      /**
       * Hides the temporary message
       */
      hideTemporaryMessage: function () {
        try {
          this.$(".temporary-message").remove();
          $("body").removeClass("has-temporary-message");
        } catch (e) {
          console.error("Couldn't hide the temporary message: ", e);
        }
      },

      /********************** Utilities ********************************/
      // Various utility functions to use across the app //
      /************ Function to add commas to large numbers ************/
      commaSeparateNumber: function (val) {
        if (!val) return 0;

        if (val &lt; 1) return Math.round(val * 100) / 100;

        while (/(\d+)(\d{3})/.test(val.toString())) {
          val = val.toString().replace(/(\d+)(\d{3})/, "$1" + "," + "$2");
        }
        return val;
      },
      numberAbbreviator: function (number, decimalPlaces) {
        if (number === 0) {
          return 0;
        }
        decimalPlaces = Math.pow(10, decimalPlaces);
        var abbreviations = ["K", "M", "B", "T"];

        // Go through the array backwards, so we do the largest first
        for (var i = abbreviations.length - 1; i >= 0; i--) {
          // Convert array index to "1000", "1000000", etc
          var size = Math.pow(10, (i + 1) * 3);

          // If the number is bigger or equal do the abbreviation
          if (size &lt;= number) {
            // Here, we multiply by decimalPlaces, round, and then divide by decimalPlaces.
            // This gives us nice rounding to a particular decimal place.
            number =
              Math.round((number * decimalPlaces) / size) / decimalPlaces;

            // Handle special case where we round up to the next abbreviation
            if (number == 1000 &amp;&amp; i &lt; abbreviations.length - 1) {
              number = 1;
              i++;
            }

            // Add the letter for the abbreviation
            number += abbreviations[i];
            break;
          }
        }
        return number;
      },
      higlightInput: function (e) {
        if (!e) return;

        e.preventDefault();
        e.target.setSelectionRange(0, 9999);
      },

      widenInput: function (e) {
        $(e.target).css("width", "200px");
      },

      narrowInput: function (e) {
        $(e.target).delay(500).animate({ width: "60px" });
      },

      // scroll to top of page
      scrollToTop: function () {
        $("body,html")
          .stop(true, true) //stop first for it to work in FF
          .animate({ scrollTop: 0 }, "slow");
        return false;
      },

      scrollTo: function (pageElement, offsetTop) {
        //Find the header height if it is a fixed element
        var headerOffset =
          this.$("#Header").css("position") == "fixed"
            ? this.$("#Header").outerHeight()
            : 0;
        var navOffset =
          this.$("#Navbar").css("position") == "fixed"
            ? this.$("#Navbar").outerHeight()
            : 0;
        var totalOffset = headerOffset + navOffset;

        $("body,html")
          .stop(true, true) //stop first for it to work in FF
          .animate(
            { scrollTop: $(pageElement).offset().top - 40 - totalOffset },
            1000
          );
        return false;
      },
    }
  );
  return AppView;
});
</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
