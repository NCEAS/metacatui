<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>MetacatUI Dev Docs: Source: src/js/views/filters/FilterEditorView.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
    <link type="text/css" rel="stylesheet" href="/metacatui/assets/css/styles.css">
    <link type="text/css" rel="stylesheet" href="styles/style.css">
</head>

<body>

<nav id="nav">
    <a href="/">
      <div class="logo">
<svg class="cat" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="cat" class="svg-inline--fa fa-cat fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M290.59 192c-20.18 0-106.82 1.98-162.59 85.95V192c0-52.94-43.06-96-96-96-17.67 0-32 14.33-32 32s14.33 32 32 32c17.64 0 32 14.36 32 32v256c0 35.3 28.7 64 64 64h176c8.84 0 16-7.16 16-16v-16c0-17.67-14.33-32-32-32h-32l128-96v144c0 8.84 7.16 16 16 16h32c8.84 0 16-7.16 16-16V289.86c-10.29 2.67-20.89 4.54-32 4.54-61.81 0-113.52-44.05-125.41-102.4zM448 96h-64l-64-64v134.4c0 53.02 42.98 96 96 96s96-42.98 96-96V32l-64 64zm-72 80c-8.84 0-16-7.16-16-16s7.16-16 16-16 16 7.16 16 16-7.16 16-16 16zm80 0c-8.84 0-16-7.16-16-16s7.16-16 16-16 16 7.16 16 16-7.16 16-16 16z"></path></svg>

<svg width="459px" height="53px" viewBox="0 0 459 53" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
    <g id="metacatui" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
        <path d="M16.492,52 C17.212,52 17.812,51.748 18.292,51.244 C18.772,50.74 19.012,50.128 19.012,49.408 L19.012,49.408 L18.94,22.912 L30.82,37.816 C31.204,38.344 31.72,38.764 32.368,39.076 C33.016,39.388 33.7,39.544 34.42,39.544 C35.908,39.544 37.132,38.896 38.092,37.6 L38.092,37.6 L49.684,22.912 L49.684,49.408 C49.684,50.128 49.96,50.74 50.512,51.244 C51.064,51.748 51.7,52 52.42,52 L52.42,52 L62.068,52 C62.788,52 63.388,51.748 63.868,51.244 C64.348,50.74 64.588,50.128 64.588,49.408 L64.588,49.408 L64.588,4.12 C64.588,3.448 64.336,2.86 63.832,2.356 C63.328,1.852 62.74,1.6 62.068,1.6 L62.068,1.6 L52.348,1.6 C51.388,1.6 50.56,1.648 49.864,1.744 C49.168,1.84 48.532,2.152 47.956,2.68 L47.956,2.68 L33.916,17.296 L20.524,2.608 C20.332,2.368 19.972,2.14 19.444,1.924 C18.916,1.708 18.412,1.6 17.932,1.6 L17.932,1.6 L6.772,1.6 C6.052,1.6 5.44,1.852 4.936,2.356 C4.432,2.86 4.18,3.448 4.18,4.12 L4.18,4.12 L4.18,49.408 C4.18,50.08 4.432,50.68 4.936,51.208 C5.44,51.736 6.052,52 6.772,52 L6.772,52 L16.492,52 Z M110.74,52 C111.556,52 112.264,51.676 112.864,51.028 C113.464,50.38 113.764,49.624 113.764,48.76 L113.764,48.76 L113.764,42.568 C113.764,41.608 113.464,40.828 112.864,40.228 C112.264,39.628 111.556,39.328 110.74,39.328 L110.74,39.328 L89.428,39.328 L89.428,32.92 L109.732,32.92 C110.5,32.92 111.184,32.596 111.784,31.948 C112.384,31.3 112.684,30.568 112.684,29.752 L112.684,29.752 L112.684,23.488 C112.684,22.576 112.384,21.82 111.784,21.22 C111.184,20.62 110.5,20.32 109.732,20.32 L109.732,20.32 L89.428,20.32 L89.428,14.488 L110.74,14.488 C111.508,14.488 112.204,14.164 112.828,13.516 C113.452,12.868 113.764,12.136 113.764,11.32 L113.764,11.32 L113.764,5.056 C113.764,4.144 113.464,3.388 112.864,2.788 C112.264,2.188 111.556,1.888 110.74,1.888 L110.74,1.888 L76.756,1.888 C75.94,1.888 75.232,2.188 74.632,2.788 C74.032,3.388 73.732,4.144 73.732,5.056 L73.732,5.056 L73.732,48.76 C73.732,49.624 74.032,50.38 74.632,51.028 C75.232,51.676 75.94,52 76.756,52 L76.756,52 L110.74,52 Z M147.604,52 C148.42,52 149.104,51.688 149.656,51.064 C150.208,50.44 150.484,49.672 150.484,48.76 L150.484,48.76 L150.484,16.216 L161.86,16.216 C162.676,16.216 163.396,15.904 164.02,15.28 C164.644,14.656 164.956,13.936 164.956,13.12 L164.956,13.12 L164.956,4.768 C164.956,4 164.644,3.316 164.02,2.716 C163.396,2.116 162.676,1.816 161.86,1.816 L161.86,1.816 L124.132,1.816 C123.22,1.816 122.464,2.104 121.864,2.68 C121.264,3.256 120.964,3.952 120.964,4.768 L120.964,4.768 L120.964,13.12 C120.964,13.936 121.264,14.656 121.864,15.28 C122.464,15.904 123.22,16.216 124.132,16.216 L124.132,16.216 L135.652,16.216 L135.148,48.832 C135.148,49.744 135.424,50.5 135.976,51.1 C136.528,51.7 137.212,52 138.028,52 L138.028,52 L147.604,52 Z M175.828,52 C176.836,52 177.676,51.82 178.348,51.46 C179.02,51.1 179.452,50.584 179.644,49.912 L179.644,49.912 L181.876,42.712 L197.932,42.712 L200.164,49.912 C200.356,50.584 200.8,51.1 201.496,51.46 C202.192,51.82 203.044,52 204.052,52 L204.052,52 L213.916,52 C215.836,51.712 216.796,50.704 216.796,48.976 C216.796,48.304 216.676,47.596 216.436,46.852 C216.196,46.108 216.052,45.616 216.004,45.376 L216.004,45.376 L199.876,4.84 C199.588,3.976 199.036,3.232 198.22,2.608 C197.404,1.984 196.372,1.648 195.124,1.6 L195.124,1.6 L184.756,1.6 C183.604,1.648 182.608,1.948 181.768,2.5 C180.928,3.052 180.292,3.832 179.86,4.84 L179.86,4.84 L163.876,45.376 C163.828,45.472 163.672,45.916 163.408,46.708 C163.144,47.5 163.012,48.304 163.012,49.12 C163.012,50.752 163.948,51.712 165.82,52 L165.82,52 L175.828,52 Z M195.34,30.544 L184.036,30.544 L189.652,13.624 L195.34,30.544 Z M245.38,53.08 C250.612,53.08 255.652,51.544 260.5,48.472 C261.22,47.944 261.58,47.296 261.58,46.528 C261.58,45.808 261.292,45.16 260.716,44.584 L260.716,44.584 L252.796,36.808 C252.364,36.376 251.836,36.16 251.212,36.16 C250.78,36.16 250.372,36.256 249.988,36.448 C248.356,37.12 246.796,37.456 245.308,37.456 C243.244,37.456 241.348,36.952 239.62,35.944 C237.892,34.936 236.512,33.58 235.48,31.876 C234.448,30.172 233.932,28.336 233.932,26.368 C233.932,24.352 234.436,22.504 235.444,20.824 C236.452,19.144 237.832,17.812 239.584,16.828 C241.336,15.844 243.244,15.352 245.308,15.352 C246.892,15.352 248.332,15.64 249.628,16.216 C250.012,16.408 250.444,16.504 250.924,16.504 C251.548,16.504 252.1,16.264 252.58,15.784 L252.58,15.784 L259.636,8.008 C260.164,7.384 260.428,6.76 260.428,6.136 C260.428,5.224 259.996,4.528 259.132,4.048 C254.86,1.552 250.276,0.304 245.38,0.304 C240.532,0.304 236.032,1.492 231.88,3.868 C227.728,6.244 224.44,9.448 222.016,13.48 C219.592,17.512 218.38,21.904 218.38,26.656 C218.38,31.408 219.592,35.812 222.016,39.868 C224.44,43.924 227.728,47.14 231.88,49.516 C236.032,51.892 240.532,53.08 245.38,53.08 Z M279.796,52 C280.804,52 281.644,51.82 282.316,51.46 C282.988,51.1 283.42,50.584 283.612,49.912 L283.612,49.912 L285.844,42.712 L301.9,42.712 L304.132,49.912 C304.324,50.584 304.768,51.1 305.464,51.46 C306.16,51.82 307.012,52 308.02,52 L308.02,52 L317.884,52 C319.804,51.712 320.764,50.704 320.764,48.976 C320.764,48.304 320.644,47.596 320.404,46.852 C320.164,46.108 320.02,45.616 319.972,45.376 L319.972,45.376 L303.844,4.84 C303.556,3.976 303.004,3.232 302.188,2.608 C301.372,1.984 300.34,1.648 299.092,1.6 L299.092,1.6 L288.724,1.6 C287.572,1.648 286.576,1.948 285.736,2.5 C284.896,3.052 284.26,3.832 283.828,4.84 L283.828,4.84 L267.844,45.376 C267.796,45.472 267.64,45.916 267.376,46.708 C267.112,47.5 266.98,48.304 266.98,49.12 C266.98,50.752 267.916,51.712 269.788,52 L269.788,52 L279.796,52 Z M299.308,30.544 L288.004,30.544 L293.62,13.624 L299.308,30.544 Z M352.588,52 C353.404,52 354.088,51.688 354.64,51.064 C355.192,50.44 355.468,49.672 355.468,48.76 L355.468,48.76 L355.468,16.216 L366.844,16.216 C367.66,16.216 368.38,15.904 369.004,15.28 C369.628,14.656 369.94,13.936 369.94,13.12 L369.94,13.12 L369.94,4.768 C369.94,4 369.628,3.316 369.004,2.716 C368.38,2.116 367.66,1.816 366.844,1.816 L366.844,1.816 L329.116,1.816 C328.204,1.816 327.448,2.104 326.848,2.68 C326.248,3.256 325.948,3.952 325.948,4.768 L325.948,4.768 L325.948,13.12 C325.948,13.936 326.248,14.656 326.848,15.28 C327.448,15.904 328.204,16.216 329.116,16.216 L329.116,16.216 L340.636,16.216 L340.132,48.832 C340.132,49.744 340.408,50.5 340.96,51.1 C341.512,51.7 342.196,52 343.012,52 L343.012,52 L352.588,52 Z M402.052,52.792 C408.1,52.792 412.912,51.628 416.488,49.3 C420.064,46.972 422.536,44.068 423.904,40.588 C425.272,37.108 425.932,33.424 425.884,29.536 C425.884,29.5309474 425.883967,29.5237673 425.8839,29.5144598 L425.883102,29.4330859 C425.879911,29.1480111 425.868211,28.3183158 425.848,26.944 C425.8294,25.6792 425.818008,22.91524 425.813823,18.65212 L425.813103,17.80828 C425.812997,17.66452 425.8129,17.5192 425.81281,17.37232 L425.812,3.904 C425.86,3.184 425.632,2.62 425.128,2.212 C424.624,1.804 423.916,1.6 423.004,1.6 L423.004,1.6 L413.428,1.6 C412.612,1.6 411.904,1.828 411.304,2.284 C410.704,2.74 410.404,3.28 410.404,3.904 L410.404,3.904 L410.26,27.808 C410.26,34.144 407.476,37.312 401.908,37.312 C399.076,37.312 396.832,36.412 395.176,34.612 C393.52,32.812 392.668,30.352 392.62,27.232 L392.62,27.232 L392.332,3.76 C392.332,3.088 392.068,2.56 391.54,2.176 C391.012,1.792 390.268,1.6 389.308,1.6 L389.308,1.6 L379.876,1.6 C378.244,1.6 377.428,2.32 377.428,3.76 L377.428,3.76 L377.5,28.816 C377.5,33.04 378.376,36.964 380.128,40.588 C381.88,44.212 384.592,47.152 388.264,49.408 C391.936,51.664 396.532,52.792 402.052,52.792 Z M449.284,52.144 C450.148,52.144 450.88,51.844 451.48,51.244 C452.08,50.644 452.38,49.84 452.38,48.832 L452.38,48.832 L452.38,4.912 C452.38,4 452.08,3.22 451.48,2.572 C450.88,1.924 450.148,1.6 449.284,1.6 L449.284,1.6 L439.42,1.6 C438.46,1.6 437.692,1.924 437.116,2.572 C436.54,3.22 436.252,4 436.252,4.912 L436.252,4.912 L436.252,48.832 C436.252,49.84 436.54,50.644 437.116,51.244 C437.692,51.844 438.46,52.144 439.42,52.144 L439.42,52.144 L449.284,52.144 Z" id="metacatui" fill="#FCBF49" fill-rule="nonzero"></path>
    </g>
</svg>
</logo>

    </a>
    <h3>Namespaces</h3><ul><li><a href="AppConfig.html">AppConfig</a></li><li><a href="MapConfig.html">MapConfig</a></li><li><a href="MetacatUI.html">MetacatUI</a></li><li><a href="Utilities.html">Utilities</a></li></ul><h3>Classes</h3><ul><li class='category-heading' data-category='Collections'>Collections</li><li><a href="AccessPolicy.html">AccessPolicy</a></li><li><a href="Citations.html">Citations</a></li><li><a href="DataPackage.html">DataPackage</a></li><li><a href="Filters.html">Filters</a></li><li><a href="ObjectFormats.html">ObjectFormats</a></li><li><a href="QualityReport.html">QualityReport</a></li><li><a href="SolrResults.html">SolrResults</a></li><li><a href="Units.html">Units</a></li><li><a href="UserGroup.html">UserGroup</a></li><li class='category-heading' data-category='Collections/Bookkeeper'>Collections/Bookkeeper</li><li><a href="Quotas.html">Quotas</a></li><li><a href="Usages.html">Usages</a></li><li class='category-heading' data-category='Collections/Maps'>Collections/Maps</li><li><a href="AssetColors.html">AssetColors</a></li><li><a href="Features.html">Features</a></li><li><a href="MapAssets.html">MapAssets</a></li><li><a href="VectorFilters.html">VectorFilters</a></li><li class='category-heading' data-category='Collections/Metadata/EML'>Collections/Metadata/EML</li><li><a href="EMLAnnotations.html">EMLAnnotations</a></li><li class='category-heading' data-category='Collections/QueryFields'>Collections/QueryFields</li><li><a href="QueryFields.html">QueryFields</a></li><li class='category-heading' data-category='Models'>Models</li><li><a href="AccessRule.html">AccessRule</a></li><li><a href="AppModel.html">AppModel</a></li><li><a href="Citation.html">Citation</a></li><li><a href="CollectionModel.html">CollectionModel</a></li><li><a href="DataONEObject.html">DataONEObject</a></li><li><a href="LookupModel.html">LookupModel</a></li><li><a href="Map.html">Map</a></li><li><a href="Metrics.html">Metrics</a></li><li><a href="QualityCheck.html">QualityCheck</a></li><li><a href="Search.html">Search</a></li><li><a href="SolrResult.html">SolrResult</a></li><li><a href="Stats.html">Stats</a></li><li class='category-heading' data-category='Models/Bookkeeper'>Models/Bookkeeper</li><li><a href="Quota.html">Quota</a></li><li><a href="Subscription.html">Subscription</a></li><li><a href="Usage.html">Usage</a></li><li class='category-heading' data-category='Models/Filters'>Models/Filters</li><li><a href="BooleanFilter.html">BooleanFilter</a></li><li><a href="ChoiceFilter.html">ChoiceFilter</a></li><li><a href="DateFilter.html">DateFilter</a></li><li><a href="Filter.html">Filter</a></li><li><a href="FilterGroup.html">FilterGroup</a></li><li><a href="NumericFilter.html">NumericFilter</a></li><li><a href="SpatialFilter.html">SpatialFilter</a></li><li><a href="ToggleFilter.html">ToggleFilter</a></li><li class='category-heading' data-category='Models/Formats'>Models/Formats</li><li><a href="ObjectFormat.html">ObjectFormat</a></li><li class='category-heading' data-category='Models/Maps'>Models/Maps</li><li><a href="AssetColor.html">AssetColor</a></li><li><a href="AssetColorPalette.html">AssetColorPalette</a></li><li><a href="Feature.html">Feature</a></li><li><a href="MapModel.html">MapModel</a></li><li><a href="VectorFilter.html">VectorFilter</a></li><li class='category-heading' data-category='Models/Maps/Assets'>Models/Maps/Assets</li><li><a href="Cesium3DTileset.html">Cesium3DTileset</a></li><li><a href="CesiumImagery.html">CesiumImagery</a></li><li><a href="CesiumTerrain.html">CesiumTerrain</a></li><li><a href="CesiumVectorData.html">CesiumVectorData</a></li><li><a href="Geohash.html">Geohash</a></li><li><a href="MapAsset.html">MapAsset</a></li><li class='category-heading' data-category='Models/Metadata'>Models/Metadata</li><li><a href="ScienceMetadata.html">ScienceMetadata</a></li><li class='category-heading' data-category='Models/Metadata/EML'>Models/Metadata/EML</li><li><a href="EMLMethodStep.html">EMLMethodStep</a></li><li><a href="EMLSpecializedText.html">EMLSpecializedText</a></li><li class='category-heading' data-category='Models/Metadata/EML211'>Models/Metadata/EML211</li><li><a href="EML211.html">EML211</a></li><li><a href="EMLAnnotation.html">EMLAnnotation</a></li><li><a href="EMLAttribute.html">EMLAttribute</a></li><li><a href="EMLDataTable.html">EMLDataTable</a></li><li><a href="EMLEntity.html">EMLEntity</a></li><li><a href="EMLGeoCoverage.html">EMLGeoCoverage</a></li><li><a href="EMLMeasurementScale.html">EMLMeasurementScale</a></li><li><a href="EMLMethods.html">EMLMethods</a></li><li><a href="EMLNonNumericDomain.html">EMLNonNumericDomain</a></li><li><a href="EMLNumericDomain.html">EMLNumericDomain</a></li><li><a href="EMLOtherEntity.html">EMLOtherEntity</a></li><li><a href="EMLParty.html">EMLParty</a></li><li><a href="EMLTemporalCoverage.html">EMLTemporalCoverage</a></li><li><a href="EMLText211.html">EMLText211</a></li><li><a href="EMLUnit.html">EMLUnit</a></li><li class='category-heading' data-category='Models/Metadata/EML220'>Models/Metadata/EML220</li><li><a href="EMLText.html">EMLText</a></li><li class='category-heading' data-category='Models/Portals'>Models/Portals</li><li><a href="PortalImage.html">PortalImage</a></li><li><a href="PortalModel.html">PortalModel</a></li><li><a href="PortalSectionModel.html">PortalSectionModel</a></li><li class='category-heading' data-category='Models/QueryFields'>Models/QueryFields</li><li><a href="QueryField.html">QueryField</a></li><li class='category-heading' data-category='Router'>Router</li><li><a href="UIRouter.html">UIRouter</a></li><li class='category-heading' data-category='Views'>Views</li><li><a href="AccessPolicyView.html">AccessPolicyView</a></li><li><a href="AccessRuleView.html">AccessRuleView</a></li><li><a href="AnnotationView.html">AnnotationView</a></li><li><a href="AppView.html">AppView</a></li><li><a href="CitationListView.html">CitationListView</a></li><li><a href="ColorPaletteView.html">ColorPaletteView</a></li><li><a href="DataCatalogViewWithFilters.html">DataCatalogViewWithFilters</a></li><li><a href="DataItemView.html">DataItemView</a></li><li><a href="DataPackageView.html">DataPackageView</a></li><li><a href="DraftsView.html">DraftsView</a></li><li><a href="EditCollectionView.html">EditCollectionView</a></li><li><a href="EditorView.html">EditorView</a></li><li><a href="FooterView.html">FooterView</a></li><li><a href="GroupListView.html">GroupListView</a></li><li><a href="ImageUploaderView.html">ImageUploaderView</a></li><li><a href="MarkdownEditorView.html">MarkdownEditorView</a></li><li><a href="MarkdownView.html">MarkdownView</a></li><li><a href="MdqRunView.html">MdqRunView</a></li><li><a href="MetadataView.html">MetadataView</a></li><li><a href="MetricModalView.html">MetricModalView</a></li><li><a href="MetricsChartView.html">MetricsChartView</a></li><li><a href="MetricView.html">MetricView</a></li><li><a href="NavbarView.html">NavbarView</a></li><li><a href="RegisterCitationView.html">RegisterCitationView</a></li><li><a href="SignInView.html">SignInView</a></li><li><a href="TableEditorView.html">TableEditorView</a></li><li><a href="TOCView.html">TOCView</a></li><li><a href="UserView.html">UserView</a></li><li class='category-heading' data-category='Views/Filters'>Views/Filters</li><li><a href="BooleanFilterView.html">BooleanFilterView</a></li><li><a href="ChoiceFilterView.html">ChoiceFilterView</a></li><li><a href="DateFilterView.html">DateFilterView</a></li><li><a href="FilterEditorView.html">FilterEditorView</a></li><li><a href="FilterGroupsView.html">FilterGroupsView</a></li><li><a href="FilterGroupView.html">FilterGroupView</a></li><li><a href="FilterView.html">FilterView</a></li><li><a href="NumericFilterView.html">NumericFilterView</a></li><li><a href="ToggleFilterView.html">ToggleFilterView</a></li><li class='category-heading' data-category='Views/Maps'>Views/Maps</li><li><a href="CesiumWidgetView.html">CesiumWidgetView</a></li><li><a href="FeatureInfoView.html">FeatureInfoView</a></li><li><a href="LayerDetailsView.html">LayerDetailsView</a></li><li><a href="LayerDetailView.html">LayerDetailView</a></li><li><a href="LayerInfoView.html">LayerInfoView</a></li><li><a href="LayerItemView.html">LayerItemView</a></li><li><a href="LayerListView.html">LayerListView</a></li><li><a href="LayerNavigationView.html">LayerNavigationView</a></li><li><a href="LayerOpacityView.html">LayerOpacityView</a></li><li><a href="LegendView.html">LegendView</a></li><li><a href="MapView.html">MapView</a></li><li><a href="ScaleBarView.html">ScaleBarView</a></li><li><a href="ToolbarView.html">ToolbarView</a></li><li class='category-heading' data-category='Views/Metadata'>Views/Metadata</li><li><a href="EML211EditorView.html">EML211EditorView</a></li><li><a href="EMLAttributeView.html">EMLAttributeView</a></li><li><a href="EMLEntityView.html">EMLEntityView</a></li><li><a href="EMlGeoCoverageView.html">EMlGeoCoverageView</a></li><li><a href="EMLMeasurementScaleView.html">EMLMeasurementScaleView</a></li><li><a href="EMLMeasurementTypeView.html">EMLMeasurementTypeView</a></li><li><a href="EMLMethodsView.html">EMLMethodsView</a></li><li><a href="EMLOtherEntityView.html">EMLOtherEntityView</a></li><li><a href="EMLPartyView.html">EMLPartyView</a></li><li><a href="EMLTempCoverageView.html">EMLTempCoverageView</a></li><li><a href="EMLView.html">EMLView</a></li><li><a href="ScienceMetadataView.html">ScienceMetadataView</a></li><li class='category-heading' data-category='Views/Portals'>Views/Portals</li><li><a href="PortalDataView.html">PortalDataView</a></li><li><a href="PortalHeaderView.html">PortalHeaderView</a></li><li><a href="PortalListView.html">PortalListView</a></li><li><a href="PortalLogosView.html">PortalLogosView</a></li><li><a href="PortalMembersView.html">PortalMembersView</a></li><li><a href="PortalSectionView.html">PortalSectionView</a></li><li><a href="PortalsSearchView.html">PortalsSearchView</a></li><li><a href="PortalUsagesView.html">PortalUsagesView</a></li><li><a href="PortalView.html">PortalView</a></li><li><a href="PortalVisualizationsView.html">PortalVisualizationsView</a></li><li class='category-heading' data-category='Views/Portals/Editor'>Views/Portals/Editor</li><li><a href="PortalEditorView.html">PortalEditorView</a></li><li><a href="PortEditorDataView.html">PortEditorDataView</a></li><li><a href="PortEditorImageView.html">PortEditorImageView</a></li><li><a href="PortEditorLogosView.html">PortEditorLogosView</a></li><li><a href="PortEditorMdSectionView.html">PortEditorMdSectionView</a></li><li><a href="PortEditorSectionsView.html">PortEditorSectionsView</a></li><li><a href="PortEditorSectionView.html">PortEditorSectionView</a></li><li><a href="PortEditorSettingsView.html">PortEditorSettingsView</a></li><li class='category-heading' data-category='Views/QueryBuilder'>Views/QueryBuilder</li><li><a href="QueryBuilderView.html">QueryBuilderView</a></li><li><a href="QueryRuleView.html">QueryRuleView</a></li><li class='category-heading' data-category='Views/SearchSelect'>Views/SearchSelect</li><li><a href="AccountSelectView.html">AccountSelectView</a></li><li><a href="AnnotationFilter.html">AnnotationFilter</a></li><li><a href="NodeSelect.html">NodeSelect</a></li><li><a href="ObjectFormatSelect.html">ObjectFormatSelect</a></li><li><a href="QueryFieldSelectView.html">QueryFieldSelectView</a></li><li><a href="SearchableSelectView.html">SearchableSelectView</a></li><li class='category-heading' data-category='Deprecated'>Deprecated</li><li><a href="AnnotatorView.html">AnnotatorView</a></li><li><a href="ExternalView.html">ExternalView</a></li><li><a href="LogsSearch.html">LogsSearch</a></li></ul><h3>Global</h3><ul><li><a href="global.html#appConfigPath">appConfigPath</a></li></ul>
</nav>

<div id="main">

    <h1 class="page-title">Source: src/js/views/filters/FilterEditorView.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/*global define */
define(['jquery', 'underscore', 'backbone',
  'models/filters/Filter',
  'models/filters/ChoiceFilter',
  'models/filters/DateFilter',
  'models/filters/ToggleFilter',
  'collections/queryFields/QueryFields',
  'views/searchSelect/QueryFieldSelectView',
  'views/filters/FilterView',
  'views/filters/ChoiceFilterView',
  'views/filters/DateFilterView',
  'views/filters/ToggleFilterView',
  'text!templates/filters/filterEditor.html'
],
  function ($, _, Backbone, Filter, ChoiceFilter, DateFilter, ToggleFilter, QueryFields,
    QueryFieldSelect, FilterView, ChoiceFilterView, DateFilterView, ToggleFilterView,
    Template) {
    'use strict';

    /**
    * @class FilterEditorView
    * @classdesc Creates a view of an editor for a custom search filter
    * @classcategory Views/Filters
    * @screenshot views/filters/FilterEditorView.png
    * @since 2.17.0
    * @name FilterEditorView
    * @extends Backbone.View
    * @constructor
    */
    var FilterEditorView = Backbone.View.extend(
    /** @lends FilterEditorView.prototype */{

        /**
         * A Filter model to be rendered and edited in this view. The Filter model must be
         * part of a Filters collection.
         //  TODO: Add support for boolean and number filters
         * @type {Filter|ChoiceFilter|DateFilter|ToggleFilter}
         */
        model: null,

        /**
         * If rendering an editor for a brand new Filter model, provide the Filters
         * collection instead of the Filter model. A new model will be created and, if the
         * user clicks save, it will be added to this Filters collection.
         * @type {Filters}
         */
        collection: null,

        /**
         * A reference to the PortalEditorView
         * @type {PortalEditorView}
         */
        editorView: undefined,

        /**
         * Set to true if rendering an editor for a brand new Filter model that is not yet
         * part of a Filters collection. If isNew is set to true, then the view requires a
         * Filters model set to the view's collection property. A model will be created.
         */
        isNew: false,

        /**
         * The HTML classes to use for this view's element
         * @type {string}
         */
        className: "filter-editor",

        /**
         * References to the template for this view. HTML files are converted to
         * Underscore.js templates
         * @type {Underscore.Template}
         */
        template: _.template(Template),

        /**
         * The classes to use for various elements in this view
         * @type {Object}
         * @property {string} fieldsContainer - the element in the template that
         * will contain the input where a user can select metadata fields for the custom
         * search filter.
         * @property {string} editButton - The button a user clicks to start
         * editing a search filter
         * @property {string} cancelButton - the element in the template that a
         * user clicks to undo any changes made to the filter and close the editing modal.
         * @property {string} saveButton - the element in the template that a user
         * clicks to add their filter changes to the parent Filters collection and close
         * the editing modal.
         * @property {string} deleteButton - the element in the template that a
         * user clicks to remove the Filter model from the Filters collection
         * @property {string} uiBuilderChoicesContainer - The container for the
         * uiBuilderChoices and the associated instruction text
         * @property {string} uiBuilderChoices - The container for each "button" a
         * user can click to switch the filter type
         * @property {string} uiBuilderChoice - The element that acts like a
         * button that switches the filter type
         * @property {string} uiBuilderChoiceActive - The class to add to a
         * uiBuilderChoice buttons when that option is active/selected
         * @property {string} uiBuilderLabel - The label that goes along with the
         * uiBuilderChoice element
         * @property {string} uiBuilderContainer - The element that will be turned
         * into a carousel that switches between each UI Builder view when a user switches
         * the filter type
         * @property {string} modalInstructions - The class to add to the
         * instruction text in the editing modal window
         */
        classes: {
          fieldsContainer: "fields-container",
          editButton: "edit-button",
          cancelButton: "cancel-button",
          saveButton: "save-button",
          deleteButton: "delete-button",
          uiBuilderChoicesContainer: "ui-builder-choices-container",
          uiBuilderChoices: "ui-builder-choices",
          uiBuilderChoice: "ui-builder-choice",
          uiBuilderChoiceActive: "selected",
          uiBuilderLabel: "ui-builder-choice-label",
          uiBuilderContainer: "ui-builder-container",
          modalInstructions: "modal-instructions",
        },

        /**
         * Strings to use to display various messages to the user in this view
         * @property {string} editButton - The text to show in the button a user clicks to
         * open the editing modal window.
         * @property {string} addFilterButton - The text to show in the button a user
         * clicks to add a new search filter and open an editing modal window.
         * @property {string} step1 - The instructions placed just before the fields input
         * @property {string} step2 - The instructions placed after the fields input and
         * before the uiBuilder select
         * @property {string} filterNotAllowed - The message to show when a filter type
         * doesn't work with the selected metadata fields
         * @property {string} saveButton - Text for the button at the bottom of the
         * editing modal that adds the filter model changes to the parent Filters
         * collection and closes the modal
         * @property {string} cancelButton - Text for the button at the bottom of the
         * editing modal that closes the modal window without making any changes.
         * @property {string} deleteButton - Text for the button at the bottom of the
         * editing modal that removes the Filter model from the Filters collection.
         * @property {string} validationError - The message to show at the top of the
         * modal when there is at least one validation error.
         * @property {string} noFilterOption - The message to show when there is no UI
         * available for the selected field or combination of fields.
         */
        text: {
          editButton: "EDIT",
          addFilterButton: "Add a search filter",
          step1: "Let people filter your data by",
          step2: "...using the following interface",
          filterNotAllowed: "This interface doesn't work with the metadata fields you" +
            " selected. Change the 'filter data by' option to use this interface.",
          saveButton: "Use these filter settings",
          cancelButton: "Cancel",
          deleteButton: "Remove filter",
          validationError: "Please provide the content flagged below before saving this " +
            "search filter.",
          noFilterOption: "There are currently no filter options available to support " +
            "this field, or this combination of fields. Change the 'filter data by' " +
            "option to select an interface."
        },

        /**
         * A function that returns a Backbone events object
         * @return {object} A Backbone events object - an object with the events this view
         * will listen to and the associated function to call.
         */
        events: function () {
          var events = {}
          events["click ." + this.classes.uiBuilderChoice] = "handleFilterIconClick"
          return events
        },

        /**
         * A list of query fields names to exclude from the list of options in the
         * QueryFieldSelectView
         * @type {string[]}
         */
        excludeFields: MetacatUI.appModel.get("collectionQueryExcludeFields"),

        /**
         * An additional field object contains the properties for an additional query
         * field to add to the QueryFieldSelectView that are required to render it
         * correctly. An additional query field is one that does not actually exist in the
         * query service index.
         *
         * @typedef {Object} AdditionalField
         *
         * @property {string} name - A unique ID to represent this field. It must not
         * match the name of any other query fields.
         * @property {string[]} fields - The list of real query fields that this
         * abstracted field will represent. It must exactly match the names of the query
         * fields that actually exist.
         * @property {string} label - A user-facing label to display.
         * @property {string} description - A description for this field.
         * @property {string} category - The name of the category under which to place
         * this field. It must match one of the category names for an existing query
         * field.
         */

        /**
         * A list of additional fields which are not retrieved from the query service
         * index, but which should be added to the list of options in the
         * QueryFieldSelectView. This can be used to add abstracted fields which are a
         * combination of multiple query fields, or to add a duplicate field that has a
         * different label.
         *
         * @type {AdditionalField[]}
         */
        specialFields: [],

        /**
         * The path to the directory that contains the SVG files which are used like an
         * icon to represent each UI type
         * @type {string}
         */
        iconDir: "templates/filters/filterIcons/",

        /**
        * A single type of custom search filter that a user can select. An option
        * represents a specific Filter model type and uses that associated Filter View.
        * @typedef {Object} UIBuilderOption
        * @property {string} label - The user-facing label to show for this option
        * @property {string} modelType - The name of the filter model type that that this
        * UI builder should create. Only one is allowed. The model must be one of the six
        * filters that are allowed in a Portal "UIFilterGroupType". See
        * {@link https://github.com/DataONEorg/collections-portals-schemas/blob/master/schemas/portals.xsd}.
        * @property {string} iconFileName - The file name, including extension, of the SVG
        * icon used to represent this option
        * @property {string} description - A very brief, user-facing description of how
        * this filter works
        * @property {string[]} filterTypes - An array of one or more filter types that are
        * allowed for this interface. If none are provided then any filter type is
        * allowed. Filter types are one of the four keys defined in
        * {@link QueryField#filterTypesMap}, and correspond to one of the four filter
        * types that are allowed in a Collection definition. See
        * {@link https://github.com/DataONEorg/collections-portals-schemas/blob/master/schemas/collections.xsd}.
        * This property is used to help users match custom search filter UIs to
        * appropriate query fields.
        * @property {function} modelFunction - A function that takes an optional object
        * with model properties and returns an instance of a model to use for this UI
        * builder
        * @property {function} uiFunction - A function that takes the model as an argument
        * and returns the filter UI builder view for this option
        */

        /**
         * The list of UI types that a user can select from. They will appear in the
         * carousel in the order they are listed here.
         * @type {UIBuilderOption[]}
         */
        uiBuilderOptions: [
          {
            label: "Free text",
            modelType: "Filter",
            iconFileName: "filter.svg",
            description: "Allow people to search using any text they enter",
            filterTypes: ["filter"],
            modelFunction: function (attrs) {
              return new Filter(attrs)
            },
            uiFunction: function (model) {
              return new FilterView({
                model: model,
                mode: "uiBuilder"
              });
            }
          },
          {
            label: "Dropdown",
            modelType: "ChoiceFilter",
            iconFileName: "choice.svg",
            description: "Allow people to select a search term from a list of options",
            filterTypes: ["filter"],
            modelFunction: function (attrs) {
              return new ChoiceFilter(attrs)
            },
            uiFunction: function (model) {
              return new ChoiceFilterView({
                model: model,
                mode: "uiBuilder"
              });
            }
          },
          {
            label: "Year slider",
            modelType: "DateFilter",
            iconFileName: "number.svg",
            description: "Let people search for a range of years",
            filterTypes: ["dateFilter"],
            modelFunction: function (attrs) {
              return new DateFilter(attrs)
            },
            uiFunction: function (model) {
              return new DateFilterView({
                model: model,
                mode: "uiBuilder"
              });
            }
          },
          {
            label: "Toggle",
            modelType: "ToggleFilter",
            iconFileName: "toggle.svg",
            description: "Let people add or remove a single, specific search term",
            filterTypes: ["filter"],
            modelFunction: function (attrs) {
              return new ToggleFilter(attrs)
            },
            uiFunction: function (model) {
              return new ToggleFilterView({
                model: model,
                mode: "uiBuilder"
              });
            }
          }
        ],

        /**
         * Executed when this view is created
         * @param {object} options - A literal object of options to pass to this view
         * @property {Filter|ChoiceFilter|DateFilter|ToggleFilter} options.model - The
         * filter model to render an editor for. It must be part of a Filters collection.
         */
        initialize: function (options) {
          try {

            // Ensure the query fields are cached for limitUITypes()
            if (typeof MetacatUI.queryFields === "undefined") {
              MetacatUI.queryFields = new QueryFields();
              MetacatUI.queryFields.fetch();
            }

            if (!options || typeof options != "object") {
              var options = {};
            }

            this.editorView = options.editorView || null;

            if (!options.isNew) {
              // If this view is an editor for an existing Filter model, check that the model
              // and the Filters collection is provided.
              if (!options.model) {
                console.log("A Filter model is required to render a Filter Editor View");
                return
              }
              if (!options.model.collection) {
                console.log("The Filter model for a FilterEditorView must be part of a" +
                  " Filters collection");
                return
              }
              // Set the model and collection on the view
              this.model = options.model
              this.collection = options.model.collection
            } else {
              // If this is an editor for a new Filter model, create a default model and
              // make sure there is a Filters collection to add it to
              if (!options.collection) {
                console.log("A Filters collection is required to render a " +
                  "FilterEditorView for a new Filters model.");
                return
              }
              this.model = new Filter()
              this.collection = options.collection
              this.isNew = true
            }


          } catch (error) {
            console.log("Error creating an FilterEditorView. Error details: " + error);
          }
        },

        /**
         * Render the view
         */
        render: function () {
          try {
            // Save a reference to this view
            var view = this;

            // Create and insert an "edit" or a "add filter" button for the filter.
            var buttonText = this.text.editButton,
              buttonClasses = this.classes.editButton,
              buttonIcon = "pencil";

            // Text &amp; styling is different for the "add a new filter" button
            if (this.isNew) {
              buttonText = this.text.addFilterButton;
              buttonIcon = "plus";
              buttonClasses = buttonClasses + " btn";
              this.$el.addClass("new");
            }
            var editButton = $("&lt;a class='" + buttonClasses + "'>" +
              "&lt;i class='icon icon-" + buttonIcon + " icon-on-left'>&lt;/i> " +
              buttonText + "&lt;/a>");
            this.$el.prepend(editButton);

            // Render the editor modal on-the-fly to make the application load faster.
            // No need to create editing modals for filters that a user doesn't edit.
            editButton.on("click", function () {
              view.renderEditorModal.call(view);
            });

            // Save a reference to this view
            this.$el.data("view", this);
            return this
          } catch (error) {
            console.log("Error rendering an FilterEditorView. Error details: " + error);
          }
        },

        /**
         * Render and show the modal window that has all the components for editing a
         * filter. This is created on-the-fly because creating these modals all at once in
         * a FilterGroupsView in edit mode takes too much time.
         */
        renderEditorModal: function () {
          try {

            // Save a reference to this view
            var view = this;

            // The list of UI Filter Editor options needs to be mutable. We will save the
            // draft filter models, and the associated editor views to this list. Rewrite
            // this.uiBuilders every time the editor modal is re-rendered.
            this.uiBuilders = [];
            this.uiBuilderOptions.forEach(function (opt) {
              this.uiBuilders.push(_.clone(opt))
            }, this);

            // Create and insert the modal window that will contain the editing interface
            var modalHTML = this.template({
              classes: view.classes,
              text: view.text
            });
            this.modalEl = $(modalHTML);
            this.$el.append(this.modalEl);

            // Start rendering the metadata field input only after the modal is shown.
            // Otherwise this step slows the rendering down, leaves too much of a delay
            // before the modal appears.
            this.modalEl.off();
            this.modalEl.on("shown", function (event) {
              view.modalEl.off("shown");
              view.renderFieldInput();
            });
            this.modalEl.modal("show");

            // Add listeners to the modal buttons save or cancel changes
            this.activateModalButtons();

            // Create and insert the "buttons" to switch filter type, and the elements
            // that will contain the UI building interfaces for each filter type.
            this.renderUIBuilders();

            // Select and render the UI Filter Editor for the filter model set on this
            // view.
            this.switchFilterType();

            // Disable any filter types that do not match the currently selected fields
            this.handleFieldChange(_.clone(view.model.get("fields")));

          }
          catch (error) {
            console.log('There was an error rendering the modal in a FilterEditorView' +
              ' Error details: ' + error);
          }
        },

        /**
         * Hide and destroy the filter editor modal window
         */
        hideModal: function () {
          try {
            var view = this;
            view.modalEl.off("hidden");
            view.modalEl.on("hidden", function () {
              view.modalEl.off();
              view.modalEl.remove();
            });
            view.modalEl.modal("hide");
          }
          catch (error) {
            console.log(
              'There was an error hiding the editing modal in a FilterEditorView' +
              '. Error details: ' + error
            );
          }
        },

        /**
         * Find the save and cancel buttons in the editing modal window, and add listeners
         * that close the modal and update the Filters collection on save
         */
        activateModalButtons: function () {
          try {

            var view = this;
            // The buttons at the bottom of the modal
            var saveButton = this.modalEl.find("." + this.classes.saveButton),
              cancelButton = this.modalEl.find("." + this.classes.cancelButton),
              deleteButton = this.modalEl.find("." + this.classes.deleteButton);

            // Add listeners to the modal's "delete", "save", and "cancel" buttons.

            // SAVE
            saveButton.on('click', function (event) {

              // Don't allow user to save a filter with a field that doesn't have a
              // matching UI type supported yet.
              if (view.noFilterOptions) {
                view.handleErrors()
                // Switch the message from "warning" to "error" so that it's clear this is
                // the reason the user cannot save the filter
                view.showNoFilterOptionMessage(false, "error");
                return
              }

              var results = view.createModel();

              if (results.success === false) {
                view.handleErrors(results.errors)
                return
              }

              saveButton.off('click');
              view.hideModal();
              // Only update the collection after the modal has closed because adding a
              // new model triggers a re-render of the FilterGroupsView which interferes
              // with removing the modal.
              var oldModel = view.model;
              // Update the filter model in the parent Filters collection
              view.model = view.collection.replaceModel(oldModel, results.model);

              if (view.editorView) {
                view.editorView.showControls();
              }

            });

            // CANCEL
            cancelButton.on('click', function (event) {
              cancelButton.off('click');
              view.hideModal();
            })

            // DELETE
            deleteButton.on('click', function (event) {
              deleteButton.off('click');
              view.hideModal();
              if (!view.isNew) {
                view.collection.remove(view.model)
              }
              if (view.editorView) {
                view.editorView.showControls();
              }
            })

          }
          catch (error) {
            console.log(
              "There was an error activating the modal buttons in a FilterEditorView" +
              ". Error details: " + error
            );
          }
        },

        /**
         * Create and insert the "buttons" to switch filter type and the elements
         * that will contain the UI building interfaces for each filter type.
         */
        renderUIBuilders: function () {
          try {
            var view = this;

            // The container for the list of filter icons that allows users to switch
            // between filter types, plus the associated instruction paragraph
            var uiBuilderChoicesContainer = this.modalEl.find("." + this.classes.uiBuilderChoicesContainer);

            // The container for just the icons/buttons
            var uiBuilderChoices = $("&lt;div>&lt;/div>").addClass(this.classes.uiBuilderChoices);
            uiBuilderChoicesContainer.append(uiBuilderChoices);

            // uiBuilderCarousel will contain all of the UIBuilder views as slides
            this.uiBuilderCarousel = this.modalEl.find("." + this.classes.uiBuilderContainer);

            // The bootstrap carousel plugin requires the carousel slide times to be
            // contained within an inner div with the class 'carousel-inner'
            var carouselInner = $('&lt;div class="carousel-inner">&lt;/div>');
            this.uiBuilderCarousel.append(carouselInner);

            // Create a container and button for each uiBuilder option
            this.uiBuilders.forEach(function (uiBuilder) {

              // Create a label button that allows the user to select the given UI

              // Create the button label
              var labelEl = $("&lt;h5>" + uiBuilder.label + "&lt;/h5>")
                .addClass(view.classes.uiBuilderLabel);
              // Create the button
              var button = $("&lt;div>&lt;/div>")
                .addClass(view.classes.uiBuilderChoice)
                .attr("data-filter-type", uiBuilder.modelType)
                .append(labelEl);
              // Insert the uiBuilder icon SVG into the button
              var svgPath = 'text!' + this.iconDir + uiBuilder.iconFileName;
              require([svgPath], function (svgString) {
                button.append(svgString)
              });
              // Add a tooltip with description to the button
              button.tooltip({
                title: uiBuilder.description,
                delay: {
                  show: 900,
                  hide: 50
                }
              })
              // Insert the button into the list of uiBuilder choices
              uiBuilderChoices.append(button);
              // Create and insert the container / carousel slide. The carousel plugin
              // requires slides to have the class 'item'. Save the container to the
              // list of uiBuilder options.
              var uiBuilderContainer = $('&lt;div class="item">&lt;/div>');
              carouselInner.append(uiBuilderContainer);

              // Add the button and container to the list of uiBuilders to make it
              // easy to switch between filter types
              uiBuilder.container = uiBuilderContainer;
              uiBuilder.button = button;

            }, this);

            // Initialize the carousel
            this.uiBuilderCarousel.addClass("slide");
            this.uiBuilderCarousel.addClass("carousel");
            this.uiBuilderCarousel.carousel({
              interval: false
            });
            // Need active class on at least one item for carousel to work properly
            this.uiBuilderCarousel.find(".item").first().addClass("active");
          }
          catch (error) {
            console.log(
              'There was an error rendering the UI filter builders in a FilterEditorView' +
              '. Error details: ' + error
            );
          }
        },

        /**
         * Create and insert the component that is used to edit the fields attribute of a
         * Filter Model. Save it to the view so that the selected fields can be accessed
         * on save.
         */
        renderFieldInput: function () {
          try {
            var view = this;
            var selectedFields = _.clone(view.model.get("fields"));
            view.fieldInput = new QueryFieldSelect({
              selected: selectedFields,
              inputLabel: "Select one or more metadata fields",
              excludeFields: view.excludeFields,
              addFields: view.specialFields,
              separatorText: view.model.get("fieldsOperator"),
            })
            view.modalEl.find("." + view.classes.fieldsContainer).append(view.fieldInput.el)
            view.fieldInput.render();

            // When the field input is changed, limit UI options to options that match
            // this field type
            view.fieldInput.off("changeSelection")
            view.fieldInput.on("changeSelection", function (selectedFields) {
              view.handleFieldChange.call(view, selectedFields);
            })
          }
          catch (error) {
            console.log('There was an error rendering a fields input in a FilterEditorView' +
              ' Error details: ' + error);
          }
        },

        /**
         * Run whenever the user selects or removes fields from the Query Field input.
         * This function checks which filter UIs support the type of Query Field selected,
         * and then blocks or enables the UIs in the editor. This is done to help prevent
         * users from building mis-matched search filters, e.g. "Year Slider" filters with
         * text query fields.
         * @param {string[]} selectedFields The Query Field names (i.e. Solr field names)
         * of the newly selected fields
         */
        handleFieldChange: function (selectedFields) {

          try {
            var view = this;

            // Enable all UI types if no field is selected yet
            if (!selectedFields || !selectedFields.length || selectedFields[0] === "") {
              this.uiBuilders.forEach(function (uiBuilder) {
                view.allowUI(uiBuilder)
              })
              return
            }

            // If at least one field is selected, then limit the available UI types to
            // those that match the type of Query Field.
            var type = MetacatUI.queryFields.getRequiredFilterType(selectedFields)

            this.uiBuilders.forEach(function (uiBuilder) {
              if (uiBuilder.filterTypes.includes(type)) {
                view.allowUI(uiBuilder)
              } else {
                view.blockUI(uiBuilder)
              }
            })
          }
          catch (error) {
            console.log(
              'There was an error handling a field change in a FilterEditorView' +
              '. Error details: ' + error
            );
          }

        },

        /**
         * Marks a UI builder is blocked (so that it can't be selected) and updates the
         * tooltip with text explaining that this UI can't be used with the selected
         * fields. If the UI to block is the currently selected UI, then switches to the
         * next allowed UI. If there are no UIs that are allowed, then shows a message and
         * hides all UI builders.
         * @param {UIBuilderOption} uiBuilder - The UI builder Object to block
         */
        blockUI: function (uiBuilder) {
          try {
            var view = this;
            uiBuilder.allowed = false;
            uiBuilder.button.addClass("disabled")
            uiBuilder.button.tooltip("destroy")
            uiBuilder.button.tooltip({
              title: view.text.filterNotAllowed,
              delay: {
                show: 400,
                hide: 50
              }
            })
            // If the current UI is a blocked one...
            if (this.currentUIBuilder === uiBuilder) {
              // ... switch to the next unblocked one.
              var allowedUIBuilder = _.findWhere(this.uiBuilders, { allowed: true });
              if (allowedUIBuilder) {
                view.switchFilterType(allowedUIBuilder.modelType)
              } else {
                // If there is no UI available, then show a message
                this.showNoFilterOptionMessage()
              }
            }
          }
          catch (error) {
            console.log(
              'There was an error blocking a filter UI builder in a FilterEditorView' +
              '. Error details: ' + error
            );
          }
        },

        /**
         * Marks a UI builder is allowed (so that it can be selected) and updates the
         * tooltip text with the description of this UI. If it's displayed, this function
         * hides the message that indicates that there are no allowed UIs that match the
         * selected query fields.
         * @param {UIBuilderOption} uiBuilder - The UI builder Object to block
         */
        allowUI: function (uiBuilder) {

          try {
            // If at least one UI is allowed, then make sure the "no filter message" is
            // hidden.
            if (this.noFilterOptions) {
              this.hideNoFilterOptionMessage()
            }
            uiBuilder.allowed = true;
            uiBuilder.button.removeClass("disabled")
            uiBuilder.button.tooltip("destroy")
            uiBuilder.button.tooltip({
              title: uiBuilder.description,
              delay: {
                show: 900,
                hide: 50
              }
            })
          }
          catch (error) {
            console.log(
              'There was an error unblocking a filter UI builder in a FilterEditorView' +
              '. Error details: ' + error
            );
          }
        },

        /**
         * Hides all filter builder UIs and displays a warning message indicating that
         * there are currently no UI options that support the selected fields.
         * @param {string} message A message to show. If not set, then the string set in
         * the view's text.noFilterOption attribute is used.
         * @param {string} [type="warning"] The type of message to display (warning,
         * error, or info)
         */
        showNoFilterOptionMessage: function (message, type="warning") {
          try {
            this.noFilterOptions = true;
            if (!message) {
              message = this.text.noFilterOption
            }
            if (this.noFilterOptionMessageEl) {
              this.noFilterOptionMessageEl.remove()
            }
            this.noFilterOptionMessageEl = $(
              '&lt;div class="alert alert-' + type + '">' + message + '&lt;/div>'
            )
            this.uiBuilderCarousel.hide()
            this.uiBuilderCarousel.after(this.noFilterOptionMessageEl)
          }
          catch (error) {
            console.log(
              'There was an error showing a message to indicate that no filter builder ' +
              'UI options are allowed in a FilterEditorView' +
              '. Error details: ' + error
            );
          }
        },

        /**
         * Removes the message displayed by the
         * {@link FilterEditorView#showNoFilterOptionMessage} function and un-hides all
         * the filter builder UIs.
         */
        hideNoFilterOptionMessage: function () {
          try {
            this.noFilterOptions = false;
            if (this.noFilterOptionMessageEl) {
              this.noFilterOptionMessageEl.remove()
              console.log(this.noFilterOptionMessageEl);
            }
            if (this.uiBuilderCarousel.is(':hidden')) {
              this.uiBuilderCarousel.show()
            }
          }
          catch (error) {
            console.log(
              'There was an error hiding a message in a FilterEditorView' +
              '. Error details: ' + error
            );
          }
        },

        /**
         * Functions to run when a user clicks the "save" button in the editing modal
         * window. Creates a new Filter model with all of the new attributes that the user
         * has selected. Checks if the model is valid. If it is, then returns the model.
         * If it is not, then returns the errors.
         * @param {Object} event The click event
         * @return {Object} Returns an object with a success property set to either true
         * (if there were no errors), or false (if there were errors). If there were
         * errors, then the object also has an errors property with the errors return from
         * the Filter validate function. If there were no errors, then the object contains
         * a model property with the new Filter to be saved to the Filters collection.
         */
        createModel: function (event) {
          try {
            var selectedUI = this.currentUIBuilder,
              newModelAttrs = selectedUI.draftModel.toJSON();

            // Set the new fields
            newModelAttrs.fields = _.clone(this.fieldInput.selected);
            // set the new fieldsOperator
            newModelAttrs.fieldsOperator = this.fieldInput.separatorText;

            delete newModelAttrs.objectDOM
            delete newModelAttrs.cid

            // The collection's model function identifies the type of model to create
            // based on the filterType attribute. Create a model before we add it to the
            // collection, so that we can make sure it's valid first, while still allowing
            // a user to press the UNDO button and not add any changes to the Filters
            // collection.
            var newModel = this.collection.model(newModelAttrs);

            // Check if the filter is valid.
            var newModelErrors = newModel.validate();
            if (newModelErrors) {
              return {
                success: false,
                errors: newModelErrors
              }
            } else {
              return {
                success: true,
                model: newModel
              }
            }
          }
          catch (error) {
            console.log('There was an error updating a Filter model in a FilterEditorView' +
              ' Error details: ' + error);
          }
        },

        /**
         * Shows errors in the filter editor modal window.
         * @param {object} errors An object where keys represent the Filter model
         * attribute that has an error, and the corresponding value explains the error in
         * text.
         */
        handleErrors: function (errors) {
          try {
            var view = this;

            // Show a general error message in the modal. (Don't add it twice.)
            if (view.validationErrorEl) {
              view.validationErrorEl.remove()
            }
            view.validationErrorEl = $('&lt;p class="alert alert-error">' + view.text.validationError + '&lt;/p>')
            this.$el.find(".modal-body").prepend(view.validationErrorEl)

            if (errors) {
              // Show an error for the "fields" attribute (common to all Filters)
              if (errors.fields) {
                view.fieldInput.showMessage(errors.fields, "error", true)
              }

              // Show errors for the attributes specific to each Filter type
              view.currentUIBuilder.view.showValidationErrors(errors)
            }
          }
          catch (error) {
            console.log(
              'There was an error  in a FilterEditorView' +
              '. Error details: ' + error
            );
          }
        },

        /**
         * Function that takes the event when a user clicks on one of the filter type
         * options, gets the name of the desired filter type, and passes it to the switch
         * filter function.
         * @param {object} event The click event
         */
        handleFilterIconClick: function (event) {
          try {

            // Get the new Filter Type from the click event. The name of the new Filter
            // Type is stored as a data attribute in the clicked Filter icon.
            // var filterTypeIcon = 
            var newFilterType = event.currentTarget.dataset.filterType;

            // Pass the Filter Type to the switch filter function
            this.switchFilterType(newFilterType)
          }
          catch (error) {
            console.log('There was an error handling a click event in a FilterEditorView' +
              ' Error details: ' + error);
          }
        },

        /**
         * Switches the current draft Filter model to a different Filter model type.
         * Carries over any common attributes from the previously selected filter type.
         * If no filter type is provided, defaults to type of the view's model
         * @param {string} newFilterType The name of the filter type to switch to
         */
        switchFilterType: function (newFilterType) {
          try {

            var view = this;

            // Use the filter type of the model if none is provided.
            if (!newFilterType) {
              newFilterType = this.model.type
            }

            // Get the properties of the Filter UI Editor for the new filter type.
            var uiBuilder = _.findWhere(this.uiBuilders, { modelType: newFilterType });

            // Don't allow user to build a mis-matched filter (e.g. text filter with date
            // field)
            if (uiBuilder.allowed === false) {
              return
            }

            // (Index is used for the carousel)
            var index = this.uiBuilders.indexOf(uiBuilder);

            // Treat the first Filter in the list of filter UI editor options as the
            // default
            if (!uiBuilder) {
              uiBuilder = this.uiBuilders[0];
              filterType = uiBuilder.modelType
            }

            // Create an object with the properties to pass on to the new draft model
            var newModelAttrs = {}

            // If there is a currently selected UI editor, then find the common model
            // attributes that we should pass on to the new UI editor type
            if (this.currentUIBuilder) {
              newModelAttrs = this.getCommonAttributes(
                this.currentUIBuilder.draftModel,
                newFilterType
              )
            }
            // All search filter models are UI Filter Type
            newModelAttrs.isUIFilterType = true

            // If a UI editor has already been created for this Filter Type, then just
            // update the pre-existing draft model. This way, if a user has already
            // selected content that is specific to a filter type (e.g. choices for a
            // choiceFilter), that content will still be there when they switch back to
            // it. Otherwise, use a clone of the model set on this view. We will update
            // the actual model in the Filters collection only when the user clicks save.
            if (!uiBuilder.draftModel) {
              if (this.model.type == newFilterType) {
                uiBuilder.draftModel = this.model.clone()
              } else {
                uiBuilder.draftModel = uiBuilder.modelFunction({ isUIFilterType: true });
              }
            }

            if (Object.keys(newModelAttrs).length) {
              uiBuilder.draftModel.set(newModelAttrs)
            }
            // Save the new selection to the view
            this.currentUIBuilder = uiBuilder;

            // Find the container for this filter type
            var uiBuilderContainer = uiBuilder.container;

            // Create or update view
            this.currentUIBuilder.view = this.currentUIBuilder.uiFunction(uiBuilder.draftModel);
            uiBuilderContainer.html(this.currentUIBuilder.view.el)
            this.currentUIBuilder.view.render();

            // Add the selected/active class to the clicked FilterTypeIcon, remove it from
            // the other icons.
            this.uiBuilders.forEach(function (uiBuilder) {
              uiBuilder.button.removeClass(view.classes.uiBuilderChoiceActive)
            })
            this.currentUIBuilder.button.addClass(view.classes.uiBuilderChoiceActive);

            // Have the carousel slide to the selected uiBuilder container.
            this.uiBuilderCarousel.carousel(index)

          }
          catch (error) {
            console.log(
              'There was an error switching filter types in a FilterEditorView.' +
              ' Error details: ' + error);
          }
        },

        /**
         * Checks for attribute keys that are the same between a given Filter model, and a
         * new Filter model type. Returns an object of model attributes that are relevant
         * to the new Filter model type. The values for this object will be pulled from
         * the given model. objectDOM, cid, and nodeName attributes are always excluded.
         *
         * @param {Filter} filterModel A filter model
         * @param {string} newFilterType The name of the new filter model type
         *
         * @returns {Object} returns the model attributes from the given filterModel that
         * are also relevant to the new Filter model type.
         */
        getCommonAttributes: function (filterModel, newFilterType) {
          try {

            // The filter model attributes that are common to both the current Filter Model
            // and the new Filter Type that we want to create.
            var commonAttributes = {};

            // Given the newFilterType string, get the default attribute names for a new
            // model of that type. 
            var uiBuilder = _.findWhere(this.uiBuilders, { modelType: newFilterType });
            var defaultAttrs = uiBuilder.modelFunction().defaults();
            var defaultAttrNames = Object.keys(defaultAttrs);

            // Check if any of those attribute types exist in the current filter model.
            // If they do, include them in the common attributes object.
            var currentAttrs = filterModel.toJSON();
            defaultAttrNames.forEach(function (attrName) {
              var valueInDraftModel = currentAttrs[attrName];
              if (valueInDraftModel || valueInDraftModel === 0 | valueInDraftModel === false) {
                commonAttributes[attrName] = valueInDraftModel
              }
            }, this);

            // Exclude attributes that shouldn't be passed to a new model, like the
            // objectDOM and the model ID.
            delete commonAttributes.objectDOM
            delete commonAttributes.cid
            delete commonAttributes.nodeName

            // Return the common attributes
            return commonAttributes
          }
          catch (error) {
            console.log(
              'There was an error getting common model attributes in a FilterEditorView' +
              '. Error details: ' + error);
          }
        },

      })
    return FilterEditorView
  });</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
