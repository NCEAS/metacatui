<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>MetacatUI Dev Docs: Source: src/js/models/filters/Filter.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
    <link type="text/css" rel="stylesheet" href="/metacatui/assets/css/styles.css">
    <link type="text/css" rel="stylesheet" href="styles/style.css">
</head>

<body>

<nav id="nav">
    <a href="/">
      <div class="logo">
<svg class="cat" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="cat" class="svg-inline--fa fa-cat fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M290.59 192c-20.18 0-106.82 1.98-162.59 85.95V192c0-52.94-43.06-96-96-96-17.67 0-32 14.33-32 32s14.33 32 32 32c17.64 0 32 14.36 32 32v256c0 35.3 28.7 64 64 64h176c8.84 0 16-7.16 16-16v-16c0-17.67-14.33-32-32-32h-32l128-96v144c0 8.84 7.16 16 16 16h32c8.84 0 16-7.16 16-16V289.86c-10.29 2.67-20.89 4.54-32 4.54-61.81 0-113.52-44.05-125.41-102.4zM448 96h-64l-64-64v134.4c0 53.02 42.98 96 96 96s96-42.98 96-96V32l-64 64zm-72 80c-8.84 0-16-7.16-16-16s7.16-16 16-16 16 7.16 16 16-7.16 16-16 16zm80 0c-8.84 0-16-7.16-16-16s7.16-16 16-16 16 7.16 16 16-7.16 16-16 16z"></path></svg>

<svg width="459px" height="53px" viewBox="0 0 459 53" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
    <g id="metacatui" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
        <path d="M16.492,52 C17.212,52 17.812,51.748 18.292,51.244 C18.772,50.74 19.012,50.128 19.012,49.408 L19.012,49.408 L18.94,22.912 L30.82,37.816 C31.204,38.344 31.72,38.764 32.368,39.076 C33.016,39.388 33.7,39.544 34.42,39.544 C35.908,39.544 37.132,38.896 38.092,37.6 L38.092,37.6 L49.684,22.912 L49.684,49.408 C49.684,50.128 49.96,50.74 50.512,51.244 C51.064,51.748 51.7,52 52.42,52 L52.42,52 L62.068,52 C62.788,52 63.388,51.748 63.868,51.244 C64.348,50.74 64.588,50.128 64.588,49.408 L64.588,49.408 L64.588,4.12 C64.588,3.448 64.336,2.86 63.832,2.356 C63.328,1.852 62.74,1.6 62.068,1.6 L62.068,1.6 L52.348,1.6 C51.388,1.6 50.56,1.648 49.864,1.744 C49.168,1.84 48.532,2.152 47.956,2.68 L47.956,2.68 L33.916,17.296 L20.524,2.608 C20.332,2.368 19.972,2.14 19.444,1.924 C18.916,1.708 18.412,1.6 17.932,1.6 L17.932,1.6 L6.772,1.6 C6.052,1.6 5.44,1.852 4.936,2.356 C4.432,2.86 4.18,3.448 4.18,4.12 L4.18,4.12 L4.18,49.408 C4.18,50.08 4.432,50.68 4.936,51.208 C5.44,51.736 6.052,52 6.772,52 L6.772,52 L16.492,52 Z M110.74,52 C111.556,52 112.264,51.676 112.864,51.028 C113.464,50.38 113.764,49.624 113.764,48.76 L113.764,48.76 L113.764,42.568 C113.764,41.608 113.464,40.828 112.864,40.228 C112.264,39.628 111.556,39.328 110.74,39.328 L110.74,39.328 L89.428,39.328 L89.428,32.92 L109.732,32.92 C110.5,32.92 111.184,32.596 111.784,31.948 C112.384,31.3 112.684,30.568 112.684,29.752 L112.684,29.752 L112.684,23.488 C112.684,22.576 112.384,21.82 111.784,21.22 C111.184,20.62 110.5,20.32 109.732,20.32 L109.732,20.32 L89.428,20.32 L89.428,14.488 L110.74,14.488 C111.508,14.488 112.204,14.164 112.828,13.516 C113.452,12.868 113.764,12.136 113.764,11.32 L113.764,11.32 L113.764,5.056 C113.764,4.144 113.464,3.388 112.864,2.788 C112.264,2.188 111.556,1.888 110.74,1.888 L110.74,1.888 L76.756,1.888 C75.94,1.888 75.232,2.188 74.632,2.788 C74.032,3.388 73.732,4.144 73.732,5.056 L73.732,5.056 L73.732,48.76 C73.732,49.624 74.032,50.38 74.632,51.028 C75.232,51.676 75.94,52 76.756,52 L76.756,52 L110.74,52 Z M147.604,52 C148.42,52 149.104,51.688 149.656,51.064 C150.208,50.44 150.484,49.672 150.484,48.76 L150.484,48.76 L150.484,16.216 L161.86,16.216 C162.676,16.216 163.396,15.904 164.02,15.28 C164.644,14.656 164.956,13.936 164.956,13.12 L164.956,13.12 L164.956,4.768 C164.956,4 164.644,3.316 164.02,2.716 C163.396,2.116 162.676,1.816 161.86,1.816 L161.86,1.816 L124.132,1.816 C123.22,1.816 122.464,2.104 121.864,2.68 C121.264,3.256 120.964,3.952 120.964,4.768 L120.964,4.768 L120.964,13.12 C120.964,13.936 121.264,14.656 121.864,15.28 C122.464,15.904 123.22,16.216 124.132,16.216 L124.132,16.216 L135.652,16.216 L135.148,48.832 C135.148,49.744 135.424,50.5 135.976,51.1 C136.528,51.7 137.212,52 138.028,52 L138.028,52 L147.604,52 Z M175.828,52 C176.836,52 177.676,51.82 178.348,51.46 C179.02,51.1 179.452,50.584 179.644,49.912 L179.644,49.912 L181.876,42.712 L197.932,42.712 L200.164,49.912 C200.356,50.584 200.8,51.1 201.496,51.46 C202.192,51.82 203.044,52 204.052,52 L204.052,52 L213.916,52 C215.836,51.712 216.796,50.704 216.796,48.976 C216.796,48.304 216.676,47.596 216.436,46.852 C216.196,46.108 216.052,45.616 216.004,45.376 L216.004,45.376 L199.876,4.84 C199.588,3.976 199.036,3.232 198.22,2.608 C197.404,1.984 196.372,1.648 195.124,1.6 L195.124,1.6 L184.756,1.6 C183.604,1.648 182.608,1.948 181.768,2.5 C180.928,3.052 180.292,3.832 179.86,4.84 L179.86,4.84 L163.876,45.376 C163.828,45.472 163.672,45.916 163.408,46.708 C163.144,47.5 163.012,48.304 163.012,49.12 C163.012,50.752 163.948,51.712 165.82,52 L165.82,52 L175.828,52 Z M195.34,30.544 L184.036,30.544 L189.652,13.624 L195.34,30.544 Z M245.38,53.08 C250.612,53.08 255.652,51.544 260.5,48.472 C261.22,47.944 261.58,47.296 261.58,46.528 C261.58,45.808 261.292,45.16 260.716,44.584 L260.716,44.584 L252.796,36.808 C252.364,36.376 251.836,36.16 251.212,36.16 C250.78,36.16 250.372,36.256 249.988,36.448 C248.356,37.12 246.796,37.456 245.308,37.456 C243.244,37.456 241.348,36.952 239.62,35.944 C237.892,34.936 236.512,33.58 235.48,31.876 C234.448,30.172 233.932,28.336 233.932,26.368 C233.932,24.352 234.436,22.504 235.444,20.824 C236.452,19.144 237.832,17.812 239.584,16.828 C241.336,15.844 243.244,15.352 245.308,15.352 C246.892,15.352 248.332,15.64 249.628,16.216 C250.012,16.408 250.444,16.504 250.924,16.504 C251.548,16.504 252.1,16.264 252.58,15.784 L252.58,15.784 L259.636,8.008 C260.164,7.384 260.428,6.76 260.428,6.136 C260.428,5.224 259.996,4.528 259.132,4.048 C254.86,1.552 250.276,0.304 245.38,0.304 C240.532,0.304 236.032,1.492 231.88,3.868 C227.728,6.244 224.44,9.448 222.016,13.48 C219.592,17.512 218.38,21.904 218.38,26.656 C218.38,31.408 219.592,35.812 222.016,39.868 C224.44,43.924 227.728,47.14 231.88,49.516 C236.032,51.892 240.532,53.08 245.38,53.08 Z M279.796,52 C280.804,52 281.644,51.82 282.316,51.46 C282.988,51.1 283.42,50.584 283.612,49.912 L283.612,49.912 L285.844,42.712 L301.9,42.712 L304.132,49.912 C304.324,50.584 304.768,51.1 305.464,51.46 C306.16,51.82 307.012,52 308.02,52 L308.02,52 L317.884,52 C319.804,51.712 320.764,50.704 320.764,48.976 C320.764,48.304 320.644,47.596 320.404,46.852 C320.164,46.108 320.02,45.616 319.972,45.376 L319.972,45.376 L303.844,4.84 C303.556,3.976 303.004,3.232 302.188,2.608 C301.372,1.984 300.34,1.648 299.092,1.6 L299.092,1.6 L288.724,1.6 C287.572,1.648 286.576,1.948 285.736,2.5 C284.896,3.052 284.26,3.832 283.828,4.84 L283.828,4.84 L267.844,45.376 C267.796,45.472 267.64,45.916 267.376,46.708 C267.112,47.5 266.98,48.304 266.98,49.12 C266.98,50.752 267.916,51.712 269.788,52 L269.788,52 L279.796,52 Z M299.308,30.544 L288.004,30.544 L293.62,13.624 L299.308,30.544 Z M352.588,52 C353.404,52 354.088,51.688 354.64,51.064 C355.192,50.44 355.468,49.672 355.468,48.76 L355.468,48.76 L355.468,16.216 L366.844,16.216 C367.66,16.216 368.38,15.904 369.004,15.28 C369.628,14.656 369.94,13.936 369.94,13.12 L369.94,13.12 L369.94,4.768 C369.94,4 369.628,3.316 369.004,2.716 C368.38,2.116 367.66,1.816 366.844,1.816 L366.844,1.816 L329.116,1.816 C328.204,1.816 327.448,2.104 326.848,2.68 C326.248,3.256 325.948,3.952 325.948,4.768 L325.948,4.768 L325.948,13.12 C325.948,13.936 326.248,14.656 326.848,15.28 C327.448,15.904 328.204,16.216 329.116,16.216 L329.116,16.216 L340.636,16.216 L340.132,48.832 C340.132,49.744 340.408,50.5 340.96,51.1 C341.512,51.7 342.196,52 343.012,52 L343.012,52 L352.588,52 Z M402.052,52.792 C408.1,52.792 412.912,51.628 416.488,49.3 C420.064,46.972 422.536,44.068 423.904,40.588 C425.272,37.108 425.932,33.424 425.884,29.536 C425.884,29.5309474 425.883967,29.5237673 425.8839,29.5144598 L425.883102,29.4330859 C425.879911,29.1480111 425.868211,28.3183158 425.848,26.944 C425.8294,25.6792 425.818008,22.91524 425.813823,18.65212 L425.813103,17.80828 C425.812997,17.66452 425.8129,17.5192 425.81281,17.37232 L425.812,3.904 C425.86,3.184 425.632,2.62 425.128,2.212 C424.624,1.804 423.916,1.6 423.004,1.6 L423.004,1.6 L413.428,1.6 C412.612,1.6 411.904,1.828 411.304,2.284 C410.704,2.74 410.404,3.28 410.404,3.904 L410.404,3.904 L410.26,27.808 C410.26,34.144 407.476,37.312 401.908,37.312 C399.076,37.312 396.832,36.412 395.176,34.612 C393.52,32.812 392.668,30.352 392.62,27.232 L392.62,27.232 L392.332,3.76 C392.332,3.088 392.068,2.56 391.54,2.176 C391.012,1.792 390.268,1.6 389.308,1.6 L389.308,1.6 L379.876,1.6 C378.244,1.6 377.428,2.32 377.428,3.76 L377.428,3.76 L377.5,28.816 C377.5,33.04 378.376,36.964 380.128,40.588 C381.88,44.212 384.592,47.152 388.264,49.408 C391.936,51.664 396.532,52.792 402.052,52.792 Z M449.284,52.144 C450.148,52.144 450.88,51.844 451.48,51.244 C452.08,50.644 452.38,49.84 452.38,48.832 L452.38,48.832 L452.38,4.912 C452.38,4 452.08,3.22 451.48,2.572 C450.88,1.924 450.148,1.6 449.284,1.6 L449.284,1.6 L439.42,1.6 C438.46,1.6 437.692,1.924 437.116,2.572 C436.54,3.22 436.252,4 436.252,4.912 L436.252,4.912 L436.252,48.832 C436.252,49.84 436.54,50.644 437.116,51.244 C437.692,51.844 438.46,52.144 439.42,52.144 L439.42,52.144 L449.284,52.144 Z" id="metacatui" fill="#FCBF49" fill-rule="nonzero"></path>
    </g>
</svg>
</logo>

    </a>
    <h3>Namespaces</h3><ul><li><a href="AppConfig.html">AppConfig</a></li><li><a href="IconUtilities.html">IconUtilities</a></li><li><a href="MapConfig.html">MapConfig</a></li><li><a href="MetacatUI.html">MetacatUI</a></li><li><a href="SearchParams.html">SearchParams</a></li><li><a href="Utilities.html">Utilities</a></li></ul><h3>Classes</h3><ul><li class='category-heading' data-category='Collections'>Collections</li><li><a href="AccessPolicy.html">AccessPolicy</a></li><li><a href="Citations.html">Citations</a></li><li><a href="DataPackage.html">DataPackage</a></li><li><a href="Filters.html">Filters</a></li><li><a href="ObjectFormats.html">ObjectFormats</a></li><li><a href="ProjectList.html">ProjectList</a></li><li><a href="QualityReport.html">QualityReport</a></li><li><a href="SolrResults.html">SolrResults</a></li><li><a href="Units.html">Units</a></li><li><a href="UserGroup.html">UserGroup</a></li><li class='category-heading' data-category='Collections/Bookkeeper'>Collections/Bookkeeper</li><li><a href="Quotas.html">Quotas</a></li><li><a href="Usages.html">Usages</a></li><li class='category-heading' data-category='Collections/Geohashes'>Collections/Geohashes</li><li><a href="Geohashes.html">Geohashes</a></li><li class='category-heading' data-category='Collections/Maps'>Collections/Maps</li><li><a href="AssetCategories.html">AssetCategories</a></li><li><a href="AssetColors.html">AssetColors</a></li><li><a href="Features.html">Features</a></li><li><a href="GeoPoints.html">GeoPoints</a></li><li><a href="MapAssets.html">MapAssets</a></li><li><a href="VectorFilters.html">VectorFilters</a></li><li><a href="ZoomPresets.html">ZoomPresets</a></li><li class='category-heading' data-category='Collections/Metadata/EML'>Collections/Metadata/EML</li><li><a href="EMLAnnotations.html">EMLAnnotations</a></li><li><a href="EMLMissingValueCodes.html">EMLMissingValueCodes</a></li><li class='category-heading' data-category='Collections/Ontologies'>Collections/Ontologies</li><li><a href="BioontologyResults.html">BioontologyResults</a></li><li class='category-heading' data-category='Collections/QueryFields'>Collections/QueryFields</li><li><a href="QueryFields.html">QueryFields</a></li><li class='category-heading' data-category='Collections/SearchSelect'>Collections/SearchSelect</li><li><a href="SearchSelectOptions.html">SearchSelectOptions</a></li><li class='category-heading' data-category='Models'>Models</li><li><a href="AccessRule.html">AccessRule</a></li><li><a href="Accordion.html">Accordion</a></li><li><a href="AppModel.html">AppModel</a></li><li><a href="CitationModel.html">CitationModel</a></li><li><a href="CollectionModel.html">CollectionModel</a></li><li><a href="CrossRef.html">CrossRef</a></li><li><a href="DataONEObject.html">DataONEObject</a></li><li><a href="LookupModel.html">LookupModel</a></li><li><a href="Map.html">Map</a></li><li><a href="Metrics.html">Metrics</a></li><li><a href="QualityCheck.html">QualityCheck</a></li><li><a href="Search.html">Search</a></li><li><a href="SolrResult.html">SolrResult</a></li><li><a href="Stats.html">Stats</a></li><li class='category-heading' data-category='Models/Accordion'>Models/Accordion</li><li><a href="AccordionItem.html">AccordionItem</a></li><li class='category-heading' data-category='Models/Analytics'>Models/Analytics</li><li><a href="Analytics.html">Analytics</a></li><li><a href="GoogleAnalytics.html">GoogleAnalytics</a></li><li class='category-heading' data-category='Models/Bookkeeper'>Models/Bookkeeper</li><li><a href="Quota.html">Quota</a></li><li><a href="Subscription.html">Subscription</a></li><li><a href="Usage.html">Usage</a></li><li class='category-heading' data-category='Models/Connectors'>Models/Connectors</li><li><a href="BioontologyAccordionSearchSelect.html">BioontologyAccordionSearchSelect</a></li><li><a href="FiltersMapConnector.html">FiltersMapConnector</a></li><li><a href="FiltersSearchConnector.html">FiltersSearchConnector</a></li><li><a href="GeoPointsCesiumConnector.html">GeoPointsCesiumConnector</a></li><li><a href="GeoPointsCesiumPointsConnector.html">GeoPointsCesiumPointsConnector</a></li><li><a href="GeoPointsCesiumPolygonConnector.html">GeoPointsCesiumPolygonConnector</a></li><li><a href="MapSearchConnector.html">MapSearchConnector</a></li><li><a href="MapSearchFiltersConnector.html">MapSearchFiltersConnector</a></li><li class='category-heading' data-category='Models/Filters'>Models/Filters</li><li><a href="BooleanFilter.html">BooleanFilter</a></li><li><a href="ChoiceFilter.html">ChoiceFilter</a></li><li><a href="DateFilter.html">DateFilter</a></li><li><a href="Filter.html">Filter</a></li><li><a href="FilterGroup.html">FilterGroup</a></li><li><a href="NumericFilter.html">NumericFilter</a></li><li><a href="SpatialFilter.html">SpatialFilter</a></li><li><a href="ToggleFilter.html">ToggleFilter</a></li><li class='category-heading' data-category='Models/Formats'>Models/Formats</li><li><a href="ObjectFormat.html">ObjectFormat</a></li><li class='category-heading' data-category='Models/Geocoder'>Models/Geocoder</li><li><a href="GeocodedLocation.html">GeocodedLocation</a></li><li><a href="GeocoderSearch.html">GeocoderSearch</a></li><li><a href="GoogleMapsAutocompleter.html">GoogleMapsAutocompleter</a></li><li><a href="GoogleMapsGeocoder.html">GoogleMapsGeocoder</a></li><li><a href="Prediction.html">Prediction</a></li><li class='category-heading' data-category='Models/Geohashes'>Models/Geohashes</li><li><a href="Geohash.html">Geohash</a></li><li class='category-heading' data-category='Models/Maps'>Models/Maps</li><li><a href="AssetCategory.html">AssetCategory</a></li><li><a href="AssetColor.html">AssetColor</a></li><li><a href="AssetColorPalette.html">AssetColorPalette</a></li><li><a href="ExpansionPanelsModel.html">ExpansionPanelsModel</a></li><li><a href="Feature.html">Feature</a></li><li><a href="GeoBoundingBox.html">GeoBoundingBox</a></li><li><a href="GeoPoint.html">GeoPoint</a></li><li><a href="GeoScale.html">GeoScale</a></li><li><a href="GeoUtilities.html">GeoUtilities</a></li><li><a href="MapInteraction.html">MapInteraction</a></li><li><a href="MapModel.html">MapModel</a></li><li><a href="VectorFilter.html">VectorFilter</a></li><li><a href="ViewfinderModel.html">ViewfinderModel</a></li><li><a href="ZoomPresetModel.html">ZoomPresetModel</a></li><li class='category-heading' data-category='Models/Maps/Assets'>Models/Maps/Assets</li><li><a href="Cesium3DTileset.html">Cesium3DTileset</a></li><li><a href="CesiumGeohash.html">CesiumGeohash</a></li><li><a href="CesiumImagery.html">CesiumImagery</a></li><li><a href="CesiumTerrain.html">CesiumTerrain</a></li><li><a href="CesiumVectorData.html">CesiumVectorData</a></li><li><a href="MapAsset.html">MapAsset</a></li><li class='category-heading' data-category='Models/Metadata'>Models/Metadata</li><li><a href="ScienceMetadata.html">ScienceMetadata</a></li><li class='category-heading' data-category='Models/Metadata/EML'>Models/Metadata/EML</li><li><a href="EMLMethodStep.html">EMLMethodStep</a></li><li><a href="EMLSpecializedText.html">EMLSpecializedText</a></li><li><a href="EMLTaxonCoverage.html">EMLTaxonCoverage</a></li><li class='category-heading' data-category='Models/Metadata/EML211'>Models/Metadata/EML211</li><li><a href="EML211.html">EML211</a></li><li><a href="EMLAnnotation.html">EMLAnnotation</a></li><li><a href="EMLAttribute.html">EMLAttribute</a></li><li><a href="EMLDataTable.html">EMLDataTable</a></li><li><a href="EMLDistribution.html">EMLDistribution</a></li><li><a href="EMLEntity.html">EMLEntity</a></li><li><a href="EMLGeoCoverage.html">EMLGeoCoverage</a></li><li><a href="EMLMeasurementScale.html">EMLMeasurementScale</a></li><li><a href="EMLMethods.html">EMLMethods</a></li><li><a href="EMLMissingValueCode.html">EMLMissingValueCode</a></li><li><a href="EMLNonNumericDomain.html">EMLNonNumericDomain</a></li><li><a href="EMLNumericDomain.html">EMLNumericDomain</a></li><li><a href="EMLOtherEntity.html">EMLOtherEntity</a></li><li><a href="EMLParty.html">EMLParty</a></li><li><a href="EMLTemporalCoverage.html">EMLTemporalCoverage</a></li><li><a href="EMLText211.html">EMLText211</a></li><li><a href="EMLUnit.html">EMLUnit</a></li><li class='category-heading' data-category='Models/Metadata/EML220'>Models/Metadata/EML220</li><li><a href="EMLText.html">EMLText</a></li><li class='category-heading' data-category='Models/Ontologies'>Models/Ontologies</li><li><a href="BioOntology.html">BioOntology</a></li><li><a href="Bioontology_.html">Bioontology</a></li><li><a href="BioontologyBatch.html">BioontologyBatch</a></li><li><a href="BioontologyClass.html">BioontologyClass</a></li><li class='category-heading' data-category='Models/Portals'>Models/Portals</li><li><a href="PortalImage.html">PortalImage</a></li><li><a href="PortalModel.html">PortalModel</a></li><li><a href="PortalSectionModel.html">PortalSectionModel</a></li><li class='category-heading' data-category='Models/Projects'>Models/Projects</li><li><a href="Project.html">Project</a></li><li class='category-heading' data-category='Models/QueryFields'>Models/QueryFields</li><li><a href="QueryField.html">QueryField</a></li><li class='category-heading' data-category='Models/SearchSelect'>Models/SearchSelect</li><li><a href="AccountSearchSelect.html">AccountSearchSelect</a></li><li><a href="QueryFieldSearchSelect.html">QueryFieldSearchSelect</a></li><li><a href="SearchSelect.html">SearchSelect</a></li><li><a href="SelectOptionModel.html">SelectOptionModel</a></li><li><a href="SolrAutocomplete.html">SolrAutocomplete</a></li><li class='category-heading' data-category='Models/schemaOrg'>Models/schemaOrg</li><li><a href="SchemaOrgModel.html">SchemaOrgModel</a></li><li class='category-heading' data-category='Router'>Router</li><li><a href="UIRouter.html">UIRouter</a></li><li class='category-heading' data-category='Views'>Views</li><li><a href="AccessPolicyView.html">AccessPolicyView</a></li><li><a href="AccessRuleView.html">AccessRuleView</a></li><li><a href="AnnotationView.html">AnnotationView</a></li><li><a href="AppView.html">AppView</a></li><li><a href="CanonicalDatasetHandlerView.html">CanonicalDatasetHandlerView</a></li><li><a href="CatalogSearchView.html">CatalogSearchView</a></li><li><a href="CitationHeaderView.html">CitationHeaderView</a></li><li><a href="CitationListView.html">CitationListView</a></li><li><a href="CitationModalView.html">CitationModalView</a></li><li><a href="CitationView.html">CitationView</a></li><li><a href="ColorPaletteView.html">ColorPaletteView</a></li><li><a href="DataCatalogView.html">DataCatalogView</a></li><li><a href="DataCatalogViewWithFilters.html">DataCatalogViewWithFilters</a></li><li><a href="DataItemView.html">DataItemView</a></li><li><a href="DataObjectView.html">DataObjectView</a></li><li><a href="DataPackageView.html">DataPackageView</a></li><li><a href="DraftsView.html">DraftsView</a></li><li><a href="EditCollectionView.html">EditCollectionView</a></li><li><a href="EditorView.html">EditorView</a></li><li><a href="FooterView.html">FooterView</a></li><li><a href="GroupListView.html">GroupListView</a></li><li><a href="ImageUploaderView.html">ImageUploaderView</a></li><li><a href="MarkdownEditorView.html">MarkdownEditorView</a></li><li><a href="MarkdownView.html">MarkdownView</a></li><li><a href="MdqRunView.html">MdqRunView</a></li><li><a href="MetadataView.html">MetadataView</a></li><li><a href="MetricModalView.html">MetricModalView</a></li><li><a href="MetricView.html">MetricView</a></li><li><a href="MetricsChartView.html">MetricsChartView</a></li><li><a href="NavbarView.html">NavbarView</a></li><li><a href="RegisterCitationView.html">RegisterCitationView</a></li><li><a href="SearchResultView.html">SearchResultView</a></li><li><a href="SignInView.html">SignInView</a></li><li><a href="TOCView.html">TOCView</a></li><li><a href="TableEditorView.html">TableEditorView</a></li><li><a href="UserGroupView.html">UserGroupView</a></li><li><a href="UserView.html">UserView</a></li><li><a href="ViewDataButtonView.html">ViewDataButtonView</a></li><li class='category-heading' data-category='Views/Accordion'>Views/Accordion</li><li><a href="AccordionItemView.html">AccordionItemView</a></li><li><a href="AccordionView.html">AccordionView</a></li><li class='category-heading' data-category='Views/Filters'>Views/Filters</li><li><a href="BooleanFilterView.html">BooleanFilterView</a></li><li><a href="ChoiceFilterView.html">ChoiceFilterView</a></li><li><a href="DateFilterView.html">DateFilterView</a></li><li><a href="FilterEditorView.html">FilterEditorView</a></li><li><a href="FilterGroupView.html">FilterGroupView</a></li><li><a href="FilterGroupsView.html">FilterGroupsView</a></li><li><a href="FilterView.html">FilterView</a></li><li><a href="NumericFilterView.html">NumericFilterView</a></li><li><a href="SemanticFilterView.html">SemanticFilterView</a></li><li><a href="ToggleFilterView.html">ToggleFilterView</a></li><li class='category-heading' data-category='Views/Maps'>Views/Maps</li><li><a href="CesiumWidgetView.html">CesiumWidgetView</a></li><li><a href="DrawTool.html">DrawTool</a></li><li><a href="FeatureInfoView.html">FeatureInfoView</a></li><li><a href="LayerCategoryListView.html">LayerCategoryListView</a></li><li><a href="LayerDetailView.html">LayerDetailView</a></li><li><a href="LayerDetailsView.html">LayerDetailsView</a></li><li><a href="LayerInfoView.html">LayerInfoView</a></li><li><a href="LayerItemView.html">LayerItemView</a></li><li><a href="LayerListView.html">LayerListView</a></li><li><a href="LayerNavigationView.html">LayerNavigationView</a></li><li><a href="LayerOpacityView.html">LayerOpacityView</a></li><li><a href="LayersPanelView.html">LayersPanelView</a></li><li><a href="MapHelpPanel.html">MapHelpPanel</a></li><li><a href="MapView.html">MapView</a></li><li><a href="MapWidgetContainerView.html">MapWidgetContainerView</a></li><li><a href="PredictionView.html">PredictionView</a></li><li><a href="PredictionsListView.html">PredictionsListView</a></li><li><a href="ScaleBarView.html">ScaleBarView</a></li><li><a href="SchemaOrgView.html">SchemaOrgView</a></li><li><a href="SearchInputView.html">SearchInputView</a></li><li><a href="SearchView.html">SearchView</a></li><li><a href="ShareUrlView.html">ShareUrlView</a></li><li><a href="ToolbarView.html">ToolbarView</a></li><li><a href="ViewfinderView.html">ViewfinderView</a></li><li class='category-heading' data-category='Views/Maps/Legend'>Views/Maps/Legend</li><li><a href="CategoricalSwatchView.html">CategoricalSwatchView</a></li><li><a href="ContinuousSwatchView.html">ContinuousSwatchView</a></li><li><a href="LayerLegendView.html">LayerLegendView</a></li><li><a href="LegendContainerView.html">LegendContainerView</a></li><li class='category-heading' data-category='Views/Maps/Viewfinder'>Views/Maps/Viewfinder</li><li><a href="ExpansionPanelView.html">ExpansionPanelView</a></li><li><a href="ZoomPresetView.html">ZoomPresetView</a></li><li><a href="ZoomPresetsListView.html">ZoomPresetsListView</a></li><li class='category-heading' data-category='Views/Metadata'>Views/Metadata</li><li><a href="EML211EditorView.html">EML211EditorView</a></li><li><a href="EMLAttributeView.html">EMLAttributeView</a></li><li><a href="EMLEntityView.html">EMLEntityView</a></li><li><a href="EMLMeasurementScaleView.html">EMLMeasurementScaleView</a></li><li><a href="EMLMeasurementTypeView.html">EMLMeasurementTypeView</a></li><li><a href="EMLMethodsView.html">EMLMethodsView</a></li><li><a href="EMLMissingValueCodeView.html">EMLMissingValueCodeView</a></li><li><a href="EMLMissingValueCodesView.html">EMLMissingValueCodesView</a></li><li><a href="EMLOtherEntityView.html">EMLOtherEntityView</a></li><li><a href="EMLPartyView.html">EMLPartyView</a></li><li><a href="EMLTempCoverageView.html">EMLTempCoverageView</a></li><li><a href="EMLView.html">EMLView</a></li><li><a href="EMlGeoCoverageView_.html">EMlGeoCoverageView</a></li><li><a href="ScienceMetadataView.html">ScienceMetadataView</a></li><li class='category-heading' data-category='Views/Ontologies'>Views/Ontologies</li><li><a href="BioontologyBrowser.html">BioontologyBrowser</a></li><li class='category-heading' data-category='Views/Portals'>Views/Portals</li><li><a href="PortalDataView.html">PortalDataView</a></li><li><a href="PortalHeaderView.html">PortalHeaderView</a></li><li><a href="PortalListView.html">PortalListView</a></li><li><a href="PortalLogosView.html">PortalLogosView</a></li><li><a href="PortalMembersView.html">PortalMembersView</a></li><li><a href="PortalSectionView.html">PortalSectionView</a></li><li><a href="PortalUsagesView.html">PortalUsagesView</a></li><li><a href="PortalView.html">PortalView</a></li><li><a href="PortalVisualizationsView.html">PortalVisualizationsView</a></li><li><a href="PortalsSearchView.html">PortalsSearchView</a></li><li class='category-heading' data-category='Views/Portals/Editor'>Views/Portals/Editor</li><li><a href="PortEditorDataView.html">PortEditorDataView</a></li><li><a href="PortEditorImageView.html">PortEditorImageView</a></li><li><a href="PortEditorLogosView.html">PortEditorLogosView</a></li><li><a href="PortEditorMdSectionView.html">PortEditorMdSectionView</a></li><li><a href="PortEditorSectionView.html">PortEditorSectionView</a></li><li><a href="PortEditorSectionsView.html">PortEditorSectionsView</a></li><li><a href="PortEditorSettingsView.html">PortEditorSettingsView</a></li><li><a href="PortalEditorView.html">PortalEditorView</a></li><li class='category-heading' data-category='Views/Projects'>Views/Projects</li><li><a href="ProjectView.html">ProjectView</a></li><li class='category-heading' data-category='Views/QueryBuilder'>Views/QueryBuilder</li><li><a href="QueryBuilderView.html">QueryBuilderView</a></li><li><a href="QueryRuleView.html">QueryRuleView</a></li><li class='category-heading' data-category='Views/Search'>Views/Search</li><li><a href="SearchResultsPagerView.html">SearchResultsPagerView</a></li><li><a href="SearchResultsView.html">SearchResultsView</a></li><li><a href="SorterView.html">SorterView</a></li><li class='category-heading' data-category='Views/SearchSelect'>Views/SearchSelect</li><li><a href="AccountSelectView.html">AccountSelectView</a></li><li><a href="AnnotationFilter.html">AnnotationFilter</a></li><li><a href="BioontologySelectView.html">BioontologySelectView</a></li><li><a href="NodeSelect.html">NodeSelect</a></li><li><a href="ObjectFormatSelect.html">ObjectFormatSelect</a></li><li><a href="QueryFieldSelectView.html">QueryFieldSelectView</a></li><li><a href="SearchSelectView.html">SearchSelectView</a></li><li><a href="SeparatorView.html">SeparatorView</a></li><li class='category-heading' data-category='Deprecated'>Deprecated</li><li><a href="AnnotatorView.html">AnnotatorView</a></li><li><a href="ExternalView.html">ExternalView</a></li><li><a href="LogsSearch.html">LogsSearch</a></li></ul><h3>Global</h3><ul><li><a href="global.html#addClassesFromResponse">addClassesFromResponse</a></li><li><a href="global.html#addFields">addFields</a></li><li><a href="global.html#addSelected">addSelected</a></li><li><a href="global.html#adjustDescriptionLength">adjustDescriptionLength</a></li><li><a href="global.html#appConfigPath">appConfigPath</a></li><li><a href="global.html#buildChildrenUrl">buildChildrenUrl</a></li><li><a href="global.html#buildSearchUrl">buildSearchUrl</a></li><li><a href="global.html#canChangeSeparator">canChangeSeparator</a></li><li><a href="global.html#changeSubmenuOnSearch">changeSubmenuOnSearch</a></li><li><a href="global.html#couldBeLatLong">couldBeLatLong</a></li><li><a href="global.html#createBatchPayload">createBatchPayload</a></li><li><a href="global.html#createHeaders">createHeaders</a></li><li><a href="global.html#defaults">defaults</a></li><li><a href="global.html#encodeIfPresent">encodeIfPresent</a></li><li><a href="global.html#excludeFields">excludeFields</a></li><li><a href="global.html#fetchClasses">fetchClasses</a></li><li><a href="global.html#fetchClassesFromOntology">fetchClassesFromOntology</a></li><li><a href="global.html#fetchFromOntologies">fetchFromOntologies</a></li><li><a href="global.html#fetchQueryFields">fetchQueryFields</a></li><li><a href="global.html#fieldToOption">fieldToOption</a></li><li><a href="global.html#filterClassesToFetch">filterClassesToFetch</a></li><li><a href="global.html#finalizeFetch">finalizeFetch</a></li><li><a href="global.html#formatResult">formatResult</a></li><li><a href="global.html#formatResults">formatResults</a></li><li><a href="global.html#generateGeoJSONPoint">generateGeoJSONPoint</a></li><li><a href="global.html#generateGeoJSONPolygon">generateGeoJSONPolygon</a></li><li><a href="global.html#generateGeoJSONString">generateGeoJSONString</a></li><li><a href="global.html#generateIdentifier">generateIdentifier</a></li><li><a href="global.html#generateSpatialCoverage">generateSpatialCoverage</a></li><li><a href="global.html#getAccountDetails">getAccountDetails</a></li><li><a href="global.html#getCachedClasses">getCachedClasses</a></li><li><a href="global.html#getCategoryNames">getCategoryNames</a></li><li><a href="global.html#getChildren">getChildren</a></li><li><a href="global.html#getClasses">getClasses</a></li><li><a href="global.html#getDOIURL">getDOIURL</a></li><li><a href="global.html#getIncludeParam">getIncludeParam</a></li><li><a href="global.html#getNextPage">getNextPage</a></li><li><a href="global.html#getNextSeparator">getNextSeparator</a></li><li><a href="global.html#getOptionByLabelOrValue">getOptionByLabelOrValue</a></li><li><a href="global.html#getOptionsByCategory">getOptionsByCategory</a></li><li><a href="global.html#getQueryFieldOptions">getQueryFieldOptions</a></li><li><a href="global.html#getSelectedModels">getSelectedModels</a></li><li><a href="global.html#hasInvalidSelections">hasInvalidSelections</a></li><li><a href="global.html#initialize">initialize</a></li><li><a href="global.html#initializeFetch">initializeFetch</a></li><li><a href="global.html#isValidValue">isValidValue</a></li><li><a href="global.html#model">model</a></li><li><a href="global.html#moveClassesToNotFound">moveClassesToNotFound</a></li><li><a href="global.html#optionsAsJSON">optionsAsJSON</a></li><li><a href="global.html#padDescription">padDescription</a></li><li><a href="global.html#parse">parse</a></li><li><a href="global.html#recordError">recordError</a></li><li><a href="global.html#removeSelected">removeSelected</a></li><li><a href="global.html#renameCategory">renameCategory</a></li><li><a href="global.html#reset">reset</a></li><li><a href="global.html#resetPageInfo">resetPageInfo</a></li><li><a href="global.html#responseAsync">responseAsync</a></li><li><a href="global.html#separatorRequired">separatorRequired</a></li><li><a href="global.html#serialize">serialize</a></li><li><a href="global.html#setAddedFieldDetails">setAddedFieldDetails</a></li><li><a href="global.html#setDataCatalogSchema">setDataCatalogSchema</a></li><li><a href="global.html#setDatasetSchema">setDatasetSchema</a></li><li><a href="global.html#setNextSeparator">setNextSeparator</a></li><li><a href="global.html#setOptionsForPreselected">setOptionsForPreselected</a></li><li><a href="global.html#setSchema">setSchema</a></li><li><a href="global.html#setSchemaFromTemplate">setSchemaFromTemplate</a></li><li><a href="global.html#setSelected">setSelected</a></li><li><a href="global.html#sortByProp">sortByProp</a></li><li><a href="global.html#sortFields">sortFields</a></li><li><a href="global.html#taxonomicClassification">taxonomicClassification</a></li><li><a href="global.html#toAccordionItem">toAccordionItem</a></li><li><a href="global.html#toJSON">toJSON</a></li><li><a href="global.html#toSearchSelectOption">toSearchSelectOption</a></li><li><a href="global.html#truncateDescription">truncateDescription</a></li><li><a href="global.html#updateOptions">updateOptions</a></li><li><a href="global.html#url">url</a></li><li><a href="global.html#waitForFetchComplete">waitForFetchComplete</a></li></ul>
</nav>

<div id="main">

    <h1 class="page-title">Source: src/js/models/filters/Filter.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>define(["jquery", "underscore", "backbone"], function ($, _, Backbone) {
  /**
   * @class Filter
   * @classdesc A single search filter that is used in queries sent to the DataONE search service.
   * @classcategory Models/Filters
   * @extends Backbone.Model
   * @constructs
   */
  var FilterModel = Backbone.Model.extend(
    /** @lends Filter.prototype */
    {
      /**
       * The name of this Model
       * @name Filter#type
       * @type {string}
       * @readonly
       */
      type: "Filter",

      /**
       * Default attributes for this model
       * @type {object}
       * @returns {object}
       * @property {Element} objectDOM - The XML DOM for this filter
       * @property {string} nodeName - The XML node name for this filter's XML DOM
       * @property {string[]} fields - The search index fields to search
       * @property {string[]} values - The values to search for in the given search fields
       * @property {object} valueLabels - Optional human-readable labels for the elements of
       * values. Keys are the value and the human-readable label is the value at that key.
       * @property {string} operator - The operator to use between values set on this model.
       * "AND" or "OR"
       * @property {string} fieldsOperator - The operator to use between fields set on this
       * model. "AND" or "OR"
       * @property {string} queryGroup - Deprecated: Add this filter along with other the
       * other associated query group filters to a FilterGroup model instead. Old definition:
       * The name of the group this Filter is a part of, which is primarily used when
       * creating a query string from multiple Filter models. Filters in the same group will
       * be wrapped in parenthesis in the query.
       * @property {boolean} exclude - If true, search index docs matching this filter will
       * be excluded from the search results
       * @property {boolean} matchSubstring - If true, the search values will be wrapped in
       * wildcard characters to match substrings
       * @property {string} label - A human-readable short label for this Filter
       * @property {string} placeholder - A short example or description of this Filter
       * @property {string} icon - A term that identifies a single icon in a supported icon
       * library
       * @property {string} description - A longer description of this Filter's function
       * @property {boolean} isInvisible - If true, this filter will be added to the query
       * but will act in the "background", like a default filter
       * @property {boolean} inFilterGroup - Deprecated: use isUIFilterType instead.
       * @property {boolean} isUIFilterType - If true, this filter is one of the
       * UIFilterTypes, belongs to a UIFilterGroupType model, and is used to create a custom
       * Portal search filters. This changes how the XML is parsed and how the model is
       * validated and serialized.
       */
      defaults: function () {
        return {
          objectDOM: null,
          nodeName: "filter",
          fields: [],
          values: [],
          valueLabels: {},
          operator: "AND",
          fieldsOperator: "AND",
          exclude: false,
          matchSubstring: false,
          label: null,
          placeholder: null,
          icon: null,
          description: null,
          isInvisible: false,
          isUIFilterType: false,
        };
      },

      /**
       * Creates a new Filter model
       */
      initialize: function (attributes) {
        if (this.get("objectDOM")) {
          this.set(this.parse(this.get("objectDOM")));
        }

        if (attributes &amp;&amp; attributes.isUIFilterType) {
          this.set("isUIFilterType", true);
        }

        //If this is an isPartOf filter, then add a label and description. Make it invisible
        //depending on how MetacatUI is configured.
        if (
          this.get("fields").length == 1 &amp;&amp;
          this.get("fields").includes("isPartOf")
        ) {
          this.set({
            label: "Datasets added manually",
            description:
              "Datasets added to this collection manually by dataset owners",
            isInvisible:
              MetacatUI.appModel.get("hideIsPartOfFilter") === true
                ? true
                : false,
          });
        }

        // Operator must be AND or OR
        ["fieldsOperator", "operator"].forEach(function (op) {
          if (!["AND", "OR"].includes(this.get(op))) {
            // Set the value to the default
            this.set(op, this.defaults()[op]);
          }
        }, this);
      },

      /**
       * Parses the given XML node into a JSON object to be set on the model
       *
       * @param {Element} xml - The XML element that contains all the filter elements
       * @return {JSON} - The JSON object of all the filter attributes
       */
      parse: function (xml) {
        //If an XML element wasn't sent as a parameter, get it from the model
        if (!xml) {
          var xml = this.get("objectDOM");

          //Return an empty JSON object if there is no objectDOM saved in the model
          if (!xml) return {};
        }

        var modelJSON = {};

        if ($(xml).children("field").length) {
          //Parse the field(s)
          modelJSON.fields = this.parseTextNode(xml, "field", true);
        }

        if ($(xml).children("label").length) {
          //Parse the label
          modelJSON.label = this.parseTextNode(xml, "label");
        }

        // Check if this filter contains one of the Id fields - we use OR by default for the
        // operator for these fields.
        var idFields = MetacatUI.appModel.get("queryIdentifierFields");
        var isIdFilter = false;
        if (modelJSON.fields) {
          isIdFilter = _.some(idFields, function (idField) {
            return modelJSON.fields.includes(idField);
          });
        }

        //Parse the operators, if they exist
        if ($(xml).find("operator").length) {
          modelJSON.operator = this.parseTextNode(xml, "operator");
        } else {
          if (isIdFilter) {
            modelJSON.operator = "OR";
          }
        }

        if ($(xml).find("fieldsOperator").length) {
          modelJSON.fieldsOperator = this.parseTextNode(xml, "fieldsOperator");
        } else {
          if (isIdFilter) {
            modelJSON.fieldsOperator = "OR";
          }
        }

        //Parse the exclude, if it exists
        if ($(xml).find("exclude").length) {
          modelJSON.exclude =
            this.parseTextNode(xml, "exclude") === "true" ? true : false;
        }

        //Parse the matchSubstring
        if ($(xml).find("matchSubstring").length) {
          modelJSON.matchSubstring =
            this.parseTextNode(xml, "matchSubstring") === "true" ? true : false;
        }

        var filterOptionsNode = $(xml).children("filterOptions");
        if (filterOptionsNode.length) {
          //Parse the filterOptions XML node
          modelJSON = _.extend(
            this.parseFilterOptions(filterOptionsNode),
            modelJSON,
          );
        }

        //If this Filter is in a filter group, don't parse the values
        if (!this.get("isUIFilterType")) {
          if ($(xml).children("value").length) {
            //Parse the value(s)
            modelJSON.values = this.parseTextNode(xml, "value", true);
          }
        }

        return modelJSON;
      },

      /**
       * Gets the text content of the XML node matching the given node name
       *
       * @param {Element} parentNode - The parent node to select from
       * @param {string} nodeName - The name of the XML node to parse
       * @param {boolean} isMultiple - If true, parses the nodes into an array
       * @return {(string|Array)} - Returns a string or array of strings of the text content
       */
      parseTextNode: function (parentNode, nodeName, isMultiple) {
        var node = $(parentNode).children(nodeName);

        //If no matching nodes were found, return falsey values
        if (!node || !node.length) {
          //Return an empty array if the isMultiple flag is true
          if (isMultiple) return [];
          //Return null if the isMultiple flag is false
          else return null;
        }
        //If exactly one node is found and we are only expecting one, return the text content
        else if (node.length == 1 &amp;&amp; !isMultiple) {
          if (!node[0].textContent) return null;
          else return node[0].textContent;
        }
        //If more than one node is found, parse into an array
        else {
          var allContents = [];

          _.each(node, function (node) {
            if (node.textContent || node.textContent === 0)
              allContents.push(node.textContent);
          });

          return allContents;
        }
      },

      /**
       * Parses the filterOptions XML node into a literal object
       * @param {Element} filterOptionsNode - The filterOptions XML element to parse
       * @return {Object} - The parsed filter options, in literal object form
       */
      parseFilterOptions: function (filterOptionsNode) {
        if (typeof filterOptionsNode == "undefined") {
          return {};
        }

        var modelJSON = {};

        try {
          //The list of options to parse
          var options = ["placeholder", "icon", "description"];

          //Parse the text nodes for each filter option
          _.each(
            options,
            function (option) {
              if ($(filterOptionsNode).children(option).length) {
                modelJSON[option] = this.parseTextNode(
                  filterOptionsNode,
                  option,
                  false,
                );
              }
            },
            this,
          );

          //Parse the generic option name and value pairs and set on the model JSON
          $(filterOptionsNode)
            .children("option")
            .each(function (i, optionNode) {
              var optName = $(optionNode).children("optionName").text();
              var optValue = $(optionNode).children("optionValue").text();

              modelJSON[optName] = optValue;
            });

          //Return the JSON to be set on this model
          return modelJSON;
        } catch (e) {
          return {};
        }
      },

      /**
       * Builds a query string that represents this filter.
       *
       * @return {string} The query string to send to Solr
       * @param {string} [groupLevelOperator] - "AND" or "OR". The operator used in the
       * parent Filters collection to combine the filter query fragments together. If the
       * group level operator is "OR" and this filter has exclude set to TRUE, then a
       * positive clause is added.
       */
      getQuery: function (groupLevelOperator) {
        //Get the values of this filter in Array format
        var values = this.get("values");
        if (!Array.isArray(values)) {
          values = [values];
        }

        //Check that there are actually values to serialize
        if (!values.length) {
          return "";
        }

        //Filter out any invalid values (can't use _.compact() because we want to keep 'false' values)
        values = _.reject(values, function (value) {
          return (
            value === null ||
            typeof value == "undefined" ||
            value === NaN ||
            value === "" ||
            (Array.isArray(value) &amp;&amp; !value.length)
          );
        });

        if (!values.length) {
          return "";
        }

        //Start a query string for this model and get the fields
        var queryString = "",
          fields = this.get("fields");

        //If the fields are not an array, convert it to an array
        if (!Array.isArray(fields)) {
          fields = [fields];
        }

        //Iterate over each field
        _.each(
          fields,
          function (field, i) {
            //Add the query string for this field to the overall model query string
            queryString += field + ":" + this.getValueQuerySubstring(values);

            //Add the OR operator between field names
            if (fields.length > i + 1 &amp;&amp; queryString.length) {
              queryString += "%20" + this.get("fieldsOperator") + "%20";
            }
          },
          this,
        );

        //If there is more than one field, wrap the multiple fields in parenthesis
        if (fields.length > 1) {
          queryString = "(" + queryString + ")";
        }

        //If this filter should be excluding matches from the results,
        // then add a hyphen in front
        if (queryString &amp;&amp; this.get("exclude")) {
          queryString = "-" + queryString;
          if (this.requiresPositiveClause(groupLevelOperator)) {
            queryString = queryString + "%20AND%20*:*";
            if (groupLevelOperator &amp;&amp; groupLevelOperator === "OR") {
              queryString = "(" + queryString + ")";
            }
          }
        }

        return queryString;
      },

      /**
       * For "negative" Filters (filter models where exclude is set to true), detects
       * whether the query requires an additional "positive" query phrase in order to avoid
       * the problem of pure negative queries returning zero results. If this Filter is not
       * part of a collection of Filters, assume it needs the positive clause. If this
       * Filter is part of a collection of Filters, detect whether there are other,
       * "positive" filters in the same query (i.e. filter models where exclude is set to
       * false). If there are other positive queries, then an additional clause is not
       * required. If the Filter is part of a pure negative query, but it is not the last
       * filter, then don't add a clause since it will be added to the last, and only one
       * is required. When looking for other positive and negative filters, exclude empty
       * filters and filters that use any of the identifier fields, as these are appended to
       * the end of the query.
       * @see {@link https://github.com/NCEAS/metacatui/issues/1600}
       * @see {@link https://cwiki.apache.org/confluence/display/SOLR/NegativeQueryProblems}
       * @param {string} [groupLevelOperator] - "AND" or "OR". The operator used in the
       * parent Filters collection to combine the filter query fragments together. If the
       * group level operator is "OR" and this filter has exclude set to TRUE, then a
       * positive clause is required.
       * @return {boolean} returns true of this Filter needs a positive clause, false
       * otherwise
       */
      requiresPositiveClause: function (groupLevelOperator) {
        try {
          // Only negative queries require the additional clause
          if (this.get("exclude") == false) {
            return false;
          }
          // If this Filter is not part of a collection of Filters, assume it needs the
          // positive clause.
          if (!this.collection) {
            return true;
          }
          // If this Filter is the only one in the group, assume it needs a positive clause
          if (this.collection.length === 1) {
            return true;
          }
          // If this filter is being "OR"'ed together with other filters, then assume it
          // needs the additional clause.
          if (groupLevelOperator &amp;&amp; groupLevelOperator === "OR") {
            return true;
          }
          // Get all of the other filters in the same collection that are not ID filters.
          // These filters are always appended to the end of the query as a separated group.
          var nonIDFilters = this.collection.getNonIdFilters();
          // Exclude filters that would give an empty query string (e.g. because value is
          // missing)
          var filters = _.reject(nonIDFilters, function (filterModel) {
            if (filterModel === this) {
              return false;
            }
            return !filterModel.isValid();
          });

          // If at least one filter in the collection is positive (exclude = false), then we
          // don't need to add anything
          var positiveFilters = _.find(filters, function (filterModel) {
            return filterModel.get("exclude") != true;
          });
          if (positiveFilters) {
            return false;
          }
          // Assuming that all the non-ID filters are negative, check if this is the first
          // last the list. Since we only need one additional positive query phrase to avoid
          // the pure negative query problem, by convention, only add the positive phrase at
          // the end of the filter group
          if (this === _.last(filters)) {
            return true;
          } else {
            return false;
          }
        } catch (error) {
          console.log(
            "There was a problem detecting whether a Filter required a positive" +
              " clause. Assuming that it needs one. Error details: " +
              error,
          );
          return true;
        }
      },

      /**
       * Constructs a query substring for each of the values set on this model
       *
       * @example
       *   values: ["walker", "jones"]
       *   Returns: "(walker%20OR%20jones)"
       *
       * @param {string[]} [values] - The values to use in this query substring.
       * If not provided, the values set on the model are used.
       * @return {string} The query substring
       */
      getValueQuerySubstring: function (values) {
        //Start a query string for this field and get the values
        var valuesQueryString = "",
          values = values || this.get("values");

        //If the values are not an array, convert it to an array
        if (!Array.isArray(values)) {
          values = [values];
        }

        //Iterate over each value set on the model
        _.each(
          values,
          function (value, i) {
            //If the value is not a string, then convert it to a string
            if (typeof value != "string") {
              value = value.toString();
            }

            //Trim off whitespace
            value = value.trim();

            var dateRangeRegEx =
                /^\[((\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d*Z)|\*)( |%20)TO( |%20)((\d{4}-[01]\d-[0-3]\dT[0-2]\d(:|\\:)[0-5]\d(:|\\:)[0-5]\d\.\d*Z)|\*)\]/,
              isDateRange = dateRangeRegEx.test(value),
              isSearchPhrase = value.indexOf(" ") > -1,
              isIdFilter = this.isIdFilter(),
              //Test for ORCIDs and group subjects
              isSubject =
                /^(?:https?:\/\/orcid\.org\/)?(?:\w{4}-){3}\w{4}$|^(?:CN=.{1,},DC=.{1,},DC=.{1,})$/i.test(
                  value,
                );

            // Escape special characters
            value = this.escapeSpecialChar(value);

            //URL encode the search value
            value = encodeURIComponent(value);

            // If the value is a search phrase (more than one word), is part of an ID filter,
            // and not a date range string, wrap in quotes
            if ((isSearchPhrase || isIdFilter || isSubject) &amp;&amp; !isDateRange) {
              value = '"' + value + '"';
            }

            if (this.get("matchSubstring") &amp;&amp; !isDateRange) {
              // Look for existing wildcard characters at the end of the value string, wrap
              // the value string in wildcard characters if there aren't any yet.
              if (!value.match(/^\*|\*$/)) {
                value = "*" + value + "*";
              }
            }

            // Add the value to the query string
            valuesQueryString += value;

            //Add the operator between values
            if (values.length > i + 1 &amp;&amp; valuesQueryString.length) {
              valuesQueryString += "%20" + this.get("operator") + "%20";
            }
          },
          this,
        );

        if (values.length > 1) {
          valuesQueryString = "(" + valuesQueryString + ")";
        }

        return valuesQueryString;
      },

      /**
       * Checks if any of the fields in this Filter match one of the
       * {@link AppConfig#queryIdentifierFields}
       * @since 2.17.0
       */
      isIdFilter: function () {
        try {
          let fields = this.get("fields");
          let values = this.get("values");

          if (!fields) {
            return false;
          }
          let idFields = MetacatUI.appModel.get("queryIdentifierFields");
          let match = _.some(idFields, (idField) => fields.includes(idField));

          //Check if the values are all identifiers by checking for uuids and dois
          if (!match &amp;&amp; values.length) {
            match = values.every((v) =>
              /^urn:uuid:\w{8,}-\w{4,}-\w{4,}-\w{4,}-\w{12,}$|^.{0,}doi.{1,}10.\d{4,9}\/[-._;()\/:A-Z0-9]+$/i.test(
                v,
              ),
            );
          }

          return match;
        } catch (error) {
          console.log(
            "Error checking if a Filter model is an ID filter. " +
              "Assuming it is not. Error details:" +
              error,
          );
          return false;
        }
      },

      /**
       * Resets the values attribute on this filter
       */
      resetValue: function () {
        this.set("values", this.defaults().values);
      },

      /**
       * Checks if this Filter has values different than the default values.
       * @return {boolean} - Returns true if this Filter has values set on it, otherwise will return false
       */
      hasChangedValues: function () {
        return this.get("values").length > 0;
      },

      /**
       * isEmpty - Checks whether this Filter has any values or fields set
       *
       * @return {boolean}  returns true if the Filter's values and fields are empty
       */
      isEmpty: function () {
        try {
          var fields = this.get("fields"),
            values = this.get("values"),
            noFields = !fields || fields.length == 0,
            fieldsEmpty = _.every(fields, function (item) {
              return item == "";
            }),
            noValues = !values || values.length == 0,
            valuesEmpty = _.every(values, function (item) {
              return item == "";
            });

          var noMinNoMax = _.every(
            [this.get("min"), this.get("max")],
            function (num) {
              return typeof num === "undefined" || (!num &amp;&amp; num !== 0);
            },
          );

          // Values aren't required for UI filter types. Labels, icons, and descriptions are
          // available.
          if (this.get("isUIFilterType")) {
            noUIVals = _.every(
              ["label", "icon", "description"],
              function (attrName) {
                var setValue = this.get(attrName);
                var defaultValue = this.defaults()[attrName];
                return !setValue || setValue === defaultValue;
              },
              this,
            );
            return noUIVals &amp;&amp; noFields &amp;&amp; fieldsEmpty &amp;&amp; noMinNoMax;
          }

          // For regular search filters, just a field and some sort of search term/value is
          // required
          return (
            noFields &amp;&amp; fieldsEmpty &amp;&amp; noValues &amp;&amp; valuesEmpty &amp;&amp; noMinNoMax
          );
        } catch (e) {
          console.log(
            "Failed to check if a Filter is empty, error message: " + e,
          );
        }
      },

      /**
       * Escapes Solr query reserved characters so that search terms can include
       *  those characters without throwing an error.
       *
       * @param {string} term - The search term or phrase to escape
       * @return {string} - The search term or phrase, after special characters are escaped
       */
      escapeSpecialChar: function (term) {
        if (!term || typeof term != "string") {
          return "";
        }

        // Removes all the ampersands since Metacat cannot handle escaped ampersands for some reason
        // See https://github.com/NCEAS/metacat/issues/1576
        term = term.replaceAll("&amp;", "");

        return term.replace(
          /\+|-|&amp;|\||!|\(|\)|\{|\}|\[|\]|\^|\\|\"|~|\?|:|\//g,
          "\\$&amp;",
        );
      },

      /**
       * Updates XML DOM with the new values from the model
       *
       *  @param {object} [options] A literal object with options for this serialization
       *  @return {Element} A new XML element with the updated values
       */
      updateDOM: function (options) {
        try {
          if (typeof options == "undefined") {
            var options = {};
          }

          var objectDOM = this.get("objectDOM"),
            filterOptionsNode;

          if (
            typeof objectDOM == "undefined" ||
            !objectDOM ||
            !$(objectDOM).length
          ) {
            // Node name differs for different filters, all of which use this function
            var nodeName = this.get("nodeName") || "filter";
            // Create an XML filter element from scratch
            var objectDOM = new DOMParser().parseFromString(
              "&lt;" + nodeName + ">&lt;/" + nodeName + ">",
              "text/xml",
            );
            var $objectDOM = $(objectDOM).find(nodeName);
          } else {
            objectDOM = objectDOM.cloneNode(true);
            var $objectDOM = $(objectDOM);

            //Detach the filterOptions so they are saved
            filterOptionsNode = $objectDOM.children("filterOptions");
            filterOptionsNode.detach();

            //Empty the DOM
            $objectDOM.empty();
          }

          var xmlDocument = $objectDOM[0].ownerDocument;

          // Get new values. Must store in an array because the order that we add each
          // element to the DOM matters
          var filterData = [
            {
              nodeName: "label",
              value: this.get("label"),
            },
            {
              nodeName: "field",
              value: this.get("fields"),
            },
            {
              nodeName: "operator",
              value: this.get("operator"),
            },
            {
              nodeName: "exclude",
              value: this.get("exclude"),
            },
            {
              nodeName: "fieldsOperator",
              value: this.get("fieldsOperator"),
            },
            {
              nodeName: "matchSubstring",
              value: this.get("matchSubstring"),
            },
            {
              nodeName: "value",
              value: this.get("values"),
            },
          ];

          filterData.forEach(function (element) {
            var values = element.value;
            var nodeName = element.nodeName;

            // Serialize the nodes with multiple occurrences
            if (Array.isArray(values)) {
              _.each(
                values,
                function (value) {
                  // Don't serialize empty, null, or undefined values
                  if (value || value === false || value === 0) {
                    var nodeSerialized = xmlDocument.createElement(nodeName);
                    $(nodeSerialized).text(value);
                    $objectDOM.append(nodeSerialized);
                  }
                },
                this,
              );
            }
            // Serialize the single occurrence nodes. Don't serialize falsey or default values
            else if (
              (values || values === false) &amp;&amp;
              values != this.defaults()[nodeName]
            ) {
              var nodeSerialized = xmlDocument.createElement(nodeName);
              $(nodeSerialized).text(values);
              $objectDOM.append(nodeSerialized);
            }
          }, this);

          // If this is a UIFilterType that won't be serialized into a Collection definition,
          // then add extra XML nodes
          if (this.get("isUIFilterType")) {
            //Update the filterOptions XML DOM
            filterOptionsNode = this.updateFilterOptionsDOM(filterOptionsNode);

            //Add the filterOptions to the filter DOM
            if (
              typeof filterOptionsNode != "undefined" &amp;&amp;
              $(filterOptionsNode).children().length
            ) {
              $objectDOM.append(filterOptionsNode);
            }
          }

          return $objectDOM[0];
        } catch (e) {
          console.error("Unable to serialize a Filter.", e);
          return this.get("objectDOM") || "";
        }
      },

      /**
       * Serializes the filter options into an XML DOM and returns it
       * @param {Element} [filterOptionsNode] - The XML filterOptions node to update
       * @return {Element} - The updated DOM
       */
      updateFilterOptionsDOM: function (filterOptionsNode) {
        try {
          if (
            typeof filterOptionsNode == "undefined" ||
            !filterOptionsNode.length
          ) {
            var filterOptionsNode = new DOMParser().parseFromString(
              "&lt;filterOptions>&lt;/filterOptions>",
              "text/xml",
            );
            var filterOptionsNode =
              $(filterOptionsNode).find("filterOptions")[0];
          }
          //Convert the XML node into a jQuery object
          var $filterOptionsNode = $(filterOptionsNode);

          //Get the first option element
          var firstOptionNode = $filterOptionsNode.children("option").first();

          var xmlDocument;
          if (filterOptionsNode.length &amp;&amp; filterOptionsNode[0]) {
            xmlDocument = filterOptionsNode[0].ownerDocument;
          }
          if (!xmlDocument) {
            xmlDocument = filterOptionsNode.ownerDocument;
          }
          if (!xmlDocument) {
            xmlDocument = filterOptionsNode;
          }

          // Update the text value of UI nodes. The following values are for
          // UIFilterOptionsType
          ["placeholder", "icon", "description"].forEach(function (nodeName) {
            //Remove the existing node, if it exists
            $filterOptionsNode.children(nodeName).remove();

            // If there is a value set on the model for this attribute, then create an XML
            // node for this attribute and set the text value
            var value = this.get(nodeName);
            if (value) {
              var newNode = $(xmlDocument.createElement(nodeName)).text(value);

              if (firstOptionNode.length) firstOptionNode.before(newNode);
              else $filterOptionsNode.append(newNode);
            }
          }, this);

          //If no options were serialized, then return an empty string
          if (!$filterOptionsNode.children().length) {
            return "";
          } else {
            return filterOptionsNode;
          }
        } catch (e) {
          console.log(
            "Error updating the FilterOptions DOM in a Filter model, " +
              "error details: ",
            e,
          );
          return "";
        }
      },

      /**
       * Returns true if the given value or value set on this filter is a date range query
       * @param {string} value - The string to test
       * @return {boolean}
       */
      isDateQuery: function (value) {
        if (typeof value == "undefined" &amp;&amp; this.get("values").length == 1) {
          var value = this.get("values")[0];
        }

        if (value) {
          return /[\d|\-|:|T]*Z TO [\d|\-|:|T]*Z/.test(value);
        } else {
          return false;
        }
      },

      /**
       * Check whether a set of query fields contain only fields that specify latitude and/or
       * longitude
       * @param {string[]} [fields] A list of fields to check for coordinate fields. If not
       * provided, the fields set on the model will be used.
       * @returns {Boolean} Returns true if every field is a field that specifies latitude or
       * longitude
       * @since 2.21.0
       */
      isCoordinateQuery: function (fields) {
        try {
          if (!fields) {
            fields = this.get("fields");
          }
          const latitudeFields = MetacatUI.appModel.get("queryLatitudeFields");
          const longitudeFields = MetacatUI.appModel.get(
            "queryLongitudeFields",
          );
          const coordinateFields = latitudeFields.concat(longitudeFields);
          return _.every(fields, function (field) {
            return _.contains(coordinateFields, field);
          });
        } catch (e) {
          console.log(
            "Error checking if filter is a coordinate filter. Returning false. ",
            e,
          );
          return false;
        }
      },

      /**
       * Check whether a set of query fields contain only fields that specify latitude
       * @param {string[]} [fields] A list of fields to check for coordinate fields. If not
       * provided, the fields set on the model will be used.
       * @returns {Boolean} Returns true if every field is a field that specifies latitude
       * @since 2.21.0
       */
      isLatitudeQuery: function (fields) {
        try {
          if (!fields) {
            fields = this.get("fields");
          }
          const latitudeFields = MetacatUI.appModel.get("queryLatitudeFields");
          return _.every(fields, function (field) {
            return _.contains(latitudeFields, field);
          });
        } catch (e) {
          console.log(
            "Error checking if filter is a latitude filter. Returning false. ",
            e,
          );
          return false;
        }
      },

      /**
       * Check whether a set of query fields contain only fields that specify longitude
       * @param {string[]} [fields] A list of fields to check for longitude fields. If not
       * provided, the fields set on the model will be used.
       * @returns {Boolean} Returns true if every field is a field that specifies longitude
       * @since 2.21.0
       */
      isLongitudeQuery: function (fields) {
        try {
          if (!fields) {
            fields = this.get("fields");
          }
          const longitudeFields = MetacatUI.appModel.get(
            "queryLongitudeFields",
          );
          return _.every(fields, function (field) {
            return _.contains(longitudeFields, field);
          });
        } catch (error) {
          console.log(
            "Error checking if filter is a longitude filter. Returning false. ",
            e,
          );
          return false;
        }
      },

      /**
       * Checks if the values set on this model are valid.
       * Some of the attributes are changed during this process if they are found to be invalid,
       * since there aren't any easy ways for users to fix these issues themselves in the UI.
       * @return {object} - Returns a literal object with the invalid attributes and their corresponding error message
       */
      validate: function () {
        try {
          var errors = {};
          // UI filter types have
          var isUIFilterType = this.get("isUIFilterType");

          //---Validate fields----
          var fields = this.get("fields");
          //All fields should be strings
          var nonStrings = _.filter(fields, function (field) {
            return typeof field != "string" || !field.trim().length;
          });

          if (nonStrings.length) {
            //Remove the nonstrings from the model, rather than returning an error
            this.set("fields", _.without(fields, nonStrings));
          }
          //If there are no fields, set an error message
          if (!this.get("fields").length) {
            errors.fields = "Filters should have at least one search field.";
          }

          //---Validate values----
          var values = this.get("values");
          // All values should be strings, booleans, numbers, or dates
          var invalidValues = _.filter(values, function (value) {
            //Empty strings are invalid
            if (typeof value == "string" &amp;&amp; !value.trim().length) {
              return true;
            }
            //Non-empty strings, booleans, numbers, or dates are valid
            else if (
              typeof value == "string" ||
              typeof value == "boolean" ||
              typeof value == "number" ||
              Date.prototype.isPrototypeOf(value)
            ) {
              return false;
            }
          });

          if (invalidValues.length) {
            //Remove the invalid values from the model, rather than returning an error
            this.set("values", _.without(values, invalidValues));
          }

          //If there are no values, and this isn't a custom search filter, set an error
          //message.
          if (!isUIFilterType &amp;&amp; !this.get("values").length) {
            errors.values = "Filters should include at least one search term.";
          }

          //---Validate operators ----
          //The operator must be either AND or OR
          ["operator", "fieldsOperator"].forEach(function (op) {
            if (!["AND", "OR"].includes(this.get(op))) {
              //Reset the value to the default rather than return an error
              this.set(op, this.defaults()[op]);
            }
          }, this);

          //---Validate exclude and matchSubstring----
          //Exclude should always be a boolean
          if (typeof this.get("exclude") != "boolean") {
            //Reset the value to the default rather than return an error
            this.set("exclude", this.defaults().exclude);
          }
          //matchSubstring should always be a boolean
          if (typeof this.get("matchSubstring") != "boolean") {
            //Reset the value to the default rather than return an error
            this.set("matchSubstring", this.defaults().matchSubstring);
          }

          //---Validate label, placeholder, icon, and description----
          var textAttributes = ["label", "placeholder", "icon", "description"];
          //These fields should be strings
          _.each(
            textAttributes,
            function (attr) {
              if (typeof this.get(attr) != "string") {
                //Reset the value to the default rather than return an error
                this.set(attr, this.defaults()[attr]);
              }
            },
            this,
          );

          if (Object.keys(errors).length) return errors;
          else {
            return;
          }
        } catch (e) {
          console.error(e);
        }
      },
    },
  );

  return FilterModel;
});
</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
