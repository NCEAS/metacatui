<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>MetacatUI Dev Docs: Source: src/js/views/MetricsChartView.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
    <link type="text/css" rel="stylesheet" href="/metacatui/assets/css/styles.css">
    <link type="text/css" rel="stylesheet" href="styles/style.css">
</head>

<body>

<nav id="nav">
    <a href="/">
      <div class="logo">
<svg class="cat" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="cat" class="svg-inline--fa fa-cat fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M290.59 192c-20.18 0-106.82 1.98-162.59 85.95V192c0-52.94-43.06-96-96-96-17.67 0-32 14.33-32 32s14.33 32 32 32c17.64 0 32 14.36 32 32v256c0 35.3 28.7 64 64 64h176c8.84 0 16-7.16 16-16v-16c0-17.67-14.33-32-32-32h-32l128-96v144c0 8.84 7.16 16 16 16h32c8.84 0 16-7.16 16-16V289.86c-10.29 2.67-20.89 4.54-32 4.54-61.81 0-113.52-44.05-125.41-102.4zM448 96h-64l-64-64v134.4c0 53.02 42.98 96 96 96s96-42.98 96-96V32l-64 64zm-72 80c-8.84 0-16-7.16-16-16s7.16-16 16-16 16 7.16 16 16-7.16 16-16 16zm80 0c-8.84 0-16-7.16-16-16s7.16-16 16-16 16 7.16 16 16-7.16 16-16 16z"></path></svg>

<svg width="459px" height="53px" viewBox="0 0 459 53" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
    <g id="metacatui" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
        <path d="M16.492,52 C17.212,52 17.812,51.748 18.292,51.244 C18.772,50.74 19.012,50.128 19.012,49.408 L19.012,49.408 L18.94,22.912 L30.82,37.816 C31.204,38.344 31.72,38.764 32.368,39.076 C33.016,39.388 33.7,39.544 34.42,39.544 C35.908,39.544 37.132,38.896 38.092,37.6 L38.092,37.6 L49.684,22.912 L49.684,49.408 C49.684,50.128 49.96,50.74 50.512,51.244 C51.064,51.748 51.7,52 52.42,52 L52.42,52 L62.068,52 C62.788,52 63.388,51.748 63.868,51.244 C64.348,50.74 64.588,50.128 64.588,49.408 L64.588,49.408 L64.588,4.12 C64.588,3.448 64.336,2.86 63.832,2.356 C63.328,1.852 62.74,1.6 62.068,1.6 L62.068,1.6 L52.348,1.6 C51.388,1.6 50.56,1.648 49.864,1.744 C49.168,1.84 48.532,2.152 47.956,2.68 L47.956,2.68 L33.916,17.296 L20.524,2.608 C20.332,2.368 19.972,2.14 19.444,1.924 C18.916,1.708 18.412,1.6 17.932,1.6 L17.932,1.6 L6.772,1.6 C6.052,1.6 5.44,1.852 4.936,2.356 C4.432,2.86 4.18,3.448 4.18,4.12 L4.18,4.12 L4.18,49.408 C4.18,50.08 4.432,50.68 4.936,51.208 C5.44,51.736 6.052,52 6.772,52 L6.772,52 L16.492,52 Z M110.74,52 C111.556,52 112.264,51.676 112.864,51.028 C113.464,50.38 113.764,49.624 113.764,48.76 L113.764,48.76 L113.764,42.568 C113.764,41.608 113.464,40.828 112.864,40.228 C112.264,39.628 111.556,39.328 110.74,39.328 L110.74,39.328 L89.428,39.328 L89.428,32.92 L109.732,32.92 C110.5,32.92 111.184,32.596 111.784,31.948 C112.384,31.3 112.684,30.568 112.684,29.752 L112.684,29.752 L112.684,23.488 C112.684,22.576 112.384,21.82 111.784,21.22 C111.184,20.62 110.5,20.32 109.732,20.32 L109.732,20.32 L89.428,20.32 L89.428,14.488 L110.74,14.488 C111.508,14.488 112.204,14.164 112.828,13.516 C113.452,12.868 113.764,12.136 113.764,11.32 L113.764,11.32 L113.764,5.056 C113.764,4.144 113.464,3.388 112.864,2.788 C112.264,2.188 111.556,1.888 110.74,1.888 L110.74,1.888 L76.756,1.888 C75.94,1.888 75.232,2.188 74.632,2.788 C74.032,3.388 73.732,4.144 73.732,5.056 L73.732,5.056 L73.732,48.76 C73.732,49.624 74.032,50.38 74.632,51.028 C75.232,51.676 75.94,52 76.756,52 L76.756,52 L110.74,52 Z M147.604,52 C148.42,52 149.104,51.688 149.656,51.064 C150.208,50.44 150.484,49.672 150.484,48.76 L150.484,48.76 L150.484,16.216 L161.86,16.216 C162.676,16.216 163.396,15.904 164.02,15.28 C164.644,14.656 164.956,13.936 164.956,13.12 L164.956,13.12 L164.956,4.768 C164.956,4 164.644,3.316 164.02,2.716 C163.396,2.116 162.676,1.816 161.86,1.816 L161.86,1.816 L124.132,1.816 C123.22,1.816 122.464,2.104 121.864,2.68 C121.264,3.256 120.964,3.952 120.964,4.768 L120.964,4.768 L120.964,13.12 C120.964,13.936 121.264,14.656 121.864,15.28 C122.464,15.904 123.22,16.216 124.132,16.216 L124.132,16.216 L135.652,16.216 L135.148,48.832 C135.148,49.744 135.424,50.5 135.976,51.1 C136.528,51.7 137.212,52 138.028,52 L138.028,52 L147.604,52 Z M175.828,52 C176.836,52 177.676,51.82 178.348,51.46 C179.02,51.1 179.452,50.584 179.644,49.912 L179.644,49.912 L181.876,42.712 L197.932,42.712 L200.164,49.912 C200.356,50.584 200.8,51.1 201.496,51.46 C202.192,51.82 203.044,52 204.052,52 L204.052,52 L213.916,52 C215.836,51.712 216.796,50.704 216.796,48.976 C216.796,48.304 216.676,47.596 216.436,46.852 C216.196,46.108 216.052,45.616 216.004,45.376 L216.004,45.376 L199.876,4.84 C199.588,3.976 199.036,3.232 198.22,2.608 C197.404,1.984 196.372,1.648 195.124,1.6 L195.124,1.6 L184.756,1.6 C183.604,1.648 182.608,1.948 181.768,2.5 C180.928,3.052 180.292,3.832 179.86,4.84 L179.86,4.84 L163.876,45.376 C163.828,45.472 163.672,45.916 163.408,46.708 C163.144,47.5 163.012,48.304 163.012,49.12 C163.012,50.752 163.948,51.712 165.82,52 L165.82,52 L175.828,52 Z M195.34,30.544 L184.036,30.544 L189.652,13.624 L195.34,30.544 Z M245.38,53.08 C250.612,53.08 255.652,51.544 260.5,48.472 C261.22,47.944 261.58,47.296 261.58,46.528 C261.58,45.808 261.292,45.16 260.716,44.584 L260.716,44.584 L252.796,36.808 C252.364,36.376 251.836,36.16 251.212,36.16 C250.78,36.16 250.372,36.256 249.988,36.448 C248.356,37.12 246.796,37.456 245.308,37.456 C243.244,37.456 241.348,36.952 239.62,35.944 C237.892,34.936 236.512,33.58 235.48,31.876 C234.448,30.172 233.932,28.336 233.932,26.368 C233.932,24.352 234.436,22.504 235.444,20.824 C236.452,19.144 237.832,17.812 239.584,16.828 C241.336,15.844 243.244,15.352 245.308,15.352 C246.892,15.352 248.332,15.64 249.628,16.216 C250.012,16.408 250.444,16.504 250.924,16.504 C251.548,16.504 252.1,16.264 252.58,15.784 L252.58,15.784 L259.636,8.008 C260.164,7.384 260.428,6.76 260.428,6.136 C260.428,5.224 259.996,4.528 259.132,4.048 C254.86,1.552 250.276,0.304 245.38,0.304 C240.532,0.304 236.032,1.492 231.88,3.868 C227.728,6.244 224.44,9.448 222.016,13.48 C219.592,17.512 218.38,21.904 218.38,26.656 C218.38,31.408 219.592,35.812 222.016,39.868 C224.44,43.924 227.728,47.14 231.88,49.516 C236.032,51.892 240.532,53.08 245.38,53.08 Z M279.796,52 C280.804,52 281.644,51.82 282.316,51.46 C282.988,51.1 283.42,50.584 283.612,49.912 L283.612,49.912 L285.844,42.712 L301.9,42.712 L304.132,49.912 C304.324,50.584 304.768,51.1 305.464,51.46 C306.16,51.82 307.012,52 308.02,52 L308.02,52 L317.884,52 C319.804,51.712 320.764,50.704 320.764,48.976 C320.764,48.304 320.644,47.596 320.404,46.852 C320.164,46.108 320.02,45.616 319.972,45.376 L319.972,45.376 L303.844,4.84 C303.556,3.976 303.004,3.232 302.188,2.608 C301.372,1.984 300.34,1.648 299.092,1.6 L299.092,1.6 L288.724,1.6 C287.572,1.648 286.576,1.948 285.736,2.5 C284.896,3.052 284.26,3.832 283.828,4.84 L283.828,4.84 L267.844,45.376 C267.796,45.472 267.64,45.916 267.376,46.708 C267.112,47.5 266.98,48.304 266.98,49.12 C266.98,50.752 267.916,51.712 269.788,52 L269.788,52 L279.796,52 Z M299.308,30.544 L288.004,30.544 L293.62,13.624 L299.308,30.544 Z M352.588,52 C353.404,52 354.088,51.688 354.64,51.064 C355.192,50.44 355.468,49.672 355.468,48.76 L355.468,48.76 L355.468,16.216 L366.844,16.216 C367.66,16.216 368.38,15.904 369.004,15.28 C369.628,14.656 369.94,13.936 369.94,13.12 L369.94,13.12 L369.94,4.768 C369.94,4 369.628,3.316 369.004,2.716 C368.38,2.116 367.66,1.816 366.844,1.816 L366.844,1.816 L329.116,1.816 C328.204,1.816 327.448,2.104 326.848,2.68 C326.248,3.256 325.948,3.952 325.948,4.768 L325.948,4.768 L325.948,13.12 C325.948,13.936 326.248,14.656 326.848,15.28 C327.448,15.904 328.204,16.216 329.116,16.216 L329.116,16.216 L340.636,16.216 L340.132,48.832 C340.132,49.744 340.408,50.5 340.96,51.1 C341.512,51.7 342.196,52 343.012,52 L343.012,52 L352.588,52 Z M402.052,52.792 C408.1,52.792 412.912,51.628 416.488,49.3 C420.064,46.972 422.536,44.068 423.904,40.588 C425.272,37.108 425.932,33.424 425.884,29.536 C425.884,29.5309474 425.883967,29.5237673 425.8839,29.5144598 L425.883102,29.4330859 C425.879911,29.1480111 425.868211,28.3183158 425.848,26.944 C425.8294,25.6792 425.818008,22.91524 425.813823,18.65212 L425.813103,17.80828 C425.812997,17.66452 425.8129,17.5192 425.81281,17.37232 L425.812,3.904 C425.86,3.184 425.632,2.62 425.128,2.212 C424.624,1.804 423.916,1.6 423.004,1.6 L423.004,1.6 L413.428,1.6 C412.612,1.6 411.904,1.828 411.304,2.284 C410.704,2.74 410.404,3.28 410.404,3.904 L410.404,3.904 L410.26,27.808 C410.26,34.144 407.476,37.312 401.908,37.312 C399.076,37.312 396.832,36.412 395.176,34.612 C393.52,32.812 392.668,30.352 392.62,27.232 L392.62,27.232 L392.332,3.76 C392.332,3.088 392.068,2.56 391.54,2.176 C391.012,1.792 390.268,1.6 389.308,1.6 L389.308,1.6 L379.876,1.6 C378.244,1.6 377.428,2.32 377.428,3.76 L377.428,3.76 L377.5,28.816 C377.5,33.04 378.376,36.964 380.128,40.588 C381.88,44.212 384.592,47.152 388.264,49.408 C391.936,51.664 396.532,52.792 402.052,52.792 Z M449.284,52.144 C450.148,52.144 450.88,51.844 451.48,51.244 C452.08,50.644 452.38,49.84 452.38,48.832 L452.38,48.832 L452.38,4.912 C452.38,4 452.08,3.22 451.48,2.572 C450.88,1.924 450.148,1.6 449.284,1.6 L449.284,1.6 L439.42,1.6 C438.46,1.6 437.692,1.924 437.116,2.572 C436.54,3.22 436.252,4 436.252,4.912 L436.252,4.912 L436.252,48.832 C436.252,49.84 436.54,50.644 437.116,51.244 C437.692,51.844 438.46,52.144 439.42,52.144 L439.42,52.144 L449.284,52.144 Z" id="metacatui" fill="#FCBF49" fill-rule="nonzero"></path>
    </g>
</svg>
</logo>

    </a>
    <h3>Namespaces</h3><ul><li><a href="AppConfig.html">AppConfig</a></li><li><a href="MapConfig.html">MapConfig</a></li><li><a href="MetacatUI.html">MetacatUI</a></li><li><a href="Utilities.html">Utilities</a></li></ul><h3>Classes</h3><ul><li class='category-heading' data-category='Collections'>Collections</li><li><a href="AccessPolicy.html">AccessPolicy</a></li><li><a href="Citations.html">Citations</a></li><li><a href="DataPackage.html">DataPackage</a></li><li><a href="Filters.html">Filters</a></li><li><a href="ObjectFormats.html">ObjectFormats</a></li><li><a href="ProjectList.html">ProjectList</a></li><li><a href="QualityReport.html">QualityReport</a></li><li><a href="SolrResults.html">SolrResults</a></li><li><a href="Units.html">Units</a></li><li><a href="UserGroup.html">UserGroup</a></li><li class='category-heading' data-category='Collections/Bookkeeper'>Collections/Bookkeeper</li><li><a href="Quotas.html">Quotas</a></li><li><a href="Usages.html">Usages</a></li><li class='category-heading' data-category='Collections/Geohashes'>Collections/Geohashes</li><li><a href="Geohashes.html">Geohashes</a></li><li class='category-heading' data-category='Collections/Maps'>Collections/Maps</li><li><a href="AssetColors.html">AssetColors</a></li><li><a href="Features.html">Features</a></li><li><a href="GeoPoints.html">GeoPoints</a></li><li><a href="MapAssets.html">MapAssets</a></li><li><a href="VectorFilters.html">VectorFilters</a></li><li class='category-heading' data-category='Collections/Metadata/EML'>Collections/Metadata/EML</li><li><a href="EMLAnnotations.html">EMLAnnotations</a></li><li><a href="EMLMissingValueCodes.html">EMLMissingValueCodes</a></li><li class='category-heading' data-category='Collections/QueryFields'>Collections/QueryFields</li><li><a href="QueryFields.html">QueryFields</a></li><li class='category-heading' data-category='Models'>Models</li><li><a href="AccessRule.html">AccessRule</a></li><li><a href="AppModel.html">AppModel</a></li><li><a href="CitationModel.html">CitationModel</a></li><li><a href="CollectionModel.html">CollectionModel</a></li><li><a href="DataONEObject.html">DataONEObject</a></li><li><a href="LookupModel.html">LookupModel</a></li><li><a href="Map.html">Map</a></li><li><a href="Metrics.html">Metrics</a></li><li><a href="QualityCheck.html">QualityCheck</a></li><li><a href="Search.html">Search</a></li><li><a href="SolrResult.html">SolrResult</a></li><li><a href="Stats.html">Stats</a></li><li class='category-heading' data-category='Models/Analytics'>Models/Analytics</li><li><a href="Analytics.html">Analytics</a></li><li><a href="GoogleAnalytics.html">GoogleAnalytics</a></li><li class='category-heading' data-category='Models/Bookkeeper'>Models/Bookkeeper</li><li><a href="Quota.html">Quota</a></li><li><a href="Subscription.html">Subscription</a></li><li><a href="Usage.html">Usage</a></li><li class='category-heading' data-category='Models/Connectors'>Models/Connectors</li><li><a href="FiltersMapConnector.html">FiltersMapConnector</a></li><li><a href="FiltersSearchConnector.html">FiltersSearchConnector</a></li><li><a href="GeoPointsCesiumConnector.html">GeoPointsCesiumConnector</a></li><li><a href="GeoPointsCesiumPointsConnector.html">GeoPointsCesiumPointsConnector</a></li><li><a href="GeoPointsCesiumPolygonConnector.html">GeoPointsCesiumPolygonConnector</a></li><li><a href="MapSearchConnector.html">MapSearchConnector</a></li><li><a href="MapSearchFiltersConnector.html">MapSearchFiltersConnector</a></li><li class='category-heading' data-category='Models/Filters'>Models/Filters</li><li><a href="BooleanFilter.html">BooleanFilter</a></li><li><a href="ChoiceFilter.html">ChoiceFilter</a></li><li><a href="DateFilter.html">DateFilter</a></li><li><a href="Filter.html">Filter</a></li><li><a href="FilterGroup.html">FilterGroup</a></li><li><a href="NumericFilter.html">NumericFilter</a></li><li><a href="SpatialFilter.html">SpatialFilter</a></li><li><a href="ToggleFilter.html">ToggleFilter</a></li><li class='category-heading' data-category='Models/Formats'>Models/Formats</li><li><a href="ObjectFormat.html">ObjectFormat</a></li><li class='category-heading' data-category='Models/Geohashes'>Models/Geohashes</li><li><a href="Geohash.html">Geohash</a></li><li class='category-heading' data-category='Models/Maps'>Models/Maps</li><li><a href="AssetColor.html">AssetColor</a></li><li><a href="AssetColorPalette.html">AssetColorPalette</a></li><li><a href="Feature.html">Feature</a></li><li><a href="GeoBoundingBox.html">GeoBoundingBox</a></li><li><a href="GeoPoint.html">GeoPoint</a></li><li><a href="GeoScale.html">GeoScale</a></li><li><a href="GeoUtilities.html">GeoUtilities</a></li><li><a href="MapInteraction.html">MapInteraction</a></li><li><a href="MapModel.html">MapModel</a></li><li><a href="VectorFilter.html">VectorFilter</a></li><li class='category-heading' data-category='Models/Maps/Assets'>Models/Maps/Assets</li><li><a href="Cesium3DTileset.html">Cesium3DTileset</a></li><li><a href="CesiumGeohash.html">CesiumGeohash</a></li><li><a href="CesiumImagery.html">CesiumImagery</a></li><li><a href="CesiumTerrain.html">CesiumTerrain</a></li><li><a href="CesiumVectorData.html">CesiumVectorData</a></li><li><a href="MapAsset.html">MapAsset</a></li><li class='category-heading' data-category='Models/Metadata'>Models/Metadata</li><li><a href="ScienceMetadata.html">ScienceMetadata</a></li><li class='category-heading' data-category='Models/Metadata/EML'>Models/Metadata/EML</li><li><a href="EMLMethodStep.html">EMLMethodStep</a></li><li><a href="EMLSpecializedText.html">EMLSpecializedText</a></li><li class='category-heading' data-category='Models/Metadata/EML211'>Models/Metadata/EML211</li><li><a href="EML211.html">EML211</a></li><li><a href="EMLAnnotation.html">EMLAnnotation</a></li><li><a href="EMLAttribute.html">EMLAttribute</a></li><li><a href="EMLDataTable.html">EMLDataTable</a></li><li><a href="EMLDistribution.html">EMLDistribution</a></li><li><a href="EMLEntity.html">EMLEntity</a></li><li><a href="EMLGeoCoverage.html">EMLGeoCoverage</a></li><li><a href="EMLMeasurementScale.html">EMLMeasurementScale</a></li><li><a href="EMLMethods.html">EMLMethods</a></li><li><a href="EMLMissingValueCode.html">EMLMissingValueCode</a></li><li><a href="EMLNonNumericDomain.html">EMLNonNumericDomain</a></li><li><a href="EMLNumericDomain.html">EMLNumericDomain</a></li><li><a href="EMLOtherEntity.html">EMLOtherEntity</a></li><li><a href="EMLParty.html">EMLParty</a></li><li><a href="EMLTemporalCoverage.html">EMLTemporalCoverage</a></li><li><a href="EMLText211.html">EMLText211</a></li><li><a href="EMLUnit.html">EMLUnit</a></li><li class='category-heading' data-category='Models/Metadata/EML220'>Models/Metadata/EML220</li><li><a href="EMLText.html">EMLText</a></li><li class='category-heading' data-category='Models/Portals'>Models/Portals</li><li><a href="PortalImage.html">PortalImage</a></li><li><a href="PortalModel.html">PortalModel</a></li><li><a href="PortalSectionModel.html">PortalSectionModel</a></li><li class='category-heading' data-category='Models/Projects'>Models/Projects</li><li><a href="Project.html">Project</a></li><li class='category-heading' data-category='Models/QueryFields'>Models/QueryFields</li><li><a href="QueryField.html">QueryField</a></li><li class='category-heading' data-category='Router'>Router</li><li><a href="UIRouter.html">UIRouter</a></li><li class='category-heading' data-category='Views'>Views</li><li><a href="AccessPolicyView.html">AccessPolicyView</a></li><li><a href="AccessRuleView.html">AccessRuleView</a></li><li><a href="AnnotationView.html">AnnotationView</a></li><li><a href="AppView.html">AppView</a></li><li><a href="CatalogSearchView.html">CatalogSearchView</a></li><li><a href="CitationHeaderView.html">CitationHeaderView</a></li><li><a href="CitationListView.html">CitationListView</a></li><li><a href="CitationModalView.html">CitationModalView</a></li><li><a href="CitationView.html">CitationView</a></li><li><a href="ColorPaletteView.html">ColorPaletteView</a></li><li><a href="DataCatalogViewWithFilters.html">DataCatalogViewWithFilters</a></li><li><a href="DataItemView.html">DataItemView</a></li><li><a href="DataPackageView.html">DataPackageView</a></li><li><a href="DraftsView.html">DraftsView</a></li><li><a href="EditCollectionView.html">EditCollectionView</a></li><li><a href="EditorView.html">EditorView</a></li><li><a href="FooterView.html">FooterView</a></li><li><a href="GroupListView.html">GroupListView</a></li><li><a href="ImageUploaderView.html">ImageUploaderView</a></li><li><a href="MarkdownEditorView.html">MarkdownEditorView</a></li><li><a href="MarkdownView.html">MarkdownView</a></li><li><a href="MdqRunView.html">MdqRunView</a></li><li><a href="MetadataView.html">MetadataView</a></li><li><a href="MetricModalView.html">MetricModalView</a></li><li><a href="MetricView.html">MetricView</a></li><li><a href="MetricsChartView.html">MetricsChartView</a></li><li><a href="NavbarView.html">NavbarView</a></li><li><a href="RegisterCitationView.html">RegisterCitationView</a></li><li><a href="SearchResultView.html">SearchResultView</a></li><li><a href="SignInView.html">SignInView</a></li><li><a href="TOCView.html">TOCView</a></li><li><a href="TableEditorView.html">TableEditorView</a></li><li><a href="UserGroupView.html">UserGroupView</a></li><li><a href="UserView.html">UserView</a></li><li class='category-heading' data-category='Views/Filters'>Views/Filters</li><li><a href="BooleanFilterView.html">BooleanFilterView</a></li><li><a href="ChoiceFilterView.html">ChoiceFilterView</a></li><li><a href="DateFilterView.html">DateFilterView</a></li><li><a href="FilterEditorView.html">FilterEditorView</a></li><li><a href="FilterGroupView.html">FilterGroupView</a></li><li><a href="FilterGroupsView.html">FilterGroupsView</a></li><li><a href="FilterView.html">FilterView</a></li><li><a href="NumericFilterView.html">NumericFilterView</a></li><li><a href="SemanticFilterView.html">SemanticFilterView</a></li><li><a href="ToggleFilterView.html">ToggleFilterView</a></li><li class='category-heading' data-category='Views/Maps'>Views/Maps</li><li><a href="CesiumWidgetView.html">CesiumWidgetView</a></li><li><a href="DrawTool.html">DrawTool</a></li><li><a href="FeatureInfoView.html">FeatureInfoView</a></li><li><a href="LayerDetailView.html">LayerDetailView</a></li><li><a href="LayerDetailsView.html">LayerDetailsView</a></li><li><a href="LayerInfoView.html">LayerInfoView</a></li><li><a href="LayerItemView.html">LayerItemView</a></li><li><a href="LayerListView.html">LayerListView</a></li><li><a href="LayerNavigationView.html">LayerNavigationView</a></li><li><a href="LayerOpacityView.html">LayerOpacityView</a></li><li><a href="LegendView.html">LegendView</a></li><li><a href="MapHelpPanel.html">MapHelpPanel</a></li><li><a href="MapView.html">MapView</a></li><li><a href="ScaleBarView.html">ScaleBarView</a></li><li><a href="ToolbarView.html">ToolbarView</a></li><li class='category-heading' data-category='Views/Metadata'>Views/Metadata</li><li><a href="EML211EditorView.html">EML211EditorView</a></li><li><a href="EMLAttributeView.html">EMLAttributeView</a></li><li><a href="EMLEntityView.html">EMLEntityView</a></li><li><a href="EMLMeasurementScaleView.html">EMLMeasurementScaleView</a></li><li><a href="EMLMeasurementTypeView.html">EMLMeasurementTypeView</a></li><li><a href="EMLMethodsView.html">EMLMethodsView</a></li><li><a href="EMLMissingValueCodeView.html">EMLMissingValueCodeView</a></li><li><a href="EMLMissingValueCodesView.html">EMLMissingValueCodesView</a></li><li><a href="EMLOtherEntityView.html">EMLOtherEntityView</a></li><li><a href="EMLPartyView.html">EMLPartyView</a></li><li><a href="EMLTempCoverageView.html">EMLTempCoverageView</a></li><li><a href="EMLView.html">EMLView</a></li><li><a href="EMlGeoCoverageView_.html">EMlGeoCoverageView</a></li><li><a href="ScienceMetadataView.html">ScienceMetadataView</a></li><li class='category-heading' data-category='Views/Portals'>Views/Portals</li><li><a href="PortalDataView.html">PortalDataView</a></li><li><a href="PortalHeaderView.html">PortalHeaderView</a></li><li><a href="PortalListView.html">PortalListView</a></li><li><a href="PortalLogosView.html">PortalLogosView</a></li><li><a href="PortalMembersView.html">PortalMembersView</a></li><li><a href="PortalSectionView.html">PortalSectionView</a></li><li><a href="PortalUsagesView.html">PortalUsagesView</a></li><li><a href="PortalView.html">PortalView</a></li><li><a href="PortalVisualizationsView.html">PortalVisualizationsView</a></li><li><a href="PortalsSearchView.html">PortalsSearchView</a></li><li class='category-heading' data-category='Views/Portals/Editor'>Views/Portals/Editor</li><li><a href="PortEditorDataView.html">PortEditorDataView</a></li><li><a href="PortEditorImageView.html">PortEditorImageView</a></li><li><a href="PortEditorLogosView.html">PortEditorLogosView</a></li><li><a href="PortEditorMdSectionView.html">PortEditorMdSectionView</a></li><li><a href="PortEditorSectionView.html">PortEditorSectionView</a></li><li><a href="PortEditorSectionsView.html">PortEditorSectionsView</a></li><li><a href="PortEditorSettingsView.html">PortEditorSettingsView</a></li><li><a href="PortalEditorView.html">PortalEditorView</a></li><li class='category-heading' data-category='Views/Projects'>Views/Projects</li><li><a href="ProjectView.html">ProjectView</a></li><li class='category-heading' data-category='Views/QueryBuilder'>Views/QueryBuilder</li><li><a href="QueryBuilderView.html">QueryBuilderView</a></li><li><a href="QueryRuleView.html">QueryRuleView</a></li><li class='category-heading' data-category='Views/Search'>Views/Search</li><li><a href="SearchResultsPagerView.html">SearchResultsPagerView</a></li><li><a href="SearchResultsView.html">SearchResultsView</a></li><li><a href="SorterView.html">SorterView</a></li><li class='category-heading' data-category='Views/SearchSelect'>Views/SearchSelect</li><li><a href="AccountSelectView.html">AccountSelectView</a></li><li><a href="AnnotationFilter.html">AnnotationFilter</a></li><li><a href="NodeSelect.html">NodeSelect</a></li><li><a href="ObjectFormatSelect.html">ObjectFormatSelect</a></li><li><a href="QueryFieldSelectView.html">QueryFieldSelectView</a></li><li><a href="SearchableSelectView.html">SearchableSelectView</a></li><li class='category-heading' data-category='Deprecated'>Deprecated</li><li><a href="AnnotatorView.html">AnnotatorView</a></li><li><a href="ExternalView.html">ExternalView</a></li><li><a href="LogsSearch.html">LogsSearch</a></li></ul><h3>Global</h3><ul><li><a href="global.html#appConfigPath">appConfigPath</a></li><li><a href="global.html#classificationsAreEqual">classificationsAreEqual</a></li><li><a href="global.html#defaults">defaults</a></li><li><a href="global.html#distLocations">distLocations</a></li><li><a href="global.html#hasValuesForDistributionLocation">hasValuesForDistributionLocation</a></li><li><a href="global.html#initialize">initialize</a></li><li><a href="global.html#isDuplicate">isDuplicate</a></li><li><a href="global.html#offlineNodes">offlineNodes</a></li><li><a href="global.html#onlineNodes">onlineNodes</a></li><li><a href="global.html#parse">parse</a></li><li><a href="global.html#removeDuplicateClassifications">removeDuplicateClassifications</a></li><li><a href="global.html#serialize">serialize</a></li><li><a href="global.html#taxonomicClassification">taxonomicClassification</a></li><li><a href="global.html#urlFunctionTypes">urlFunctionTypes</a></li></ul>
</nav>

<div id="main">

    <h1 class="page-title">Source: src/js/views/MetricsChartView.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/*global define */
define(['jquery', 'underscore', 'backbone', 'd3'],
    function($, _, Backbone, d3) {
    'use strict';

    /**
    * @class MetricsChartView
    * @classdesc The MetricsChartView will render an SVG times-series chart using D3 that shows the number of metrics over time.
    * @screenshot views/MetricsChartView.png
    * @classcategory Views
    */
    var MetricsChartView = Backbone.View.extend(
      /** @lends MetricsChartView.prototype */{

        initialize: function (options) {

            if(!d3){ console.log('SVG is not supported'); return null; }

            if(typeof options !== "undefined"){

            this.model        = options.model         || null;    // TODO: figure out how to set the model on this view

            this.metricCount  = options.metricCount   || "0";     // for now, use individual arrays
            this.metricMonths = options.metricMonths  || "0";
            this.id           = options.id            || "metrics-chart";
            this.viewType     = options.type          || "dataset";
            this.width        = options.width         || 600;
            this.height       = options.height        || 370;
            this.metricName   = options.metricName;

        }
      },

        // http://stackoverflow.com/questions/9651167/svg-not-rendering-properly-as-a-backbone-view
        // Give our el a svg namespace because Backbone gives a different one automatically
        nameSpace: "http://www.w3.org/2000/svg",
        _ensureElement: function() {
           if (!this.el) {
              var attrs = _.extend({}, _.result(this, 'attributes'));
              if (this.id) attrs.id = _.result(this, 'id');
              if (this.className) attrs['class'] = _.result(this, 'className');
              var $el = $(window.document.createElementNS(_.result(this, 'nameSpace'), _.result(this, 'tagName'))).attr(attrs);
              this.setElement($el, false);
           } else {
              this.setElement(_.result(this, 'el'), false);
           }
       },

       tagName: "svg",

      /** Renders this Metric Chart view. */
      render: function(){

        //Clear out any view elements in case this is a re-render
        this.$el.empty();

          /*
          * ========================================================================
          *  NAMING CONVENTIONS:

          CONTEXT: Context refers to the mini slider chart at the bottom, that includes the d3 "brush"
          FOCUS: Focus refers to the larger main chart at the top
          BRUSH: The rectangle in the context chart that highlights what is currently in focus in the focus chart.

          * ========================================================================
          */

          // check if there have been any views/citations
          var sumMetricCount = 0;
          for (var i = 0; i &lt; this.metricCount.length; i++) {
              sumMetricCount += this.metricCount[i]
          }

          var self = this;

          // when ther no data or no views/citations yet, just show some text:
          if(this.metricCount.length == 0 || this.metricCount == 0 || sumMetricCount ==0){

              var metricNameLemma = this.metricName.toLowerCase().substring(0, this.metricName.length - 1);
              var textMessage = "This dataset hasn’t been " + metricNameLemma + "ed yet."
              if (this.viewType != "dataset") {
                  textMessage = "These datasets have not been " + metricNameLemma + "ed yet."
              }

              var margin	= {top: 25, right: 40, bottom: 40, left: 40},
                  height	= this.height - margin.top - margin.bottom;

              //Set the chart width
              this.$el.css("width", "100%");
              var width = (this.$el.width() || this.width) - margin.left - margin.right;
              this.width = width;

              var vis = d3.select(this.el)
                  .attr("width", width + margin.left + margin.right)
                  .attr("height", height + margin.top + margin.bottom)
                	.attr("class", "line-chart no-data");

              var bkg = vis.append("svg:rect")
                  .attr("class", "no-data")
                  .attr("width", width)
                  .attr("height", height)
                  .attr("rx", 2)
                  .attr("ry", 2)
                  .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

              var msg = vis.append("text")
                  .attr("class", "no-data")
                  .text(textMessage)
                  .attr("text-anchor", "middle")
                  .attr("font-size", "20px")
                  .attr("x", width/2)
                  .attr("y", height/2)
                  .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

          // if there is data (even a series of zeros), draw the time-series chart:
      } else {

          /*
          * ========================================================================
          *  Global variables and options
          * ========================================================================
          */

          var metricName = this.metricName;

          // the format of the date in the input data
          var input_date_format 	  =		d3.time.format("%Y-%m");
          // how dates will be displayed in the chart in most cases
          var display_date_format	  = 	d3.time.format("%b %Y");

          // the length of a day/year in milliseconds
          var day_in_ms = 86400000,
          	year_in_ms = 31540000000;

          // focus chart sizing
          var margin	= {top: 30, right: 30, bottom: 95, left: 20},
              height	= this.height - margin.top - margin.bottom;

          //Set the chart width
          this.$el.css("width", "100%");
          var width = (this.$el.width() || this.width) - margin.left - margin.right;
          this.width = width;

          // context chart sizing
          var margin_context = {top: 315, right: 30, bottom: 20, left: 20},
              height_context = this.height - margin_context.top - margin_context.bottom;

          // zoom button sizing
          var button_width = 40,
          	button_height = 14,
          	button_padding = 10;

          // how wide does the tooltip div need to be to accomdate text?
          var tooltip_width = 76;

          // what proportion of a month should a bar cover?
          var bar_width_factor = 0.8;

          /*
          * ========================================================================
          *  Prepare data
          * ========================================================================
          */

          // change dates to milliseconds, to enable calculating the `d3.extent`
          var metricMonths_parsed = [];
          this.metricMonths.forEach(function(part, index, theArray) {

              try {
                  metricMonths_parsed[index] = input_date_format.parse(part).getTime();
              }
              catch {
                  // replace null with current month
                  var today = new Date();
                  var yyyy = today.getFullYear();
                  var mm = today.getMonth() + 1;
                  var updatedPart = yyyy.toString() + "-" + (mm.toString()).padStart(2, '0');

                  metricMonths_parsed[index] = input_date_format.parse(updatedPart).getTime();
              }

          });

          // input data from model doesn't list months where there were 0 counts for all metrics (views/downloads/citations)
          // construct an array of all months between min and max dates to use as x variable
          var all_months = d3.time.scale()
          				.domain(d3.extent(metricMonths_parsed))
                          .ticks(d3.time.months, 1);

          // add padding to both sides of array so that bars don't get cut off.
          // add more padding when there's just one bar (otherwise it's too wide)
          if (metricMonths_parsed.length == 1) {
              var new_min_date = new Date(d3.extent(metricMonths_parsed)[0] - day_in_ms*13),
                  new_max_date = new Date(d3.extent(metricMonths_parsed)[1] + day_in_ms*31*bar_width_factor + day_in_ms*13);
          } else {
              var new_min_date = new Date(d3.extent(metricMonths_parsed)[0] - day_in_ms*1),
                  new_max_date = new Date(d3.extent(metricMonths_parsed)[1] + day_in_ms*31*bar_width_factor);
          };

          all_months.push(new_min_date);
          // also add a little padding on the left for consistency
          all_months.push(new_max_date);

          // for each month, check whether there is a count available,
          // if so append it, otherwise append zero.
          var dataset = [];
          for(var i=0; i&lt;all_months.length; i++){
          	var match_index = metricMonths_parsed.indexOf(all_months[i].getTime());
          	if (match_index == -1) { // no match in data
          		dataset.push({integer: i, month: all_months[i], count:0});
          	} else { // match in data
          		dataset.push({integer: i, month: all_months[i], count:this.metricCount[match_index]});
          	}
          };

          /*
          * ========================================================================
          *  x and y coordinates
          * ========================================================================
          */

          var x_full_extent = d3.extent(dataset, function(d) { return d.month; });
          var bar_width = ((day_in_ms*30)/(x_full_extent[1]-x_full_extent[0])) * width * bar_width_factor;

          /* === Focus Chart === */

          var x = d3.time.scale()
              .range([0,width])
              .domain(d3.extent(dataset, function(d) { return d.month; }));

          var y = d3.scale.linear()
          	.range([height, 0])
              .domain([0, d3.max(dataset, function(d) { return d.count; })*1.04]);

          var x_axis = d3.svg.axis()
          	.scale(x)
              .orient("bottom")
          	.tickSize(-(height))
              .ticks(generate_ticks)
          	.tickFormat(format_months);

          var y_axis = d3.svg.axis()
          	.scale(y)
              .ticks(4)
          	.tickFormat(d3.format("d"))
              .tickSize(-(width))
          	.orient("right");

          /* === Context Chart === */

          var x_context = d3.time.scale()
              .range([0, width])
              .domain(d3.extent(dataset, function(d) { return d.month; }));

          var y_context = d3.scale.linear()
          	.range([height_context, 0])
              .domain(y.domain());

          var x_axis_context = d3.svg.axis()
              .scale(x_context)
              .orient("bottom")
              .ticks(generate_ticks)
              .tickFormat(format_months);

          /*
          * ========================================================================
          *  Variables for brushing and zooming behaviour
          * ========================================================================
          */

          var brush = d3.svg.brush()
              .x(x_context)
              .on("brush", change_focus_brush)
              .on("brushend", check_bounds);

          var zoom = d3.behavior.zoom()
              .on("zoom", change_focus_zoom)
              .on("zoomend", check_bounds);

          /*
          * ========================================================================
          *  Define the SVG area ("vis") and append all the layers
          * ========================================================================
          */

          // === the main components === //

          var vis = d3.select(this.el)
              .attr("width", width + margin.left + margin.right)
              .attr("height", height + margin.top + margin.bottom)
            	.attr("class", "line-chart");

          // clipPath is used to keep elements from moving outside of plot area when viwer zooms/scrolls/brushes
          vis.append("defs").append("clipPath")
              .attr("id", "clip")
              .append("rect")
              .attr("width", width)
              .attr("height", height);

          var pane = vis.append("rect")
              .attr("class", "pane")
              .attr("width", width)
              .attr("height", height)
              .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

          var context = vis.append("g")
              .attr("class", "context")
              .attr("transform", "translate(" + margin_context.left + "," + margin_context.top + ")");

          var focus = vis.append("g")
              .attr("class", "focus")
              .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

          // === current date range text &amp; zoom buttons === //

          var expl_text = vis.append("g")
              .attr("id", "buttons_group")
              .attr("transform", "translate(" + 0 + ","+ 0 +")");

          expl_text.append("text")
          	.attr("id", "totalCount")
              .style("text-anchor", "start")
              .attr("transform", "translate(" + 18 + ","+ 11 +")");

          expl_text.append("text")
              .attr("id", "displayDates")
              .style("text-anchor", "start")
              .attr("transform", "translate(" + 20 + ","+ 22 +")");

          update_context();

          // === the zooming/scaling buttons === //

          if ((x_full_extent[1] - x_full_extent[0]) &lt; year_in_ms) {
              var button_data =["month","all"];
          } else {
             var button_data =["year","month","all"];
          };

          var button_count	 = button_data.length -1,
          	button_g_width	 =	(button_count*button_width) +
          						(button_count*button_padding) +
          						margin.right - button_padding;

          expl_text.append("text")
          	.attr("class", "zoomto_text")
              .text("Zoom to")
              .style("text-anchor", "start")
              .attr("transform", "translate(" + (width - button_g_width - 45) + ","+ 14 +")")
          	.style("opacity", "0");

          var button = expl_text.selectAll("g")
              .data(button_data)
              .enter().append("g")
              .attr("class", "scale_button")
              .attr("transform", function(d, i) { return "translate(" + ((width - button_g_width) + i*button_width + i*button_padding) + ",4)"; })
          	.style("opacity", "0");

          button.append("rect")
          	.attr("class", "button_rect")
          	.attr("width", button_width)
          	.attr("height", button_height)
              .attr("rx", 1)
              .attr("ry", 1);

          button.append("text")
              .attr("dy", (button_height/2 + 3))
              .attr("dx", button_width/2)
              .style("text-anchor", "middle")
              .text(function(d) { return d; });

          /* === focus chart === */

          focus.append("g")
              .attr("class", "y axis")
              .call(y_axis)
             	.attr("transform", "translate(" + (width) + ", 0)")
          	.style("text-anchor", "middle");

          // x-axis
          focus.append("g")
              .attr("class", "x axis")
              .attr("transform", "translate(0," + height + ")")
              .call(x_axis)
          	.style("text-anchor", "middle");

          // enter bars
          focus.selectAll(".bar")
          	.data(dataset)
          	.enter().append("rect")
          	  		.attr("class", "bar")
          			  .attr("id", function(d){return "bar_" + d.month.getTime()}) //id of each bar is "bar_" plus it's associated date in ms
          	  		.attr("x", function (d) {return x(d.month); })
          	  		.attr("y", height)
          	  		.attr("height", 0)
          	  		.attr("width", bar_width)
          			.style("opacity", 0)
          			.on("mouseover", function(d) {
          				var floor_month = d3.time.month.floor(d.month).getTime();
          				highlight_bar("#bar_" + floor_month);
          				highlight_label("#label_" + floor_month);
          				show_tooltip(d);
          			})
          			.on("mouseout", function(d) {
          				var floor_month = d3.time.month.floor(d.month).getTime();
          				unhighlight_bar("#bar_" + floor_month);
          				unhighlight_label("#label_" + floor_month);
          				hide_tooltip(d);
          			});

          // animate bars
          focus.selectAll(".bar")
          	.transition()
          	.duration(450)
          	.ease("elastic", 1.03, 0.98)
          	.delay(function(d, i) {
          		var max_delay = 600;
          		var z = i / (dataset.length-1);
          		var line_z =  z * max_delay * 0.4;
          		var log_z = Math.log2(z + 1) * max_delay * 0.6;
          		return(250+line_z + log_z);
          	})
          	.attr("y", function (d) {return y(d.count);	  		})
          	.attr("height", function (d) {return y(0) - y(d.count);	  		})
          	.style("opacity", 1);

          /* === context chart === */

          // enter context bars
          context.selectAll(".bar_context")
          	.data(dataset)
          	.enter().append("rect")
          	  		.attr("class", "bar_context")
          	  		.attr("x", function (d) {return x_context(d.month) })
          	  		.attr("y", height_context)
          	  		.attr("height", 0)
          	  		.attr("width", bar_width)
          			.style("opacity", 0);

          // animate context bars
          context.selectAll(".bar_context")
          	.transition()
          	.duration(450)
          	.ease("elastic", 1.03, 0.98)
          	.delay(function(d, i) {
          		var max_delay = 600;
          		var z = i / (dataset.length-1);
          		var line_z =  z * max_delay * 0.4;
          		var log_z = Math.log2(z + 1) * max_delay * 0.6;
          		return(line_z + log_z);
          	})
          	.attr("y", function (d) {return y_context(d.count);	  		})
          	.attr("height", function (d) {return y_context(0) - y_context(d.count);	  		})
          	.style("opacity", 1);

          // x-axis
          context.append("g")
              .attr("class", "x axis")
              .attr("transform", "translate(0," + height_context + ")")
              .call(x_axis_context);

          /* === brush  === */

          var brushg = context.append("g")
              .attr("class", "x brush")
              .call(brush);

          brushg.selectAll(".extent")
          	.attr("y", -6)
          	.attr("height", height_context + 8)
          	.style("opacity" , "0");

          brushg.selectAll(".resize")
              .append("rect")
              .attr("class", "handle")
              .attr("transform", "translate(0," +  -3 + ")")
              .attr('rx', 1)
          	.attr('ry', 1)
              .attr("height", 0)
              .attr("width", 3)
          	.style("opacity" , "0");

          brushg.selectAll(".resize")
              .append("rect")
              .attr("class", "handle-mini")
              .attr("transform", "translate(-2,8.5)")
              .attr('rx', 2)
              .attr('ry', 2)
              .attr("height", 0)
              .attr("width", 7)
          	.style("opacity" , "0");

          /* === y axis title === */
          vis.append("text")
              .attr("class", "y axis title")
              .text("Monthly " + this.metricName)
              .attr("x", (-((height+margin.top+margin.bottom-50)/2)))
              .attr("y", 0)
              .attr("dy", "1em")
              .attr("transform", "rotate(-90)")
              .style("text-anchor", "middle");

          // allow zoom, brush, and scale behavior after a small delay,
          // so that user does not interrupt bar entrance animation.
          // show UI elements only once user is able to interact with them.
          setTimeout(function(){

              // disable the zoom behavior on wheel zoom event
              // add behaviours
            	pane.call(zoom)
                  .call(change_focus_zoom)
                  .on("wheel.zoom", null);
            	zoom.x(x);

            	vis.selectAll(".scale_button")
            		.style("cursor", "pointer")
            		.on("click", zoom_to_interval);

            	// fade in buttons
            	vis.selectAll(".scale_button,.zoomto_text")
            		.transition()
            		.duration(100)
            		.ease("cubic")
            		.style("opacity","1");

            	// fade in brush elements
            	brushg.selectAll(".extent")
            		.transition()
            		.duration(100)
            		.ease("cubic")
            		.style("opacity" , "1");

            	brushg.selectAll(".handle-mini")
            		.transition()
            		.duration(170)
            		.ease("linear")
            		.attr("height", (height_context/2))
            		.style("opacity" , "1");

            	brushg.selectAll(".handle")
            		.transition()
            		.duration(170)
            		.ease("linear")
            		.attr("height", height_context + 6)
            		.style("opacity" , "1");

              if (self.viewType === "dataset") {
                d3.select(".metric-chart")
                    .append("div")
                        .attr("class", "metric_tooltip")
                        .style("opacity", 0)
                        .style("width", tooltip_width + "px");
              }
              else {
                d3.select("#user-" + self.id)
                    .append("div")
                        .attr("class", "metric_tooltip")
                        .style("opacity", 0)
                        .style("width", tooltip_width + "px");
              }
          	},
          900);

          /*
          * ========================================================================
          *  Functions
          * ========================================================================
          */

          /*	------------------------------------------------------
          		HELPER FUNCTIONS
          	------------------------------------------------------  */

          function get_zoom_scale(){
          // custom zoom scale needed to calculate width of bars with zoom/brush.
          // can't use zoom.scale() because this needs to be reset (to one) when using change_focus_brush()
          	var x_current_width = x.domain()[1] - x.domain()[0],
          		x_total_width = x_full_extent[1] - x_full_extent[0],
          		zoom_scale = x_total_width/x_current_width;
          	return(zoom_scale);
          };

          function convert_metric_name(n){
          // remove s from metric name if count is 1
          	if (n == 1) {
          		return metricName.slice(0, -1);
          	} else {
          		return metricName;
          	}
          };

          /*	------------------------------------------------------
          		HOVER BEHAVIOUR: X-AXIS LABELS, BARS, TOOLTIPS
          	------------------------------------------------------  */

          function highlight_bar(bar_id){
          // mouseover effect on bar
          	focus.select(bar_id)
          		.style("stroke-width", "1")
          		.style("opacity", "0.9");
          };

          function unhighlight_bar(bar_id) {
          // undo mouseover effect on bar
          	focus.select(bar_id)
          		.style("stroke-width", "0")
          		.style("opacity", "1");
          };

          function highlight_label(label_id){
          // mouseover effect on label
          	focus.select(label_id).selectAll("text")
          		.style("font-weight", "bold");
          };

          function unhighlight_label(label_id){
          // undo mouseover effect on label
          	focus.select(label_id).selectAll("text")
          		.style("font-weight", "normal");
          };

          function add_tick_behaviour() {
          // adds html ID and hover behaviour to the x-axis ticks/labels
          // this function is called each time these labels/ticks are re-generated.

          	focus.selectAll(".x.axis .tick")[0].forEach(function(tick) {
          	    d3.select(tick)
          			.attr("id", function(d,i) {
          				return "label_" + d3.time.month.floor(d).getTime();
          			})
          			.on("mouseover", function(tick) {
          				// extract the datapoint from dataset that is associated with x-axis label
          				var floor_month = d3.time.month.floor(tick).getTime();
          				var d = dataset.filter( function(d) { return d.month.getTime() === floor_month; })[0];
          				highlight_bar("#bar_" + floor_month);
          				highlight_label("#label_" + floor_month);
          				show_tooltip(d);
          			})
          	    .on("mouseout", function(tick) {
          				var floor_month = d3.time.month.floor(tick).getTime();
          				unhighlight_bar("#bar_" + floor_month);
          				unhighlight_label("#label_" + floor_month);
          				hide_tooltip(tick);
          			});
          		});
          };

          function show_tooltip(d) {

              if (self.viewType === "dataset") {

                var bar_width_px = bar_width * get_zoom_scale();

                // get the width of the modal. Need for tooltip x-position.
                var modal_width = d3.select("#metric-modal")
                    .style('width')
                    .slice(0, -2);
                var modal_width = Math.round(Number(modal_width));

                d3.select(".metric_tooltip")
                    .html("&lt;b>" + display_date_format(d.month) + "&lt;/b>&lt;br/>"  + d.count + " " + convert_metric_name(d.count))
                    .style("left", (x(d.month) + (modal_width-(width + margin.left + margin.right)) + (bar_width_px/2) - (tooltip_width/2) + "px"))//) + 300 + ((width/dataset.length) * 0.5 * get_zoom_scale())) + "px")
                    .style("top", (y(d.count) + 19) + "px");

                d3.select(".metric_tooltip")
                    .transition()
                    .duration(60)
                    .style("opacity", 0.98);
              }
              else {
                d3.select("#user-" + self.id + " > .metric_tooltip")
                    .html("&lt;b>" + display_date_format(d.month) + "&lt;/b>&lt;br/>"  + d.count + " " + convert_metric_name(d.count))
                    .style("left", d3.event.pageX - 150 + "px")
                    .style("top", y(d.count) - y(0) - 150 + "px");

                d3.select("#user-" + self.id + " > .metric_tooltip")
                    .transition()
                    .duration(60)
                    .style("opacity", 0.98);
              }
          };

          function hide_tooltip(d) {
            if (self.viewType === "dataset") {
              d3.select(".metric_tooltip")
                  .transition()
                  .duration(60)
                  .style("opacity", 0);
            }
            else {
              d3.select("#user-" + self.id + " > .metric_tooltip")
                  .transition()
                  .duration(60)
                  .style("opacity", 0);
            }
          };


          /*	------------------------------------------------------
          		TICK FORMATTING FUNCTIONS (focus x-axis)
          	------------------------------------------------------  */


          function generate_ticks(t0, t1, dt)  {

              var label_size_px = 45;
              var max_total_labels = Math.floor(width / label_size_px);
              // offset so that labels are at the center of each month.
          	var offset = (day_in_ms*30*bar_width_factor)/2;

              function step(date, next_step)  {
                  date.setMonth(date.getMonth() + next_step);
              }

              var time = d3.time.month.floor(t0),
          		time = new Date(time.getTime() + offset),
          		times = [],
          		monthFactors = [1,3,4,12];

              while (time &lt; t1) { times.push(new Date(+time)), step(time, 1)};

              var timesCopy = times;
              var i;

              for(i=0 ; times.length > max_total_labels ; i++){
                  var times = _.filter(timesCopy, function(d){ return (d.getMonth()) % monthFactors[i] == 0; } )
          	};

              return times;

          };

          function format_months(d){
          	add_tick_behaviour(); // add tick hover behaviour everytime ticks are re-formatted;
          	var test = (x.domain()[1] - x.domain()[0]) > 132167493818; // when to switch from yyyy to mm-yyyy
          	if(d.getMonth()==0 &amp; test){//if january
          		var yearOnly = d3.time.format("%Y");
          		return(yearOnly(d));
          	} else {
          		return(display_date_format(d))
          	}
          }

          /*	------------------------------------------------------
          		BRUSH &amp; ZOOM BEHAVIOUR
          	------------------------------------------------------  */

          function change_focus_brush() {
          	// make the x domain match the brush domain
              x.domain(brush.empty() ? x_context.domain() : brush.extent());
          	// reset zoom
              zoom.x(x);
          	// re-draw axis and elements at new scale
          	update_focus();
          	// update the explanatory text (total views, date range)
              update_context();
          }

          function change_focus_zoom() {
              // make the brush range change with the x domain in focus
              brush.extent(x.domain());
              vis.select(".brush").call(brush);
          	// re-draw axis and elements at new scale
          	update_focus();
              // update the explanatory text (total views, date range)
              update_context();
          }

          function update_focus() {

              // calculate where the bar goes out of focus
              var bar_width_days = bar_width_factor*30.5;

          	var left_date = x.domain()[0];
          	if(left_date.getDate() &lt; bar_width_days){
          		var left_date = d3.time.month.floor(left_date),
          			left_date = new Date(left_date.getTime())
          	};

          	var data_subset_focus = dataset.filter( function(d) {
          		return d.month &lt;= x.domain()[1] &amp;&amp; d.month >= left_date
          	});

          	var y_max_focus = d3.max(data_subset_focus, function(d) { return d.count; }) * 1.04 || 1.04;
          	var y_change_duration = 85;

          	// reset y-axis
          	y.domain([0, y_max_focus]);
          	focus.select(".y.axis")
          		.transition()
          		.duration(y_change_duration*0.95)
          		.call(y_axis);

          	// reset bar height given y-axis
          	focus.selectAll(".bar")
          		.transition()
          		.duration(y_change_duration)
          		.attr("y", function (d) {return y(d.count);	  		})
          		.attr("height", function (d) {return y(0) - y(d.count);	  		});

          	// redraw other elements
          	focus.select(".x.axis").call(x_axis);
          	focus.selectAll(".bar")
          		.attr("x", function (d) {return x(d.month); })
          		.attr("width", bar_width * get_zoom_scale())
          		.style("opacity", "1"); // incase user scrolls before entrance animation finishes.

          };

          function update_context() {

          // updates display dates, total count, and decreases opacity of context bars out of focus
              var b = brush.extent();

          	// calculate where the bar goes out of focus
              var bar_width_days = bar_width_factor*30.5;
          	if(b[0].getDate() >= bar_width_days){
          		var left_date = d3.time.month.ceil(b[0]),
          			left_date = new Date(left_date.getTime())
          	} else {
          		left_date = d3.time.month.floor(b[0])
          	};

              // get the range of data in focus
              // if there's only one data point, make sure start and end month are the same
              if (metricMonths_parsed.length == 1) {
                  var start_month = display_date_format(new Date(metricMonths_parsed[0])),
                      end_month   = start_month;
              } else {
                  var start_month = (brush.empty()) ? display_date_format(x_full_extent[0]) : display_date_format(left_date),
                      end_month   = (brush.empty()) ? display_date_format(x_full_extent[1]) : display_date_format(b[1]);
              };

          	var data_subset_focus = dataset.filter(function(d) {
                  if (metricMonths_parsed.length == 1) {
                      return d.month
                  }
                  else {
                      return d.month &lt;= display_date_format.parse(end_month) &amp;&amp; d.month >= left_date
                  };
          	});

          	// calcualte the total views/downloads within focus area
          	var total_count = 0;
              for (var i = 0; i &lt; data_subset_focus.length; i++) {
                      total_count += data_subset_focus[i].count;
              }

              // Update start and end dates and total count
              vis.select("#displayDates")
                  .text(start_month == end_month ? "in " + start_month : "from " + start_month + " to " + end_month);
          	vis.select("#totalCount")
          		.text(MetacatUI.appView.commaSeparateNumber(total_count) + " " + convert_metric_name(total_count));

          	// Fade all years in the bar chart not within the brush
              context.selectAll(".bar_context")
          		.style("opacity", function(d, i) {

                      if (metricMonths_parsed.length == 1) {
                          return "1";
                      } else {
                          return  d.month &lt;= display_date_format.parse(end_month) &amp;&amp; d.month >= left_date || brush.empty() ? "1" : ".3";
                      }

              });

          };

          function check_bounds() {
          // when brush stops moving:

              // check whether chart was scrolled out of bounds and fix,
              var b = brush.extent();
              var out_of_bounds = brush.extent().some(function(e) { return e &lt; x_full_extent[0] | e > x_full_extent[1]; });
              if (out_of_bounds){ b = move_in_bounds(b) };

          };

          function move_in_bounds(b) {
          // move back to boundaries if user pans outside min and max date.

              var year_in_ms = 31536000000,
                  brush_start_new,
                  brush_end_new;

              if       (b[0] &lt; x_full_extent[0])   { brush_start_new = x_full_extent[0]; }
              else if  (b[0] > x_full_extent[1])   { brush_start_new = x_full_extent[0]; }
              else                        { brush_start_new = b[0]; };

              if       (b[1] > x_full_extent[1])   { brush_end_new = x_full_extent[1]; }
              else if  (b[1] &lt; x_full_extent[0])   { brush_end_new = x_full_extent[1]; }
              else                        { brush_end_new = b[1]; };

              brush.extent([brush_start_new, brush_end_new]);

              brush(d3.select("#" + self.id + " > .context > .brush").transition());
              change_focus_brush();
              change_focus_zoom();

              return(brush.extent())
          };

          function zoom_to_interval(d,i) {
          // action for buttons that zoom focus to certain time interval

              var b = brush.extent(),
                  interval_ms,
                  brush_end_new,
                  brush_start_new;

              if      (d == "year")   { interval_ms = 31536000000}
              else if (d == "month")  { interval_ms = 2592000000 };

              if ( d == "year" | d == "month" )  {

                  if((x_full_extent[1].getTime() - b[1].getTime()) &lt; interval_ms){
                  // if brush is too far to the right that increasing the right-hand brush boundary would make the chart go out of bounds....
                      brush_start_new = new Date(x_full_extent[1].getTime() - interval_ms); // ...then decrease the left-hand brush boundary...
                      brush_end_new = x_full_extent[1]; //...and set the right-hand brush boundary to the maxiumum limit.
                  } else {
                  // otherwise, increase the right-hand brush boundary.
                      brush_start_new = b[0];
                      brush_end_new = new Date(b[0].getTime() + interval_ms);
                  };

              } else if ( d == "all")  {
                  brush_start_new = x_full_extent[0];
                  brush_end_new = x_full_extent[1]
              } else {
                  brush_start_new = b[0];
                  brush_end_new = b[1];
              };

              brush.extent([brush_start_new, brush_end_new]);

              // now draw the brush to match our extent

              brush(d3.select("#" + self.id + " > .context > .brush").transition());
              // now fire the brushstart, brushmove, and check_bounds events
              brush.event(d3.select("#" + self.id + " > .context > .brush").transition());
          };

          // that's it!
      }

        //Re-render this view when the window is resized
        this.listenToWindowResize();

          return this;

      },

      /**
      * Adds a listener so when the window is resized, the chart is redrawn
      */
      listenToWindowResize: function(){

        if( !this.resizeCallback ){
          this.resizeCallback = this.render.bind(this);
          window.addEventListener('resize', this.resizeCallback, false);
        }
      },

      /**
      * Removes the window resize listener set in {@link MetricsChartView#listenToWindowResize}
      */
      stopListenToWindowResize: function(){

      //Remove the listener to window resize
      window.removeEventListener("resize", this.resizeCallback, false);
      delete this.resizeCallback;

    },

      /**
      * Cleans up listeners and other artifacts from this view
      */
      onClose: function(){
        this.stopListenToWindowResize();
      }

    });

    return MetricsChartView;

});
</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
