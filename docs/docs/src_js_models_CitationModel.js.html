<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>MetacatUI Dev Docs: Source: src/js/models/CitationModel.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
    <link type="text/css" rel="stylesheet" href="/metacatui/assets/css/styles.css">
    <link type="text/css" rel="stylesheet" href="styles/style.css">
</head>

<body>

<nav id="nav">
    <a href="/">
      <div class="logo">
<svg class="cat" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="cat" class="svg-inline--fa fa-cat fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M290.59 192c-20.18 0-106.82 1.98-162.59 85.95V192c0-52.94-43.06-96-96-96-17.67 0-32 14.33-32 32s14.33 32 32 32c17.64 0 32 14.36 32 32v256c0 35.3 28.7 64 64 64h176c8.84 0 16-7.16 16-16v-16c0-17.67-14.33-32-32-32h-32l128-96v144c0 8.84 7.16 16 16 16h32c8.84 0 16-7.16 16-16V289.86c-10.29 2.67-20.89 4.54-32 4.54-61.81 0-113.52-44.05-125.41-102.4zM448 96h-64l-64-64v134.4c0 53.02 42.98 96 96 96s96-42.98 96-96V32l-64 64zm-72 80c-8.84 0-16-7.16-16-16s7.16-16 16-16 16 7.16 16 16-7.16 16-16 16zm80 0c-8.84 0-16-7.16-16-16s7.16-16 16-16 16 7.16 16 16-7.16 16-16 16z"></path></svg>

<svg width="459px" height="53px" viewBox="0 0 459 53" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
    <g id="metacatui" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
        <path d="M16.492,52 C17.212,52 17.812,51.748 18.292,51.244 C18.772,50.74 19.012,50.128 19.012,49.408 L19.012,49.408 L18.94,22.912 L30.82,37.816 C31.204,38.344 31.72,38.764 32.368,39.076 C33.016,39.388 33.7,39.544 34.42,39.544 C35.908,39.544 37.132,38.896 38.092,37.6 L38.092,37.6 L49.684,22.912 L49.684,49.408 C49.684,50.128 49.96,50.74 50.512,51.244 C51.064,51.748 51.7,52 52.42,52 L52.42,52 L62.068,52 C62.788,52 63.388,51.748 63.868,51.244 C64.348,50.74 64.588,50.128 64.588,49.408 L64.588,49.408 L64.588,4.12 C64.588,3.448 64.336,2.86 63.832,2.356 C63.328,1.852 62.74,1.6 62.068,1.6 L62.068,1.6 L52.348,1.6 C51.388,1.6 50.56,1.648 49.864,1.744 C49.168,1.84 48.532,2.152 47.956,2.68 L47.956,2.68 L33.916,17.296 L20.524,2.608 C20.332,2.368 19.972,2.14 19.444,1.924 C18.916,1.708 18.412,1.6 17.932,1.6 L17.932,1.6 L6.772,1.6 C6.052,1.6 5.44,1.852 4.936,2.356 C4.432,2.86 4.18,3.448 4.18,4.12 L4.18,4.12 L4.18,49.408 C4.18,50.08 4.432,50.68 4.936,51.208 C5.44,51.736 6.052,52 6.772,52 L6.772,52 L16.492,52 Z M110.74,52 C111.556,52 112.264,51.676 112.864,51.028 C113.464,50.38 113.764,49.624 113.764,48.76 L113.764,48.76 L113.764,42.568 C113.764,41.608 113.464,40.828 112.864,40.228 C112.264,39.628 111.556,39.328 110.74,39.328 L110.74,39.328 L89.428,39.328 L89.428,32.92 L109.732,32.92 C110.5,32.92 111.184,32.596 111.784,31.948 C112.384,31.3 112.684,30.568 112.684,29.752 L112.684,29.752 L112.684,23.488 C112.684,22.576 112.384,21.82 111.784,21.22 C111.184,20.62 110.5,20.32 109.732,20.32 L109.732,20.32 L89.428,20.32 L89.428,14.488 L110.74,14.488 C111.508,14.488 112.204,14.164 112.828,13.516 C113.452,12.868 113.764,12.136 113.764,11.32 L113.764,11.32 L113.764,5.056 C113.764,4.144 113.464,3.388 112.864,2.788 C112.264,2.188 111.556,1.888 110.74,1.888 L110.74,1.888 L76.756,1.888 C75.94,1.888 75.232,2.188 74.632,2.788 C74.032,3.388 73.732,4.144 73.732,5.056 L73.732,5.056 L73.732,48.76 C73.732,49.624 74.032,50.38 74.632,51.028 C75.232,51.676 75.94,52 76.756,52 L76.756,52 L110.74,52 Z M147.604,52 C148.42,52 149.104,51.688 149.656,51.064 C150.208,50.44 150.484,49.672 150.484,48.76 L150.484,48.76 L150.484,16.216 L161.86,16.216 C162.676,16.216 163.396,15.904 164.02,15.28 C164.644,14.656 164.956,13.936 164.956,13.12 L164.956,13.12 L164.956,4.768 C164.956,4 164.644,3.316 164.02,2.716 C163.396,2.116 162.676,1.816 161.86,1.816 L161.86,1.816 L124.132,1.816 C123.22,1.816 122.464,2.104 121.864,2.68 C121.264,3.256 120.964,3.952 120.964,4.768 L120.964,4.768 L120.964,13.12 C120.964,13.936 121.264,14.656 121.864,15.28 C122.464,15.904 123.22,16.216 124.132,16.216 L124.132,16.216 L135.652,16.216 L135.148,48.832 C135.148,49.744 135.424,50.5 135.976,51.1 C136.528,51.7 137.212,52 138.028,52 L138.028,52 L147.604,52 Z M175.828,52 C176.836,52 177.676,51.82 178.348,51.46 C179.02,51.1 179.452,50.584 179.644,49.912 L179.644,49.912 L181.876,42.712 L197.932,42.712 L200.164,49.912 C200.356,50.584 200.8,51.1 201.496,51.46 C202.192,51.82 203.044,52 204.052,52 L204.052,52 L213.916,52 C215.836,51.712 216.796,50.704 216.796,48.976 C216.796,48.304 216.676,47.596 216.436,46.852 C216.196,46.108 216.052,45.616 216.004,45.376 L216.004,45.376 L199.876,4.84 C199.588,3.976 199.036,3.232 198.22,2.608 C197.404,1.984 196.372,1.648 195.124,1.6 L195.124,1.6 L184.756,1.6 C183.604,1.648 182.608,1.948 181.768,2.5 C180.928,3.052 180.292,3.832 179.86,4.84 L179.86,4.84 L163.876,45.376 C163.828,45.472 163.672,45.916 163.408,46.708 C163.144,47.5 163.012,48.304 163.012,49.12 C163.012,50.752 163.948,51.712 165.82,52 L165.82,52 L175.828,52 Z M195.34,30.544 L184.036,30.544 L189.652,13.624 L195.34,30.544 Z M245.38,53.08 C250.612,53.08 255.652,51.544 260.5,48.472 C261.22,47.944 261.58,47.296 261.58,46.528 C261.58,45.808 261.292,45.16 260.716,44.584 L260.716,44.584 L252.796,36.808 C252.364,36.376 251.836,36.16 251.212,36.16 C250.78,36.16 250.372,36.256 249.988,36.448 C248.356,37.12 246.796,37.456 245.308,37.456 C243.244,37.456 241.348,36.952 239.62,35.944 C237.892,34.936 236.512,33.58 235.48,31.876 C234.448,30.172 233.932,28.336 233.932,26.368 C233.932,24.352 234.436,22.504 235.444,20.824 C236.452,19.144 237.832,17.812 239.584,16.828 C241.336,15.844 243.244,15.352 245.308,15.352 C246.892,15.352 248.332,15.64 249.628,16.216 C250.012,16.408 250.444,16.504 250.924,16.504 C251.548,16.504 252.1,16.264 252.58,15.784 L252.58,15.784 L259.636,8.008 C260.164,7.384 260.428,6.76 260.428,6.136 C260.428,5.224 259.996,4.528 259.132,4.048 C254.86,1.552 250.276,0.304 245.38,0.304 C240.532,0.304 236.032,1.492 231.88,3.868 C227.728,6.244 224.44,9.448 222.016,13.48 C219.592,17.512 218.38,21.904 218.38,26.656 C218.38,31.408 219.592,35.812 222.016,39.868 C224.44,43.924 227.728,47.14 231.88,49.516 C236.032,51.892 240.532,53.08 245.38,53.08 Z M279.796,52 C280.804,52 281.644,51.82 282.316,51.46 C282.988,51.1 283.42,50.584 283.612,49.912 L283.612,49.912 L285.844,42.712 L301.9,42.712 L304.132,49.912 C304.324,50.584 304.768,51.1 305.464,51.46 C306.16,51.82 307.012,52 308.02,52 L308.02,52 L317.884,52 C319.804,51.712 320.764,50.704 320.764,48.976 C320.764,48.304 320.644,47.596 320.404,46.852 C320.164,46.108 320.02,45.616 319.972,45.376 L319.972,45.376 L303.844,4.84 C303.556,3.976 303.004,3.232 302.188,2.608 C301.372,1.984 300.34,1.648 299.092,1.6 L299.092,1.6 L288.724,1.6 C287.572,1.648 286.576,1.948 285.736,2.5 C284.896,3.052 284.26,3.832 283.828,4.84 L283.828,4.84 L267.844,45.376 C267.796,45.472 267.64,45.916 267.376,46.708 C267.112,47.5 266.98,48.304 266.98,49.12 C266.98,50.752 267.916,51.712 269.788,52 L269.788,52 L279.796,52 Z M299.308,30.544 L288.004,30.544 L293.62,13.624 L299.308,30.544 Z M352.588,52 C353.404,52 354.088,51.688 354.64,51.064 C355.192,50.44 355.468,49.672 355.468,48.76 L355.468,48.76 L355.468,16.216 L366.844,16.216 C367.66,16.216 368.38,15.904 369.004,15.28 C369.628,14.656 369.94,13.936 369.94,13.12 L369.94,13.12 L369.94,4.768 C369.94,4 369.628,3.316 369.004,2.716 C368.38,2.116 367.66,1.816 366.844,1.816 L366.844,1.816 L329.116,1.816 C328.204,1.816 327.448,2.104 326.848,2.68 C326.248,3.256 325.948,3.952 325.948,4.768 L325.948,4.768 L325.948,13.12 C325.948,13.936 326.248,14.656 326.848,15.28 C327.448,15.904 328.204,16.216 329.116,16.216 L329.116,16.216 L340.636,16.216 L340.132,48.832 C340.132,49.744 340.408,50.5 340.96,51.1 C341.512,51.7 342.196,52 343.012,52 L343.012,52 L352.588,52 Z M402.052,52.792 C408.1,52.792 412.912,51.628 416.488,49.3 C420.064,46.972 422.536,44.068 423.904,40.588 C425.272,37.108 425.932,33.424 425.884,29.536 C425.884,29.5309474 425.883967,29.5237673 425.8839,29.5144598 L425.883102,29.4330859 C425.879911,29.1480111 425.868211,28.3183158 425.848,26.944 C425.8294,25.6792 425.818008,22.91524 425.813823,18.65212 L425.813103,17.80828 C425.812997,17.66452 425.8129,17.5192 425.81281,17.37232 L425.812,3.904 C425.86,3.184 425.632,2.62 425.128,2.212 C424.624,1.804 423.916,1.6 423.004,1.6 L423.004,1.6 L413.428,1.6 C412.612,1.6 411.904,1.828 411.304,2.284 C410.704,2.74 410.404,3.28 410.404,3.904 L410.404,3.904 L410.26,27.808 C410.26,34.144 407.476,37.312 401.908,37.312 C399.076,37.312 396.832,36.412 395.176,34.612 C393.52,32.812 392.668,30.352 392.62,27.232 L392.62,27.232 L392.332,3.76 C392.332,3.088 392.068,2.56 391.54,2.176 C391.012,1.792 390.268,1.6 389.308,1.6 L389.308,1.6 L379.876,1.6 C378.244,1.6 377.428,2.32 377.428,3.76 L377.428,3.76 L377.5,28.816 C377.5,33.04 378.376,36.964 380.128,40.588 C381.88,44.212 384.592,47.152 388.264,49.408 C391.936,51.664 396.532,52.792 402.052,52.792 Z M449.284,52.144 C450.148,52.144 450.88,51.844 451.48,51.244 C452.08,50.644 452.38,49.84 452.38,48.832 L452.38,48.832 L452.38,4.912 C452.38,4 452.08,3.22 451.48,2.572 C450.88,1.924 450.148,1.6 449.284,1.6 L449.284,1.6 L439.42,1.6 C438.46,1.6 437.692,1.924 437.116,2.572 C436.54,3.22 436.252,4 436.252,4.912 L436.252,4.912 L436.252,48.832 C436.252,49.84 436.54,50.644 437.116,51.244 C437.692,51.844 438.46,52.144 439.42,52.144 L439.42,52.144 L449.284,52.144 Z" id="metacatui" fill="#FCBF49" fill-rule="nonzero"></path>
    </g>
</svg>
</logo>

    </a>
    <h3>Namespaces</h3><ul><li><a href="AppConfig.html">AppConfig</a></li><li><a href="IconUtilities.html">IconUtilities</a></li><li><a href="MapConfig.html">MapConfig</a></li><li><a href="MetacatUI.html">MetacatUI</a></li><li><a href="SearchParams.html">SearchParams</a></li><li><a href="Utilities.html">Utilities</a></li></ul><h3>Classes</h3><ul><li class='category-heading' data-category='Collections'>Collections</li><li><a href="AccessPolicy.html">AccessPolicy</a></li><li><a href="Citations.html">Citations</a></li><li><a href="DataPackage.html">DataPackage</a></li><li><a href="Filters.html">Filters</a></li><li><a href="ObjectFormats.html">ObjectFormats</a></li><li><a href="ProjectList.html">ProjectList</a></li><li><a href="QualityReport.html">QualityReport</a></li><li><a href="SolrResults.html">SolrResults</a></li><li><a href="Units.html">Units</a></li><li><a href="UserGroup.html">UserGroup</a></li><li class='category-heading' data-category='Collections/Bookkeeper'>Collections/Bookkeeper</li><li><a href="Quotas.html">Quotas</a></li><li><a href="Usages.html">Usages</a></li><li class='category-heading' data-category='Collections/Geohashes'>Collections/Geohashes</li><li><a href="Geohashes.html">Geohashes</a></li><li class='category-heading' data-category='Collections/Maps'>Collections/Maps</li><li><a href="AssetCategories.html">AssetCategories</a></li><li><a href="AssetColors.html">AssetColors</a></li><li><a href="Features.html">Features</a></li><li><a href="GeoPoints.html">GeoPoints</a></li><li><a href="MapAssets.html">MapAssets</a></li><li><a href="VectorFilters.html">VectorFilters</a></li><li><a href="ZoomPresets.html">ZoomPresets</a></li><li class='category-heading' data-category='Collections/Metadata/EML'>Collections/Metadata/EML</li><li><a href="EMLAnnotations.html">EMLAnnotations</a></li><li><a href="EMLMissingValueCodes.html">EMLMissingValueCodes</a></li><li class='category-heading' data-category='Collections/Ontologies'>Collections/Ontologies</li><li><a href="BioontologyResults.html">BioontologyResults</a></li><li class='category-heading' data-category='Collections/QueryFields'>Collections/QueryFields</li><li><a href="QueryFields.html">QueryFields</a></li><li class='category-heading' data-category='Collections/SearchSelect'>Collections/SearchSelect</li><li><a href="SearchSelectOptions.html">SearchSelectOptions</a></li><li class='category-heading' data-category='Models'>Models</li><li><a href="AccessRule.html">AccessRule</a></li><li><a href="Accordion.html">Accordion</a></li><li><a href="AppModel.html">AppModel</a></li><li><a href="CitationModel.html">CitationModel</a></li><li><a href="CollectionModel.html">CollectionModel</a></li><li><a href="DataONEObject.html">DataONEObject</a></li><li><a href="LookupModel.html">LookupModel</a></li><li><a href="Map.html">Map</a></li><li><a href="Metrics.html">Metrics</a></li><li><a href="QualityCheck.html">QualityCheck</a></li><li><a href="Search.html">Search</a></li><li><a href="SolrResult.html">SolrResult</a></li><li><a href="Stats.html">Stats</a></li><li class='category-heading' data-category='Models/Accordion'>Models/Accordion</li><li><a href="AccordionItem.html">AccordionItem</a></li><li class='category-heading' data-category='Models/Analytics'>Models/Analytics</li><li><a href="Analytics.html">Analytics</a></li><li><a href="GoogleAnalytics.html">GoogleAnalytics</a></li><li class='category-heading' data-category='Models/Bookkeeper'>Models/Bookkeeper</li><li><a href="Quota.html">Quota</a></li><li><a href="Subscription.html">Subscription</a></li><li><a href="Usage.html">Usage</a></li><li class='category-heading' data-category='Models/Connectors'>Models/Connectors</li><li><a href="BioontologyAccordionSearchSelect.html">BioontologyAccordionSearchSelect</a></li><li><a href="FiltersMapConnector.html">FiltersMapConnector</a></li><li><a href="FiltersSearchConnector.html">FiltersSearchConnector</a></li><li><a href="GeoPointsCesiumConnector.html">GeoPointsCesiumConnector</a></li><li><a href="GeoPointsCesiumPointsConnector.html">GeoPointsCesiumPointsConnector</a></li><li><a href="GeoPointsCesiumPolygonConnector.html">GeoPointsCesiumPolygonConnector</a></li><li><a href="MapSearchConnector.html">MapSearchConnector</a></li><li><a href="MapSearchFiltersConnector.html">MapSearchFiltersConnector</a></li><li class='category-heading' data-category='Models/Filters'>Models/Filters</li><li><a href="BooleanFilter.html">BooleanFilter</a></li><li><a href="ChoiceFilter.html">ChoiceFilter</a></li><li><a href="DateFilter.html">DateFilter</a></li><li><a href="Filter.html">Filter</a></li><li><a href="FilterGroup.html">FilterGroup</a></li><li><a href="NumericFilter.html">NumericFilter</a></li><li><a href="SpatialFilter.html">SpatialFilter</a></li><li><a href="ToggleFilter.html">ToggleFilter</a></li><li class='category-heading' data-category='Models/Formats'>Models/Formats</li><li><a href="ObjectFormat.html">ObjectFormat</a></li><li class='category-heading' data-category='Models/Geocoder'>Models/Geocoder</li><li><a href="GeocodedLocation.html">GeocodedLocation</a></li><li><a href="GeocoderSearch.html">GeocoderSearch</a></li><li><a href="GoogleMapsAutocompleter.html">GoogleMapsAutocompleter</a></li><li><a href="GoogleMapsGeocoder.html">GoogleMapsGeocoder</a></li><li><a href="Prediction.html">Prediction</a></li><li class='category-heading' data-category='Models/Geohashes'>Models/Geohashes</li><li><a href="Geohash.html">Geohash</a></li><li class='category-heading' data-category='Models/Maps'>Models/Maps</li><li><a href="AssetCategory.html">AssetCategory</a></li><li><a href="AssetColor.html">AssetColor</a></li><li><a href="AssetColorPalette.html">AssetColorPalette</a></li><li><a href="ExpansionPanelsModel.html">ExpansionPanelsModel</a></li><li><a href="Feature.html">Feature</a></li><li><a href="GeoBoundingBox.html">GeoBoundingBox</a></li><li><a href="GeoPoint.html">GeoPoint</a></li><li><a href="GeoScale.html">GeoScale</a></li><li><a href="GeoUtilities.html">GeoUtilities</a></li><li><a href="MapInteraction.html">MapInteraction</a></li><li><a href="MapModel.html">MapModel</a></li><li><a href="VectorFilter.html">VectorFilter</a></li><li><a href="ViewfinderModel.html">ViewfinderModel</a></li><li><a href="ZoomPresetModel.html">ZoomPresetModel</a></li><li class='category-heading' data-category='Models/Maps/Assets'>Models/Maps/Assets</li><li><a href="Cesium3DTileset.html">Cesium3DTileset</a></li><li><a href="CesiumGeohash.html">CesiumGeohash</a></li><li><a href="CesiumImagery.html">CesiumImagery</a></li><li><a href="CesiumTerrain.html">CesiumTerrain</a></li><li><a href="CesiumVectorData.html">CesiumVectorData</a></li><li><a href="MapAsset.html">MapAsset</a></li><li class='category-heading' data-category='Models/Metadata'>Models/Metadata</li><li><a href="ScienceMetadata.html">ScienceMetadata</a></li><li class='category-heading' data-category='Models/Metadata/EML'>Models/Metadata/EML</li><li><a href="EMLMethodStep.html">EMLMethodStep</a></li><li><a href="EMLSpecializedText.html">EMLSpecializedText</a></li><li><a href="EMLTaxonCoverage.html">EMLTaxonCoverage</a></li><li class='category-heading' data-category='Models/Metadata/EML211'>Models/Metadata/EML211</li><li><a href="EML211.html">EML211</a></li><li><a href="EMLAnnotation.html">EMLAnnotation</a></li><li><a href="EMLAttribute.html">EMLAttribute</a></li><li><a href="EMLDataTable.html">EMLDataTable</a></li><li><a href="EMLDistribution.html">EMLDistribution</a></li><li><a href="EMLEntity.html">EMLEntity</a></li><li><a href="EMLGeoCoverage.html">EMLGeoCoverage</a></li><li><a href="EMLMeasurementScale.html">EMLMeasurementScale</a></li><li><a href="EMLMethods.html">EMLMethods</a></li><li><a href="EMLMissingValueCode.html">EMLMissingValueCode</a></li><li><a href="EMLNonNumericDomain.html">EMLNonNumericDomain</a></li><li><a href="EMLNumericDomain.html">EMLNumericDomain</a></li><li><a href="EMLOtherEntity.html">EMLOtherEntity</a></li><li><a href="EMLParty.html">EMLParty</a></li><li><a href="EMLTemporalCoverage.html">EMLTemporalCoverage</a></li><li><a href="EMLText211.html">EMLText211</a></li><li><a href="EMLUnit.html">EMLUnit</a></li><li class='category-heading' data-category='Models/Metadata/EML220'>Models/Metadata/EML220</li><li><a href="EMLText.html">EMLText</a></li><li class='category-heading' data-category='Models/Ontologies'>Models/Ontologies</li><li><a href="BioOntology.html">BioOntology</a></li><li><a href="Bioontology_.html">Bioontology</a></li><li><a href="BioontologyBatch.html">BioontologyBatch</a></li><li><a href="BioontologyClass.html">BioontologyClass</a></li><li class='category-heading' data-category='Models/Portals'>Models/Portals</li><li><a href="PortalImage.html">PortalImage</a></li><li><a href="PortalModel.html">PortalModel</a></li><li><a href="PortalSectionModel.html">PortalSectionModel</a></li><li class='category-heading' data-category='Models/Projects'>Models/Projects</li><li><a href="Project.html">Project</a></li><li class='category-heading' data-category='Models/QueryFields'>Models/QueryFields</li><li><a href="QueryField.html">QueryField</a></li><li class='category-heading' data-category='Models/SearchSelect'>Models/SearchSelect</li><li><a href="AccountSearchSelect.html">AccountSearchSelect</a></li><li><a href="QueryFieldSearchSelect.html">QueryFieldSearchSelect</a></li><li><a href="SearchSelect.html">SearchSelect</a></li><li><a href="SelectOptionModel.html">SelectOptionModel</a></li><li><a href="SolrAutocomplete.html">SolrAutocomplete</a></li><li class='category-heading' data-category='Router'>Router</li><li><a href="UIRouter.html">UIRouter</a></li><li class='category-heading' data-category='Views'>Views</li><li><a href="AccessPolicyView.html">AccessPolicyView</a></li><li><a href="AccessRuleView.html">AccessRuleView</a></li><li><a href="AnnotationView.html">AnnotationView</a></li><li><a href="AppView.html">AppView</a></li><li><a href="CatalogSearchView.html">CatalogSearchView</a></li><li><a href="CitationHeaderView.html">CitationHeaderView</a></li><li><a href="CitationListView.html">CitationListView</a></li><li><a href="CitationModalView.html">CitationModalView</a></li><li><a href="CitationView.html">CitationView</a></li><li><a href="ColorPaletteView.html">ColorPaletteView</a></li><li><a href="DataCatalogView.html">DataCatalogView</a></li><li><a href="DataCatalogViewWithFilters.html">DataCatalogViewWithFilters</a></li><li><a href="DataItemView.html">DataItemView</a></li><li><a href="DataPackageView.html">DataPackageView</a></li><li><a href="DraftsView.html">DraftsView</a></li><li><a href="EditCollectionView.html">EditCollectionView</a></li><li><a href="EditorView.html">EditorView</a></li><li><a href="FooterView.html">FooterView</a></li><li><a href="GroupListView.html">GroupListView</a></li><li><a href="ImageUploaderView.html">ImageUploaderView</a></li><li><a href="MarkdownEditorView.html">MarkdownEditorView</a></li><li><a href="MarkdownView.html">MarkdownView</a></li><li><a href="MdqRunView.html">MdqRunView</a></li><li><a href="MetadataView.html">MetadataView</a></li><li><a href="MetricModalView.html">MetricModalView</a></li><li><a href="MetricView.html">MetricView</a></li><li><a href="MetricsChartView.html">MetricsChartView</a></li><li><a href="NavbarView.html">NavbarView</a></li><li><a href="RegisterCitationView.html">RegisterCitationView</a></li><li><a href="SearchResultView.html">SearchResultView</a></li><li><a href="SignInView.html">SignInView</a></li><li><a href="TOCView.html">TOCView</a></li><li><a href="TableEditorView.html">TableEditorView</a></li><li><a href="UserGroupView.html">UserGroupView</a></li><li><a href="UserView.html">UserView</a></li><li class='category-heading' data-category='Views/Accordion'>Views/Accordion</li><li><a href="AccordionItemView.html">AccordionItemView</a></li><li><a href="AccordionView.html">AccordionView</a></li><li class='category-heading' data-category='Views/Filters'>Views/Filters</li><li><a href="BooleanFilterView.html">BooleanFilterView</a></li><li><a href="ChoiceFilterView.html">ChoiceFilterView</a></li><li><a href="DateFilterView.html">DateFilterView</a></li><li><a href="FilterEditorView.html">FilterEditorView</a></li><li><a href="FilterGroupView.html">FilterGroupView</a></li><li><a href="FilterGroupsView.html">FilterGroupsView</a></li><li><a href="FilterView.html">FilterView</a></li><li><a href="NumericFilterView.html">NumericFilterView</a></li><li><a href="SemanticFilterView.html">SemanticFilterView</a></li><li><a href="ToggleFilterView.html">ToggleFilterView</a></li><li class='category-heading' data-category='Views/Maps'>Views/Maps</li><li><a href="CesiumWidgetView.html">CesiumWidgetView</a></li><li><a href="DrawTool.html">DrawTool</a></li><li><a href="FeatureInfoView.html">FeatureInfoView</a></li><li><a href="LayerCategoryListView.html">LayerCategoryListView</a></li><li><a href="LayerDetailView.html">LayerDetailView</a></li><li><a href="LayerDetailsView.html">LayerDetailsView</a></li><li><a href="LayerInfoView.html">LayerInfoView</a></li><li><a href="LayerItemView.html">LayerItemView</a></li><li><a href="LayerListView.html">LayerListView</a></li><li><a href="LayerNavigationView.html">LayerNavigationView</a></li><li><a href="LayerOpacityView.html">LayerOpacityView</a></li><li><a href="LayersPanelView.html">LayersPanelView</a></li><li><a href="LegendView.html">LegendView</a></li><li><a href="MapHelpPanel.html">MapHelpPanel</a></li><li><a href="MapView.html">MapView</a></li><li><a href="MapWidgetContainerView.html">MapWidgetContainerView</a></li><li><a href="PredictionView.html">PredictionView</a></li><li><a href="PredictionsListView.html">PredictionsListView</a></li><li><a href="ScaleBarView.html">ScaleBarView</a></li><li><a href="SearchInputView.html">SearchInputView</a></li><li><a href="SearchView.html">SearchView</a></li><li><a href="ShareUrlView.html">ShareUrlView</a></li><li><a href="ToolbarView.html">ToolbarView</a></li><li><a href="ViewfinderView.html">ViewfinderView</a></li><li class='category-heading' data-category='Views/Maps/Legend'>Views/Maps/Legend</li><li><a href="CategoricalSwatchView.html">CategoricalSwatchView</a></li><li><a href="ContinuousSwatchView.html">ContinuousSwatchView</a></li><li><a href="LayerLegendView.html">LayerLegendView</a></li><li><a href="LegendContainerView.html">LegendContainerView</a></li><li class='category-heading' data-category='Views/Maps/Viewfinder'>Views/Maps/Viewfinder</li><li><a href="ExpansionPanelView.html">ExpansionPanelView</a></li><li><a href="ZoomPresetView.html">ZoomPresetView</a></li><li><a href="ZoomPresetsListView.html">ZoomPresetsListView</a></li><li class='category-heading' data-category='Views/Metadata'>Views/Metadata</li><li><a href="EML211EditorView.html">EML211EditorView</a></li><li><a href="EMLAttributeView.html">EMLAttributeView</a></li><li><a href="EMLEntityView.html">EMLEntityView</a></li><li><a href="EMLMeasurementScaleView.html">EMLMeasurementScaleView</a></li><li><a href="EMLMeasurementTypeView.html">EMLMeasurementTypeView</a></li><li><a href="EMLMethodsView.html">EMLMethodsView</a></li><li><a href="EMLMissingValueCodeView.html">EMLMissingValueCodeView</a></li><li><a href="EMLMissingValueCodesView.html">EMLMissingValueCodesView</a></li><li><a href="EMLOtherEntityView.html">EMLOtherEntityView</a></li><li><a href="EMLPartyView.html">EMLPartyView</a></li><li><a href="EMLTempCoverageView.html">EMLTempCoverageView</a></li><li><a href="EMLView.html">EMLView</a></li><li><a href="EMlGeoCoverageView_.html">EMlGeoCoverageView</a></li><li><a href="ScienceMetadataView.html">ScienceMetadataView</a></li><li class='category-heading' data-category='Views/Ontologies'>Views/Ontologies</li><li><a href="BioontologyBrowser.html">BioontologyBrowser</a></li><li class='category-heading' data-category='Views/Portals'>Views/Portals</li><li><a href="PortalDataView.html">PortalDataView</a></li><li><a href="PortalHeaderView.html">PortalHeaderView</a></li><li><a href="PortalListView.html">PortalListView</a></li><li><a href="PortalLogosView.html">PortalLogosView</a></li><li><a href="PortalMembersView.html">PortalMembersView</a></li><li><a href="PortalSectionView.html">PortalSectionView</a></li><li><a href="PortalUsagesView.html">PortalUsagesView</a></li><li><a href="PortalView.html">PortalView</a></li><li><a href="PortalVisualizationsView.html">PortalVisualizationsView</a></li><li><a href="PortalsSearchView.html">PortalsSearchView</a></li><li class='category-heading' data-category='Views/Portals/Editor'>Views/Portals/Editor</li><li><a href="PortEditorDataView.html">PortEditorDataView</a></li><li><a href="PortEditorImageView.html">PortEditorImageView</a></li><li><a href="PortEditorLogosView.html">PortEditorLogosView</a></li><li><a href="PortEditorMdSectionView.html">PortEditorMdSectionView</a></li><li><a href="PortEditorSectionView.html">PortEditorSectionView</a></li><li><a href="PortEditorSectionsView.html">PortEditorSectionsView</a></li><li><a href="PortEditorSettingsView.html">PortEditorSettingsView</a></li><li><a href="PortalEditorView.html">PortalEditorView</a></li><li class='category-heading' data-category='Views/Projects'>Views/Projects</li><li><a href="ProjectView.html">ProjectView</a></li><li class='category-heading' data-category='Views/QueryBuilder'>Views/QueryBuilder</li><li><a href="QueryBuilderView.html">QueryBuilderView</a></li><li><a href="QueryRuleView.html">QueryRuleView</a></li><li class='category-heading' data-category='Views/Search'>Views/Search</li><li><a href="SearchResultsPagerView.html">SearchResultsPagerView</a></li><li><a href="SearchResultsView.html">SearchResultsView</a></li><li><a href="SorterView.html">SorterView</a></li><li class='category-heading' data-category='Views/SearchSelect'>Views/SearchSelect</li><li><a href="AccountSelectView.html">AccountSelectView</a></li><li><a href="AnnotationFilter.html">AnnotationFilter</a></li><li><a href="BioontologySelectView.html">BioontologySelectView</a></li><li><a href="NodeSelect.html">NodeSelect</a></li><li><a href="ObjectFormatSelect.html">ObjectFormatSelect</a></li><li><a href="QueryFieldSelectView.html">QueryFieldSelectView</a></li><li><a href="SearchSelectView.html">SearchSelectView</a></li><li><a href="SeparatorView.html">SeparatorView</a></li><li class='category-heading' data-category='Deprecated'>Deprecated</li><li><a href="AnnotatorView.html">AnnotatorView</a></li><li><a href="ExternalView.html">ExternalView</a></li><li><a href="LogsSearch.html">LogsSearch</a></li></ul><h3>Global</h3><ul><li><a href="global.html#addClassesFromResponse">addClassesFromResponse</a></li><li><a href="global.html#addFields">addFields</a></li><li><a href="global.html#addSelected">addSelected</a></li><li><a href="global.html#appConfigPath">appConfigPath</a></li><li><a href="global.html#buildChildrenUrl">buildChildrenUrl</a></li><li><a href="global.html#buildSearchUrl">buildSearchUrl</a></li><li><a href="global.html#canChangeSeparator">canChangeSeparator</a></li><li><a href="global.html#changeSubmenuOnSearch">changeSubmenuOnSearch</a></li><li><a href="global.html#couldBeLatLong">couldBeLatLong</a></li><li><a href="global.html#createBatchPayload">createBatchPayload</a></li><li><a href="global.html#createHeaders">createHeaders</a></li><li><a href="global.html#defaults">defaults</a></li><li><a href="global.html#encodeIfPresent">encodeIfPresent</a></li><li><a href="global.html#excludeFields">excludeFields</a></li><li><a href="global.html#fetchClasses">fetchClasses</a></li><li><a href="global.html#fetchClassesFromOntology">fetchClassesFromOntology</a></li><li><a href="global.html#fetchFromOntologies">fetchFromOntologies</a></li><li><a href="global.html#fetchQueryFields">fetchQueryFields</a></li><li><a href="global.html#fieldToOption">fieldToOption</a></li><li><a href="global.html#filterClassesToFetch">filterClassesToFetch</a></li><li><a href="global.html#finalizeFetch">finalizeFetch</a></li><li><a href="global.html#formatResult">formatResult</a></li><li><a href="global.html#formatResults">formatResults</a></li><li><a href="global.html#getAccountDetails">getAccountDetails</a></li><li><a href="global.html#getCachedClasses">getCachedClasses</a></li><li><a href="global.html#getCategoryNames">getCategoryNames</a></li><li><a href="global.html#getChildren">getChildren</a></li><li><a href="global.html#getClasses">getClasses</a></li><li><a href="global.html#getIncludeParam">getIncludeParam</a></li><li><a href="global.html#getNextPage">getNextPage</a></li><li><a href="global.html#getNextSeparator">getNextSeparator</a></li><li><a href="global.html#getOptionByLabelOrValue">getOptionByLabelOrValue</a></li><li><a href="global.html#getOptionsByCategory">getOptionsByCategory</a></li><li><a href="global.html#getQueryFieldOptions">getQueryFieldOptions</a></li><li><a href="global.html#getSelectedModels">getSelectedModels</a></li><li><a href="global.html#hasInvalidSelections">hasInvalidSelections</a></li><li><a href="global.html#initialize">initialize</a></li><li><a href="global.html#initializeFetch">initializeFetch</a></li><li><a href="global.html#isValidValue">isValidValue</a></li><li><a href="global.html#model">model</a></li><li><a href="global.html#moveClassesToNotFound">moveClassesToNotFound</a></li><li><a href="global.html#optionsAsJSON">optionsAsJSON</a></li><li><a href="global.html#parse">parse</a></li><li><a href="global.html#recordError">recordError</a></li><li><a href="global.html#removeSelected">removeSelected</a></li><li><a href="global.html#renameCategory">renameCategory</a></li><li><a href="global.html#resetPageInfo">resetPageInfo</a></li><li><a href="global.html#responseAsync">responseAsync</a></li><li><a href="global.html#separatorRequired">separatorRequired</a></li><li><a href="global.html#setAddedFieldDetails">setAddedFieldDetails</a></li><li><a href="global.html#setNextSeparator">setNextSeparator</a></li><li><a href="global.html#setOptionsForPreselected">setOptionsForPreselected</a></li><li><a href="global.html#setSelected">setSelected</a></li><li><a href="global.html#sortByProp">sortByProp</a></li><li><a href="global.html#sortFields">sortFields</a></li><li><a href="global.html#taxonomicClassification">taxonomicClassification</a></li><li><a href="global.html#toAccordionItem">toAccordionItem</a></li><li><a href="global.html#toJSON">toJSON</a></li><li><a href="global.html#toSearchSelectOption">toSearchSelectOption</a></li><li><a href="global.html#updateOptions">updateOptions</a></li><li><a href="global.html#url">url</a></li><li><a href="global.html#waitForFetchComplete">waitForFetchComplete</a></li></ul>
</nav>

<div id="main">

    <h1 class="page-title">Source: src/js/models/CitationModel.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>"use strict";

define(["jquery", "underscore", "backbone", "collections/Citations"], (
  $,
  _,
  Backbone,
  Citations,
) => {
  /**
   * @class CitationModel
   * @classdesc A Citation Model represents a single Citation Object returned by
   * the metrics-service. A citation model can alternatively be populated with a
   * SolrResultsModel or a DataONEObjectModel, or an extension of either of
   * those models. A Citation Model can represent a citation to a local
   * MetacatUI object, or an external document or publication.
   * @classcategory Models
   * @augments Backbone.Model
   * @see https://app.swaggerhub.com/apis/nenuji/data-metrics
   */
  const Citation = Backbone.Model.extend(
    /** @lends CitationModel.prototype */ {
      /**
       * The name of this type of model
       * @type {string}
       */
      type: "CitationModel",

      /**
       * The default Citation fields
       * @name CitationModel#defaults
       * @type {object}
       * @property {string} origin - text of authors who published the source
       * dataset / document / article
       * @property {string[]} originArray - array of authors who published the
       * source dataset / document / article. Same as origin, but split on commas
       * and trimmed.
       * @property {string} title - Title of the source dataset / document /
       * article
       * @property {number} year_of_publishing - Year in which the source dataset
       * / document / article was published
       * @property {string} source_url - URL to the source dataset / document /
       * article. This is usually an external publication that cites one or more
       * DataONE datasets.
       * @property {string} source_id - Unique identifier for the source dataset /
       * document / article that cited the target dataset. This is usually an
       * external publication that cites one or more DataONE datasets.
       * @property {string} target_id - Unique identifier to the target DATAONE
       * dataset. This is the dataset that was cited by the "source" document.
       * @property {string} publisher - Publisher for the source dataset /
       * document / article
       * @property {string} journal - The journal where the the document was
       * published
       * @property {number|string} volume - The volume of the journal where the
       * document was published
       * @property {number} page - The page of the journal where the document was
       * published
       * @property {Citations} citationMetadata - When this Citation Model refers
       * to an external document, citationMetadata is a collection of DataONE
       * datasets that the external document cites. This info is retrieved by the
       * metrics service, then parsed and stored as a collection of Citation
       * Models. This attribute is used in the Portals view, for example, where we
       * display a list of external publications that cite the portal data. In
       * this case, each publication's citationMetadata is the list of local
       * MetacatUI data packages cited in the publication.
       * @property {Backbone.Model} sourceModel - The model to use to populate
       * this citation model. This can be a SolrResultsModel, a
       * DataONEObjectModel, or an extension of either of those models. Do not set
       * this attribute directly. Instead, use the setSourceModel() method.
       * @property {string} pid - The pid or unique identifier of the object being
       * cited.
       * @property {string} seriesId - The seriesId of the object being cited
       * @property {string} view_url - For citations that are in the local
       * MetacatUI repository, this is the URL to the metadata view page for the
       * object being cited.
       * @property {string} pid_url - If the pid is a DOI, then this is the URL to
       * the DOI landing page for the object being cited. This will automatically
       * be set when the pid attribute is set.
       * @property {string} seriesId_url - If the seriesId is a DOI, then this is
       * the URL to the DOI landing page for the object being cited. This will
       * automatically be set when the seriesId attribute is set.
       */
      defaults() {
        return {
          origin: null,
          originArray: [],
          title: null,
          year_of_publishing: null,
          source_url: null,
          source_id: null,
          target_id: null,
          publisher: null,
          journal: null,
          volume: null,
          page: null,
          citationMetadata: null,
          sourceModel: null,
          pid: null,
          seriesId: null,
          view_url: null,
          pid_url: null,
          seriesId_url: null,
        };
      },

      /**
       * Get the attribute getters for this model. "Attribute getters" are
       * functions that return the value of an attribute for this Citation Model
       * given a source model. The source model can be a SolrResultsModel, a
       * DataONEObjectModel, or an extension of either of those models.
       * @returns {object} - An object that maps the name of the CitationModel
       * attribute to the function that returns the value for that attribute.
       */
      attrGetters() {
        return {
          year_of_publishing: this.getYearFromSourceModel,
          title: this.getTitleFromSourceModel,
          journal: this.getJournalFromSourceModel,
          pid: this.getPidFromSourceModel,
          seriesId: this.getSeriesIdFromSourceModel,
          originArray: this.getOriginArrayFromSourceModel,
          view_url: this.getViewUrlFromSourceModel,
        };
      },

      /**
       * Override the default Backbone.Model.parse() method to convert the
       * citationMetadata object into a nested collection of CitationModels.
       * @param {object} response - The response from the metrics-service API
       * @param {object} options - Options to pass to the parse() method.
       * @returns {object} The parsed response
       */
      parse(response) {
        try {
          // strings that need formatting when coming from the metrics-service:
          const toFormat = ["journal", "page", "volume", "publisher"];
          toFormat.forEach((attr) => {
            response[attr] = this.formatMetricsServiceString(response[attr]);
          }, this);

          // Turn the author strings into CSL JSON objects
          if (response.origin) {
            const or = this.originToArray(response.origin);
          }
          let sID = response.source_id;
          if (this.isDOI(sID)) {
            if (sID.startsWith("http")) {
              sID = this.URLtoDOI(sID);
            }
            if (!sID.startsWith("doi:")) {
              sID = `doi:${sID}`;
            }
            response.source_id = sID;
          }

          // Format the citation metadata = DataONE datasets cited by this
          // citation (external document)
          const cm = response.citationMetadata;

          // We use the inline require here in addition to the define above to
          // avoid an issue caused by the circular dependency between
          // CitationModel and Citations
          const Citations = require("collections/Citations");
          if (cm) {
            if (cm &amp;&amp; !(cm instanceof Citations)) {
              const citationMetadata = Object.entries(cm).map(([pid, data]) => {
                // Convert format from {id: {data}} to {data, id}
                const item = { ...data, pid };
                // Origin returned by metrics-service is actually an array, not a
                // string
                item.originArray = item.origin;
                delete item.origin;
                // Format the authors in the origin array
                item.originArray = item.originArray.map((author) =>
                  this.formatAuthor(author),
                );
                // Get the publish year
                const date =
                  item.datePublished || item.dateUpdated || item.dateModified;
                item.year_of_publishing = date
                  ? new Date(date).getUTCFullYear()
                  : null;
                // Because the citation metadata is always referencing an object
                // in the local MetacatUI repository, we assume that the view_url
                // exists for the given PID.
                // DOIs from the metrics service are not prefixed with "doi:"
                if (this.isDOI(pid) &amp;&amp; !pid.startsWith("doi:")) {
                  pid = `doi:${pid}`;
                }
                item.pid = pid;
                item.view_url = `${MetacatUI.root}/view/${encodeURIComponent(pid)}`;

                return item;
              });
              response.citationMetadata = new Citations(citationMetadata);
            }
          }
          return response;
        } catch (error) {
          console.log(
            "Error parsing a CitationModel. Returning response as-is.",
            error,
          );
          return response;
        }
      },

      /**
       * Override the default Backbone.Model.set() method to format the title,
       * page, and volume attributes before setting them, and ensure that
       * attributes that are different formats of the same value are in sync,
       * including: origin and originArray; pid and pid_url; seriesId and
       * seriesId_url. This method will prevent the sourceModel attribute from
       * being set here.
       * @param {string | object} key - The attribute name to set, or an object of
       * attribute names and values to set.
       * @param {string | number | object} val - The value to set the attribute to.
       * @param {object} options - Options to pass to the set() method.
       * @see https://backbonejs.org/#Model-set
       * @since 2.23.0
       */
      set(key, val, options) {
        try {
          if (key == null) return this;

          // Handle both `"key", value` and `{key: value}` -style arguments.
          let attrs = {};
          if (typeof key === "object") {
            attrs = key;
            options = val;
          } else {
            (attrs = {})[key] = val;
          }

          // Don't allow setting the sourceModel attribute here.
          // TODO: how to handle this better?
          delete attrs.sourceModel;

          // If the title attribute is being set, then format it first
          if (Object.keys(attrs).includes("title")) {
            attrs.title = this.formatTitle(attrs.title);
          }

          // Ensure origin and originArray contain the same data, with preference
          // given to originArray. If originArray has content, then overwrite
          // origin with the a string created from originArray. If *only* origin
          // has content, then overwrite originArray with an array created from
          // origin.
          if (
            Object.keys(attrs).includes("originArray") ||
            Object.keys(attrs).includes("origin")
          ) {
            const strToArray = this.originToArray(attrs.origin);
            const arrayToStr = this.originArrayToString(attrs.originArray);
            if (arrayToStr) {
              attrs.origin = arrayToStr;
            } else {
              attrs.originArray = strToArray;
            }
          }

          // Ensure that the pid_url and seriesId_url attributes match the pid and
          // seriesId attributes being set, and vice versa. If they don't match,
          // then set them to the correct values. Prefer the content of the IDs
          // over the URLs.
          const idToUrlAttrs = [
            { id: "pid", url: "pid_url" },
            { id: "seriesId", url: "seriesId_url" },
          ];

          idToUrlAttrs.forEach(({ id, url }) => {
            if (
              Object.keys(attrs).includes(id) ||
              Object.keys(attrs).includes(url)
            ) {
              if (!!attrs[id] &amp;&amp; !attrs[url]) {
                attrs[url] = this.DOItoURL(attrs[id]);
              } else if (!!attrs[url] &amp;&amp; !attrs[id]) {
                attrs[id] = this.URLtoDOI(attrs[url]);
              } else if (!!attrs[id] &amp;&amp; !!attrs[url]) {
                attrs[url] = this.DOItoURL(attrs[id]);
              }
            }
          });

          // If citationMetadata is being changed, remove old listeners and add
          // new ones
          if (Object.keys(attrs).includes("citationMetadata")) {
            if (this.citationMetadata) {
              this.stopListening(this.citationMetadata);
            }
            if (attrs.citationMetadata &amp;&amp; attrs.citationMetadata.length) {
              this.listenTo(
                attrs.citationMetadata,
                "update",
                this.trigger.bind(this, "change"),
              );
            }
          }

          // Set modified attributes in the regular Backbone way
          Backbone.Model.prototype.set.call(this, attrs, options);
        } catch (error) {
          console.log(
            "Error in custom set() method on CitationModel. Will attempt to set" +
              " using with Backbone set(). Attributes and error stack trace:",
            { key, val, options },
            error,
          );
          Backbone.Model.prototype.set.call(this, key, val, options);
        }
      },

      /**
       * Sets the sourceModel attribute and calls the method to populate the
       * Citation Model with the sourceModel attributes. Also removes any existing
       * listeners on the previous sourceModel and readds them to the new
       * sourceModel. Use this method to set or change the sourceModel attribute.
       * @param {Backbone.Model} newSourceModel - The new sourceModel
       * @since 2.23.0
       */
      setSourceModel(newSourceModel) {
        try {
          newSourceModel =
            newSourceModel &amp;&amp; newSourceModel.type == "Package"
              ? newSourceModel.getMetadata()
              : newSourceModel;

          // Remove any existing listeners on the previous sourceModel
          const currentSourceModel = this.get("sourceModel");
          if (currentSourceModel) {
            this.stopListening(currentSourceModel);
            const creators = currentSourceModel.get("creator") || [];
            creators.forEach((creator) => this.stopListening(creator), this);
          }

          // Add listeners to the new sourceModel
          if (newSourceModel) {
            const creatorEvents =
              "change:individualName change:organizationName change:positionName";
            const sourceModelEvents =
              "change:origin change:creator change:pubDate change:dateUploaded change:title change:seriesId change:id change:datasource";
            const creators = newSourceModel.get("creator") || [];
            this.listenTo(newSourceModel, sourceModelEvents, () => {
              this.setSourceModel(newSourceModel);
            });
            creators.forEach((creator) => {
              this.listenTo(creator, creatorEvents, () => {
                this.setSourceModel(newSourceModel);
              });
            });
          }
          Backbone.Model.prototype.set.call(
            this,
            "sourceModel",
            newSourceModel,
          );
          this.populateFromModel(newSourceModel);
        } catch (error) {
          console.log("Error in CitationModel.setSourceModel(). Error:", error);
        }
      },

      /**
       * Do not call this method directly. Instead, call setSourceModel(), which
       * will update listeners and then call this method. This method will
       * populate this citation model's attributes from another model, such as a
       * SolrResult model or a DataONEObject model. This will reset and overwrite
       * any existing attributes on this model.
       * @param {Backbone.Model} model - The model to populate from, accepts
       * SolrResult or a model that is a DataONEObject or an extended
       * DataONEObject. If no model is passed, then the model will be reset to the
       * default attributes.
       * @param newSourceModel
       * @since 2.23.0
       */
      populateFromModel(newSourceModel) {
        try {
          // Populate this model from the new sourceModel

          const newAttrs = this.defaults();

          if (!newSourceModel) {
            this.set(newAttrs);
            return;
          }

          const attrGetters = this.attrGetters();

          Object.entries(attrGetters).forEach(([attrName, getter]) => {
            const attrValue = getter.call(this, newSourceModel);
            if (attrValue) newAttrs[attrName] = attrValue;
          });

          this.set(newAttrs);
        } catch (error) {
          console.log(
            "Error populating a CitationModel from the model: ",
            newSourceModel,
            " Error: ",
            error,
          );
        }
      },

      /**
       * Get the year from the sourceModel. First look for pubDate, then
       * dateUploaded (both in SolrResult &amp; ScienceMetadata/EML models). Lastly
       * check datePublished (found in ScienceMetadata/EML models only.)
       * @param {Backbone.Model} sourceModel - The model to get the year from
       * @returns {number} - The year
       * @since 2.23.0
       */
      getYearFromSourceModel(sourceModel) {
        try {
          const year =
            this.yearFromDate(sourceModel.get("pubDate")) ||
            this.yearFromDate(sourceModel.get("dateUploaded")) ||
            this.yearFromDate(sourceModel.get("datePublished"));
          return year;
        } catch (error) {
          console.log(
            "Error getting year from the sourceModel. Model and error:",
            sourceModel,
            error,
          );
          return this.defaults().year_of_publishing;
        }
      },

      /**
       * Get the title from the sourceModel
       * @param {Backbone.Model} sourceModel - The model to get the title from
       * @returns {string} - The title
       * @since 2.23.0
       */
      getTitleFromSourceModel(sourceModel) {
        try {
          let title = sourceModel.get("title");
          title = Array.isArray(title) ? title[0] : title;
          // If this is a Data object, there may not be a title, so try to get the
          // title from the file name
          if (!title &amp;&amp; sourceModel.get("fileName")) {
            let fn = sourceModel.get("fileName");
            const extRegex = /\.[^/.]+$/;
            // Save the extension
            let ext = fn ? fn.match(extRegex) : null;
            // remove the period and make it all uppercase
            ext = ext ? ext[0].replace(".", "").toUpperCase() : ext;
            // Remove the extension and replace underscores with spaces
            fn = fn.replace(extRegex, "").replace(/_+/g, " ");
            title = fn || title;
            title = title &amp;&amp; ext ? `${title} [${ext}]` : title;
          }
          return title;
        } catch (error) {
          console.log(
            "Error getting title from the sourceModel. Model and error:",
            sourceModel,
            error,
          );
          return this.defaults().title;
        }
      },

      /**
       * Get the journal (datasource/node) from the sourceModel. If there is a
       * datasource attribute on the sourceModel, then get the name of the member
       * node that has that datasource ID. If we can't find a member node that
       * matches the datasource, then check if the datasource is the current node.
       * If it is, then use the repository name. If there is no datasource
       * attribute, then use the current member node's name.
       * @param {Backbone.Model} sourceModel - The model to get the journal from
       * @returns {string} - The journal
       * @since 2.23.0
       */
      getJournalFromSourceModel(sourceModel) {
        try {
          let journal = null;
          const datasource = sourceModel.get("datasource");
          const mn = MetacatUI.nodeModel.getMember(datasource);
          const currentMN = MetacatUI.nodeModel.get("currentMemberNode");
          if (datasource) {
            if (mn) {
              journal = mn.name;
            } else if (datasource == MetacatUI.appModel.get("nodeId")) {
              journal = MetacatUI.appModel.get("repositoryName");
            }
          }
          if (!journal &amp;&amp; currentMN) {
            const mnCurrent = MetacatUI.nodeModel.getMember(currentMN);
            journal = mnCurrent ? mnCurrent.name : null;
          }
          return journal;
        } catch (error) {
          console.log(
            "Error getting journal from the sourceModel. Model and error:",
            sourceModel,
            error,
          );
          return this.defaults().journal;
        }
      },

      /**
       * Get the array of authors ("origin") from the sourceModel. First look for
       * creator (EML), then origin (science metadata &amp; solr results), then
       * rightsHolder &amp; submitter (base D1 object model). Convert EML parties to
       * strings &amp; check for incorrectly escaped characters.
       * @param {Backbone.Model} sourceModel - The model to get the originArray
       * from
       * @returns {Array} - The originArray
       * @since 2.23.0
       */
      getOriginArrayFromSourceModel(sourceModel) {
        try {
          // AUTHORS
          let authors =
            // If it's an EML document, there will be a creator field
            sourceModel.get("creator") ||
            // If it's a science metadata model or solr results, use origin
            sourceModel.get("origin") ||
            "";

          // otherwise, this is probably a base D1 object model. Don't use
          // rightsHolder or submitter for now, because it might not always be the
          // author.

          // sourceModel.get("rightsHolder") ||
          // sourceModel.get("submitter");

          // Convert EML parties to strings &amp; check for incorrectly escaped
          // characters
          if (authors) {
            authors = Array.isArray(authors) ? authors : [authors];
            authors = authors.map((author) => this.formatAuthor(author));
          }
          return authors;
        } catch (error) {
          console.log(
            "Error getting originArray from the sourceModel. Model and error:",
            sourceModel,
            error,
          );
          return this.defaults().originArray;
        }
      },

      /**
       * Get the pid from the sourceModel. First look for id, then identifier.
       * @param {Backbone.Model} sourceModel - The model to get the pid from
       * @returns {string} - The pid
       * @since 2.23.0
       */
      getPidFromSourceModel(sourceModel) {
        try {
          const pid =
            sourceModel.get("id") || sourceModel.get("identifier") || null;
          return pid;
        } catch (error) {
          console.log(
            "Error getting the pid from the sourceModel. Model and error:",
            sourceModel,
            error,
          );
          return this.defaults().pid;
        }
      },

      /**
       * Get the seriesId from the sourceModel. Simply looks for the seriesId
       * attribute.
       * @param {Backbone.Model} sourceModel - The model to get the seriesId from
       * @returns {string} - The seriesId
       * @since 2.23.0
       */
      getSeriesIdFromSourceModel(sourceModel) {
        try {
          const seriesId = sourceModel.get("seriesId") || null;
          return seriesId;
        } catch (error) {
          console.log(
            "Error getting the seriesId from the sourceModel. Model and error:",
            sourceModel,
            error,
          );
          return this.defaults().seriesId;
        }
      },

      /**
       * Use the sourceModel's createViewURL() method to get the viewUrl for the
       * citation. This method is built into DataONEObject models, SolrResult
       * models, as  well as Portal models. If the sourceModel doesn't have a
       * createViewURL() method, then use the default viewUrl (null)
       * @param {Backbone.Model} sourceModel - The model to get the viewUrl from
       * @returns {string} - The viewUrl, or null if the sourceModel doesn't have
       * a createViewURL() method.
       * @since 2.23.0
       */
      getViewUrlFromSourceModel(sourceModel) {
        try {
          if (sourceModel &amp;&amp; sourceModel.createViewURL) {
            return sourceModel.createViewURL();
          }
          return this.defaults().viewUrl;
        } catch (error) {
          console.log(
            "Error getting the viewUrl from the sourceModel. Model and error:",
            sourceModel,
            error,
          );
          return this.defaults().viewUrl;
        }
      },

      /**
       * Format an individual author for display within a citation.
       * @param {string|EMLParty} author The author to format
       * @returns {string} Returns the author as a string if it was an EMLParty
       * with any incorrectly escaped characters corrected.
       */
      formatAuthor(author) {
        try {
          // Update the origin array asynchonously if the author is an ORCID
          if (this.isOrcid(author)) this.originArrayFromOrcid(author);

          // If author is an EMLParty model, then convert it to a string with
          // given name + sur name, or organization name
          if (typeof author.toCSLJSON === "function") {
            author = author.toCSLJSON();
          } else if (typeof author === "string") {
            author = this.nameStrToCSLJSON(author);
          }

          return author;
        } catch (error) {
          console.log(
            "There was an error formatting an author, returning " +
              "the author input as is.",
            error,
          );
          return author;
        }
      },

      /**
       * Cleans up the title for display within a citation. Removes a period from
       * the end of the title if it exists and trims whitespace.This method is
       * called any time a title is set on the Citation model.
       * @param {string} title The title to format
       * @returns {string} Returns the title with a period removed from the end if
       * it exists.
       * @since 2.23.0
       */
      formatTitle(title) {
        if (!title) return "";
        return title.replace(/\.+$/, "").trim();
      },

      /**
       * Cleans up the metrics service string for display within a citation.
       * Replaces "NULL" with an empty string, removes a period from the end of
       * the string if it exists, removes curly braces, and trims whitespace.
       * @param {string} str The metrics service string to format
       * @returns {string} Returns the metrics service string with "NULL" replaced
       * with an empty string.
       * @since 2.23.0
       */
      formatMetricsServiceString(str) {
        if (!str) return "";
        // The metrics service returns "NULL" if there is no data
        str = str === "NULL" ? "" : str;
        // Replace period at the end of the string
        str = str.replace(/\.+$/, "");
        // Remove curly braces
        str = str.replace(/{|}/g, "");
        // Remove any leading or trailing whitespace
        str = str.trim();
        // Check for incorrectly escaped characters, like &amp;amp;
        const doc = new DOMParser().parseFromString(str, "text/html");
        str = doc.body.textContent || "";
        return str;
      },

      /**
       * Convert the author string that is returned from the metrics service into
       * CSL JSON format. Author strings that come from the metrics service take
       * many formats, which might include full given and last names, middle
       * initials, first initials, etc. Here are a few example strings: "Chelsea
       * Wegner Koch", "Lee W. Cooper", "J. Wiktor", "Sei-Ichi Saitoh", "William
       * K. W. Li", "J.R. Lovvorn". Last name prefixes like "van" or "de" are
       * stored as a "non-dropping particle". See:
       * {@link https://citeproc-js.readthedocs.io/en/latest/csl-json/markup.html#name-variables}
       * @param {str} author The author string to convert
       * @param str
       * @returns {object} Returns an object with the author's name in CSL JSON
       * format.
       * @since 2.23.0
       */
      nameStrToCSLJSON(str) {
        if (!str) return null;
        const name = {};
        str = this.formatMetricsServiceString(str);

        // If the string contains one comma, then assume it is in the format "last
        // name, first name". Move the first name to the front of the string.
        if (str.split(",").length == 2) {
          const parts = str.split(",");
          str = `${parts[1].trim()} ${parts[0].trim()}`;
        }

        const parts = str
          .trim()
          .split(/\s+|\./)
          .filter((part) => part !== "");

        if (parts.length === 1) {
          name.literal = str;
          return name;
        }

        // Assume the last word is the family name
        name.family = parts.pop();

        // Any remaining lowercase words are assumed to be non-dropping particles
        const nonDroppingParticles = parts.filter((part) =>
          part.match(/^[a-z]+$/),
        );
        if (nonDroppingParticles.length > 0) {
          name["non-dropping-particle"] = nonDroppingParticles.join(" ");
        }

        // Any remaining words are assumed to be given names
        const givenNames = parts.filter((part) => !part.match(/^[a-z]+$/));
        if (givenNames.length > 0) {
          name.given = givenNames.join(" ");
        }

        return name;
      },

      /**
       * Given a date, extract the year as a number.
       * @param {Date | string | number} date The date to extract the year from
       * @returns {number} Returns the year as a number, or null if the date is
       * invalid.
       * @since 2.23.0
       */
      yearFromDate(date) {
        try {
          if (!date) return null;
          // If Date is already a year (Number object with 4 digits), return it
          if (Number.isInteger(date) &amp;&amp; date.toString().length == 4) {
            return date;
          }
          // If it is a string with 4 digits, return it as an integer. Use regex.
          if (typeof date === "string" &amp;&amp; /^\d{4}$/.test(date)) {
            return parseInt(date);
          }
          // Check if the date is a Date object
          if (!(date instanceof Date)) {
            date = new Date(date);
          }
          const yr = date.getUTCFullYear();
          return yr == "NaN" ? null : yr;
        } catch (error) {
          console.log(
            "There was an error getting the year from the date, returning null.",
            error,
          );
          return null;
        }
      },

      /**
       * Check if a string is a valid ORCID.
       * @param {string} orcid The ORCID to check
       * @returns {boolean} Returns true if the ORCID is valid, false otherwise
       * @since 2.23.0
       */
      isOrcid(orcid) {
        try {
          if (!orcid) return false;
          const regex = new RegExp(
            "^https?:\\/\\/orcid.org\\/(\\d{4}-){3}(\\d{3}[0-9X])$",
          );
          return regex.test(orcid);
        } catch {
          return false;
        }
      },

      /**
       * Use the App Lookup model's get Accounts method to get the name of the
       * author from their ORCID, then asynchronously set the originArray to
       * contain that name.
       * @param {string} orcid The ORCID to get the name for
       * @since 2.23.0
       */
      originArrayFromOrcid(orcid) {
        try {
          const request = { term: orcid };
          const model = this;

          const callback = function (response) {
            let name = null;
            if (response) {
              if (Array.isArray(response)) {
                const { label } = response[0];
                if (label) {
                  // Name is the format "Min Liew
                  // (http://orcid.org/0000-0002-5156-4610)" We want to return
                  // "Min Liew". It will always be two spaces and a "("
                  name = label.split("  (")[0];
                }
              }
            }
            if (name) {
              console.log("Setting originArray to ", [name]);
              model.set("originArray", [name]);
            }
          };
          MetacatUI.appLookupModel.getAccountsAutocomplete(request, callback);
        } catch (error) {
          console.log(
            "There was an error getting the name from the orcid.",
            error,
          );
        }
      },

      /**
       * Checks if the citation is for a DataONE object from a specific node (e.g.
       * PANGAEA)
       * @param {string} node - The node id to check, e.g. "urn:node:PANGAEA"
       * @returns {boolean} - True if the citation is for a DataONE object from
       * the given node
       * @since 2.23.0
       */
      isFromNode(node) {
        try {
          const sourceModel = this.get("sourceModel");
          return (
            sourceModel &amp;&amp;
            sourceModel.get &amp;&amp;
            sourceModel.get("datasource") &amp;&amp;
            sourceModel.get("datasource") === node
          );
        } catch (error) {
          console.log(
            `There was an error checking if the citation is from node ${node}.` +
              `Returning false.`,
            error,
          );
          return false;
        }
      },

      /**
       * Convert the comma-separated origin string to an array of authors.
       * @param {string} origin - The origin string to convert to an array. If a
       * falsy value is passed in, then the default originArray attribute of the
       * model is returned.
       * @returns {Array} - An array of authors
       * @since 2.23.0
       */
      originToArray(origin) {
        try {
          if (!origin) {
            return this.defaults().originArray;
          }
          const originArray = origin ? origin.split(", ") : [];
          return originArray.map((author) => this.formatAuthor(author));
        } catch (error) {
          console.log(
            "There was an error converting the origin string to an array.",
            error,
          );
          return this.defaults().originArray;
        }
      },

      /**
       * Convert the origin array to a string.
       * @param originArray
       * @returns {string} - The origin string. If a falsy value is passed in,
       * then the default origin attribute of the model is returned.
       * @since 2.23.0
       */
      originArrayToString(originArray) {
        try {
          if (!originArray || !originArray.length) {
            return this.defaults().origin;
          }
          // Each author in the array is a CSL JSON object. Map it to a string
          // with the author's name in the format First Particle Last or Literal.
          // Separate each author name with a comma and a space.
          const origin = originArray
            .map((a) => {
              if (!a) return null;
              const ndp = a["non-dropping-particle"];
              const name =
                (a.given ? `${a.given} ` : "") +
                (ndp ? `${ndp} ` : "") +
                (a.family ? a.family : "");
              return (name || a.literal || "").trim();
            })
            .filter((a) => a)
            .join(", ");
          return origin;
        } catch (error) {
          console.log(
            "There was an error converting the origin array to a string.",
            error,
          );
          return this.defaults().origin;
        }
      },

      /**
       * Returns true if the citation is for a DataONE object that has been
       * archived and archived content is not available in the search index.
       * @returns {boolean} - True if the citation has no content because it is
       * archived and archived content is not indexed.
       * @see AppModel#archivedContentIsIndexed
       * @since 2.23.0
       */
      isArchivedAndNotIndexed() {
        return this.isArchived() &amp;&amp; !this.archivedContentIsIndexed();
      },

      /**
       * Checks if the object being cited is archived, according to the `archived`
       * attribute of the source model.
       * @returns {boolean} - True if the source model has an `archived` attribute
       * that is true.
       * @since 2.23.0
       */
      isArchived() {
        return (
          this.sourceModel &amp;&amp;
          this.sourceModel.get &amp;&amp;
          this.sourceModel.get("archived")
        );
      },

      /**
       * Checks if archived content is available in the search index.
       * @see AppModel#archivedContentIsIndexed
       * @returns {boolean} - True if archived content is available in the search
       * index.
       * @since 2.23.0
       */
      archivedContentIsIndexed() {
        return MetacatUI.appModel.get("archivedContentIsIndexed");
      },

      /**
       * Remove all DOI prefixes from a DOI string, including https, http, doi.org,
       * dx.doi.org, and doi:.
       * @param {string} str - The DOI string to remove prefixes from.
       * @returns {string} - The DOI string without any prefixes.
       * @since 2.23.0
       */
      removeAllDOIPrefixes(str) {
        if (!str) return "";
        // Remove https and http prefixes
        str = str.replace(/^(https?:\/\/)?/, "");
        // Remove domain prefixes, like doi.org and dx.doi.org
        str = str.replace(/^(doi\.org\/|dx\.doi\.org\/)/, "");
        // Remove doi: prefix
        str = str.replace(/^doi:/, "");
        return str;
      },

      /**
       * Check if a string is a valid DOI.
       * @param {string} doi - The string to check.
       * @param str
       * @returns {boolean} - True if the string is a valid DOI, false otherwise.
       * @since 2.23.0
       */
      isDOI(str) {
        return MetacatUI.appModel.isDOI(str);
      },

      /**
       * Get the URL for the online location of the object being cited when it has
       * a DOI. If the DOI is not passed to the function, or if the string is not
       * a DOI, then an empty string is returned.
       * @param {string} [str] - The DOI string with or without the "doi:" prefix.
       * It may already be a URL, or it may be a DOI string. It also handles the
       * case where the DOI is already a URL.
       * @returns {string} - The DOI URL
       * @since 2.23.0
       */
      DOItoURL(str) {
        return MetacatUI.appModel.DOItoURL(str);
      },

      /**
       * Get the DOI from a DOI URL. The URL can be http or https, can include the
       * "doi:" prefix or not, and can use "dx.doi.org" or "doi.org" as the
       * domain. If a string is not passed to the function, or if the string is
       * not for a DOI URL, then an empty string is returned.
       * @param {string} url - The DOI URL
       * @returns {string} - The DOI string, including the "doi:" prefix
       * @since 2.23.0
       */
      URLtoDOI(url) {
        return MetacatUI.appModel.URLtoDOI(url);
      },

      /**
       * Checks if the citation has a DOI in the seriesId or pid attributes.
       * @returns {string} - The DOI of the seriesID, if it is a DOI, or the DOI
       * of the pid, if it is a DOI. Otherwise, returns null.
       * @since 2.23.0
       */
      findDOI() {
        try {
          if (!this.sourceModel || !this.sourceModel.isDOI) return null;
          const seriesID = this.get("seriesId");
          const pid = this.get("pid");
          if (this.sourceModel.isDOI(seriesID)) return seriesID;
          if (this.sourceModel.isDOI(pid)) return pid;
          return null;
        } catch (error) {
          console.log(
            "There was an error finding the DOI for the citation. Returning null",
            error,
          );
          return null;
        }
      },

      /**
       * Checks if the citation has a DOI in the seriesId or pid attributes.
       * @returns {boolean} - True if the citation has a DOI
       * @since 2.23.0
       */
      hasDOI() {
        return !!this.findDOI();
      },

      /**
       * If this citation has a source model, and if that source model is a
       * DataONEObject, then return the results of the DataONEObject's
       * `getUploadStatus` function
       * @returns {string} - The upload status of the source model, if it is a
       * DataONEObject, or null if it is not.
       * @since 2.23.0
       * @see DataONEObject#getUploadStatus
       */
      getUploadStatus() {
        return this.sourceModel ? this.sourceModel.get("uploadStatus") : null;
      },

      /**
       * Get the URL for the citation. This will check the model for the following
       * attributes and return the first that is not empty: view_url, source_url,
       * sid_url, pid_url.
       * @returns {string} Returns the URL for the citation or an empty string.
       * @since 2.23.0
       */
      getURL() {
        const urlSources = ["view_url", "source_url", "sid_url", "pid_url"];
        for (let i = 0; i &lt; urlSources.length; i++) {
          const url = this.get(urlSources[i]);
          if (url) return url;
        }
        return "";
      },

      /**
       * Get the main identifier for the citation. This will check the model for
       * the following attributes and return the first that is not empty: pid,
       * seriesId, source_url.
       * @returns {string} Returns the main identifier for the citation or an
       * empty string.
       * @since 2.23.0
       */
      getID() {
        const idSources = ["pid", "seriesId", "source_url"];
        for (let i = 0; i &lt; idSources.length; i++) {
          const id = this.get(idSources[i]);
          if (id) return id;
        }
        return "";
      },
    },
  );

  return Citation;
});
</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
