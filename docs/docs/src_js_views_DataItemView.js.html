<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>MetacatUI Dev Docs: Source: src/js/views/DataItemView.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
    <link type="text/css" rel="stylesheet" href="/metacatui/assets/css/styles.css">
    <link type="text/css" rel="stylesheet" href="styles/style.css">
</head>

<body>

<nav id="nav">
    <a href="/">
      <div class="logo">
<svg class="cat" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="cat" class="svg-inline--fa fa-cat fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M290.59 192c-20.18 0-106.82 1.98-162.59 85.95V192c0-52.94-43.06-96-96-96-17.67 0-32 14.33-32 32s14.33 32 32 32c17.64 0 32 14.36 32 32v256c0 35.3 28.7 64 64 64h176c8.84 0 16-7.16 16-16v-16c0-17.67-14.33-32-32-32h-32l128-96v144c0 8.84 7.16 16 16 16h32c8.84 0 16-7.16 16-16V289.86c-10.29 2.67-20.89 4.54-32 4.54-61.81 0-113.52-44.05-125.41-102.4zM448 96h-64l-64-64v134.4c0 53.02 42.98 96 96 96s96-42.98 96-96V32l-64 64zm-72 80c-8.84 0-16-7.16-16-16s7.16-16 16-16 16 7.16 16 16-7.16 16-16 16zm80 0c-8.84 0-16-7.16-16-16s7.16-16 16-16 16 7.16 16 16-7.16 16-16 16z"></path></svg>

<svg width="459px" height="53px" viewBox="0 0 459 53" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
    <g id="metacatui" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
        <path d="M16.492,52 C17.212,52 17.812,51.748 18.292,51.244 C18.772,50.74 19.012,50.128 19.012,49.408 L19.012,49.408 L18.94,22.912 L30.82,37.816 C31.204,38.344 31.72,38.764 32.368,39.076 C33.016,39.388 33.7,39.544 34.42,39.544 C35.908,39.544 37.132,38.896 38.092,37.6 L38.092,37.6 L49.684,22.912 L49.684,49.408 C49.684,50.128 49.96,50.74 50.512,51.244 C51.064,51.748 51.7,52 52.42,52 L52.42,52 L62.068,52 C62.788,52 63.388,51.748 63.868,51.244 C64.348,50.74 64.588,50.128 64.588,49.408 L64.588,49.408 L64.588,4.12 C64.588,3.448 64.336,2.86 63.832,2.356 C63.328,1.852 62.74,1.6 62.068,1.6 L62.068,1.6 L52.348,1.6 C51.388,1.6 50.56,1.648 49.864,1.744 C49.168,1.84 48.532,2.152 47.956,2.68 L47.956,2.68 L33.916,17.296 L20.524,2.608 C20.332,2.368 19.972,2.14 19.444,1.924 C18.916,1.708 18.412,1.6 17.932,1.6 L17.932,1.6 L6.772,1.6 C6.052,1.6 5.44,1.852 4.936,2.356 C4.432,2.86 4.18,3.448 4.18,4.12 L4.18,4.12 L4.18,49.408 C4.18,50.08 4.432,50.68 4.936,51.208 C5.44,51.736 6.052,52 6.772,52 L6.772,52 L16.492,52 Z M110.74,52 C111.556,52 112.264,51.676 112.864,51.028 C113.464,50.38 113.764,49.624 113.764,48.76 L113.764,48.76 L113.764,42.568 C113.764,41.608 113.464,40.828 112.864,40.228 C112.264,39.628 111.556,39.328 110.74,39.328 L110.74,39.328 L89.428,39.328 L89.428,32.92 L109.732,32.92 C110.5,32.92 111.184,32.596 111.784,31.948 C112.384,31.3 112.684,30.568 112.684,29.752 L112.684,29.752 L112.684,23.488 C112.684,22.576 112.384,21.82 111.784,21.22 C111.184,20.62 110.5,20.32 109.732,20.32 L109.732,20.32 L89.428,20.32 L89.428,14.488 L110.74,14.488 C111.508,14.488 112.204,14.164 112.828,13.516 C113.452,12.868 113.764,12.136 113.764,11.32 L113.764,11.32 L113.764,5.056 C113.764,4.144 113.464,3.388 112.864,2.788 C112.264,2.188 111.556,1.888 110.74,1.888 L110.74,1.888 L76.756,1.888 C75.94,1.888 75.232,2.188 74.632,2.788 C74.032,3.388 73.732,4.144 73.732,5.056 L73.732,5.056 L73.732,48.76 C73.732,49.624 74.032,50.38 74.632,51.028 C75.232,51.676 75.94,52 76.756,52 L76.756,52 L110.74,52 Z M147.604,52 C148.42,52 149.104,51.688 149.656,51.064 C150.208,50.44 150.484,49.672 150.484,48.76 L150.484,48.76 L150.484,16.216 L161.86,16.216 C162.676,16.216 163.396,15.904 164.02,15.28 C164.644,14.656 164.956,13.936 164.956,13.12 L164.956,13.12 L164.956,4.768 C164.956,4 164.644,3.316 164.02,2.716 C163.396,2.116 162.676,1.816 161.86,1.816 L161.86,1.816 L124.132,1.816 C123.22,1.816 122.464,2.104 121.864,2.68 C121.264,3.256 120.964,3.952 120.964,4.768 L120.964,4.768 L120.964,13.12 C120.964,13.936 121.264,14.656 121.864,15.28 C122.464,15.904 123.22,16.216 124.132,16.216 L124.132,16.216 L135.652,16.216 L135.148,48.832 C135.148,49.744 135.424,50.5 135.976,51.1 C136.528,51.7 137.212,52 138.028,52 L138.028,52 L147.604,52 Z M175.828,52 C176.836,52 177.676,51.82 178.348,51.46 C179.02,51.1 179.452,50.584 179.644,49.912 L179.644,49.912 L181.876,42.712 L197.932,42.712 L200.164,49.912 C200.356,50.584 200.8,51.1 201.496,51.46 C202.192,51.82 203.044,52 204.052,52 L204.052,52 L213.916,52 C215.836,51.712 216.796,50.704 216.796,48.976 C216.796,48.304 216.676,47.596 216.436,46.852 C216.196,46.108 216.052,45.616 216.004,45.376 L216.004,45.376 L199.876,4.84 C199.588,3.976 199.036,3.232 198.22,2.608 C197.404,1.984 196.372,1.648 195.124,1.6 L195.124,1.6 L184.756,1.6 C183.604,1.648 182.608,1.948 181.768,2.5 C180.928,3.052 180.292,3.832 179.86,4.84 L179.86,4.84 L163.876,45.376 C163.828,45.472 163.672,45.916 163.408,46.708 C163.144,47.5 163.012,48.304 163.012,49.12 C163.012,50.752 163.948,51.712 165.82,52 L165.82,52 L175.828,52 Z M195.34,30.544 L184.036,30.544 L189.652,13.624 L195.34,30.544 Z M245.38,53.08 C250.612,53.08 255.652,51.544 260.5,48.472 C261.22,47.944 261.58,47.296 261.58,46.528 C261.58,45.808 261.292,45.16 260.716,44.584 L260.716,44.584 L252.796,36.808 C252.364,36.376 251.836,36.16 251.212,36.16 C250.78,36.16 250.372,36.256 249.988,36.448 C248.356,37.12 246.796,37.456 245.308,37.456 C243.244,37.456 241.348,36.952 239.62,35.944 C237.892,34.936 236.512,33.58 235.48,31.876 C234.448,30.172 233.932,28.336 233.932,26.368 C233.932,24.352 234.436,22.504 235.444,20.824 C236.452,19.144 237.832,17.812 239.584,16.828 C241.336,15.844 243.244,15.352 245.308,15.352 C246.892,15.352 248.332,15.64 249.628,16.216 C250.012,16.408 250.444,16.504 250.924,16.504 C251.548,16.504 252.1,16.264 252.58,15.784 L252.58,15.784 L259.636,8.008 C260.164,7.384 260.428,6.76 260.428,6.136 C260.428,5.224 259.996,4.528 259.132,4.048 C254.86,1.552 250.276,0.304 245.38,0.304 C240.532,0.304 236.032,1.492 231.88,3.868 C227.728,6.244 224.44,9.448 222.016,13.48 C219.592,17.512 218.38,21.904 218.38,26.656 C218.38,31.408 219.592,35.812 222.016,39.868 C224.44,43.924 227.728,47.14 231.88,49.516 C236.032,51.892 240.532,53.08 245.38,53.08 Z M279.796,52 C280.804,52 281.644,51.82 282.316,51.46 C282.988,51.1 283.42,50.584 283.612,49.912 L283.612,49.912 L285.844,42.712 L301.9,42.712 L304.132,49.912 C304.324,50.584 304.768,51.1 305.464,51.46 C306.16,51.82 307.012,52 308.02,52 L308.02,52 L317.884,52 C319.804,51.712 320.764,50.704 320.764,48.976 C320.764,48.304 320.644,47.596 320.404,46.852 C320.164,46.108 320.02,45.616 319.972,45.376 L319.972,45.376 L303.844,4.84 C303.556,3.976 303.004,3.232 302.188,2.608 C301.372,1.984 300.34,1.648 299.092,1.6 L299.092,1.6 L288.724,1.6 C287.572,1.648 286.576,1.948 285.736,2.5 C284.896,3.052 284.26,3.832 283.828,4.84 L283.828,4.84 L267.844,45.376 C267.796,45.472 267.64,45.916 267.376,46.708 C267.112,47.5 266.98,48.304 266.98,49.12 C266.98,50.752 267.916,51.712 269.788,52 L269.788,52 L279.796,52 Z M299.308,30.544 L288.004,30.544 L293.62,13.624 L299.308,30.544 Z M352.588,52 C353.404,52 354.088,51.688 354.64,51.064 C355.192,50.44 355.468,49.672 355.468,48.76 L355.468,48.76 L355.468,16.216 L366.844,16.216 C367.66,16.216 368.38,15.904 369.004,15.28 C369.628,14.656 369.94,13.936 369.94,13.12 L369.94,13.12 L369.94,4.768 C369.94,4 369.628,3.316 369.004,2.716 C368.38,2.116 367.66,1.816 366.844,1.816 L366.844,1.816 L329.116,1.816 C328.204,1.816 327.448,2.104 326.848,2.68 C326.248,3.256 325.948,3.952 325.948,4.768 L325.948,4.768 L325.948,13.12 C325.948,13.936 326.248,14.656 326.848,15.28 C327.448,15.904 328.204,16.216 329.116,16.216 L329.116,16.216 L340.636,16.216 L340.132,48.832 C340.132,49.744 340.408,50.5 340.96,51.1 C341.512,51.7 342.196,52 343.012,52 L343.012,52 L352.588,52 Z M402.052,52.792 C408.1,52.792 412.912,51.628 416.488,49.3 C420.064,46.972 422.536,44.068 423.904,40.588 C425.272,37.108 425.932,33.424 425.884,29.536 C425.884,29.5309474 425.883967,29.5237673 425.8839,29.5144598 L425.883102,29.4330859 C425.879911,29.1480111 425.868211,28.3183158 425.848,26.944 C425.8294,25.6792 425.818008,22.91524 425.813823,18.65212 L425.813103,17.80828 C425.812997,17.66452 425.8129,17.5192 425.81281,17.37232 L425.812,3.904 C425.86,3.184 425.632,2.62 425.128,2.212 C424.624,1.804 423.916,1.6 423.004,1.6 L423.004,1.6 L413.428,1.6 C412.612,1.6 411.904,1.828 411.304,2.284 C410.704,2.74 410.404,3.28 410.404,3.904 L410.404,3.904 L410.26,27.808 C410.26,34.144 407.476,37.312 401.908,37.312 C399.076,37.312 396.832,36.412 395.176,34.612 C393.52,32.812 392.668,30.352 392.62,27.232 L392.62,27.232 L392.332,3.76 C392.332,3.088 392.068,2.56 391.54,2.176 C391.012,1.792 390.268,1.6 389.308,1.6 L389.308,1.6 L379.876,1.6 C378.244,1.6 377.428,2.32 377.428,3.76 L377.428,3.76 L377.5,28.816 C377.5,33.04 378.376,36.964 380.128,40.588 C381.88,44.212 384.592,47.152 388.264,49.408 C391.936,51.664 396.532,52.792 402.052,52.792 Z M449.284,52.144 C450.148,52.144 450.88,51.844 451.48,51.244 C452.08,50.644 452.38,49.84 452.38,48.832 L452.38,48.832 L452.38,4.912 C452.38,4 452.08,3.22 451.48,2.572 C450.88,1.924 450.148,1.6 449.284,1.6 L449.284,1.6 L439.42,1.6 C438.46,1.6 437.692,1.924 437.116,2.572 C436.54,3.22 436.252,4 436.252,4.912 L436.252,4.912 L436.252,48.832 C436.252,49.84 436.54,50.644 437.116,51.244 C437.692,51.844 438.46,52.144 439.42,52.144 L439.42,52.144 L449.284,52.144 Z" id="metacatui" fill="#FCBF49" fill-rule="nonzero"></path>
    </g>
</svg>
</logo>

    </a>
    <h3>Externals</h3><ul><li><a href="external-TaxonomicClassification.html">TaxonomicClassification</a></li></ul><h3>Namespaces</h3><ul><li><a href="AppConfig.html">AppConfig</a></li><li><a href="EMLUtilities.html">EMLUtilities</a></li><li><a href="IconUtilities.html">IconUtilities</a></li><li><a href="MapConfig.html">MapConfig</a></li><li><a href="MetacatUI.html">MetacatUI</a></li><li><a href="SearchParams.html">SearchParams</a></li><li><a href="Utilities.html">Utilities</a></li><li><a href="XMLUtilities.html">XMLUtilities</a></li></ul><h3>Classes</h3><ul><li class='category-heading' data-category='Collections'>Collections</li><li><a href="AccessPolicy.html">AccessPolicy</a></li><li><a href="Citations.html">Citations</a></li><li><a href="DataPackage.html">DataPackage</a></li><li><a href="Filters.html">Filters</a></li><li><a href="ObjectFormats.html">ObjectFormats</a></li><li><a href="ProjectList.html">ProjectList</a></li><li><a href="QualityReport.html">QualityReport</a></li><li><a href="SolrResults.html">SolrResults</a></li><li><a href="Units.html">Units</a></li><li><a href="UserGroup.html">UserGroup</a></li><li class='category-heading' data-category='Collections/Bookkeeper'>Collections/Bookkeeper</li><li><a href="Quotas.html">Quotas</a></li><li><a href="Usages.html">Usages</a></li><li class='category-heading' data-category='Collections/Geohashes'>Collections/Geohashes</li><li><a href="Geohashes.html">Geohashes</a></li><li class='category-heading' data-category='Collections/Maps'>Collections/Maps</li><li><a href="AssetCategories.html">AssetCategories</a></li><li><a href="AssetColors.html">AssetColors</a></li><li><a href="Features.html">Features</a></li><li><a href="GeoPoints.html">GeoPoints</a></li><li><a href="MapAssets.html">MapAssets</a></li><li><a href="VectorFilters.html">VectorFilters</a></li><li><a href="ZoomPresets.html">ZoomPresets</a></li><li class='category-heading' data-category='Collections/Metadata/EML'>Collections/Metadata/EML</li><li><a href="EMLAnnotations.html">EMLAnnotations</a></li><li><a href="EMLAttributes.html">EMLAttributes</a></li><li><a href="EMLEntities.html">EMLEntities</a></li><li><a href="EMLMissingValueCodes.html">EMLMissingValueCodes</a></li><li class='category-heading' data-category='Collections/Ontologies'>Collections/Ontologies</li><li><a href="BioontologyResults.html">BioontologyResults</a></li><li class='category-heading' data-category='Collections/QueryFields'>Collections/QueryFields</li><li><a href="QueryFields.html">QueryFields</a></li><li class='category-heading' data-category='Collections/SearchSelect'>Collections/SearchSelect</li><li><a href="SearchSelectOptions.html">SearchSelectOptions</a></li><li class='category-heading' data-category='Common'>Common</li><li><a href="ResourceMapResolver.html">ResourceMapResolver</a></li><li class='category-heading' data-category='Errors'>Errors</li><li><a href="EmptyAttributeListError.html">EmptyAttributeListError</a></li><li><a href="InvalidAttributeListError.html">InvalidAttributeListError</a></li><li class='category-heading' data-category='Models'>Models</li><li><a href="AccessRule.html">AccessRule</a></li><li><a href="Accordion.html">Accordion</a></li><li><a href="AppModel.html">AppModel</a></li><li><a href="CitationModel.html">CitationModel</a></li><li><a href="CollectionModel.html">CollectionModel</a></li><li><a href="CrossRef.html">CrossRef</a></li><li><a href="DataONEObject.html">DataONEObject</a></li><li><a href="LookupModel.html">LookupModel</a></li><li><a href="Map.html">Map</a></li><li><a href="Metrics.html">Metrics</a></li><li><a href="PackageModel.html">PackageModel</a></li><li><a href="QualityCheck.html">QualityCheck</a></li><li><a href="Search.html">Search</a></li><li><a href="SolrResult.html">SolrResult</a></li><li><a href="Stats.html">Stats</a></li><li><a href="UserModel.html">UserModel</a></li><li class='category-heading' data-category='Models/Accordion'>Models/Accordion</li><li><a href="AccordionItem.html">AccordionItem</a></li><li class='category-heading' data-category='Models/Analytics'>Models/Analytics</li><li><a href="Analytics.html">Analytics</a></li><li><a href="GoogleAnalytics.html">GoogleAnalytics</a></li><li class='category-heading' data-category='Models/Bookkeeper'>Models/Bookkeeper</li><li><a href="Quota.html">Quota</a></li><li><a href="Subscription.html">Subscription</a></li><li><a href="Usage.html">Usage</a></li><li class='category-heading' data-category='Models/Connectors'>Models/Connectors</li><li><a href="BioontologyAccordionSearchSelect.html">BioontologyAccordionSearchSelect</a></li><li><a href="FiltersMapConnector.html">FiltersMapConnector</a></li><li><a href="FiltersSearchConnector.html">FiltersSearchConnector</a></li><li><a href="GeoPointsCesiumConnector.html">GeoPointsCesiumConnector</a></li><li><a href="GeoPointsCesiumPointsConnector.html">GeoPointsCesiumPointsConnector</a></li><li><a href="GeoPointsCesiumPolygonConnector.html">GeoPointsCesiumPolygonConnector</a></li><li><a href="MapSearchConnector.html">MapSearchConnector</a></li><li><a href="MapSearchFiltersConnector.html">MapSearchFiltersConnector</a></li><li class='category-heading' data-category='Models/Filters'>Models/Filters</li><li><a href="BooleanFilter.html">BooleanFilter</a></li><li><a href="ChoiceFilter.html">ChoiceFilter</a></li><li><a href="DateFilter.html">DateFilter</a></li><li><a href="Filter.html">Filter</a></li><li><a href="FilterGroup.html">FilterGroup</a></li><li><a href="NumericFilter.html">NumericFilter</a></li><li><a href="SpatialFilter.html">SpatialFilter</a></li><li><a href="ToggleFilter.html">ToggleFilter</a></li><li class='category-heading' data-category='Models/Formats'>Models/Formats</li><li><a href="ObjectFormat.html">ObjectFormat</a></li><li class='category-heading' data-category='Models/Geocoder'>Models/Geocoder</li><li><a href="GeocodedLocation.html">GeocodedLocation</a></li><li><a href="GeocoderSearch.html">GeocoderSearch</a></li><li><a href="GoogleMapsAutocompleter.html">GoogleMapsAutocompleter</a></li><li><a href="GoogleMapsGeocoder.html">GoogleMapsGeocoder</a></li><li><a href="Prediction.html">Prediction</a></li><li class='category-heading' data-category='Models/Geohashes'>Models/Geohashes</li><li><a href="Geohash.html">Geohash</a></li><li class='category-heading' data-category='Models/Maps'>Models/Maps</li><li><a href="AssetCategory.html">AssetCategory</a></li><li><a href="AssetColor.html">AssetColor</a></li><li><a href="AssetColorPalette.html">AssetColorPalette</a></li><li><a href="ExpansionPanelsModel.html">ExpansionPanelsModel</a></li><li><a href="Feature.html">Feature</a></li><li><a href="GeoBoundingBox.html">GeoBoundingBox</a></li><li><a href="GeoPoint.html">GeoPoint</a></li><li><a href="GeoScale.html">GeoScale</a></li><li><a href="GeoUtilities.html">GeoUtilities</a></li><li><a href="MapInteraction.html">MapInteraction</a></li><li><a href="MapModel.html">MapModel</a></li><li><a href="VectorFilter.html">VectorFilter</a></li><li><a href="ViewfinderModel.html">ViewfinderModel</a></li><li><a href="ZoomPresetModel.html">ZoomPresetModel</a></li><li class='category-heading' data-category='Models/Maps/Assets'>Models/Maps/Assets</li><li><a href="Cesium3DTileset.html">Cesium3DTileset</a></li><li><a href="CesiumGeohash.html">CesiumGeohash</a></li><li><a href="CesiumImagery.html">CesiumImagery</a></li><li><a href="CesiumTerrain.html">CesiumTerrain</a></li><li><a href="CesiumVectorData.html">CesiumVectorData</a></li><li><a href="MapAsset.html">MapAsset</a></li><li class='category-heading' data-category='Models/Metadata'>Models/Metadata</li><li><a href="ScienceMetadata.html">ScienceMetadata</a></li><li class='category-heading' data-category='Models/Metadata/EML'>Models/Metadata/EML</li><li><a href="EMLMethodStep.html">EMLMethodStep</a></li><li><a href="EMLSpecializedText.html">EMLSpecializedText</a></li><li><a href="EMLTaxonCoverage.html">EMLTaxonCoverage</a></li><li class='category-heading' data-category='Models/Metadata/EML211'>Models/Metadata/EML211</li><li><a href="EML211.html">EML211</a></li><li><a href="EMLAnnotation.html">EMLAnnotation</a></li><li><a href="EMLAttribute.html">EMLAttribute</a></li><li><a href="EMLAttributeList.html">EMLAttributeList</a></li><li><a href="EMLDataTable.html">EMLDataTable</a></li><li><a href="EMLDistribution.html">EMLDistribution</a></li><li><a href="EMLEntity.html">EMLEntity</a></li><li><a href="EMLGeoCoverage.html">EMLGeoCoverage</a></li><li><a href="EMLMeasurementScale.html">EMLMeasurementScale</a></li><li><a href="EMLMethods.html">EMLMethods</a></li><li><a href="EMLMissingValueCode.html">EMLMissingValueCode</a></li><li><a href="EMLNonNumericDomain.html">EMLNonNumericDomain</a></li><li><a href="EMLNumericDomain.html">EMLNumericDomain</a></li><li><a href="EMLOtherEntity.html">EMLOtherEntity</a></li><li><a href="EMLParty.html">EMLParty</a></li><li><a href="EMLReferences.html">EMLReferences</a></li><li><a href="EMLTemporalCoverage.html">EMLTemporalCoverage</a></li><li><a href="EMLText211.html">EMLText211</a></li><li><a href="EMLUnit.html">EMLUnit</a></li><li class='category-heading' data-category='Models/Metadata/EML220'>Models/Metadata/EML220</li><li><a href="EMLText.html">EMLText</a></li><li class='category-heading' data-category='Models/Ontologies'>Models/Ontologies</li><li><a href="BioOntology.html">BioOntology</a></li><li><a href="Bioontology_.html">Bioontology</a></li><li><a href="BioontologyBatch.html">BioontologyBatch</a></li><li><a href="BioontologyClass.html">BioontologyClass</a></li><li class='category-heading' data-category='Models/Portals'>Models/Portals</li><li><a href="PortalImage.html">PortalImage</a></li><li><a href="PortalModel.html">PortalModel</a></li><li><a href="PortalSectionModel.html">PortalSectionModel</a></li><li class='category-heading' data-category='Models/Projects'>Models/Projects</li><li><a href="Project.html">Project</a></li><li class='category-heading' data-category='Models/QueryFields'>Models/QueryFields</li><li><a href="QueryField.html">QueryField</a></li><li class='category-heading' data-category='Models/SearchSelect'>Models/SearchSelect</li><li><a href="AccountSearchSelect.html">AccountSearchSelect</a></li><li><a href="QueryFieldSearchSelect.html">QueryFieldSearchSelect</a></li><li><a href="SearchSelect.html">SearchSelect</a></li><li><a href="SelectOptionModel.html">SelectOptionModel</a></li><li><a href="SolrAutocomplete.html">SolrAutocomplete</a></li><li class='category-heading' data-category='Models/SysMeta'>Models/SysMeta</li><li><a href="VersionTracker.html">VersionTracker</a></li><li class='category-heading' data-category='Models/schemaOrg'>Models/schemaOrg</li><li><a href="SchemaOrgModel.html">SchemaOrgModel</a></li><li class='category-heading' data-category='Router'>Router</li><li><a href="UIRouter.html">UIRouter</a></li><li class='category-heading' data-category='Views'>Views</li><li><a href="AccessPolicyView.html">AccessPolicyView</a></li><li><a href="AccessRuleView.html">AccessRuleView</a></li><li><a href="AnnotationView.html">AnnotationView</a></li><li><a href="AppView.html">AppView</a></li><li><a href="CanonicalDatasetHandlerView.html">CanonicalDatasetHandlerView</a></li><li><a href="CatalogSearchView.html">CatalogSearchView</a></li><li><a href="CitationHeaderView.html">CitationHeaderView</a></li><li><a href="CitationListView.html">CitationListView</a></li><li><a href="CitationModalView.html">CitationModalView</a></li><li><a href="CitationView.html">CitationView</a></li><li><a href="ColorPaletteView.html">ColorPaletteView</a></li><li><a href="DataCatalogView.html">DataCatalogView</a></li><li><a href="DataCatalogViewWithFilters.html">DataCatalogViewWithFilters</a></li><li><a href="DataItemView.html">DataItemView</a></li><li><a href="DataObjectView.html">DataObjectView</a></li><li><a href="DataPackageView.html">DataPackageView</a></li><li><a href="DownloadButtonView.html">DownloadButtonView</a></li><li><a href="DraftsView.html">DraftsView</a></li><li><a href="EditCollectionView.html">EditCollectionView</a></li><li><a href="EditorView.html">EditorView</a></li><li><a href="FooterView.html">FooterView</a></li><li><a href="GroupListView.html">GroupListView</a></li><li><a href="ImageUploaderView.html">ImageUploaderView</a></li><li><a href="MarkdownEditorView.html">MarkdownEditorView</a></li><li><a href="MarkdownView.html">MarkdownView</a></li><li><a href="MdqRunView.html">MdqRunView</a></li><li><a href="MetadataView.html">MetadataView</a></li><li><a href="MetricModalView.html">MetricModalView</a></li><li><a href="MetricView.html">MetricView</a></li><li><a href="MetricsChartView.html">MetricsChartView</a></li><li><a href="NavbarView.html">NavbarView</a></li><li><a href="RegisterCitationView.html">RegisterCitationView</a></li><li><a href="SearchResultView.html">SearchResultView</a></li><li><a href="SignInView.html">SignInView</a></li><li><a href="TOCView.html">TOCView</a></li><li><a href="TableEditorView.html">TableEditorView</a></li><li><a href="UserGroupView.html">UserGroupView</a></li><li><a href="UserView.html">UserView</a></li><li><a href="ViewDataButtonView.html">ViewDataButtonView</a></li><li class='category-heading' data-category='Views/Accordion'>Views/Accordion</li><li><a href="AccordionItemView.html">AccordionItemView</a></li><li><a href="AccordionView.html">AccordionView</a></li><li class='category-heading' data-category='Views/Filters'>Views/Filters</li><li><a href="BooleanFilterView.html">BooleanFilterView</a></li><li><a href="ChoiceFilterView.html">ChoiceFilterView</a></li><li><a href="DateFilterView.html">DateFilterView</a></li><li><a href="FilterEditorView.html">FilterEditorView</a></li><li><a href="FilterGroupView.html">FilterGroupView</a></li><li><a href="FilterGroupsView.html">FilterGroupsView</a></li><li><a href="FilterView.html">FilterView</a></li><li><a href="NumericFilterView.html">NumericFilterView</a></li><li><a href="SemanticFilterView.html">SemanticFilterView</a></li><li><a href="ToggleFilterView.html">ToggleFilterView</a></li><li class='category-heading' data-category='Views/Maps'>Views/Maps</li><li><a href="CesiumWidgetView.html">CesiumWidgetView</a></li><li><a href="DownloadPanelView.html">DownloadPanelView</a></li><li><a href="FeatureInfoView.html">FeatureInfoView</a></li><li><a href="LayerCategoryListView.html">LayerCategoryListView</a></li><li><a href="LayerDetailView.html">LayerDetailView</a></li><li><a href="LayerDetailsView.html">LayerDetailsView</a></li><li><a href="LayerInfoView.html">LayerInfoView</a></li><li><a href="LayerItemView.html">LayerItemView</a></li><li><a href="LayerListView.html">LayerListView</a></li><li><a href="LayerNavigationView.html">LayerNavigationView</a></li><li><a href="LayerOpacityView.html">LayerOpacityView</a></li><li><a href="LayersPanelView.html">LayersPanelView</a></li><li><a href="MapHelpPanel.html">MapHelpPanel</a></li><li><a href="MapView.html">MapView</a></li><li><a href="MapWidgetContainerView.html">MapWidgetContainerView</a></li><li><a href="PredictionView.html">PredictionView</a></li><li><a href="PredictionsListView.html">PredictionsListView</a></li><li><a href="ScaleBarView.html">ScaleBarView</a></li><li><a href="SchemaOrgView.html">SchemaOrgView</a></li><li><a href="SearchInputView.html">SearchInputView</a></li><li><a href="SearchView.html">SearchView</a></li><li><a href="ShareUrlView.html">ShareUrlView</a></li><li><a href="ToolbarView.html">ToolbarView</a></li><li><a href="VectorFilterView.html">VectorFilterView</a></li><li><a href="ViewfinderView.html">ViewfinderView</a></li><li class='category-heading' data-category='Views/Maps/Legend'>Views/Maps/Legend</li><li><a href="CategoricalSwatchView.html">CategoricalSwatchView</a></li><li><a href="ContinuousSwatchView.html">ContinuousSwatchView</a></li><li><a href="LayerLegendView.html">LayerLegendView</a></li><li><a href="LegendContainerView.html">LegendContainerView</a></li><li class='category-heading' data-category='Views/Maps/Viewfinder'>Views/Maps/Viewfinder</li><li><a href="ExpansionPanelView.html">ExpansionPanelView</a></li><li><a href="ZoomPresetView.html">ZoomPresetView</a></li><li><a href="ZoomPresetsListView.html">ZoomPresetsListView</a></li><li class='category-heading' data-category='Views/Metadata'>Views/Metadata</li><li><a href="AutofillAttributesView.html">AutofillAttributesView</a></li><li><a href="EML211EditorView.html">EML211EditorView</a></li><li><a href="EMLAttributeView.html">EMLAttributeView</a></li><li><a href="EMLAttributesView.html">EMLAttributesView</a></li><li><a href="EMLEntityView.html">EMLEntityView</a></li><li><a href="EMLMeasurementScaleView.html">EMLMeasurementScaleView</a></li><li><a href="EMLMeasurementTypeView.html">EMLMeasurementTypeView</a></li><li><a href="EMLMethodsView.html">EMLMethodsView</a></li><li><a href="EMLMissingValueCodeView.html">EMLMissingValueCodeView</a></li><li><a href="EMLMissingValueCodesView.html">EMLMissingValueCodesView</a></li><li><a href="EMLOtherEntityView.html">EMLOtherEntityView</a></li><li><a href="EMLPartyView.html">EMLPartyView</a></li><li><a href="EMLTempCoverageView.html">EMLTempCoverageView</a></li><li><a href="EMLView.html">EMLView</a></li><li><a href="EMlGeoCoverageView_.html">EMlGeoCoverageView</a></li><li><a href="ScienceMetadataView.html">ScienceMetadataView</a></li><li class='category-heading' data-category='Views/Ontologies'>Views/Ontologies</li><li><a href="BioontologyBrowser.html">BioontologyBrowser</a></li><li class='category-heading' data-category='Views/Portals'>Views/Portals</li><li><a href="PortalDataView.html">PortalDataView</a></li><li><a href="PortalHeaderView.html">PortalHeaderView</a></li><li><a href="PortalListView.html">PortalListView</a></li><li><a href="PortalLogosView.html">PortalLogosView</a></li><li><a href="PortalMembersView.html">PortalMembersView</a></li><li><a href="PortalSectionView.html">PortalSectionView</a></li><li><a href="PortalUsagesView.html">PortalUsagesView</a></li><li><a href="PortalView.html">PortalView</a></li><li><a href="PortalVisualizationsView.html">PortalVisualizationsView</a></li><li><a href="PortalsSearchView.html">PortalsSearchView</a></li><li class='category-heading' data-category='Views/Portals/Editor'>Views/Portals/Editor</li><li><a href="PortEditorDataView.html">PortEditorDataView</a></li><li><a href="PortEditorImageView.html">PortEditorImageView</a></li><li><a href="PortEditorLogosView.html">PortEditorLogosView</a></li><li><a href="PortEditorMdSectionView.html">PortEditorMdSectionView</a></li><li><a href="PortEditorSectionView.html">PortEditorSectionView</a></li><li><a href="PortEditorSectionsView.html">PortEditorSectionsView</a></li><li><a href="PortEditorSettingsView.html">PortEditorSettingsView</a></li><li><a href="PortalEditorView.html">PortalEditorView</a></li><li class='category-heading' data-category='Views/Projects'>Views/Projects</li><li><a href="ProjectView.html">ProjectView</a></li><li class='category-heading' data-category='Views/QueryBuilder'>Views/QueryBuilder</li><li><a href="QueryBuilderView.html">QueryBuilderView</a></li><li><a href="QueryRuleView.html">QueryRuleView</a></li><li class='category-heading' data-category='Views/Search'>Views/Search</li><li><a href="SearchResultsPagerView.html">SearchResultsPagerView</a></li><li><a href="SearchResultsView.html">SearchResultsView</a></li><li><a href="SorterView.html">SorterView</a></li><li class='category-heading' data-category='Views/SearchSelect'>Views/SearchSelect</li><li><a href="AccountSelectView.html">AccountSelectView</a></li><li><a href="AnnotationFilter.html">AnnotationFilter</a></li><li><a href="BioontologySelectView.html">BioontologySelectView</a></li><li><a href="NodeSelect.html">NodeSelect</a></li><li><a href="ObjectFormatSelect.html">ObjectFormatSelect</a></li><li><a href="QueryFieldSelectView.html">QueryFieldSelectView</a></li><li><a href="SearchSelectView.html">SearchSelectView</a></li><li><a href="SeparatorView.html">SeparatorView</a></li><li class='category-heading' data-category='Views/UIElements'>Views/UIElements</li><li><a href="ToggleView.html">ToggleView</a></li><li><a href="EMLTaxonView.html">EMLTaxonView</a></li><li><a href="EventLog.html">EventLog</a></li><li><a href="SystemMetadata.html">SystemMetadata</a></li><li class='category-heading' data-category='Deprecated'>Deprecated</li><li><a href="AnnotatorView.html">AnnotatorView</a></li><li><a href="ExternalView.html">ExternalView</a></li><li><a href="LogsSearch.html">LogsSearch</a></li></ul><h3>Global</h3><ul><li><a href="global.html#addClassesFromResponse">addClassesFromResponse</a></li><li><a href="global.html#addFields">addFields</a></li><li><a href="global.html#addSelected">addSelected</a></li><li><a href="global.html#adjustDescriptionLength">adjustDescriptionLength</a></li><li><a href="global.html#appConfigPath">appConfigPath</a></li><li><a href="global.html#buildChildrenUrl">buildChildrenUrl</a></li><li><a href="global.html#buildSearchUrl">buildSearchUrl</a></li><li><a href="global.html#canChangeSeparator">canChangeSeparator</a></li><li><a href="global.html#changeSubmenuOnSearch">changeSubmenuOnSearch</a></li><li><a href="global.html#couldBeLatLong">couldBeLatLong</a></li><li><a href="global.html#createBatchPayload">createBatchPayload</a></li><li><a href="global.html#createHeaders">createHeaders</a></li><li><a href="global.html#defaults">defaults</a></li><li><a href="global.html#encodeIfPresent">encodeIfPresent</a></li><li><a href="global.html#excludeFields">excludeFields</a></li><li><a href="global.html#fetchClasses">fetchClasses</a></li><li><a href="global.html#fetchClassesFromOntology">fetchClassesFromOntology</a></li><li><a href="global.html#fetchFromOntologies">fetchFromOntologies</a></li><li><a href="global.html#fetchQueryFields">fetchQueryFields</a></li><li><a href="global.html#fieldToOption">fieldToOption</a></li><li><a href="global.html#filterClassesToFetch">filterClassesToFetch</a></li><li><a href="global.html#finalizeFetch">finalizeFetch</a></li><li><a href="global.html#formatResult">formatResult</a></li><li><a href="global.html#formatResults">formatResults</a></li><li><a href="global.html#generateGeoJSONPoint">generateGeoJSONPoint</a></li><li><a href="global.html#generateGeoJSONPolygon">generateGeoJSONPolygon</a></li><li><a href="global.html#generateGeoJSONString">generateGeoJSONString</a></li><li><a href="global.html#generateIdentifier">generateIdentifier</a></li><li><a href="global.html#generateSpatialCoverage">generateSpatialCoverage</a></li><li><a href="global.html#getAccountDetails">getAccountDetails</a></li><li><a href="global.html#getCachedClasses">getCachedClasses</a></li><li><a href="global.html#getCategoryNames">getCategoryNames</a></li><li><a href="global.html#getChildren">getChildren</a></li><li><a href="global.html#getClasses">getClasses</a></li><li><a href="global.html#getDOIURL">getDOIURL</a></li><li><a href="global.html#getIncludeParam">getIncludeParam</a></li><li><a href="global.html#getNextPage">getNextPage</a></li><li><a href="global.html#getNextSeparator">getNextSeparator</a></li><li><a href="global.html#getOptionByLabelOrValue">getOptionByLabelOrValue</a></li><li><a href="global.html#getOptionsByCategory">getOptionsByCategory</a></li><li><a href="global.html#getQueryFieldOptions">getQueryFieldOptions</a></li><li><a href="global.html#getSelectedModels">getSelectedModels</a></li><li><a href="global.html#hasInvalidSelections">hasInvalidSelections</a></li><li><a href="global.html#initialize">initialize</a></li><li><a href="global.html#initializeFetch">initializeFetch</a></li><li><a href="global.html#isValidValue">isValidValue</a></li><li><a href="global.html#model">model</a></li><li><a href="global.html#moveClassesToNotFound">moveClassesToNotFound</a></li><li><a href="global.html#optionsAsJSON">optionsAsJSON</a></li><li><a href="global.html#padDescription">padDescription</a></li><li><a href="global.html#parse">parse</a></li><li><a href="global.html#recordError">recordError</a></li><li><a href="global.html#removeSelected">removeSelected</a></li><li><a href="global.html#renameCategory">renameCategory</a></li><li><a href="global.html#reset">reset</a></li><li><a href="global.html#resetPageInfo">resetPageInfo</a></li><li><a href="global.html#responseAsync">responseAsync</a></li><li><a href="global.html#restoreTypes">restoreTypes</a></li><li><a href="global.html#separatorRequired">separatorRequired</a></li><li><a href="global.html#serialize">serialize</a></li><li><a href="global.html#setAddedFieldDetails">setAddedFieldDetails</a></li><li><a href="global.html#setDataCatalogSchema">setDataCatalogSchema</a></li><li><a href="global.html#setDatasetSchema">setDatasetSchema</a></li><li><a href="global.html#setNextSeparator">setNextSeparator</a></li><li><a href="global.html#setOptionsForPreselected">setOptionsForPreselected</a></li><li><a href="global.html#setSchema">setSchema</a></li><li><a href="global.html#setSchemaFromTemplate">setSchemaFromTemplate</a></li><li><a href="global.html#setSelected">setSelected</a></li><li><a href="global.html#sortByProp">sortByProp</a></li><li><a href="global.html#sortFields">sortFields</a></li><li><a href="global.html#toAccordionItem">toAccordionItem</a></li><li><a href="global.html#toJSON">toJSON</a></li><li><a href="global.html#toSearchSelectOption">toSearchSelectOption</a></li><li><a href="global.html#truncateDescription">truncateDescription</a></li><li><a href="global.html#updateOptions">updateOptions</a></li><li><a href="global.html#url">url</a></li><li><a href="global.html#waitForFetchComplete">waitForFetchComplete</a></li></ul>
</nav>

<div id="main">

    <h1 class="page-title">Source: src/js/views/DataItemView.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>define([
  "underscore",
  "jquery",
  "backbone",
  "models/DataONEObject",
  "models/metadata/eml211/EML211",
  "views/DownloadButtonView",
  "text!templates/dataItem.html",
  "text!templates/dataItemHierarchy.html",
], (
  _,
  $,
  Backbone,
  DataONEObject,
  EML,
  DownloadButtonView,
  DataItemTemplate,
  DataItemHierarchy,
) => {
  /**
   * @class DataItemView
   * @classdesc A DataItemView represents a single data item in a data package
   * as a single row of a nested table.  An item may represent a metadata object
   * (as a folder), or a data object described by the metadata (as a file).
   * Every metadata DataItemView has a resource map associated with it that
   * describes the relationships between the aggregated metadata and data
   * objects.
   * @classcategory Views
   * @class
   * @screenshot views/DataItemView.png
   */
  const DataItemView = Backbone.View.extend(
    /** @lends DataItemView.prototype */ {
      tagName: "tr",

      className: "data-package-item",

      id: null,

      /** The HTML template for a data item */
      template: _.template(DataItemTemplate),

      /** The HTML template for a data item */
      dataItemHierarchyTemplate: _.template(DataItemHierarchy),

      /**
       * The HTML template for a data item
       * @type {Underscore.template}
       */
      metricTemplate: _.template(
        "&lt;span class='packageTable-resultItem badge '>" +
          "&lt;i class='catalog-metric-icon &lt;%= metricIcon %>'>" +
          "&lt;/i> &lt;%= memberRowMetrics %> " +
          "&lt;/span>",
      ),

      /**
       * The DataONEObject model to display in this view
       * @type {DataONEObject}
       */
      model: null,

      /**
       * A reference to the parent EditorView that contains this DataItemView
       * @type {EditorView}
       * @since 2.15.0
       */
      parentEditorView: null,

      /** Events this view listens to */
      events: {
        "focusout .name.canRename": "updateName",
        "click    .name.canRename": "emptyName",
        "click .duplicate": "duplicate", // Edit dropdown, duplicate scimeta/rdf
        "click .addFolder": "handleAddFolder", // Edit dropdown, add nested scimeta/rdf
        "click .addFiles": "handleAddFiles", // Edit dropdown, open file picker dialog
        "change .file-upload": "addFiles", // Adds the files into the collection
        "change .file-replace": "replaceFile", // Replace a file in the collection
        dragover: "showDropzone", // Drag &amp; drop, show the dropzone for this row
        dragend: "hideDropzone", // Drag &amp; drop, hide the dropzone for this row
        dragleave: "hideDropzone", // Drag &amp; drop, hide the dropzone for this row
        drop: "addFiles", // Drag &amp; drop, adds the files into the collection
        "click .replaceFile": "handleReplace", // Replace dropdown, data in collection
        "click .removeFiles": "handleRemove", // Edit dropdown, remove sci{data,meta} from collection
        "click .cancel": "handleCancel", // Cancel a file load
        "change: percentLoaded": "updateLoadProgress", // Update the file read progress bar
        "mouseover .remove": "previewRemove",
        "mouseout  .remove": "previewRemove",
        "change .public": "changeAccessPolicy",
        "click .downloadAction": "downloadFile",
      },

      /** @inheritdoc */
      initialize(options = {}) {
        this.model = options.model || new DataONEObject();
        this.currentlyViewing = options.currentlyViewing || null;
        this.mode = options.mode || "edit";
        this.itemName = options.itemName || null;
        this.itemPath = options.itemPath || null;
        this.itemType = options.itemType || "file";
        this.insertInfoIcon = options.insertInfoIcon || false;
        this.id = this.model.get("id");
        this.canWrite = false; // Default. Updated in render()
        this.canShare = false; // Default. Updated in render()
        this.parentEditorView = options.parentEditorView || null;
        this.dataPackageId = options.dataPackageId || null;

        if (options.metricsModel) {
          this.metricsModel = options.metricsModel;
        }
      },

      /** @inheritdoc */
      render() {
        // Prevent duplicate listeners
        this.stopListening();

        let itemPathParts = [];

        if (this.itemType === "folder") {
          // Set the data-id for identifying events to model ids
          this.$el.attr(
            "data-id",
            `${this.itemPath ? this.itemPath : ""}/${this.itemName}`,
          );
          this.$el.attr("data-parent", this.itemPath ? this.itemPath : "");
          this.$el.attr("data-category", `entities-${this.itemName}`);

          const attributes = {};
          attributes.fileType = null;
          attributes.isFolder = true;
          attributes.icon = "icon-folder-open";
          attributes.id = this.itemName;
          attributes.size = null;
          attributes.insertInfoIcon = false;
          attributes.memberRowMetrics = null;
          attributes.isMetadata = false;
          attributes.downloadUrl = null;
          attributes.moreInfoLink = null;
          // attributes.isMetadata = false;
          attributes.viewType = this.mode;
          attributes.objectTitle = this.itemName;

          if (this.itemPath) {
            itemPathParts = this.itemPath.split("/");
            attributes.nodeLevel = itemPathParts.length;
            if (this.itemPath.startsWith("/")) {
              attributes.nodeLevel -= 1;
            }
            if (this.itemPath.endsWith("/")) {
              attributes.nodeLevel -= 1;
            }
            if (itemPathParts[-1] === attributes.objectTitle) {
              attributes.nodeLevel -= 1;
            }
          } else {
            attributes.nodeLevel = 0;
            this.itemPath = "/";
            this.$el.attr("data-packageId", this.dataPackageId);
          }
          this.$el.html(this.dataItemHierarchyTemplate(attributes));
        } else {
          // Set the data-id for identifying events to model ids
          this.$el.attr("data-id", this.model.get("id"));
          this.$el.attr("data-category", `entities-${this.model.get("id")}`);

          // Destroy the old tooltip
          this.$(".status .icon, .status .progress")
            .tooltip("hide")
            .tooltip("destroy");

          const attributes = this.model.toJSON();

          // check if this data item is a metadata object
          attributes.isMetadata = false;
          if (
            this.model.get("type") === "Metadata" ||
            this.model.get("formatType") === "METADATA"
          ) {
            attributes.isMetadata = true;
          }

          // Format the title
          if (Array.isArray(attributes.title)) {
            [attributes.title] = attributes.title;
          }

          // Set some defaults
          attributes.numAttributes = 0;
          attributes.entityIsValid = true;
          attributes.hasInvalidAttribute = false;
          attributes.viewType = this.mode;

          if (this.mode === "edit") {
            // Restrict item replacement and renaming depending on access policy
            //
            // Note: .canWrite is set here (at render) instead of at init
            // because render will get called a few times during page load
            // as the app updates what it knows about the object
            const accessPolicy = this.model.get("accessPolicy");
            if (accessPolicy) {
              attributes.canWrite = accessPolicy.isAuthorized("write");
              this.canWrite = attributes.canWrite;
              attributes.canRename = accessPolicy.isAuthorizedUpdateSysMeta();
            } else {
              attributes.canWrite = false;
              this.canWrite = false;
              attributes.canRename = false;
            }

            // Restrict item sharing depending on access
            this.canShare = this.canShareItem();
            attributes.canShare = this.canShare;

            // Get the number of attributes for this item
            if (this.model.type !== "EML") {
              let { parentEML } = this;
              // Get the parent EML model
              if (!this.parentEML) {
                parentEML = MetacatUI.rootDataPackage.where({
                  id: Array.isArray(this.model.get("isDocumentedBy"))
                    ? this.model.get("isDocumentedBy")[0]
                    : null,
                });
              }

              if (Array.isArray(parentEML)) [parentEML] = parentEML;

              // If we found a parent EML model
              if (parentEML &amp;&amp; parentEML.type === "EML") {
                this.parentEML = parentEML;

                // Find the EMLEntity model for this data item
                const entity =
                  this.model.get("metadataEntity") ||
                  parentEML.getEntity(this.model);

                // If we found an EMLEntity model
                if (entity) {
                  this.entity = entity;

                  // Get the file name from the metadata if it is not in the model
                  if (!this.model.get("fileName")) {
                    let fileName = "";

                    if (entity.get("physicalObjectName"))
                      fileName = entity.get("physicalObjectName");
                    else if (entity.get("entityName"))
                      fileName = entity.get("entityName");

                    if (fileName) attributes.fileName = fileName;
                    this.model.set("fileName", fileName);
                  }

                  // Get the number of attributes for this entity
                  const attrList = entity.get("attributeList");
                  attributes.numAttributes = attrList.hasNonEmptyAttributes()
                    ? entity.get("attributeList").get("emlAttributes").length
                    : 0;
                  // Determine if the entity model is valid
                  attributes.entityIsValid = entity.isValid();

                  // Listen to changes to certain attributes of this EMLEntity model
                  // to re-render this view
                  this.stopListening(entity);
                  this.listenTo(
                    entity,
                    "change:entityType, change:entityName",
                    this.render,
                  );

                  // Check if there are any invalid attribute models
                  // Also listen to each attribute model
                  entity
                    .get("attributeList")
                    .get("emlAttributes")
                    .each((attr) => {
                      const isValid = attr.isValid();

                      // Mark that this entity has at least one invalid attribute
                      if (!attributes.hasInvalidAttribute &amp;&amp; !isValid)
                        attributes.hasInvalidAttribute = true;

                      this.stopListening(attr);

                      // Listen to when the validation status changes and rerender
                      if (isValid) this.listenTo(attr, "invalid", this.render);
                      else this.listenTo(attr, "valid", this.render);
                    }, this);

                  // If there are no attributes now, rerender when one is added
                  this.stopListening(
                    entity,
                    "change:attributeList",
                    this.render,
                  );
                  this.listenTo(entity, "change:attributeList", this.render);
                  this.stopListening(
                    entity.get("attributeList"),
                    "change update",
                    this.render,
                  );
                  this.listenTo(
                    entity.get("attributeList"),
                    "change update",
                    this.render,
                  );
                } else {
                  // Rerender when an entity is added
                  this.stopListening(
                    this.model,
                    "change:entities",
                    this.render,
                  );
                  this.listenTo(this.model, "change:entities", this.render);
                }
              } else {
                // When the package is complete, rerender
                this.listenTo(
                  MetacatUI.rootDataPackage,
                  "add:EML",
                  this.render,
                );
              }
            }

            this.$el.html(this.template(attributes));

            // Initialize dropdowns
            this.$el.find(".dropdown-toggle").dropdown();

            // Render the Share button
            this.renderShareControl();

            if (this.model.get("type") === "Metadata") {
              // Add the title data-attribute attribute to the name cell
              this.$el.find(".name").attr("data-attribute", "title");
              this.$el.addClass("folder");
            } else {
              this.$el.addClass("data");
            }

            // Add tooltip to a disabled Replace link
            $(this.$el)
              .find(".replace.disabled")
              .tooltip({
                title:
                  "You don't have sufficient privileges to replace this item.",
                placement: "left",
                trigger: "hover",
                delay: { show: 400 },
                container: "body",
              });

            // Check if the data package is in progress of being uploaded
            this.toggleSaving();

            // Create tooltips based on the upload status
            const uploadStatus = this.model.get("uploadStatus");
            let errorMessage = this.model.get("errorMessage");

            // Use a friendlier message for 401 errors (the one returned is a little hard to understand)
            if (this.model.get("sysMetaErrorCode") === 401) {
              // If the user at least has write permission, they cannot update the system metadata only, so show this message
              /** @todo Do an object update when someone has write permission but not changePermission and is trying to change the system metadata (but not the access policy)  */
              if (accessPolicy &amp;&amp; accessPolicy.isAuthorized("write")) {
                errorMessage = `The owner of this data file has not given you permission to rename it or change the ${MetacatUI.appModel.get(
                  "accessPolicyName",
                )}.`;
                // Otherwise, assume they only have read access
              } else {
                errorMessage = `The owner of this data file has not given you permission to edit this data file or change the ${MetacatUI.appModel.get(
                  "accessPolicyName",
                )}.`;
              }
            }

            // When there's an error or a warninig
            if (uploadStatus === "e" &amp;&amp; errorMessage) {
              const tooltipClass = uploadStatus === "e" ? "error" : "";

              this.$(".status .icon").tooltip({
                placement: "top",
                trigger: "hover",
                html: true,
                title: `&lt;div class='status-tooltip ${tooltipClass}'>&lt;h6>Issue saving:&lt;/h6>&lt;div>${errorMessage}&lt;/div>&lt;/div>`,
                container: "body",
              });

              this.$el.removeClass("loading");
            } else if (
              (!uploadStatus || uploadStatus === "c" || uploadStatus === "q") &amp;&amp;
              !attributes.numAttributes
            ) {
              this.$(".status .icon").tooltip({
                placement: "top",
                trigger: "hover",
                html: true,
                title:
                  "&lt;div class='status-tooltip'>This file needs to be described - Click 'Describe'&lt;/div>",
                container: "body",
              });

              this.$el.removeClass("loading");
            } else if (
              attributes.hasInvalidAttribute ||
              !attributes.entityIsValid
            ) {
              this.$(".status .icon").tooltip({
                placement: "top",
                trigger: "hover",
                html: true,
                title:
                  "&lt;div class='status-tooltip'>There is missing information about this file. Click 'Describe'&lt;/div>",
                container: "body",
              });

              this.$el.removeClass("loading");
            } else if (uploadStatus === "c") {
              this.$(".status .icon").tooltip({
                placement: "top",
                trigger: "hover",
                html: true,
                title: "&lt;div class='status-tooltip'>Complete&lt;/div>",
                container: "body",
              });

              this.$el.removeClass("loading");
            } else if (uploadStatus === "l") {
              this.$(".status .icon").tooltip({
                placement: "top",
                trigger: "hover",
                html: true,
                title: "&lt;div class='status-tooltip'>Reading file...&lt;/div>",
                container: "body",
              });

              this.$el.addClass("loading");
            } else if (uploadStatus === "p") {
              const { model } = this;

              this.$(".status .progress").tooltip({
                placement: "top",
                trigger: "hover",
                html: true,
                title() {
                  if (model.get("numSaveAttempts") > 0) {
                    return `&lt;div class='status-tooltip'>Something went wrong during upload. &lt;br/> Trying again... (attempt ${
                      model.get("numSaveAttempts") + 1
                    } of 3)&lt;/div>`;
                  }
                  let percentDone = "0";
                  if (model.get("uploadProgress")) {
                    percentDone = model.get("uploadProgress").toString();
                    if (percentDone.indexOf(".") > -1)
                      percentDone = percentDone.substring(
                        0,
                        percentDone.indexOf("."),
                      );
                  }

                  return `&lt;div class='status-tooltip'>Uploading: ${percentDone}%&lt;/div>`;
                },
                container: "body",
              });

              this.$el.addClass("loading");
            } else {
              this.$el.removeClass("loading");
            }

            // Listen to changes to the upload progress of this object
            this.listenTo(
              this.model,
              "change:uploadProgress",
              this.showUploadProgress,
            );

            // Listen to changes to the upload status of the entire package
            this.listenTo(
              MetacatUI.rootDataPackage.packageModel,
              "change:uploadStatus",
              this.toggleSaving,
            );

            // listen for changes to rerender the view
            this.listenTo(
              this.model,
              "change:fileName change:title change:id change:formatType " +
                "change:formatId change:type change:resourceMap change:documents change:isDocumentedBy " +
                "change:size change:nodeLevel change:uploadStatus change:errorMessage",
              this.render,
            ); // render changes to the item

            const view = this;
            this.listenTo(this.model, "replace", (newModel) => {
              view.model = newModel;
              view.render();
            });
          } else {
            this.isMetadata = false;
            // format metadata object title
            if (
              attributes.isMetadata ||
              this.model.getFormat() === "metadata" ||
              this.model.get("id") === this.currentlyViewing
            ) {
              attributes.title = `Metadata: ${this.model.get("fileName")}`;
              attributes.icon = "icon-file-text";
              attributes.metricIcon = "icon-eye-open";
              this.isMetadata = true;
              this.$el.attr("data-packageId", this.dataPackageId);
            }

            const objectTitleTooltip =
              attributes.title || attributes.fileName || attributes.id;
            attributes.objectTitle =
              objectTitleTooltip.length > 150
                ? `${objectTitleTooltip.slice(
                    0,
                    75,
                  )}...${objectTitleTooltip.slice(
                    objectTitleTooltip.length - 75,
                    objectTitleTooltip.length,
                  )}`
                : objectTitleTooltip;

            attributes.fileType = this.model.getFormat();
            attributes.isFolder = false;
            // Determine the icon type based on format type
            if (this.model.getFormat() === "program")
              attributes.icon = "icon-code";
            else if (this.model.getFormat() === "data")
              attributes.icon = "icon-table";
            else if (this.model.getFormat() === "image/jpeg")
              attributes.icon = "icon-picture";
            else if (this.model.getFormat() === "PDF")
              attributes.icon = "icon-file";
            else attributes.icon = "icon-table";

            attributes.id = this.model.get("id");
            attributes.memberRowMetrics = null;
            let metricToolTip = null;
            const view = this;

            // Insert metrics for this item,
            // if the model has already been fethced.
            if (this.metricsModel?.get("views")) {
              metricToolTip = this.getMemberRowMetrics(view.id);
              attributes.memberRowMetrics =
                typeof metricToolTip === "string"
                  ? metricToolTip.split(" ")[0]
                  : "";
            } else {
              // Update the metrics later on
              // If the fetch() is still in progress.
              this.listenTo(this.metricsModel, "sync", () => {
                metricToolTip = this.getMemberRowMetrics(view.id);
                const readsCell = this.$(
                  `.metrics-count.downloads[data-id="${view.id}"]`,
                );
                metricToolTip = view.getMemberRowMetrics(view.id);
                if (metricToolTip)
                  readsCell.html(
                    this.metricTemplate({
                      metricIcon: attributes.metricIcon,
                      memberRowMetrics: metricToolTip.split(" ")[0],
                    }),
                  );
              });
            }

            // add nodeLevel for displaying indented filename
            attributes.nodeLevel = 1;
            if (
              !(
                attributes.isMetadata ||
                this.model.getFormat() === "metadata" ||
                this.model.get("id") === this.currentlyViewing
              )
            ) {
              attributes.metricIcon = "icon-cloud-download";

              this.$el.addClass();
              if (this.itemPath &amp;&amp; this.itemPath !== "/") {
                itemPathParts = this.itemPath.split("/");

                attributes.nodeLevel = itemPathParts.length;

                if (this.itemPath.startsWith("/")) {
                  attributes.nodeLevel -= 1;
                }
                if (this.itemPath.endsWith("/")) {
                  attributes.nodeLevel -= 1;
                }

                const parentPath = itemPathParts.slice(0, -1).join("/");

                if (parentPath) {
                  this.$el.attr("data-parent", parentPath);
                }
              } else {
                attributes.nodeLevel = 1;
                this.$el.attr("data-packageId", this.dataPackageId);
              }
            }

            if (attributes.nodeLevel === 1) {
              this.$el.attr("data-packageId", this.dataPackageId);
            }

            // Download button
            this.downloadButtonView = new DownloadButtonView({
              model: this.model,
              view: "actionsView",
            });
            this.downloadButtonView.render();

            const id = this.model.get("id");
            const infoLink = `${MetacatUI.root}/view/${encodeURIComponent(
              this.currentlyViewing,
            )}#${encodeURIComponent(id)}`;
            attributes.moreInfoLink = infoLink;

            attributes.insertInfoIcon = this.insertInfoIcon;

            this.$el.html(this.dataItemHierarchyTemplate(attributes));

            this.$(".downloadAction").html(this.downloadButtonView.el);

            // add tooltip for metrics in package table
            this.$(".packageTable-resultItem").tooltip({
              placement: "top",
              trigger: "hover",
              delay: 300,
              title: metricToolTip,
            });

            this.$(".fileTitle")
              .addClass("tooltip-this")
              .attr("data-placement", "top")
              .attr("data-trigger", "hover")
              .attr("data-delay", "300")
              .attr("data-title", objectTitleTooltip);
          }
        }

        this.$el.data({
          view: this,
          model: this.model,
        });

        if (this.model.get("errorMessage")) {
          this.showError(this.model.get("errorMessage"));
        }

        return this;
      },

      /**
       * Renders a button that opens the AccessPolicyView for editing
       * permissions on this data item
       * @since 2.15.0
       */
      renderShareControl() {
        // Get the Share button element
        const shareButton = this.$(".sharing button");

        if (
          this.parentEditorView &amp;&amp;
          this.parentEditorView.isAccessPolicyEditEnabled()
        ) {
          // Start a title for the button tooltip
          let sharebuttonTitle;

          // If the user is not authorized to change the permissions of
          // this object, then disable the share button
          if (this.canShare) {
            shareButton.removeClass("disabled");
            sharebuttonTitle = "Share this item with others";
          } else {
            shareButton.addClass("disabled");
            sharebuttonTitle = "You are not authorized to share this item.";
          }

          // Set up tooltips for share button
          shareButton.tooltip({
            title: sharebuttonTitle,
            placement: "top",
            container: this.el,
            trigger: "hover",
            delay: { show: 400 },
          });
        } else {
          shareButton.remove();
        }
      },

      /** Close the view and remove it from the DOM */
      onClose() {
        this.remove(); // remove for the DOM, stop listening
        this.off(); // remove callbacks, prevent zombies
      },

      /**
       * Generate a unique id for each data item in the table TODO: This could
       * be replaced with the DataONE identifier
       * @returns {string} A unique identifier string for the data item
       */
      generateId() {
        let idStr = ""; // the id to return
        const length = 30; // the length of the generated string
        const chars =
          "0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz".split(
            "",
          );

        for (let i = 0; i &lt; length; i += 1) {
          idStr += chars[Math.floor(Math.random() * chars.length)];
        }

        return idStr;
      },

      /**
       * Update the folder name based on the scimeta title
       * @param {Event} e The event that triggered this method
       */
      updateName(e) {
        const enteredText = this.cleanInput($(e.target).text().trim());

        // Set the title if this item is metadata or set the file name
        // if its not
        if (this.model.get("type") === "Metadata") {
          const title = this.model.get("title");

          // Get the current title which is either an array of titles
          // or a single string. When it's an array of strings, we
          // use the first as the canonical title
          const currentTitle = Array.isArray(title) ? title[0] : title;

          // Don't set the title if it hasn't changed or is empty
          if (
            enteredText !== "" &amp;&amp;
            currentTitle !== enteredText &amp;&amp;
            enteredText !== "Untitled dataset"
          ) {
            // Set the new title, upgrading any title attributes
            // that aren't Arrays into Arrays
            if (
              (Array.isArray(title) &amp;&amp; title.length &lt; 2) ||
              typeof title === "string"
            ) {
              this.model.set("title", [enteredText]);
            } else {
              title[0] = enteredText;
            }
          }
        } else {
          this.model.set("fileName", enteredText);

          // Reset sysMetaUploadStatus only if this item doesn't
          // have content changes. This is here because replaceFile
          // sets sysMetaUploadStatus to "c" to prevent the editor
          // from updating sysmeta after the update call
          if (!this.model.get("hasContentChanges")) {
            this.model.set("sysMetaUploadStatus", null);
          }
        }
      },

      /**
       * Handle the add file event, showing the file picker dialog. Multiple
       * files are allowed using the shift and or option/alt key.
       * @param {Event} event - The event that triggered the file picker dialog.
       */
      handleAddFiles(event) {
        event.stopPropagation();
        const fileUploadElement = this.$(".file-upload");

        fileUploadElement.val("");

        if (fileUploadElement) {
          fileUploadElement.click();
        }
        event.preventDefault();
      },

      /**
       * Method to handle batch file uploads. This method processes files
       * independently to avoid being slowed down by large files.
       * @param {FileList} fileList - The list of files to be uploaded.
       * @param {number} [batchSize] - The number of files to upload
       * concurrently.
       * @since 2.32.0
       */
      uploadFilesInBatch(fileList, batchSize = 10) {
        let currentIndex = 0; // Index of the current file being processed
        let activeUploads = 0; // Counter for the number of active uploads

        // If batchSize is 0, set it to the total number of files
        // TODO, use MetacatUI.appModel.get("batchSizeUpload"); ?
        let effectiveBatchSize = batchSize;
        if (!effectiveBatchSize) effectiveBatchSize = fileList.length;

        /**
         * Function to upload the next file in the list. This function is called
         * recursively to ensure that the number of concurrent uploads does not
         * exceed the batch size.
         */
        function uploadNextFile() {
          // If all files have been processed, return
          if (currentIndex >= fileList.length) {
            return;
          }

          // If the number of active uploads is less than the batch size, start a new upload
          if (activeUploads &lt; effectiveBatchSize) {
            const dataONEObject = fileList[currentIndex];
            currentIndex += 1; // Move to the next file
            activeUploads += 1; // Increment the active uploads counter

            // Create a new Promise to handle the file upload
            new Promise((resolve, reject) => {
              // If the file needs to be uploaded and its checksum is not calculated
              if (
                dataONEObject.get("uploadFile") &amp;&amp;
                !dataONEObject.get("checksum")
              ) {
                // Stop listening to previous checksumCalculated events
                dataONEObject.stopListening(
                  dataONEObject,
                  "checksumCalculated",
                );
                // Listen to the checksumCalculated event to start the upload
                dataONEObject.listenToOnce(
                  dataONEObject,
                  "checksumCalculated",
                  () => {
                    dataONEObject.save(); // Save the file
                    // Listen to changes in the uploadStatus to resolve the Promise
                    dataONEObject.listenTo(
                      dataONEObject,
                      "change:uploadStatus",
                      () => {
                        if (
                          dataONEObject.get("uploadStatus") !== "p" &amp;&amp;
                          dataONEObject.get("uploadStatus") !== "q" &amp;&amp;
                          dataONEObject.get("uploadStatus") !== "l"
                        ) {
                          resolve(); // Resolve the Promise when the upload is complete
                        }
                      },
                    );
                  },
                );
                try {
                  dataONEObject.calculateChecksum(); // Calculate the checksum
                } catch (exception) {
                  reject(exception); // Reject the Promise if an error occurs
                }
              } else {
                resolve(); // Resolve the Promise if the file does not need to be uploaded
              }
            })
              .then(() => {
                activeUploads -= 1; // Decrement the active uploads counter
                uploadNextFile(); // Start the next file upload
              })
              .catch((_e) => {
                activeUploads -= 1; // Decrement the active uploads counter
                uploadNextFile(); // Start the next file upload
              });

            uploadNextFile(); // Start the next file upload
          }
        }

        // Start the initial batch of uploads
        for (let i = 0; i &lt; effectiveBatchSize; i += 1) {
          uploadNextFile();
        }
      },

      /**
       * With a file list from the file picker or drag and drop, add the files
       * to the collection
       * @param {Event} event The event that triggered this method
       */
      addFiles(event) {
        let fileList; // The list of chosen files

        event.stopPropagation();
        event.preventDefault();
        // handle drag and drop files
        if (event.originalEvent.dataTransfer) {
          fileList = event.originalEvent.dataTransfer.files;

          // handle file picker files
        } else if (event.target) {
          fileList = event.target.files;
        }
        this.$el.removeClass("droppable");

        // Find the correct collection to add to. Use JQuery's delegateTarget
        // attribute corresponding to the element where the event handler was attached
        if (event.delegateTarget.dataset.id) {
          this.parentSciMeta = this.getParentScienceMetadata(event);
          this.collection = this.getParentDataPackage(event);
          // Queue the files for upload
          const queueFilesPromise = new Promise((resolve) => {
            _.each(
              fileList,
              (file) => {
                let uploadStatus = "l";
                let errorMessage = "";

                if (!file.size) {
                  uploadStatus = "e";
                  errorMessage =
                    "This is an empty file. It won't be included in the dataset.";
                }

                const dataONEObject = new DataONEObject({
                  synced: true,
                  type: "Data",
                  fileName: file.name,
                  size: file.size,
                  mediaType: file.type,
                  uploadFile: file,
                  uploadStatus,
                  errorMessage,
                  isDocumentedBy: [this.parentSciMeta.id],
                  isDocumentedByModels: [this.parentSciMeta],
                  resourceMap: [this.collection.packageModel.id],
                });

                // Add it to the parent collection
                this.collection.add(dataONEObject);
              },
              this,
            );
            resolve();
          });

          queueFilesPromise.then(() => {
            // Call the batch upload method
            this.uploadFilesInBatch(
              this.collection.models,
              MetacatUI.appModel.get("batchSizeUpload"),
            );
          });
        }
      },

      /** Show the drop zone for this row in the table */
      showDropzone() {
        if (this.model.get("type") !== "Metadata") return;
        this.$el.addClass("droppable");
      },

      /**
       * Hide the drop zone for this row in the table
       * @param {Event} _event The event that triggered this method
       */
      hideDropzone(_event) {
        if (this.model.get("type") !== "Metadata") return;
        this.$el.removeClass("droppable");
      },

      /**
       * Handle the user's click of the Replace item in the DataItemView
       * dropdown. Triggers replaceFile after some basic validation.
       *
       * Called indirectly via the "click" event on elements with the class
       * .replaceFile. See this View's events map.
       * @param {MouseEvent} event Browser Click event
       */
      handleReplace(event) {
        event.stopPropagation();

        // Stop immediately if we know the user doesn't have privs
        if (!this.canWrite) {
          event.preventDefault();
          return;
        }

        const fileReplaceElement = $(event.target)
          .parents(".dropdown-menu")
          .children(".file-replace");

        if (!fileReplaceElement) {
          return;
        }

        fileReplaceElement.val("");
        fileReplaceElement.trigger("click");

        event.preventDefault();
      },

      /**
       * Replace a file (DataONEObject) in the collection with another one from
       * a file picker. Maintains attributes on the original DataONEObject and
       * maintains the entity information in the parent collection's metadata
       * record (i.e., keeps your attributes, etc.).
       *
       * Called indirectly via the "change" event on elements with the class
       * .file-upload. See this View's events map.
       *
       * The bulk of the work is done in a try-catch block to catch mistakes
       * that would cause the editor to get into a broken state. On error, we
       * attempt to return the editor back to its pre-replace state.
       * @param {Event} event Browser Click event
       */
      replaceFile(event) {
        event.stopPropagation();
        event.preventDefault();

        if (!this.canWrite) {
          return;
        }

        const fileList = event.target.files;

        // Pre-check fileList value to make sure we can work with it
        if (fileList.length !== 1) {
          // TODO: Show error, find out how to do this
          return;
        }

        if (!event.delegateTarget.dataset.id) {
          // TODO: Show error, find out how to do this
          return;
        }

        // Save uploadStatus for reverting if need to
        const oldUploadStatus = this.model.get("uploadStatus");

        const file = fileList[0];
        let uploadStatus = "q";
        let errorMessage = "";

        if (!file.size) {
          uploadStatus = "e";
          errorMessage =
            "This is an empty file. It won't be included in the dataset.";
        }

        if (!this.model) {
          throw new Error("No model to replace");
        }

        // Copy model attributes aside for reverting on error
        const newAttributes = {
          synced: false,
          fileName: file.name,
          size: file.size,
          mediaType: file.type,
          uploadFile: file,
          hasContentChanges: true,
          checksum: null,
          uploadStatus,
          sysMetaUploadStatus: "c", // I set this so DataPackage::save
          // wouldn't try to update the sysmeta after the update
          errorMessage,
        };

        // Save a copy of the attributes we're changing so we can revert
        // later if we encounter an exception
        const oldAttributes = {};
        _.each(
          Object.keys(newAttributes),
          (k) => {
            oldAttributes[k] = _.clone(this.model.get(k));
          },
          this,
        );

        oldAttributes.uploadStatus = oldUploadStatus;

        try {
          this.model.set(newAttributes);

          // Attempt the formatId. Defaults to app/octet-stream
          this.model.set("formatId", this.model.getFormatId());

          // Grab a reference to the entity in the EML for the object
          // we're replacing
          this.parentSciMeta = this.getParentScienceMetadata(event);
          let entity = null;

          if (this.parentSciMeta) {
            entity = this.parentSciMeta.getEntity(this.model);
          }

          // Eagerly update the PID for this object so we can update
          // the matching EML entity
          this.model.updateID();

          // Update the EML entity with the new id
          if (entity) {
            entity.set("xmlID", this.model.getXMLSafeID());
          }

          this.render();

          if (this.model.get("uploadFile") &amp;&amp; !this.model.get("checksum")) {
            try {
              this.model.calculateChecksum();
            } catch (exception) {
              // TODO: Fail gracefully here for the user
            }
          }

          MetacatUI.rootDataPackage.packageModel.set("changed", true);

          // Last, provided a visual indication the replace was completed
          const describeButton = this.$el
            .children(".controls")
            .children(".btn-group")
            .children("button.edit")
            .first();

          if (describeButton.length !== 1) {
            return;
          }

          const oldText = describeButton.html();

          describeButton.html('&lt;i class="icon icon-ok success" /> Replaced');

          const previousBtnClasses = describeButton.attr("class");
          describeButton.removeClass("warning error").addClass("message");

          window.setTimeout(() => {
            describeButton.html(oldText);
            describeButton.addClass(previousBtnClasses).removeClass("message");
          }, 3000);
        } catch (error) {
          // Revert changes to the attributes
          this.model.set(oldAttributes);
          this.model.set("formatId", this.model.getFormatId());
          this.model.set("sysMetaUploadStatus", "c"); // Prevents a sysmeta update
          this.model.resetID();

          this.render();
        }
      },

      /**
       * Handle remove events for this row in the data package table
       *  @param {Event} event The event that triggered this method
       */
      handleRemove(event) {
        let eventId; // The id of the row of this event
        const removalIds = []; // The list of target ids to remove
        let dataONEObject; // The model represented by this row
        let documents; // The list of ids documented by this row (if meta)

        event.stopPropagation();
        event.preventDefault();

        // Get the row id, add it to the remove list
        if (event.delegateTarget.dataset.id) {
          eventId = event.delegateTarget.dataset.id;
          removalIds.push(eventId);
        }

        this.parentSciMeta = this.getParentScienceMetadata(event);

        if (!this.parentSciMeta) {
          this.$(".status .icon, .status .progress")
            .tooltip("hide")
            .tooltip("destroy");

          // Remove the row
          this.remove();
          return;
        }

        this.collection = this.getParentDataPackage(event);

        // Get the corresponding model
        if (eventId) {
          dataONEObject = this.collection.get(eventId);
        }

        // Is it nested science metadata?
        if (dataONEObject &amp;&amp; dataONEObject.get("type") === "Metadata") {
          // We also remove the data documented by these metadata
          documents = dataONEObject.get("documents");

          if (documents.length > 0) {
            _.each(documents, removalIds.push());
          }
        }
        // Data objects may need to be removed from the EML model entities list
        else if (dataONEObject &amp;&amp; this.parentSciMeta.type === "EML") {
          const matchingEntity = this.parentSciMeta.getEntity(dataONEObject);

          if (matchingEntity) this.parentSciMeta.removeEntity(matchingEntity);
        }

        // Remove the id from the documents array in the science metadata
        _.each(
          removalIds,
          (id) => {
            const documentsId = this.parentSciMeta.get("documents");
            const index = documentsId.indexOf(id);
            if (index > -1) {
              this.parentSciMeta.get("documents").splice(index, 1);
            }
          },
          this,
        );

        // Remove each object from the collection
        this.collection.remove(removalIds);

        this.$(".status .icon, .status .progress")
          .tooltip("hide")
          .tooltip("destroy");

        // Remove the row
        this.remove();

        MetacatUI.rootDataPackage.packageModel.set("changed", true);
      },

      /**
       * Return the parent science metadata model associated with the data or
       * metadata row of the UI event
       * @param {Event} event The event that triggered this method
       * @returns {DataONEObject} The parent science metadata model
       */
      getParentScienceMetadata(event) {
        let eventModel; // The model associated with the event's table row
        let parentSciMeta; // The parent science metadata for the event model

        if (!event.delegateTarget.dataset.id) {
          // TODO: Handle this case
          return null;
        }

        // The models associated with the event's table row
        const eventModels = MetacatUI.rootDataPackage.where({
          id: event.delegateTarget.dataset.id,
        });

        if (eventModels.length) {
          [eventModel] = eventModels;
        } else {
          return null;
        }

        // Is this a Data or Metadata model?
        if (eventModel.get &amp;&amp; eventModel.get("type") === "Metadata") {
          return eventModel;
        }
        // The parent metadata array in the collection. It's data, get the
        // parent scimeta.
        const parentMetadata = MetacatUI.rootDataPackage.where({
          id: Array.isArray(eventModel.get("isDocumentedBy"))
            ? eventModel.get("isDocumentedBy")[0]
            : null,
        });

        if (parentMetadata.length > 0) {
          [parentSciMeta] = parentMetadata;
          return parentSciMeta;
        }
        // If there is only one metadata model in the root data package, then use that metadata model
        const metadataModels = MetacatUI.rootDataPackage.where({
          type: "Metadata",
        });

        if (metadataModels.length === 1) return metadataModels[0];

        return null;
      },

      /**
       * Return the parent data package collection associated with the data or
       * metadata row of the UI event
       * @param {Event} event The event that triggered this method
       * @returns {DataPackage} The parent data package collection
       */
      getParentDataPackage(event) {
        let parentSciMeta;
        let parentResourceMapId;

        if (event.delegateTarget.dataset.id) {
          parentSciMeta = this.getParentScienceMetadata(event);

          if (
            parentSciMeta.get &amp;&amp;
            parentSciMeta.get("resourceMap").length > 0
          ) {
            // TODO: Do we need to use parentResourceMaps here?
            // const parentResourceMaps = parentSciMeta.get("resourceMap");

            if (!MetacatUI.rootDataPackage.packageModel.get("latestVersion")) {
              // TODO: Decide how to handle this by calling model.findLatestVersion()
              // and listen for the result, setting getParentDataPackage() as the callback?
            } else {
              parentResourceMapId =
                MetacatUI.rootDataPackage.packageModel.get("latestVersion");
            }
          }

          // Is this the root package or a nested package?
          if (
            MetacatUI.rootDataPackage.packageModel.id === parentResourceMapId
          ) {
            return MetacatUI.rootDataPackage;

            // A nested package
          }
          return MetacatUI.rootDataPackage.where({
            id: parentResourceMapId,
          })[0];
        }

        return null;
      },

      /**
       * Removes invalid characters and formatting from the given input string
       * @param {string} input The string to clean
       * @returns {string} The cleaned string
       */
      cleanInput(input) {
        // 1. remove line breaks / Mso classes
        const stringStripper = /(\n|\r| class=(")?Mso[a-zA-Z]+(")?)/g;
        let output = input.replace(stringStripper, " ");

        // 2. strip Word generated HTML comments
        const commentSripper = /&lt;!--(.*?)-->/g;
        output = output.replace(commentSripper, "");
        let tagStripper = /&lt;(\/?)(meta|link|span|\?xml:|st1:|o:|font)(.*?)>/gi;

        // 3. remove tags leave content if any
        output = output.replace(tagStripper, "");

        // 4. Remove everything in between and including tags '&lt;style(.)style(.)>'
        const badTags = [
          "style",
          "script",
          "applet",
          "embed",
          "noframes",
          "noscript",
        ];

        for (let i = 0; i &lt; badTags.length; i += 1) {
          tagStripper = new RegExp(
            `&lt;${badTags[i]}.*?${badTags[i]}(.*?)>`,
            "gi",
          );
          output = output.replace(tagStripper, "");
        }

        // 5. remove attributes ' style="..."'
        const badAttributes = ["style", "start"];
        for (let i = 0; i &lt; badAttributes.length; i += 1) {
          const attributeStripper = new RegExp(
            ` ${badAttributes[i]}="(.*?)"`,
            "gi",
          );
          output = output.replace(attributeStripper, "");
        }

        output = EML.prototype.cleanXMLText(output);

        return output;
      },

      /**
       * Style this table row to indicate it will be removed
       */
      previewRemove() {
        this.$el.toggleClass("remove-preview");
      },

      /**
       * Clears the text in the cell if the text was the default. We add an
       * 'empty' class, and remove it when the user focuses back out.
       * @param {Event} _e - The event that triggered this function as a
       * callback
       */
      emptyName(_e) {
        const editableCell = this.$(".canRename [contenteditable]");

        editableCell.tooltip("hide");

        if (editableCell.text().indexOf("Untitled") > -1) {
          editableCell
            .attr("data-original-text", editableCell.text().trim())
            .text("")
            .addClass("empty")
            .on("focusout", () => {
              if (!editableCell.text())
                editableCell
                  .text(editableCell.attr("data-original-text"))
                  .removeClass("empty");
            });
        }
      },

      /**
       * Changes the access policy of a data object based on user input.
       * @param {Event} e - The event that triggered this function as a callback
       */
      changeAccessPolicy(e) {
        if (!e) return;

        const accessPolicy = this.model.get("accessPolicy");

        const makePublic = $(e.target).prop("checked");

        // If the user has chosen to make this object private
        if (!makePublic) {
          if (accessPolicy) {
            // Make the access policy private
            accessPolicy.makePrivate();
          } else {
            // Create an access policy from the default settings
            this.model.createAccessPolicy();
            // Make the access policy private
            this.model.get("accessPolicy").makePrivate();
          }
        } else if (accessPolicy) {
          // Make the access policy public
          accessPolicy.makePublic();
        } else {
          // Create an access policy from the default settings
          this.model.createAccessPolicy();
          // Make the access policy public
          this.model.get("accessPolicy").makePublic();
        }
      },

      /**
       * Shows form validation for this data item
       * @param {string} attr The modal attribute that has been validated
       * @param {string} _errorMsg The validation error message to display
       */
      showValidation(attr, _errorMsg) {
        // TODO - not implemented?
        // Find the element that is required
        this.$(`[data-category='${attr}']`).addClass("error");
        // TODO: add the error message to the element

        // When it is updated, remove the error styling
        this.listenToOnce(this.model, `change:${attr}`, this.hideRequired);
      },

      /**
       * Show an error, e.g. if the file can't be fetched
       * @param {string} message The error message to display
       * @since 2.32.1
       */
      showError(message) {
        this.$el.removeClass("loading");
        const nameColumn = this.$(".name");
        nameColumn.addClass("error");
        // Append an error message
        this.errorEl = $(document.createElement("div"))
          .addClass("error-message")
          .text(`There was an error: ${message}`);
        nameColumn.append(this.errorEl);
        const icon = this.$(".type-icon");
        icon.addClass("error");
      },

      /** Hides the 'required' styling from this view */
      hideRequired() {
        // Remove the error styling
        this.$("[contenteditable].error").removeClass("error");
      },

      /** Show the data item as saving */
      showSaving() {
        this.$(".controls button").prop("disabled", true);

        if (this.model.get("type") !== "Metadata")
          this.$(".controls").prepend(
            $(document.createElement("div")).addClass("disable-layer"),
          );

        this.$(".canRename > div").prop("contenteditable", false);
      },

      /** Hides the styles applied in {@link DataItemView#showSaving} */
      hideSaving() {
        this.$(".controls button").prop("disabled", false);
        this.$(".disable-layer").remove();

        // Make the name cell editable again
        this.$(".canRename > div").prop("contenteditable", true);

        this.$el.removeClass("error-saving");
      },

      /**
       * Show or hide the saving icon and progress bar based on the uploadStatus
       * of the model
       */
      toggleSaving() {
        if (
          this.model.get("uploadStatus") === "p" ||
          this.model.get("uploadStatus") === "l" ||
          (this.model.get("uploadStatus") === "e" &amp;&amp;
            this.model.get("type") !== "Metadata") ||
          MetacatUI.rootDataPackage.packageModel.get("uploadStatus") === "p"
        )
          this.showSaving();
        else this.hideSaving();

        if (this.model.get("uploadStatus") === "e")
          this.$el.addClass("error-saving");
      },

      /** Shows the current progress of the file upload */
      showUploadProgress() {
        if (this.model.get("numSaveAttempts") > 0) {
          this.$(".progress .bar").css("width", "100%");
        } else {
          this.$(".progress .bar").css(
            "width",
            `${this.model.get("uploadProgress")}%`,
          );
        }
      },

      /**
       * Determine whether this item can be shared
       *
       * Used to control whether the Share button in the template is enabled or
       * not.
       *
       * Has special behavior depending on whether the item is metadata or not.
       * If metadata (ie type is EML), also checks that the resource map can be
       * shared. Otherwise, only checks if the data item can be shared.
       * @returns {boolean} Whether the item can be shared
       * @since 2.15.0
       */
      canShareItem() {
        if (this.parentEditorView) {
          if (this.parentEditorView.isAccessPolicyEditEnabled()) {
            if (this.model.type === "EML") {
              // Check whether we can share the resource map
              const pkgModel = MetacatUI.rootDataPackage.packageModel;
              const pkgAccessPolicy = pkgModel.get("accessPolicy");

              const canShareResourceMap =
                pkgModel.isNew() ||
                (pkgAccessPolicy &amp;&amp;
                  pkgAccessPolicy.isAuthorized("changePermission"));

              // Check whether we can share the metadata
              const modelAccessPolicy = this.model.get("accessPolicy");
              const canShareMetadata =
                this.model.isNew() ||
                (modelAccessPolicy &amp;&amp;
                  modelAccessPolicy.isAuthorized("changePermission"));

              // Only return true if we can share both
              return canShareMetadata &amp;&amp; canShareResourceMap;
            }
            return (
              this.model.get("accessPolicy") &amp;&amp;
              this.model.get("accessPolicy").isAuthorized("changePermission")
            );
          }
        }
        return null;
      },

      downloadFile(e) {
        this.downloadButtonView.download(e);
      },

      // Member row metrics for the package table
      // Retrieving information from the Metrics Model's result details
      getMemberRowMetrics(id) {
        let reads = 0;
        const metricsResultDetails = this.metricsModel?.get("resultDetails");
        if (metricsResultDetails) {
          const metricsPackageDetails =
            metricsResultDetails.metrics_package_counts;
          const objectLevelMetrics = metricsPackageDetails[id];
          if (objectLevelMetrics) {
            if (this.isMetadata) {
              reads = objectLevelMetrics.viewCount;
            } else {
              reads = objectLevelMetrics.downloadCount;
            }
          }
        }

        if (reads) {
          // giving labels
          if (this.isMetadata &amp;&amp; reads === 1) reads += " view";
          else if (this.isMetadata) reads += " views";
          else if (reads === 1) reads += " download";
          else reads += " downloads";
        } else {
          // returning an empty string if the metrics are 0
          reads = "";
        }

        return reads;
      },
    },
  );

  return DataItemView;
});
</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
