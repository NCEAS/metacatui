(function(d1Utilities,undefined){d1Utilities.toggleElement=function(button,element,open){try{if(element!==null&&button!==null){button.setAttribute("aria-expanded",!open);element.setAttribute("aria-hidden",open);}}catch(e){console.log("Error toggling the search");console.log(e);}};d1Utilities.throttle=function throttle(fn,wait){var time=Date.now();return function(){if((time+wait-Date.now())<0){fn();time=Date.now();}}};d1Utilities.isMobile=function(){var mobileDesktopBreakpoint=699||700;var winWidth=window.innerWidth||document.documentElement.clientWidth;if(winWidth<mobileDesktopBreakpoint){return true}else{return false}};}(window.d1Utilities=window.d1Utilities||{}));try{(function(d1_globalHeader,undefined){var block=d1_globalHeader;const
urlMCUI="https://search.dataone.org",baseUrl="https://preview.dataone.org",iframeId="tempIframeId",inIframe=(function(){try{return window.self!==window.top;}catch(e){return true}})(),referrerIsWebsite=document.referrer?new URL(document.referrer).origin.replace(/\/$/,"")===baseUrl.replace(/\/$/,""):true,inWebsiteIframe=inIframe&&referrerIsWebsite,isMCUI=typeof MetacatUI!=='undefined',subLinkTextSelector=".d1_menu-item__sub-item-name";var lastScroll=0,closeDropdownTimeout=0;block.initialize=function(){if(inWebsiteIframe&&isMCUI){window.parent.postMessage(JSON.stringify(extractUserData(MetacatUI)),baseUrl);return}
selectElements();setListeners();if(getUserData()){updateProfileMenu()}
if(isMCUI){saveUserData(extractUserData(MetacatUI));updateProfileMenu();}else{window.removeEventListener('message',receiveMessage,false);window.addEventListener('message',receiveMessage,false);addIframe();}}
const selectElements=function(){block.menuButton=document.getElementById("global-menu-toggle");block.menu=document.getElementById("global-menu");block.header=document.getElementById("nav");block.signin=document.querySelector(".d1_menu-item--sign-in");block.profile=document.querySelector(".d1_menu-item--profile");block.profileText=block.profile.querySelector(".d1_menu-item__top-item-name");block.profileTerm=block.profileText.innerHTML;block.dropdownEls=[];document.querySelectorAll(".d1_menu-item--dropdown").forEach((container,i)=>{d1_globalHeader.dropdownEls[i]={container:container,button:container.querySelector("button"),submenu:container.querySelector(".d1_menu-item__sub-menu")}});block.profileLinkEls=[];block.profile.querySelectorAll("a").forEach((link,i)=>{const textEl=link.querySelector(subLinkTextSelector);block.profileLinkEls[i]={el:link,textEl:textEl,originalHref:link.getAttribute("href"),originalDisplay:link.style.display}});}
const addIframe=function(){const iframe=document.createElement('iframe');iframe.setAttribute('src',urlMCUI+"/about");iframe.setAttribute('id',iframeId);iframe.style.display='none';iframe.style.width=0+'px';iframe.style.height=0+'px';document.body.appendChild(iframe);}
const receiveMessage=function(e){if(e.origin!==urlMCUI){return}
saveUserData(e.data);updateProfileMenu();}
const extractUserData=function(MetacatUI){return{loggedin:MetacatUI.appUserModel.get("loggedIn"),username:MetacatUI.appUserModel.get('username'),name:MetacatUI.appUserModel.get('fullName')?MetacatUI.appUserModel.get('fullName').charAt(0).toUpperCase()+MetacatUI.appUserModel.get("fullName").substring(1):MetacatUI.appUserModel.get("username"),showPortals:MetacatUI.appModel.get("showMyPortals")!==false&&MetacatUI.appModel.get("enableUserProfiles")&&MetacatUI.appModel.get("enableUserProfileSettings")}}
const getUserData=function(){const storedData=localStorage.getItem("metacatuiData");if(storedData){return JSON.parse(storedData);}else{return false}}
const saveUserData=function(data){if(data){if(!(typeof data==='string'||data instanceof String)){data=JSON.stringify(data)}
localStorage.setItem("metacatuiData",data);}}
const resetProfileMenu=function(){block.profileText.innerHTML=block.profileTerm;showMenu(block.signin);hideMenu(block.profile);if(!block.profileLinkEls){return}
block.profileLinkEls.forEach((link,i)=>{link.el.href=link.originalHref;link.el.style.display=link.originalDisplay;});}
const updateProfileMenu=function(){if(!block.profile){console.warn("Couldn't update profile menu in the navigation bar because the menu element was missing.");return}
resetProfileMenu();const data=getUserData();if(!data){console.warn("Couldn't update profile menu in the navigation bar because the user data was missing.");return}
if(data.loggedin){if(data.name){block.profileText.innerHTML=data.name}
showMenu(block.profile);hideMenu(block.signin);block.profileLinkEls.forEach((link,i)=>{link.el.href=link.el.href.replace(/^.*?SEARCH/,urlMCUI).replace(/USERNAME/,data.username);if(link.el.title.toLowerCase()==="my profile"){if(!data.showPortals){link.el.display="none"}}});}}
const showMenu=function(menuEl){if(!menuEl)return;menuEl.style.display="block";}
const hideMenu=function(menuEl){if(!menuEl)return;menuEl.style.display="none";}
const closeAllDropdowns=function(){if(block.dropdownEls){block.dropdownEls.forEach(els=>{d1Utilities.toggleElement(els.button,els.submenu,true);});}}
const startCloseTimeout=function(){closeDropdownTimeout=setTimeout(()=>closeAllDropdowns(),70);};const stopCloseTimeout=function(){clearTimeout(closeDropdownTimeout);};const dropdownMouseenter=function(els){if(!d1Utilities.isMobile()){stopCloseTimeout();closeAllDropdowns();d1Utilities.toggleElement(els.button,els.submenu,false);}}
const dropdownMouseleave=function(){if(!d1Utilities.isMobile()){startCloseTimeout()}}
const dropdownClick=function(els){if(d1Utilities.isMobile()){var open=JSON.parse(els.button.getAttribute("aria-expanded"));closeAllDropdowns();d1Utilities.toggleElement(els.button,els.submenu,open);}}
const menuButtonClick=function(){if(d1Utilities.isMobile()){var open=JSON.parse(block.menuButton.getAttribute("aria-expanded"));d1Utilities.toggleElement(block.menuButton,block.menu,open);closeAllDropdowns();}};block.toggleHeader=function(){if(!block.header||!d1Utilities.isMobile()){return}
const currentScroll=window.pageYOffset;var currentScrollPos=window.pageYOffset;if(currentScroll==0){block.header.style.bottom="0";return}
if(currentScroll>lastScroll){block.header.style.bottom="-63px";d1Utilities.toggleElement(block.menuButton,block.menu,true);}else if(currentScroll<lastScroll){block.header.style.bottom="0";}
lastScroll=currentScrollPos;}
const setListeners=function(){window.removeEventListener("load",function(e){if(!d1Utilities.isMobile()){d1Utilities.toggleElement(block.menuButton,block.menu,false)}},false);window.addEventListener("load",function(e){if(!d1Utilities.isMobile()){d1Utilities.toggleElement(block.menuButton,block.menu,false)}},false);window.addEventListener("scroll",d1Utilities.throttle(block.toggleHeader,100));block.dropdownEls.forEach(els=>{els.container.removeEventListener("mouseenter",function(){dropdownMouseenter(els)},false);els.container.addEventListener("mouseenter",function(){dropdownMouseenter(els)},false);els.container.removeEventListener("mouseleave",function(){dropdownMouseleave(els)},false);els.container.addEventListener("mouseleave",function(){dropdownMouseleave(els)},false);els.container.removeEventListener("click",function(){dropdownClick(els)},false);els.container.addEventListener("click",function(){dropdownClick(els)},false);});if(block.menu!==null&&block.menuButton!==null){block.menuButton.removeEventListener("click",menuButtonClick);block.menuButton.addEventListener("click",menuButtonClick);}}}(window.d1_globalHeader=window.d1_globalHeader||{}));}catch(e){console.log('error in: themes/dataone/layouts/partials/blocks/nav/nav.js, error message:'+e)}