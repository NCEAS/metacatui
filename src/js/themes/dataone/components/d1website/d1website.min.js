(function(e){const n=e;n.toggleElement=function(e,t,n){try{t!==null&&e!==null&&(e.setAttribute("aria-expanded",!n),t.setAttribute("aria-hidden",n))}catch(e){console.log("Error toggling the search"),console.log(e)}},n.throttle=function(t,n){var s=Date.now();return function(){s+n-Date.now()<0&&(t(),s=Date.now())}},n.isMobile=function(){var e=699||700,t=window.innerWidth||document.documentElement.clientWidth;return t<e},n.isSafari=function(){return navigator.userAgent.search("Safari")>=0&&navigator.userAgent.search("Chrome")<0}})(window.d1Utilities=window.d1Utilities||{});try{var toggleCalendarMenu=function(e){if(e){var t=JSON.parse(e.getAttribute("aria-expanded"));menuEl=e.parentNode.querySelector("#calendar-menu"),d1Utilities.toggleElement(e,menuEl,t)}}}catch(e){console.log("error in: themes/dataone/layouts/partials/blocks/button/button--add2cal.js, error message:"+e)}try{(function(e){n=e;const F="https://cn.dataone.org/portal/token",v=typeof MetacatUI!="undefined",f="https://search.dataone.org",z="https://dataone.org",M=".d1_menu-item__sub-item-name",i=".d1_menu-item--profile",S=".d1_menu-item--sign-in",E=i+" .d1_menu-item__top-item-name",C=".d1_menu-item a",x=".d1_menu-item--dropdown",O=".d1_menu-item__sub-menu";var n,a=0,p=0;n.initialize=function(){_(),T(),o()&&r(),v?j():y()};const _=function(){n.menuButton=document.getElementById("global-menu-toggle"),n.menu=document.getElementById("global-menu"),n.header=document.getElementById("nav"),n.signin=document.querySelectorAll(S),n.profile=document.querySelectorAll(i),n.profileText=document.querySelectorAll(E),n.profileTerm=n.profileText[0].innerHTML,n.allMenuLinks=[],document.querySelectorAll(C).forEach((e,t)=>{n.allMenuLinks[t]={el:e}}),n.dropdownEls=[],document.querySelectorAll(x).forEach((e,t)=>{n.dropdownEls[t]={container:e,button:e.querySelector("button"),submenu:e.querySelector(O)}}),n.profileLinkEls=[],document.querySelectorAll(i+" a").forEach((e,t)=>{const s=e.querySelector(M);n.profileLinkEls[t]={el:e,textEl:s,originalHref:e.getAttribute("href"),originalDisplay:e.style.display}})},y=function(){fetch(F,{method:"GET",dataType:"text",credentials:"include"}).then(function(e){e.text().then(function(e){var t;if(e){const n=b(e);t={loggedin:!0,username:n.fullName,userId:n.userId||n.sub}}else t={loggedin:!1,username:"",userId:""};o()!=t&&(g(t),r())})}).catch(function(e){console.log("error fetching user data, error message:"),console.log(e)})},b=function(e){try{if(typeof e=="undefined")return"";var t=new KJUR.jws.JWS,n=0;try{n=t.parseJWS(e)}catch{n=0}return t.parsedJWS?JSON.parse(t.parsedJWS.payloadS):""}catch(e){console.log("Error parsing token, error message: "),console.log(e)}},j=function(){n.allMenuLinks.forEach((e)=>{e.el.href=e.el.href.replace(f,"")}),userData={loggedin:MetacatUI.appUserModel.get("loggedIn"),username:MetacatUI.appUserModel.get("fullName")?MetacatUI.appUserModel.get("fullName").charAt(0).toUpperCase()+MetacatUI.appUserModel.get("fullName").substring(1):MetacatUI.appUserModel.get("username"),userId:MetacatUI.appUserModel.get("username")},o()!=userData&&(g(userData),r())},o=function(){const e=localStorage.getItem("userData");return!!e&&JSON.parse(e)},g=function(e){e&&(typeof e=="string"||e instanceof String||(e=JSON.stringify(e)),localStorage.setItem("userData",e))},w=function(){if(n.profileText.forEach((e)=>{e.innerHTML=n.profileTerm}),n.signin.forEach((e)=>{h(e)}),n.profile.forEach((e)=>{c(e)}),!n.profileLinkEls)return;n.profileLinkEls.forEach((e)=>{e.el.href=e.originalHref,e.el.style.display=e.originalDisplay})},r=function(){if(!n.profile){console.warn("Couldn't update profile menu in the navigation bar because the menu element was missing.");return}w();const e=o();if(!e){console.warn("Couldn't update profile menu in the navigation bar because the user data was missing.");return}e.loggedin&&(e.username&&n.profileText.forEach((t)=>{t.innerHTML=e.username}),n.signin.forEach((e)=>{c(e)}),n.profile.forEach((e)=>{h(e)}),n.profileLinkEls.forEach((t)=>{const s=v?"":f;t.el.href=t.el.href.replace(/USERNAME/,e.userId).replace(/^.*?SEARCH/,s)}))},h=function(e){if(!e)return;e.style.display="block"},c=function(e){if(!e)return;e.style.display="none"},s=function(){n.dropdownEls&&n.dropdownEls.forEach(e=>{d1Utilities.toggleElement(e.button,e.submenu,!0)})},k=function(){p=setTimeout(()=>s(),70)},A=function(){clearTimeout(p)},l=function(e){d1Utilities.isMobile()||(A(),s(),d1Utilities.toggleElement(e.button,e.submenu,!1))},u=function(){d1Utilities.isMobile()||k()},d=function(e){if(d1Utilities.isMobile()){var t=JSON.parse(e.button.getAttribute("aria-expanded"));s(),d1Utilities.toggleElement(e.button,e.submenu,t)}},m=function(){if(d1Utilities.isMobile()){var e=JSON.parse(n.menuButton.getAttribute("aria-expanded"));d1Utilities.toggleElement(n.menuButton,n.menu,e),s()}};n.toggleHeader=function(){if(!n.header||!d1Utilities.isMobile())return;const e=window.pageYOffset;var t=window.pageYOffset;if(e==0){n.header.style.bottom="0";return}e>a?(n.header.style.bottom="-63px",d1Utilities.toggleElement(n.menuButton,n.menu,!0)):e<a&&(n.header.style.bottom="0"),a=t};const T=function(){window.removeEventListener("load",function(){d1Utilities.isMobile()||d1Utilities.toggleElement(n.menuButton,n.menu,!1)},!1),window.addEventListener("load",function(){d1Utilities.isMobile()||d1Utilities.toggleElement(n.menuButton,n.menu,!1)},!1),window.addEventListener("scroll",d1Utilities.throttle(n.toggleHeader,100)),n.dropdownEls.forEach(e=>{e.container.removeEventListener("mouseenter",function(){l(e)},!1),e.container.addEventListener("mouseenter",function(){l(e)},!1),e.container.removeEventListener("mouseleave",function(){u(e)},!1),e.container.addEventListener("mouseleave",function(){u(e)},!1),e.container.removeEventListener("click",function(){d(e)},!1),e.container.addEventListener("click",function(){d(e)},!1)}),n.menu!==null&&n.menuButton!==null&&(n.menuButton.removeEventListener("click",m),n.menuButton.addEventListener("click",m))}})(window.d1_globalHeader=window.d1_globalHeader||{})}catch(e){console.log("error in: themes/dataone/layouts/partials/blocks/nav/nav.js, error message:"+e)}